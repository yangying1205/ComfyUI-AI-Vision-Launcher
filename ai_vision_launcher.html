<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIè§†ç•Œå¯åŠ¨å™¨</title>
    <!-- Font Awesome å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- ç‰ˆæœ¬ç®¡ç†ä¼˜åŒ–è„šæœ¬ -->
    <script src="version-management-optimized.js" defer></script>
    <script src="version-management-integration.js" defer></script>
    <!-- ä½¿ç”¨æœ¬åœ°å­—ä½“ï¼Œé¿å…å¤–éƒ¨CDNä¾èµ– -->
    <style>
        /* å†…åµŒFont Awesomeå›¾æ ‡æ ·å¼ */
        .fa, .fas, .far, .fal, .fab {
            font-family: 'Font Awesome 6 Free', 'Font Awesome 6 Pro', sans-serif;
            font-weight: 900;
        }
        /* å¦‚æœæ²¡æœ‰Font Awesomeï¼Œä½¿ç”¨Unicodeç¬¦å·ä½œä¸ºå¤‡ç”¨ */
        .fa-play:before { content: 'â–¶'; }
        .fa-stop:before { content: 'â¹'; }
        .fa-pause:before { content: 'â¸'; }
        .fa-refresh:before { content: 'ğŸ”„'; }
        .fa-download:before { content: 'â¬‡'; }
        .fa-upload:before { content: 'â¬†'; }
        .fa-cog:before { content: 'âš™'; }
        .fa-home:before { content: 'ğŸ '; }
        .fa-folder:before { content: 'ğŸ“'; }
        .fa-file:before { content: 'ğŸ“„'; }
        .fa-check:before { content: 'âœ“'; }
        .fa-times:before { content: 'âœ•'; }
        .fa-plus:before { content: '+'; }
        .fa-minus:before { content: '-'; }
        .fa-search:before { content: 'ğŸ”'; }
        .fa-star:before { content: 'â­'; }
        .fa-heart:before { content: 'â¤'; }
        .fa-info:before { content: 'â„¹'; }
        .fa-warning:before { content: 'âš '; }
        .fa-error:before { content: 'âŒ'; }
        /* æ’ä»¶ç®¡ç†æŒ‰é’®å›¾æ ‡ */
        .fa-external-link-alt:before { content: 'ğŸ”—'; }
        .fa-trash:before { content: 'ğŸ—‘'; }
        .fa-code-branch:before { content: 'ğŸ”€'; }
        .fa-sync-alt:before { content: 'ğŸ”„'; }
        .fa-spinner:before { content: 'âŸ³'; }
        .fa-rocket:before { content: 'ğŸš€'; }
        .fa-puzzle-piece:before { content: 'ğŸ§©'; }
        .fa-exclamation-triangle:before { content: 'âš '; }
        .fa-info-circle:before { content: 'â„¹'; }
        .fa-check-circle:before { content: 'âœ“'; }
        .fa-lightbulb:before { content: 'ğŸ’¡'; }
        .fa-eraser:before { content: 'ğŸ§¹'; }
        .fa-history:before { content: 'ğŸ“œ'; }

        /* ç‰ˆæœ¬ç®¡ç†ä¼˜åŒ–æ ·å¼ */
        .version-loading-content {
            text-align: center;
            padding: 30px 20px;
            color: var(--text-primary);
        }

        .loading-spinner-modern {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 245, 255, 0.2);
            border-top: 3px solid var(--neon-glow);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .loading-progress-modern {
            width: 100%;
            max-width: 300px;
            height: 4px;
            background: rgba(0, 245, 255, 0.1);
            border-radius: 2px;
            margin: 15px auto;
            overflow: hidden;
        }

        .progress-bar-modern {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-glow), #00ff88);
            border-radius: 2px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .loading-text {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .loading-status-modern {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        .version-error-content {
            text-align: center;
            padding: 30px 20px;
            color: #ff4757;
        }

        .version-error-content i {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .error-detail {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 10px 0;
        }

        .retry-btn {
            background: linear-gradient(135deg, #ff4757, #ff3742);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 71, 87, 0.3);
        }

        .version-item {
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .version-item.current {
            border-left-color: var(--neon-glow);
            background: rgba(0, 245, 255, 0.05);
        }

        .version-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .current-icon {
            color: var(--neon-glow);
            font-size: 1rem;
        }

        .version-type-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .version-type-badge.stable {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .version-type-badge.development {
            background: rgba(255, 102, 0, 0.2);
            color: #ff6600;
            border: 1px solid rgba(255, 102, 0, 0.3);
        }

        .version-switch-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .fa-clock:before { content: 'ğŸ•'; }
    </style>
    <!-- éŸ³æ•ˆç®¡ç†å™¨ -->
    <script src="assets/sounds/audio-manager.js"></script>

    <!-- ä¾¿æºåŒ…å¯åŠ¨å™¨æ€§èƒ½ä¼˜åŒ– -->
    <script src="emergency-performance-fix.js"></script>

    <!-- å‰ç«¯é€Ÿåº¦ä¿®å¤ -->
    <script src="frontend-speed-fix.js"></script>
    <style>
        :root {
            --primary-bg: #0a0a0f;
            --secondary-bg: #1a1a2e;
            --accent-cyan: #00f5ff;
            --accent-blue: #0066ff;
            --neon-glow: #00ffff;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --border-glow: #00f5ff;
            --card-bg: rgba(26, 26, 46, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', 'Consolas', monospace;
            background: var(--primary-bg);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* é˜²æ­¢æ°´å¹³æ»šåŠ¨æ¡å’Œå†…åµŒæ»šåŠ¨æ¡ */
        * {
            box-sizing: border-box;
        }

        .page-content, .plugin-management-container, .plugin-content {
            overflow-x: hidden !important;
        }

        /* å¼ºåˆ¶é˜²æ­¢æ’ä»¶é¡µé¢å‡ºç°å†…åµŒæ»šåŠ¨æ¡ */
        #available-plugin-list, #installed-plugin-list {
            overflow: visible !important;
            max-height: none !important;
            height: auto !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        /* ç¡®ä¿æ’ä»¶ç®¡ç†é¡µé¢å®¹å™¨ä¸ä¼šäº§ç”Ÿæ»šåŠ¨æ¡ */
        .plugin-management-page, .installed-plugins, .available-plugins {
            overflow: visible !important;
        }

        /* æ’ä»¶åˆ—è¡¨å®¹å™¨ - é˜²æ­¢å†…åµŒæ»šåŠ¨æ¡ */
        .plugin-list {
            overflow: visible !important;
            max-height: none !important;
            height: auto !important;
        }

        /* ä¸»å®¹å™¨ - ç«–ç‰ˆæ¯”ä¾‹ */
        .launcher-container {
            width: 600px;
            height: 900px;
            background: var(--card-bg);
            border: 2px solid var(--border-glow);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
            box-shadow:
                0 0 30px rgba(0, 245, 255, 0.3),
                0 0 60px rgba(0, 245, 255, 0.1),
                inset 0 0 30px rgba(0, 245, 255, 0.05);
        }

        /* èƒŒæ™¯å®¹å™¨ */
        .background-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            border-radius: 18px;
            overflow: hidden;
        }

        .background-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(1.0) contrast(1.1);
            transition: all 0.5s ease;
        }

        .background-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(1.0) contrast(1.1);
            transition: all 0.5s ease;
            display: none;
        }

        .background-image.dimmed {
            filter: brightness(0.15) contrast(1.2);
            opacity: 0.6;
        }

        .background-video.dimmed {
            filter: brightness(0.15) contrast(1.2);
            opacity: 0.6;
        }

        .background-overlay {
            display: none;
        }

        /* å†…å®¹å±‚ */
        .content-layer {
            position: relative;
            z-index: 10;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 25px;
        }

        /* é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ */
        .header-section {
            text-align: center;
            margin-bottom: 25px;
        }

        .app-title {
            font-family: 'Rajdhani', sans-serif;
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--neon-glow);
            text-shadow:
                0 0 10px #00BFFF,
                0 0 20px #0080FF,
                0 0 30px #004FFF,
                0 0 40px #002FFF,
                1px 1px 3px rgba(0, 0, 0, 0.8);
            letter-spacing: 3px;
            margin-bottom: 8px;
        }

        .app-subtitle {
            font-family: 'Exo 2', sans-serif;
            font-size: 1rem;
            color: var(--neon-glow);
            font-weight: 300;
            letter-spacing: 2px;
            text-shadow:
                0 0 6px #00BFFF,
                0 0 12px #0080FF,
                0 0 18px #004FFF,
                1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        /* åŠŸèƒ½å¯¼èˆªæ ‡ç­¾ */
        .navigation-tabs {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            gap: 8px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px 8px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--neon-glow);
            font-family: 'Exo 2', sans-serif;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-shadow:
                0 0 8px var(--neon-glow),
                0 0 16px var(--neon-glow),
                2px 2px 6px rgba(0, 0, 0, 0.9);
        }

        .tab-btn:hover {
            color: #FFFFFF;
            text-shadow:
                0 0 2px #6A5ACD,
                0 0 4px #6A5ACD,
                0 0 8px #6A5ACD,
                0 0 12px #6A5ACD,
                1px 1px 3px rgba(0, 0, 0, 1),
                -1px -1px 3px rgba(0, 0, 0, 1),
                1px -1px 3px rgba(0, 0, 0, 1),
                -1px 1px 3px rgba(0, 0, 0, 1);
        }

        .tab-btn.active {
            color: #FFFFFF;
            text-shadow:
                0 0 3px #6A5ACD,
                0 0 6px #6A5ACD,
                0 0 12px #6A5ACD,
                0 0 18px #6A5ACD,
                1px 1px 4px rgba(0, 0, 0, 1),
                -1px -1px 4px rgba(0, 0, 0, 1),
                1px -1px 4px rgba(0, 0, 0, 1),
                -1px 1px 4px rgba(0, 0, 0, 1);
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
            min-height: 0;
            width: 100%;
            height: 100%;
        }

        .main-home {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            gap: 30px;
            position: relative;
            z-index: 50;
        }

        /* å½“æ’ä»¶ç®¡ç†é¡µé¢æ¿€æ´»æ—¶ï¼Œéšè—ä¸»é¡µ */
        .main-home.hidden {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            z-index: 1 !important;
        }

        /* å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ */
        .upload-section {
            position: absolute;
            top: 25px;
            right: 25px;
            z-index: 20;
        }

        .upload-btn {
            background: transparent;
            border: 1px solid transparent;
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            text-shadow:
                0 0 8px rgba(255, 255, 255, 0.6),
                0 0 16px rgba(255, 255, 255, 0.4),
                2px 2px 6px rgba(0, 0, 0, 0.9);
            margin-right: 8px;
        }

        .upload-btn:hover {
            color: var(--neon-glow);
            text-shadow:
                0 0 12px var(--neon-glow),
                0 0 24px var(--neon-glow),
                2px 2px 8px rgba(0, 0, 0, 0.9);
        }



        /* é…ç½®ä¿¡æ¯å¡ç‰‡ */
        .info-card {
            background: rgba(0, 245, 255, 0.08);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(15px);
        }

        .info-card h3 {
            color: var(--neon-glow);
            font-size: 1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }

        .info-label {
            color: var(--text-secondary);
        }

        .info-value {
            color: var(--neon-glow);
            font-weight: 500;
        }

        /* åŠŸèƒ½å†…å®¹åŒºåŸŸ - ä¼˜åŒ–æ€§èƒ½ */
        .tab-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.95);
            padding: 30px;
            overflow-y: auto;
            display: none;
            z-index: 100;
            border-radius: 18px;
            /* ç§»é™¤backdrop-filterä»¥æé«˜æ€§èƒ½ */
        }

        .tab-content.active {
            display: block !important;
            z-index: 200 !important;
        }

        /* æ’ä»¶ç®¡ç†é¡µé¢ä½¿ç”¨é€šç”¨æ ·å¼ï¼Œä¸éœ€è¦ç‰¹æ®Šè¦†ç›– */

        /* ç®€åŒ–çš„æ’ä»¶ç®¡ç†å¸ƒå±€ */
        .plugin-management-simple {
            width: 100% !important;
            height: 100% !important;
            color: white !important;
        }

        .plugin-header-simple {
            display: flex !important;
            align-items: center !important;
            margin-bottom: 25px !important;
            padding-bottom: 15px !important;
            border-bottom: 1px solid #333 !important;
        }

        .plugin-header-simple h2 {
            color: #00f5ff !important;
            margin: 0 !important;
            font-size: 24px !important;
        }

        .plugin-header-simple i {
            color: #00f5ff !important;
            font-size: 24px !important;
            margin-right: 15px !important;
        }

        .plugin-count {
            margin-left: auto !important;
            color: #ccc !important;
            font-size: 14px !important;
        }

        .plugin-content-simple {
            background: rgba(0, 245, 255, 0.1) !important;
            border: 1px solid #00f5ff !important;
            border-radius: 8px !important;
            padding: 20px !important;
            margin-bottom: 20px !important;
        }

        .plugin-content-simple h3 {
            color: #00f5ff !important;
            margin: 0 0 15px 0 !important;
            font-size: 18px !important;
        }

        .plugin-items-container {
            /* ç§»é™¤å›ºå®šé«˜åº¦é™åˆ¶ï¼Œä½¿ç”¨è‡ªç„¶é«˜åº¦ */
            overflow: visible !important;
        }

        .plugin-item-simple {
            background: rgba(255,255,255,0.05) !important;
            padding: 15px !important;
            margin: 10px 0 !important;
            border-radius: 8px !important;
            border-left: 3px solid #00f5ff !important;
        }

        .plugin-item-header {
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            flex-wrap: wrap !important;
        }

        .plugin-info-simple {
            flex: 1 !important;
            min-width: 300px !important;
        }

        .plugin-name-simple {
            color: #00f5ff !important;
            font-size: 16px !important;
            font-weight: bold !important;
            margin-bottom: 8px !important;
        }

        .plugin-status {
            margin-left: 15px !important;
            font-size: 14px !important;
        }

        .plugin-status.enabled {
            color: #28a745 !important;
        }

        .plugin-status.disabled {
            color: #dc3545 !important;
        }

        .plugin-details {
            color: #ccc !important;
            font-size: 12px !important;
            margin-bottom: 5px !important;
        }

        .plugin-description {
            color: #999 !important;
            font-size: 11px !important;
        }

        .plugin-actions-simple {
            display: flex !important;
            gap: 8px !important;
            flex-wrap: wrap !important;
            margin-top: 10px !important;
        }

        .plugin-btn-simple {
            padding: 6px 12px !important;
            border: none !important;
            border-radius: 4px !important;
            cursor: pointer !important;
            font-size: 12px !important;
            color: white !important;
        }

        .plugin-btn-simple.home { background: #007bff !important; }
        .plugin-btn-simple.update { background: #28a745 !important; }
        .plugin-btn-simple.switch { background: #6c757d !important; }
        .plugin-btn-simple.toggle { background: #ffc107 !important; color: black !important; }
        .plugin-btn-simple.uninstall { background: #dc3545 !important; }

        .plugin-footer {
            text-align: center !important;
            color: #666 !important;
            padding: 20px !important;
            border-top: 1px solid #333 !important;
            font-size: 12px !important;
        }


        /* åº•éƒ¨å¯åŠ¨æŒ‰é’®åŒºåŸŸ */
        .launch-section {
            margin-top: auto;
            padding-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .launch-btn {
            width: 90%;
            min-width: 400px;
            padding: 18px 30px;
            font-size: 1.3rem;
            font-weight: bold;
            background: linear-gradient(45deg, var(--accent-cyan), var(--accent-blue));
            border: 2px solid var(--neon-glow);
            border-radius: 12px;
            color: #000;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow:
                0 0 20px rgba(0, 245, 255, 0.4),
                0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .launch-btn:hover {
            transform: translateY(-2px);
            box-shadow:
                0 0 25px var(--neon-glow),
                0 0 50px var(--neon-glow),
                0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .launch-btn:active {
            transform: translateY(0);
        }

        .launch-btn.running {
            background: linear-gradient(45deg, #ff4757, #ff3742);
            border-color: #ff4757;
        }

        .launch-btn.starting {
            background: linear-gradient(45deg, #ffa502, #ff6348);
            border-color: #ffa502;
            cursor: not-allowed;
        }

        .launch-btn.stopping {
            background: linear-gradient(45deg, #ff7675, #fd79a8);
            border-color: #ff7675;
            cursor: not-allowed;
        }

        .launch-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        /* æµè§ˆå™¨æŒ‰é’® */
        .browser-btn {
            width: 90%;
            min-width: 400px;
            padding: 12px 25px;
            font-size: 1.1rem;
            font-weight: 600;
            background: linear-gradient(45deg, rgba(0, 245, 255, 0.1), rgba(0, 102, 255, 0.1));
            border: 2px solid rgba(0, 245, 255, 0.6);
            border-radius: 10px;
            color: var(--accent-cyan);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            box-shadow:
                0 0 15px rgba(0, 245, 255, 0.2),
                0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .browser-btn:hover {
            background: linear-gradient(45deg, rgba(0, 245, 255, 0.2), rgba(0, 102, 255, 0.2));
            border-color: var(--neon-glow);
            transform: translateY(-1px);
            box-shadow:
                0 0 20px rgba(0, 245, 255, 0.4),
                0 3px 12px rgba(0, 0, 0, 0.3);
        }

        .browser-btn:active {
            transform: translateY(0);
        }

        /* æ˜¾å¡ä¿¡æ¯ */
        .gpu-info {
            position: relative;
            margin-top: 15px;
            width: 90%;
            min-width: 400px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(0, 245, 255, 0.5);
            border-radius: 10px;
            backdrop-filter: blur(15px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .gpu-details {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .gpu-icon-container {
            position: relative;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gpu-icon {
            font-size: 1.5rem;
            color: var(--neon-glow);
            z-index: 2;
        }

        .rotating-ring {
            position: absolute;
            top: -2px;
            left: -2px;
            width: 39px;
            height: 39px;
            border: 2px solid transparent;
            border-top: 2px solid var(--neon-glow);
            border-right: 2px solid var(--neon-glow);
            border-radius: 50%;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 0 8px var(--neon-glow);
            pointer-events: none; /* ç¡®ä¿ä¸å½±å“ç‚¹å‡»äº‹ä»¶ */
        }

        .gpu-info.working::before {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle,
                #ffffff 0%,
                #ffffff 25%,
                var(--neon-glow) 50%,
                rgba(0, 245, 255, 0.8) 75%,
                rgba(0, 245, 255, 0.4) 90%,
                transparent 100%
            );
            border-radius: 50%;
            opacity: 1;
            animation: snake-head-trace 3s linear infinite;
            pointer-events: none;
            z-index: 5;
            box-shadow:
                0 0 10px #ffffff,
                0 0 20px var(--neon-glow);
        }

        .gpu-info.working::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle,
                rgba(255, 255, 255, 0.9) 0%,
                rgba(255, 255, 255, 0.7) 20%,
                var(--neon-glow) 40%,
                rgba(0, 245, 255, 0.7) 65%,
                rgba(0, 245, 255, 0.4) 85%,
                transparent 100%
            );
            border-radius: 50%;
            opacity: 1;
            animation: snake-body1-trace 3s linear infinite;
            pointer-events: none;
            z-index: 4;
            box-shadow: 0 0 8px var(--neon-glow);
        }

        /* è›‡èº«ä½“æ®µ - é€‚ä¸­çš„å°ºå¯¸é€’å‡ï¼Œä¿æŒäº®åº¦ */
        .gpu-info.working .gpu-chip::before {
            content: '';
            position: absolute;
            width: 7px;
            height: 7px;
            background: radial-gradient(circle,
                rgba(255, 255, 255, 0.8) 0%,
                rgba(255, 255, 255, 0.6) 25%,
                var(--neon-glow) 45%,
                rgba(0, 245, 255, 0.6) 70%,
                rgba(0, 245, 255, 0.3) 90%,
                transparent 100%
            );
            border-radius: 50%;
            opacity: 1;
            animation: snake-body2-trace 3s linear infinite;
            pointer-events: none;
            z-index: 3;
            box-shadow: 0 0 7px rgba(0, 245, 255, 0.7);
        }

        .gpu-info.working .gpu-chip::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: radial-gradient(circle,
                rgba(255, 255, 255, 0.7) 0%,
                rgba(255, 255, 255, 0.5) 30%,
                var(--neon-glow) 50%,
                rgba(0, 245, 255, 0.5) 75%,
                rgba(0, 245, 255, 0.3) 90%,
                transparent 100%
            );
            border-radius: 50%;
            opacity: 1;
            animation: snake-body3-trace 3s linear infinite;
            pointer-events: none;
            z-index: 2;
            box-shadow: 0 0 6px rgba(0, 245, 255, 0.6);
        }

        .gpu-info.working .gpu-name::before {
            content: '';
            position: absolute;
            width: 5px;
            height: 5px;
            background: radial-gradient(circle,
                rgba(255, 255, 255, 0.6) 0%,
                rgba(255, 255, 255, 0.4) 35%,
                var(--neon-glow) 55%,
                rgba(0, 245, 255, 0.4) 80%,
                transparent 100%
            );
            border-radius: 50%;
            opacity: 1;
            animation: snake-body4-trace 3s linear infinite;
            pointer-events: none;
            z-index: 1;
            box-shadow: 0 0 5px rgba(0, 245, 255, 0.5);
        }

        .gpu-info.working .gpu-name::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle,
                rgba(255, 255, 255, 0.5) 0%,
                rgba(255, 255, 255, 0.3) 40%,
                var(--neon-glow) 60%,
                rgba(0, 245, 255, 0.3) 85%,
                transparent 100%
            );
            border-radius: 50%;
            opacity: 1;
            animation: snake-tail-trace 3s linear infinite;
            pointer-events: none;
            z-index: 1;
            box-shadow: 0 0 4px rgba(0, 245, 255, 0.4);
        }



        @keyframes snake-head-trace {
            /* è›‡å¤´ - é¢†å…ˆç§»åŠ¨ (10px) */
            0% {
                top: -5px;
                left: -5px;
            }
            25% {
                top: -5px;
                left: calc(100% - 5px);
            }
            50% {
                top: calc(100% - 5px);
                left: calc(100% - 5px);
            }
            75% {
                top: calc(100% - 5px);
                left: -5px;
            }
            100% {
                top: -5px;
                left: -5px;
            }
        }

        @keyframes snake-body1-trace {
            /* è›‡èº«1 - å»¶è¿Ÿ3% (8px) */
            0% {
                top: -4px;
                left: -12px;
            }
            3% {
                top: -4px;
                left: -4px;
            }
            28% {
                top: -4px;
                left: calc(100% - 4px);
            }
            53% {
                top: calc(100% - 4px);
                left: calc(100% - 4px);
            }
            78% {
                top: calc(100% - 4px);
                left: -4px;
            }
            100% {
                top: -4px;
                left: -12px;
            }
        }

        @keyframes snake-body2-trace {
            /* è›‡èº«2 - å»¶è¿Ÿ6% (7px) */
            0% {
                top: -3.5px;
                left: -20px;
            }
            6% {
                top: -3.5px;
                left: -3.5px;
            }
            31% {
                top: -3.5px;
                left: calc(100% - 3.5px);
            }
            56% {
                top: calc(100% - 3.5px);
                left: calc(100% - 3.5px);
            }
            81% {
                top: calc(100% - 3.5px);
                left: -3.5px;
            }
            100% {
                top: -3.5px;
                left: -20px;
            }
        }

        @keyframes snake-body3-trace {
            /* è›‡èº«3 - å»¶è¿Ÿ9% (6px) */
            0% {
                top: -3px;
                left: -28px;
            }
            9% {
                top: -3px;
                left: -3px;
            }
            34% {
                top: -3px;
                left: calc(100% - 3px);
            }
            59% {
                top: calc(100% - 3px);
                left: calc(100% - 3px);
            }
            84% {
                top: calc(100% - 3px);
                left: -3px;
            }
            100% {
                top: -3px;
                left: -28px;
            }
        }

        @keyframes snake-body4-trace {
            /* è›‡èº«4 - å»¶è¿Ÿ12% (5px) */
            0% {
                top: -2.5px;
                left: -36px;
            }
            12% {
                top: -2.5px;
                left: -2.5px;
            }
            37% {
                top: -2.5px;
                left: calc(100% - 2.5px);
            }
            62% {
                top: calc(100% - 2.5px);
                left: calc(100% - 2.5px);
            }
            87% {
                top: calc(100% - 2.5px);
                left: -2.5px;
            }
            100% {
                top: -2.5px;
                left: -36px;
            }
        }

        @keyframes snake-tail-trace {
            /* è›‡å°¾ - å»¶è¿Ÿ15% (4px) */
            0% {
                top: -2px;
                left: -44px;
            }
            15% {
                top: -2px;
                left: -2px;
            }
            40% {
                top: -2px;
                left: calc(100% - 2px);
            }
            65% {
                top: calc(100% - 2px);
                left: calc(100% - 2px);
            }
            90% {
                top: calc(100% - 2px);
                left: -2px;
            }
            100% {
                top: -2px;
                left: -44px;
            }
        }







        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 8px var(--neon-glow);
                border-top-color: var(--neon-glow);
                border-right-color: var(--neon-glow);
            }
            50% {
                box-shadow: 0 0 15px var(--neon-glow), 0 0 20px var(--neon-glow);
                border-top-color: #ffffff;
                border-right-color: #ffffff;
            }
        }

        .gpu-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .gpu-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--neon-glow);
            text-shadow: 0 0 5px var(--neon-glow);
        }

        .gpu-usage {
            font-size: 0.75rem;
            color: var(--text-primary);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .gpu-status {
            font-size: 0.8rem;
            color: var(--text-primary);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* æ‰«æçº¿æ•ˆæœ */
        .launcher-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 245, 255, 0.02) 2px,
                rgba(0, 245, 255, 0.02) 4px
            );
            pointer-events: none;
            z-index: 5;
            border-radius: 18px;
        }

        /* ä¸“å®¶æ¨¡å¼æŒ‰é’® */
        .expert-mode-btn {
            background: rgba(255, 102, 0, 0.2);
            border: 1px solid rgba(255, 102, 0, 0.5);
            color: #ff6600;
            font-size: 0.75rem;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .expert-mode-btn:hover {
            background: rgba(255, 102, 0, 0.3);
            box-shadow: 0 0 10px rgba(255, 102, 0, 0.3);
        }

        /* å¯åŠ¨è®¾ç½®é¡µé¢æ ·å¼ */
        .launch-settings-container {
            padding: 20px;
            max-width: 100%;
            color: var(--text-primary);
        }

        .launch-settings-container h3 {
            color: var(--neon-glow);
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 10px var(--neon-glow);
        }

        /* é¢„è®¾é…ç½®å¡ç‰‡ */
        .preset-section {
            margin-bottom: 25px;
        }

        .preset-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .preset-card {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .preset-card:hover {
            border-color: var(--neon-glow);
            box-shadow: 0 0 15px rgba(0, 245, 255, 0.3);
            transform: translateY(-2px);
        }

        .preset-card.active {
            border-color: var(--neon-glow);
            background: rgba(0, 245, 255, 0.1);
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.4);
        }

        .preset-card h4 {
            color: var(--neon-glow);
            font-size: 0.9rem;
            margin-bottom: 6px;
            text-shadow: 0 0 5px var(--neon-glow);
        }

        .preset-card p {
            color: var(--text-secondary);
            font-size: 0.7rem;
            line-height: 1.3;
            font-family: 'JetBrains Mono', monospace;
        }

        /* è®¾ç½®åŒºåŸŸ */
        .memory-section, .attention-section, .network-section, .proxy-section {
            margin-bottom: 25px;
            background: rgba(26, 26, 46, 0.4);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        /* å¯åŠ¨è®¾ç½®é¡µé¢è¾“å…¥æ¡†æ ·å¼ */
        .launch-settings-container input[type="text"],
        .launch-settings-container input[type="number"],
        .launch-settings-container select {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 6px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s ease;
            width: 100%;
        }

        .launch-settings-container input[type="text"]:focus,
        .launch-settings-container input[type="number"]:focus,
        .launch-settings-container select:focus {
            outline: none;
            border-color: var(--neon-glow);
            box-shadow: 0 0 10px rgba(0, 245, 255, 0.3);
            background: rgba(26, 26, 46, 0.8);
        }

        .launch-settings-container select option {
            background: rgba(26, 26, 46, 0.95);
            color: var(--text-primary);
            padding: 8px;
        }

        /* æ°´å¹³å¸ƒå±€çš„è®¾ç½®é¡¹ */
        .setting-item.horizontal {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 15px;
            padding: 8px 0;
        }

        .setting-item.horizontal label {
            flex-shrink: 0;
            min-width: 140px;
            margin-bottom: 0;
            padding-top: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* æ˜¾å­˜ä¼˜åŒ–ç‰ˆå—çš„ç‰¹æ®Šè°ƒæ•´ - æ ‡ç­¾ä½ç½®ä¸å¤é€‰æ¡†å¯¹é½ */
        .memory-section .setting-item.horizontal label {
            margin-left: 24px; /* ä¸å¤é€‰æ¡†æ ‡ç­¾å¯¹é½ */
        }

        .setting-item.horizontal input,
        .setting-item.horizontal select {
            flex: 1;
            max-width: 280px;
            min-width: 200px;
        }

        .setting-item.horizontal .input-with-hint {
            flex: 1;
            max-width: 280px;
            min-width: 200px;
        }

        .setting-item.horizontal .input-with-hint input,
        .setting-item.horizontal .input-with-hint select {
            width: 100%;
            margin-bottom: 4px;
        }

        .setting-item.horizontal .input-with-hint .hint {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.3;
            opacity: 0.8;
        }

        /* ä»£ç†è®¾ç½®çš„ç‰¹æ®Šæ ·å¼ */
        .proxy-inputs .setting-item.horizontal {
            gap: 15px; /* å‡å°‘é—´è·ï¼Œé˜²æ­¢è¾“å…¥æ¡†è·‘å‡ºè¾¹ç•Œ */
        }

        .proxy-inputs .setting-item.horizontal label {
            margin-left: 24px; /* ä¸"å¯ç”¨ä»£ç†"å¤é€‰æ¡†æ ‡ç­¾å¯¹é½ */
            min-width: 100px; /* å‡å°‘æ ‡ç­¾å®½åº¦ï¼Œä¸ºè¾“å…¥æ¡†ç•™å‡ºç©ºé—´ */
        }

        .proxy-inputs .setting-item.horizontal input {
            max-width: 280px; /* å‡å°‘æœ€å¤§å®½åº¦ï¼Œé˜²æ­¢è·‘å‡ºè¾¹ç•Œ */
            min-width: 200px;
        }

        /* å•é€‰æŒ‰é’®ç»„ */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .radio-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .radio-item:hover {
            background: rgba(0, 245, 255, 0.05);
        }

        .radio-item input[type="radio"] {
            margin-top: 3px;
            accent-color: var(--neon-glow);
        }

        .radio-item span {
            color: var(--text-primary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .radio-item small {
            color: var(--text-secondary);
            font-size: 0.75rem;
            display: block;
            margin-top: 2px;
        }

        /* å¤é€‰æ¡†ç»„ */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: rgba(0, 245, 255, 0.05);
        }

        .checkbox-item input[type="checkbox"] {
            margin-top: 3px;
            accent-color: var(--neon-glow);
        }

        .checkbox-item span {
            color: var(--text-primary);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .checkbox-item small {
            color: var(--text-secondary);
            font-size: 0.7rem;
            display: block;
            margin-top: 2px;
        }

        /* è¾“å…¥æ¡†ç»„ */
        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .input-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .input-item label {
            color: var(--text-primary);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .input-item input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 6px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 0.85rem;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s ease;
        }

        .input-item input:focus {
            outline: none;
            border-color: var(--neon-glow);
            box-shadow: 0 0 10px rgba(0, 245, 255, 0.3);
        }

        .input-item small {
            color: var(--text-secondary);
            font-size: 0.7rem;
        }

        /* å‘½ä»¤é¢„è§ˆ */
        .command-preview {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            backdrop-filter: blur(5px);
        }

        .command-preview h4 {
            color: var(--neon-glow);
            font-size: 0.9rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .command-text {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 6px;
            padding: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--neon-glow);
            word-break: break-all;
            line-height: 1.4;
            text-shadow: 0 0 5px var(--neon-glow);
        }

        /* ä¸“å®¶æ¨¡å¼ */
        .expert-settings {
            margin-top: 20px;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }

        .expert-settings.active {
            opacity: 1;
            max-height: 500px;
        }

        /* å¯åŠ¨æŒ‰é’®åœ¨è®¾ç½®é¡µé¢ */
        .settings-launch-btn {
            width: 100%;
            margin-top: 25px;
            background: linear-gradient(45deg, var(--accent-cyan), var(--accent-blue));
            border: 2px solid var(--neon-glow);
            border-radius: 12px;
            padding: 15px 30px;
            color: #000;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: none;
        }

        .settings-launch-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(0, 245, 255, 0.6);
        }

        .settings-launch-btn i {
            margin-right: 8px;
        }

        /* æ“ä½œæŒ‰é’®ç»„ */
        .actions-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(0, 245, 255, 0.2);
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            backdrop-filter: blur(10px);
        }

        .btn-primary {
            background: rgba(0, 102, 255, 0.8);
            color: white;
            border: 1px solid rgba(0, 102, 255, 0.6);
        }

        .btn-primary:hover {
            background: rgba(0, 102, 255, 1);
            box-shadow: 0 0 15px rgba(0, 102, 255, 0.5);
            transform: translateY(-2px);
        }

        .btn-success {
            background: rgba(0, 255, 102, 0.8);
            color: #000;
            border: 1px solid rgba(0, 255, 102, 0.6);
        }

        .btn-success:hover {
            background: rgba(0, 255, 102, 1);
            box-shadow: 0 0 15px rgba(0, 255, 102, 0.5);
            transform: translateY(-2px);
        }

        .btn-warning {
            background: rgba(255, 153, 0, 0.8);
            color: white;
            border: 1px solid rgba(255, 153, 0, 0.6);
        }

        .btn-warning:hover {
            background: rgba(255, 153, 0, 1);
            box-shadow: 0 0 15px rgba(255, 153, 0, 0.5);
            transform: translateY(-2px);
        }

        /* æ›´æ–°é€šçŸ¥åŠ¨ç”» */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* ä¿¡æ¯å¡ç‰‡æ ·å¼ */
        .info-card {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

        .info-card h3 {
            color: var(--neon-glow);
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 10px var(--neon-glow);
        }

        .info-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 245, 255, 0.1);
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .info-value {
            color: var(--neon-glow);
            font-weight: 600;
            font-size: 0.9rem;
            text-shadow: 0 0 5px var(--neon-glow);
        }

        /* ç‰ˆæœ¬ç®¡ç†é¡µé¢æ ·å¼ */
        .version-management-container {
            padding: 20px;
            max-width: 100%;
            color: var(--text-primary);
        }

        /* ç‰ˆæœ¬æ›´æ–°çŠ¶æ€æ ·å¼ */
        .version-update-status {
            margin: 10px 0;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 0.9rem;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .update-checking {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.3);
            color: #3498db;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .update-notification {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
            color: #2ecc71;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .update-error {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
            color: #e74c3c;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .update-close-btn {
            background: none;
            border: none;
            color: inherit;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0 4px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .update-close-btn:hover {
            opacity: 1;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ç‰ˆæœ¬ç®¡ç†å¤´éƒ¨ */
        .version-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 245, 255, 0.2);
        }



        .version-header h2 {
            color: var(--neon-glow);
            font-size: 1.3rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 10px var(--neon-glow);
        }

        /* åˆ·æ–°ç‰ˆæœ¬æŒ‰é’® */
        .refresh-versions-btn {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.1), rgba(0, 245, 255, 0.2));
            border: 1px solid rgba(0, 245, 255, 0.3);
            color: var(--neon-glow);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
        }

        .refresh-versions-btn:hover {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.2), rgba(0, 245, 255, 0.3));
            border-color: rgba(0, 245, 255, 0.5);
            box-shadow: 0 0 10px rgba(0, 245, 255, 0.3);
            transform: translateY(-1px);
        }

        .refresh-versions-btn:active {
            transform: translateY(0);
        }

        .refresh-versions-btn i {
            transition: transform 0.3s ease;
        }

        .refresh-versions-btn:hover i {
            transform: rotate(180deg);
        }

        /* ç‰ˆæœ¬ç±»å‹åˆ‡æ¢æ ‡ç­¾ */
        .version-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 25px;
            background: rgba(26, 26, 46, 0.4);
            border-radius: 10px;
            padding: 4px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 245, 255, 0.2);
        }

        .version-tab-btn {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .version-tab-btn:hover {
            color: var(--text-primary);
            background: rgba(0, 245, 255, 0.1);
        }

        .version-tab-btn.active {
            color: var(--neon-glow);
            background: rgba(0, 245, 255, 0.15);
            text-shadow: 0 0 10px var(--neon-glow);
            box-shadow: 0 0 10px rgba(0, 245, 255, 0.3);
        }

        /* ç‰ˆæœ¬åˆ—è¡¨å®¹å™¨ */
        .version-list-container {
            position: relative;
            min-height: 400px;
        }

        /* åŠ è½½çŠ¶æ€ */
        .version-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: var(--text-secondary);
            font-size: 16px;
            gap: 16px;
            flex-direction: column;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 245, 255, 0.3);
            border-top: 3px solid var(--neon-glow);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* ç‰ˆæœ¬åˆ—è¡¨ */
        .version-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* ç‰ˆæœ¬æ¡ç›® */
        .version-item {
            background: rgba(26, 26, 46, 0.4);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 10px;
            padding: 16px 20px;
            min-height: 80px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .version-item:hover {
            border-color: rgba(0, 245, 255, 0.4);
            box-shadow: 0 0 15px rgba(0, 245, 255, 0.2);
        }

        .version-item:last-child {
            margin-bottom: 0;
        }

        .version-item.current {
            border-color: var(--neon-glow);
            background: rgba(0, 245, 255, 0.03);
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.3);
            animation: currentVersionPulse 3s ease-in-out infinite;
        }

        @keyframes currentVersionPulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(0, 245, 255, 0.3);
            }
            50% {
                box-shadow: 0 0 25px rgba(0, 245, 255, 0.5);
            }
        }

        /* ç‰ˆæœ¬ä¿¡æ¯ */
        .version-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-height: 48px;
            justify-content: center;
        }

        .version-main {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .version-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(0, 245, 255, 0.3);
            transition: all 0.3s ease;
        }

        .version-id {
            color: var(--neon-glow);
            font-weight: 600;
            font-size: 1rem;
            text-shadow: 0 0 5px var(--neon-glow);
            font-family: 'JetBrains Mono', monospace;
        }

        .version-commit {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-left: 24px;
            font-style: italic;
            opacity: 0.8;
            line-height: 1.3;
            max-height: 2.6em;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .version-item.current .version-indicator {
            background: var(--neon-glow);
            box-shadow: 0 0 10px var(--neon-glow);
        }

        .version-item.latest {
            border-color: rgba(0, 245, 255, 0.4);
            background: rgba(0, 245, 255, 0.05);
        }

        .version-item.latest .version-indicator {
            background: rgba(0, 245, 255, 0.6);
            box-shadow: 0 0 8px rgba(0, 245, 255, 0.4);
        }

        .version-id {
            color: var(--neon-glow);
            font-weight: 600;
            font-size: 1rem;
            text-shadow: 0 0 5px var(--neon-glow);
            font-family: 'JetBrains Mono', monospace;
        }

        .version-date {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-left: auto;
        }



        /* ğŸš€ é«˜æ€§èƒ½ç‰ˆæœ¬å¾½ç« æ ·å¼ */
        .badge {
            font-size: 11px;
            margin-left: 8px;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .current-badge {
            color: #28a745;
            background: rgba(40, 167, 69, 0.1);
            text-shadow: 0 0 3px rgba(40, 167, 69, 0.5);
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .latest-badge {
            color: #00f5ff;
            background: rgba(0, 245, 255, 0.1);
            text-shadow: 0 0 3px rgba(0, 245, 255, 0.5);
            border: 1px solid rgba(0, 245, 255, 0.3);
        }

        .newer-badge {
            color: #ff6b35;
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.3);
            animation: badgePulse 2s infinite;
        }

        .version-author {
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin-left: 24px;
            opacity: 0.7;
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @keyframes badgePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* ğŸš€ akiçº§åˆ«å¿«é€ŸåŠ è½½æ ·å¼ */
        .version-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .version-loading i {
            margin-right: 8px;
            color: var(--primary-color);
        }

        .version-loading span {
            animation: loadingPulse 1.5s infinite;
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* ç‰ˆæœ¬åˆ‡æ¢æŒ‰é’® - ä¸åŸå§‹é¡¹ç›®æ ·å¼ä¿æŒä¸€è‡´ */
        .version-switch-btn {
            background: transparent;
            border: 1px solid var(--neon-glow);
            border-radius: 6px;
            padding: 6px 12px;
            color: var(--neon-glow);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            min-width: 70px;
        }

        .version-switch-btn:hover {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .version-switch-btn.current {
            background: rgba(0, 200, 100, 0.8);
            border-color: rgba(0, 200, 100, 0.6);
            cursor: default;
            color: white;
        }

        .version-switch-btn.current:hover {
            background: rgba(0, 200, 100, 0.8);
            box-shadow: none;
        }

        .version-switch-btn.newer {
            background: transparent;
            border-color: #ff6b35;
            color: #ff6b35;
        }

        .version-switch-btn.newer:hover {
            background: rgba(255, 107, 53, 0.1);
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }

        /* å¼€å‘ç‰ˆæœ¬ç‰¹æ®Šæ ·å¼ */
        .version-item.development {
            border-color: rgba(255, 107, 53, 0.4);
            background: rgba(255, 107, 53, 0.05);
        }

        .version-item.development:hover {
            border-color: rgba(255, 107, 53, 0.6);
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.3);
        }

        .version-item.development.current {
            border-color: #ff6b35;
            background: rgba(255, 107, 53, 0.1);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.4);
        }

        .version-switch-btn.development {
            background: transparent;
            border-color: var(--neon-glow);
            color: var(--neon-glow);
        }

        .version-switch-btn.development:hover {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .version-switch-btn.development.current {
            background: rgba(0, 200, 100, 0.8);
            border-color: rgba(0, 200, 100, 0.6);
        }

        .version-switch-btn.development.current:hover {
            background: rgba(0, 200, 100, 0.8);
            box-shadow: none;
        }



        .version-item.newer {
            border-left: 3px solid #ff6b35;
            background: rgba(255, 107, 53, 0.05);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 53, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 53, 0); }
        }

        /* æ¨¡æ€å¯¹è¯æ¡† */
        .version-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: modalFadeIn 0.3s ease;
        }

        .version-modal.show {
            display: flex;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: rgba(26, 26, 46, 0.95);
            border: 1px solid var(--neon-glow);
            border-radius: 12px;
            padding: 25px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            backdrop-filter: blur(20px);
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.3);
        }

        .modal-content h3 {
            color: var(--neon-glow);
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-shadow: 0 0 10px var(--neon-glow);
        }

        .modal-content p {
            color: var(--text-primary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .modal-content #target-version,
        .modal-content #progress-version {
            color: var(--neon-glow);
            font-weight: 600;
            text-shadow: 0 0 5px var(--neon-glow);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* è¿›åº¦æ¡ */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
            border: 1px solid rgba(0, 245, 255, 0.3);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-glow), var(--accent-blue));
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--neon-glow);
        }

        .modal-content small {
            color: var(--text-secondary);
            font-size: 0.75rem;
        }

        /* æ’ä»¶ç®¡ç†é¡µé¢æ ·å¼ - æ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬ */
        .plugin-management-container {
            padding: 20px;
            max-width: 100%;
            color: var(--text-primary);
            /* ç§»é™¤å›ºå®šé«˜åº¦é™åˆ¶ï¼Œä¸ç‰ˆæœ¬ç®¡ç†é¡µé¢ä¿æŒä¸€è‡´ */
            /* å¯ç”¨ç¡¬ä»¶åŠ é€Ÿå’Œä¼˜åŒ– */
            transform: translateZ(0);
            will-change: transform;
            contain: layout style paint;
        }

        .plugin-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .plugin-header h2 {
            color: var(--neon-glow);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 10px var(--neon-glow);
            margin: 0;
        }

        .plugin-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding-bottom: 5px;
            /* æ€§èƒ½ä¼˜åŒ– */
            transform: translateZ(0);
            will-change: transform;
        }

        .plugin-tab-btn {
            padding: 10px 16px;
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            min-width: fit-content;
            flex-shrink: 0;
            text-overflow: ellipsis;
            overflow: hidden;
        }

        .plugin-tab-btn:hover {
            border-color: var(--neon-glow);
            background: rgba(0, 245, 255, 0.1);
        }

        .plugin-tab-btn.active {
            border-color: var(--neon-glow);
            background: rgba(0, 245, 255, 0.15);
            color: var(--neon-glow);
            text-shadow: 0 0 5px var(--neon-glow);
        }

        /* ç¡®ä¿æ ‡ç­¾æ–‡å­—åœ¨å°å±å¹•ä¸Šä¹Ÿä¿æŒä¸€è¡Œ */
        @media (max-width: 768px) {
            .plugin-tabs {
                gap: 6px;
            }

            .plugin-tab-btn {
                padding: 8px 14px;
                font-size: 0.85rem;
                gap: 6px;
            }
        }

        @media (max-width: 600px) {
            .plugin-tabs {
                gap: 4px;
            }

            .plugin-tab-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
                gap: 5px;
            }

            .plugin-tab-btn i {
                font-size: 0.9em;
            }
        }

        @media (max-width: 500px) {
            .plugin-tab-btn {
                padding: 6px 10px;
                font-size: 0.75rem;
                gap: 4px;
            }

            .plugin-tab-btn i {
                font-size: 0.85em;
            }
        }

        .plugin-content {
            /* ç§»é™¤overflow-y: autoï¼Œä½¿ç”¨é¡µé¢çº§åˆ«çš„æ»šåŠ¨æ¡ */
        }

        /* å·²å®‰è£…æ’ä»¶æ ·å¼ */
        .installed-plugins {
            display: none;
        }

        .installed-plugins.active {
            display: block;
        }

        /* å¯å®‰è£…æ’ä»¶æ ·å¼ */
        .available-plugins {
            display: none;
        }

        .available-plugins.active {
            display: block !important;
        }

        /* æ’ä»¶å·¥å…·æ æ ·å¼ - ç®€çº¦è®¾è®¡ */
        .plugin-toolbar {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(26, 26, 46, 0.4);
            border-radius: 12px;
            border: 1px solid rgba(0, 245, 255, 0.15);
            backdrop-filter: blur(15px);
        }

        .search-container {
            flex: 2;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 20px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 25px;
            color: var(--text-primary);
            font-size: 15px;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--neon-glow);
            box-shadow: 0 0 15px rgba(0, 245, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
        }

        .search-input::placeholder {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 16px;
        }

        .filter-container {
            flex: 1;
            min-width: 180px;
        }

        .category-select {
            width: 100%;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 25px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-select:focus {
            outline: none;
            border-color: var(--neon-glow);
            box-shadow: 0 0 15px rgba(0, 245, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
        }

        .category-select option {
            background: rgba(26, 26, 46, 0.95);
            color: var(--text-primary);
            padding: 8px;
        }

        /* æ’ä»¶åˆ—è¡¨å¸ƒå±€ - ç´§å‡‘è¡¨æ ¼å¼ï¼Œä¼˜åŒ–æ»šåŠ¨æ€§èƒ½ */
        .plugin-list {
            display: block;
            padding: 0;
            margin: 0;
            /* ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½ */
            contain: layout style paint;
            transform: translate3d(0, 0, 0);
        }

        /* å¯ç”¨æ’ä»¶é¡¹ - ä¸¤è¡Œå¸ƒå±€è®¾è®¡ï¼Œä¼˜åŒ–æ»šåŠ¨æ€§èƒ½ */
        .available-plugin-item {
            background: rgba(26, 26, 46, 0.2);
            border: 1px solid rgba(0, 245, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            backdrop-filter: blur(10px);
            transition: all 0.2s ease;
            /* å¯ç”¨ç¡¬ä»¶åŠ é€Ÿï¼Œä¼˜åŒ–æ»šåŠ¨æ€§èƒ½ */
            transform: translate3d(0, 0, 0);
            will-change: transform, background-color, border-color;
        }

        .available-plugin-item:hover {
            border-color: rgba(0, 245, 255, 0.3);
            background: rgba(26, 26, 46, 0.4);
            transform: translate3d(4px, 0, 0);
        }

        /* æ’ä»¶ä¿¡æ¯åŒºåŸŸ */
        .available-plugin-info {
            display: flex;
            width: 100%;
            gap: 20px;
        }

        /* å·¦ä¾§ï¼šæ’ä»¶åç§°å’Œæè¿° */
        .plugin-main-info {
            flex: 1;
            min-width: 0;
        }

        /* æ’ä»¶æ ‡é¢˜è¡Œï¼šåç§° + ä½œè€… */
        .plugin-title-line {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 6px;
        }

        .available-plugin-name {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
            min-width: 0;
        }

        .plugin-author {
            color: #ffa500;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            flex-shrink: 0;
        }

        /* æ’ä»¶æè¿° */
        .plugin-description {
            color: var(--text-secondary);
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* åº•éƒ¨ä¿¡æ¯è¡Œï¼šåˆ†ç±»ã€æ˜Ÿæ ‡ã€ä¸»é¡µã€å®‰è£… */
        .plugin-bottom-line {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            font-size: 12px;
            margin-top: 8px;
        }

        /* å·¦ä¾§ä¿¡æ¯ç»„ */
        .plugin-left-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        /* å³ä¾§æŒ‰é’®ç»„ */
        .plugin-right-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }

        .plugin-category {
            color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            white-space: nowrap;
            display: inline-block;
            min-width: 80px;
            text-align: center;
        }

        .plugin-stars {
            color: #ffd700;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
            min-width: 60px;
        }

        .plugin-action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            white-space: nowrap;
            min-width: 60px;
        }

        .plugin-action-btn.install {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .plugin-action-btn.install:hover {
            background: linear-gradient(135deg, #218838, #1ea080);
            transform: translateY(-1px);
        }

        .plugin-action-btn.installed {
            background: rgba(108, 117, 125, 0.6);
            color: rgba(255, 255, 255, 0.8);
            cursor: not-allowed;
        }

        .plugin-action-btn.info {
            background: rgba(0, 123, 255, 0.1);
            color: #007bff;
            border: 1px solid rgba(0, 123, 255, 0.3);
        }

        .plugin-action-btn.info:hover {
            background: rgba(0, 123, 255, 0.2);
            border-color: rgba(0, 123, 255, 0.5);
            transform: translateY(-1px);
        }

        /* åŠ è½½çŠ¶æ€æ ·å¼ */
        .plugin-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px 40px;
            color: var(--text-secondary);
            font-size: 16px;
            gap: 16px;
            flex-direction: column;
        }

        .loading-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            min-width: 300px;
        }

        .loading-progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(0, 245, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .loading-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-cyan), var(--neon-glow));
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 3px;
            box-shadow: 0 0 8px rgba(0, 245, 255, 0.6);
        }

        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(0, 245, 255, 0.2);
            border-top: 3px solid var(--neon-glow);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ç¯å¢ƒé…ç½®é¡µé¢æ ·å¼ */
        .environment-container {
            padding: 20px;
        }

        /* ç¯å¢ƒé…ç½®å­æ ‡ç­¾å¯¼èˆª */
        .environment-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 1px solid rgba(0, 245, 255, 0.2);
            padding-bottom: 16px;
        }

        .environment-tab-btn {
            background: rgba(26, 26, 46, 0.3);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 8px;
            padding: 12px 20px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .environment-tab-btn:hover {
            border-color: rgba(0, 245, 255, 0.4);
            background: rgba(26, 26, 46, 0.5);
            color: var(--text-primary);
        }

        .environment-tab-btn.active {
            background: rgba(0, 245, 255, 0.1);
            border-color: var(--neon-glow);
            color: var(--neon-glow);
            box-shadow: 0 0 10px rgba(0, 245, 255, 0.2);
        }



        /* è®¾ç½®é¡µé¢æ ·å¼ */
        .settings-container {
            padding: 0;
        }

        /* å¡ç‰‡å¼ç½‘æ ¼å¸ƒå±€ */
        .settings-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            padding: 0;
        }

        /* è®¾ç½®å¡ç‰‡ */
        .settings-card {
            background: rgba(0, 245, 255, 0.03);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .settings-card:hover {
            border-color: rgba(0, 245, 255, 0.4);
            box-shadow: 0 8px 32px rgba(0, 245, 255, 0.1);
            transform: translateY(-2px);
        }

        /* å¡ç‰‡å¤´éƒ¨ */
        .settings-card-header {
            background: rgba(0, 245, 255, 0.08);
            padding: 16px 24px;
            border-bottom: 1px solid rgba(0, 245, 255, 0.15);
        }

        .settings-card-header h3 {
            color: var(--neon-glow);
            font-size: 1.3rem;
            margin: 0 0 4px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            text-shadow: 0 0 10px var(--neon-glow);
        }

        .settings-card-header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            margin: 0;
            line-height: 1.3;
        }

        /* å¡ç‰‡å†…å®¹ */
        .settings-card-content {
            padding: 24px;
        }

        /* è®¾ç½®ç»„ */
        .settings-group {
            margin-bottom: 24px;
        }

        .settings-group:last-child {
            margin-bottom: 0;
        }

        .settings-group h4 {
            color: var(--text-primary);
            font-size: 1rem;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .settings-group h4 i {
            font-size: 14px;
            color: var(--neon-glow);
        }

        /* è®¾ç½®é¡¹å®¹å™¨ */
        .settings-items {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-item label {
            color: var(--text-primary);
            font-weight: 500;
            font-size: 14px;
            flex: 1;
        }

        /* ä¿¡æ¯åˆ—è¡¨ */
        .info-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .info-list .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .info-list .info-item:last-child {
            border-bottom: none;
        }

        /* è®¾ç½®é¡µé¢è¿”å›æŒ‰é’® */
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }



        /* ç´§å‡‘å‹è®¾ç½®é¡¹ */
        .setting-item.compact {
            padding: 8px 0;
        }

        .upload-btn.compact {
            padding: 6px 12px;
            font-size: 12px;
            min-width: 100px;
        }

        /* ç´§å‡‘å‹ä¸»é¢˜é€‰æ‹©å™¨ */
        .theme-selector.compact {
            gap: 6px;
        }

        .theme-btn.compact {
            padding: 6px 10px;
            font-size: 11px;
        }

        .theme-btn.compact .theme-color {
            width: 10px;
            height: 10px;
        }

        /* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */
        .file-upload-area {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: flex-end;
        }

        .upload-btn {
            background: rgba(0, 245, 255, 0.1);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 6px;
            padding: 8px 16px;
            color: var(--neon-glow);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .upload-btn:hover {
            background: rgba(0, 245, 255, 0.2);
            border-color: var(--neon-glow);
            transform: translateY(-1px);
        }

        .upload-info {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
        }

        /* ä¸»é¢˜é€‰æ‹©å™¨ */
        .theme-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .theme-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .theme-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .theme-btn.active {
            border-color: var(--neon-glow);
            background: rgba(0, 245, 255, 0.1);
            color: var(--neon-glow);
        }

        .theme-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* æ“ä½œæŒ‰é’® */
        .action-btn {
            background: rgba(0, 245, 255, 0.1);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 6px;
            padding: 10px 20px;
            color: var(--neon-glow);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            background: rgba(0, 245, 255, 0.2);
            border-color: var(--neon-glow);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 245, 255, 0.2);
        }

        .action-btn.primary {
            background: linear-gradient(45deg, var(--accent-cyan), var(--accent-blue));
            border-color: var(--neon-glow);
            color: #000;
        }

        .action-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            color: var(--text-primary);
        }

        .action-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* è¡¨å•é€‰æ‹©å™¨ */
        .form-select {
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 6px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 14px;
            min-width: 120px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-select:hover {
            border-color: var(--neon-glow);
            background: rgba(26, 26, 46, 0.9);
        }

        .form-select:focus {
            outline: none;
            border-color: var(--neon-glow);
            box-shadow: 0 0 8px rgba(0, 245, 255, 0.3);
        }

        .form-select option {
            background: rgba(26, 26, 46, 0.95);
            color: var(--text-primary);
            padding: 8px;
        }

        /* åˆ‡æ¢å¼€å…³ */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-label {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            transition: 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .toggle-label:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle-switch input:checked + .toggle-label {
            background: var(--neon-glow);
            border-color: var(--neon-glow);
        }

        .toggle-switch input:checked + .toggle-label:before {
            transform: translateX(26px);
            background: #000;
        }

        /* ä¿¡æ¯ç½‘æ ¼ */
        .info-grid {
            display: grid;
            gap: 12px;
        }

        .info-grid .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-grid .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
        }

        .info-value {
            color: var(--neon-glow);
            font-weight: 500;
            font-size: 13px;
        }

        /* ç¯å¢ƒæ ‡ç­¾é¡µå†…å®¹ */
        .environment-tab-content {
            display: none;
        }

        .environment-tab-content.active {
            display: block;
        }

        /* ç¯å¢ƒä¿¡æ¯ç½‘æ ¼ */
        .env-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        /* ç¯å¢ƒä¿¡æ¯å¡ç‰‡ */
        .env-info-card {
            background: rgba(26, 26, 46, 0.3);
            border: 1px solid rgba(0, 245, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .env-info-card h4 {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .env-info-card h4 i {
            color: var(--neon-glow);
        }

        /* ç¯å¢ƒä¿¡æ¯åˆ—è¡¨ */
        .env-info-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .env-info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 245, 255, 0.1);
        }

        .env-info-item:last-child {
            border-bottom: none;
        }

        .env-label {
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
        }

        .env-value {
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 600;
            text-align: right;
            max-width: 60%;
            word-break: break-all;
        }

        /* ç¯å¢ƒæ“ä½œæŒ‰é’® */
        .env-actions {
            display: flex;
            justify-content: center;
            gap: 16px;
        }

        .env-refresh-btn {
            background: linear-gradient(135deg, var(--neon-glow), #00ff88);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            color: #000;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .env-refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 245, 255, 0.3);
        }

        /* ç»ˆç«¯å®¹å™¨æ ·å¼ */
        .terminal-container {
            background: rgba(26, 26, 46, 0.3);
            border: 1px solid rgba(0, 245, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            height: 600px;
            display: flex;
            flex-direction: column;
        }

        .terminal-header {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px 16px;
            border-bottom: 1px solid rgba(0, 245, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .terminal-header h4 {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .terminal-controls {
            display: flex;
            gap: 8px;
        }

        .terminal-btn {
            background: rgba(0, 245, 255, 0.1);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 6px;
            padding: 6px 12px;
            color: var(--neon-glow);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .terminal-btn:hover {
            background: rgba(0, 245, 255, 0.2);
            border-color: var(--neon-glow);
        }

        .terminal-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #0a0a0a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
        }

        .terminal-welcome {
            padding: 16px;
            border-bottom: 1px solid rgba(0, 255, 0, 0.2);
            color: #00ff88;
        }

        .terminal-welcome p {
            margin: 4px 0;
        }

        .terminal-welcome ul {
            margin: 8px 0 0 20px;
            padding: 0;
        }

        .terminal-welcome li {
            margin: 4px 0;
        }

        .terminal-welcome code {
            background: rgba(0, 255, 0, 0.1);
            padding: 2px 4px;
            border-radius: 3px;
            color: #00ff00;
        }

        .terminal-output {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            scroll-behavior: smooth;
        }

        .terminal-output::-webkit-scrollbar {
            width: 8px;
        }

        .terminal-output::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .terminal-output::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 0, 0.3);
            border-radius: 4px;
        }

        .terminal-output::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 0, 0.5);
        }

        .terminal-input-line {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-top: 1px solid rgba(0, 255, 0, 0.2);
            background: rgba(0, 0, 0, 0.5);
        }

        .terminal-prompt {
            color: #00ff88;
            font-weight: bold;
            margin-right: 8px;
        }

        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            outline: none;
        }

        .terminal-input::placeholder {
            color: rgba(0, 255, 0, 0.5);
        }

        .plugin-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: rgba(26, 26, 46, 0.4);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 10px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .plugin-item:hover {
            border-color: rgba(0, 245, 255, 0.4);
            background: rgba(26, 26, 46, 0.6);
        }

        .plugin-item.disabled {
            opacity: 0.6;
        }

        .plugin-item.disabled .plugin-name {
            text-decoration: line-through;
        }

        /* ç©ºçŠ¶æ€æ ·å¼ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--accent-cyan);
            margin-bottom: 20px;
            opacity: 0.6;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .empty-state p {
            font-size: 1rem;
            margin-bottom: 30px;
            opacity: 0.8;
        }

        .empty-state .btn {
            padding: 12px 24px;
            background: linear-gradient(45deg, var(--accent-cyan), var(--accent-blue));
            border: 2px solid var(--neon-glow);
            border-radius: 8px;
            color: #000;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .empty-state .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.4);
        }

        .plugin-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .plugin-name {
            color: var(--neon-glow);
            font-size: 1rem;
            font-weight: 600;
            text-shadow: 0 0 5px var(--neon-glow);
            min-width: 200px;
        }

        .plugin-version {
            color: var(--text-secondary);
            font-size: 0.85rem;
            min-width: 80px;
        }

        .plugin-date {
            color: var(--text-secondary);
            font-size: 0.8rem;
            min-width: 100px;
        }

        .plugin-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .plugin-btn {
            padding: 6px 12px;
            border: 1px solid;
            border-radius: 6px;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
            text-decoration: none;
        }

        .plugin-btn-link {
            border-color: rgba(0, 150, 255, 0.5);
            color: #0096ff;
        }

        .plugin-btn-link:hover {
            background: rgba(0, 150, 255, 0.1);
            border-color: #0096ff;
        }

        .plugin-btn-update {
            border-color: rgba(0, 200, 100, 0.5);
            color: #00c864;
        }

        .plugin-btn-update:hover {
            background: rgba(0, 200, 100, 0.1);
            border-color: #00c864;
        }

        /* å·²å®‰è£…æ’ä»¶åŠŸèƒ½æŒ‰é’®æ ·å¼ - ä¸åŸå§‹é¡¹ç›®ä¿æŒä¸€è‡´ */
        [data-plugin-name] button {
            transition: all 0.2s ease !important;
        }

        [data-plugin-name] button:hover {
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2) !important;
        }

        /* ä¸»é¡µæŒ‰é’®æ‚¬åœæ•ˆæœ */
        [data-plugin-name] button[onclick*="openInExternalBrowser"]:hover {
            background: #0056b3 !important;
            box-shadow: 0 4px 8px rgba(0,123,255,0.4) !important;
        }

        /* å¯ç”¨/ç¦ç”¨æŒ‰é’®æ‚¬åœæ•ˆæœ */
        [data-plugin-name] button[onclick*="togglePlugin"]:hover {
            filter: brightness(1.1) !important;
        }

        /* å¸è½½æŒ‰é’®æ‚¬åœæ•ˆæœ */
        [data-plugin-name] button[onclick*="uninstallPlugin"]:hover {
            background: #c82333 !important;
            box-shadow: 0 4px 8px rgba(220,53,69,0.4) !important;
        }

        /* åˆ‡æ¢æŒ‰é’®æ‚¬åœæ•ˆæœ */
        [data-plugin-name] button[onclick*="showPluginVersions"]:hover {
            background: #5a6268 !important;
            box-shadow: 0 4px 8px rgba(108,117,125,0.4) !important;
        }

        /* æ›´æ–°æŒ‰é’®æ‚¬åœæ•ˆæœ */
        [data-plugin-name] button[onclick*="updatePlugin"]:hover {
            filter: brightness(1.1) !important;
        }

        /* æ‰‹åŠ¨å®‰è£…æ’ä»¶æ ·å¼ */
        .manual-install-container {
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .manual-install-info,
        .manual-install-form,
        .install-progress,
        .install-history {
            margin-bottom: 30px;
        }

        .info-card,
        .form-card,
        .progress-card,
        .history-card {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 12px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }

        .info-card h3,
        .form-card h3,
        .progress-card h3,
        .history-card h3 {
            color: var(--neon-glow);
            margin: 0 0 20px 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-content p {
            color: var(--text-primary);
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .info-content ul {
            color: var(--text-secondary);
            padding-left: 20px;
            margin-bottom: 20px;
        }

        .info-content li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .info-content strong {
            color: var(--neon-glow);
        }

        .warning-note {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ffc107;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            color: var(--text-primary);
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .url-input,
        .name-input {
            flex: 1;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .url-input:focus,
        .name-input:focus {
            outline: none;
            border-color: var(--neon-glow);
            box-shadow: 0 0 10px rgba(0, 245, 255, 0.3);
        }

        .validate-btn {
            padding: 12px 16px;
            background: rgba(0, 245, 255, 0.2);
            border: 1px solid var(--neon-glow);
            border-radius: 8px;
            color: var(--neon-glow);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 50px;
        }

        .validate-btn:hover {
            background: rgba(0, 245, 255, 0.3);
            transform: translateY(-1px);
        }

        .input-hint {
            margin-top: 8px;
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .install-options {
            margin: 25px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .option-group {
            margin-bottom: 15px;
        }

        .option-group:last-child {
            margin-bottom: 0;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 14px;
        }

        .option-checkbox {
            display: none;
        }

        .checkmark {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            position: relative;
            transition: all 0.3s ease;
        }

        .option-checkbox:checked + .checkmark {
            background: var(--neon-glow);
            border-color: var(--neon-glow);
        }

        .option-checkbox:checked + .checkmark::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000;
            font-weight: bold;
            font-size: 12px;
        }

        .install-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .install-btn,
        .clear-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
            justify-content: center;
        }

        .install-btn.primary {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #000;
        }

        .install-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }

        .clear-btn.secondary {
            background: rgba(108, 117, 125, 0.8);
            color: white;
        }

        .clear-btn.secondary:hover {
            background: rgba(108, 117, 125, 1);
            transform: translateY(-1px);
        }

        /* å®‰è£…è¿›åº¦æ ·å¼ */
        .progress-content {
            text-align: center;
        }

        .progress-info {
            margin-bottom: 20px;
        }

        .progress-text {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .progress-details {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .progress-bar-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-glow), #00ff88);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-percentage {
            color: var(--neon-glow);
            font-weight: 500;
            min-width: 40px;
            text-align: right;
        }

        .progress-actions {
            display: flex;
            justify-content: center;
        }

        .cancel-btn {
            padding: 10px 20px;
            background: rgba(220, 53, 69, 0.8);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cancel-btn:hover {
            background: rgba(220, 53, 69, 1);
            transform: translateY(-1px);
        }

        /* å®‰è£…å†å²æ ·å¼ */
        .history-content {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-empty {
            text-align: center;
            color: var(--text-secondary);
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .history-empty i {
            font-size: 24px;
            opacity: 0.5;
        }

        .history-item {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            border-color: rgba(0, 245, 255, 0.3);
            background: rgba(0, 245, 255, 0.05);
        }

        .history-item:last-child {
            margin-bottom: 0;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .history-name {
            color: var(--text-primary);
            font-weight: 500;
            font-size: 14px;
        }

        .history-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .history-status.success {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .history-status.failed {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.3);
        }

        .history-status.installing {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .history-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .history-url {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 15px;
        }

        .history-time {
            white-space: nowrap;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .manual-install-container {
                padding: 15px;
            }

            .input-container {
                flex-direction: column;
                align-items: stretch;
            }

            .validate-btn {
                margin-top: 10px;
            }

            .install-actions {
                flex-direction: column;
            }

            .progress-bar-container {
                flex-direction: column;
                gap: 10px;
            }

            .progress-percentage {
                text-align: center;
            }

            .history-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .history-details {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }

        .plugin-btn-switch {
            border-color: rgba(255, 165, 0, 0.5);
            color: #ffa500;
        }

        .plugin-btn-switch:hover {
            background: rgba(255, 165, 0, 0.1);
            border-color: #ffa500;
        }

        .plugin-btn-toggle {
            border-color: rgba(0, 245, 255, 0.5);
            color: var(--neon-glow);
        }

        .plugin-btn-toggle:hover {
            background: rgba(0, 245, 255, 0.1);
            border-color: var(--neon-glow);
        }

        .plugin-btn-toggle.disabled {
            border-color: rgba(255, 100, 100, 0.5);
            color: #ff6464;
        }

        .plugin-btn-toggle.disabled:hover {
            background: rgba(255, 100, 100, 0.1);
            border-color: #ff6464;
        }

        .plugin-btn-uninstall {
            border-color: rgba(255, 100, 100, 0.5);
            color: #ff6464;
        }

        .plugin-btn-uninstall:hover {
            background: rgba(255, 100, 100, 0.1);
            border-color: #ff6464;
        }

        /* æ–°æ’ä»¶å®‰è£…æ ·å¼ */
        .install-plugins {
            display: none;
        }

        .install-plugins.active {
            display: block;
        }

        .plugin-search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .plugin-search-input {
            flex: 1;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .plugin-search-input:focus {
            outline: none;
            border-color: var(--neon-glow);
            box-shadow: 0 0 10px rgba(0, 245, 255, 0.3);
        }

        .plugin-category-select {
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
            min-width: 150px;
        }

        .available-plugin-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: rgba(26, 26, 46, 0.4);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 10px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .available-plugin-item:hover {
            border-color: rgba(0, 245, 255, 0.4);
            background: rgba(26, 26, 46, 0.6);
        }

        .available-plugin-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .available-plugin-name {
            color: var(--neon-glow);
            font-size: 1rem;
            font-weight: 600;
            text-shadow: 0 0 5px var(--neon-glow);
            min-width: 250px;
        }

        .plugin-author {
            color: var(--text-secondary);
            font-size: 0.85rem;
            min-width: 120px;
        }

        .plugin-stars {
            color: #ffa500;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 80px;
        }

        .plugin-btn-install {
            border-color: rgba(0, 200, 100, 0.5);
            color: #00c864;
        }

        .plugin-btn-install:hover {
            background: rgba(0, 200, 100, 0.1);
            border-color: #00c864;
        }

        /* ç‰ˆæœ¬åˆ‡æ¢æ¨¡æ€æ¡† */
        .version-switch-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 15000;
            animation: modalFadeIn 0.3s ease;
        }

        .version-switch-modal.show {
            display: flex;
        }

        .version-switch-content {
            background: rgba(26, 26, 46, 0.95);
            border: 1px solid var(--neon-glow);
            border-radius: 12px;
            padding: 25px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.3);
        }

        .version-switch-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .version-switch-header h3 {
            color: var(--neon-glow);
            margin: 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 10px var(--neon-glow);
        }

        .version-close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .version-close-btn:hover {
            color: var(--text-primary);
        }



        .version-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .version-number {
            color: var(--neon-glow);
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* æ’ä»¶ç®¡ç†åŠ è½½çŠ¶æ€ */
        .plugin-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* æŒ‰é’®åŠ è½½çŠ¶æ€æ ·å¼ - ç»Ÿä¸€çš„ç‚¹ç‚¹ç‚¹åŠ¨ç”» */
        .btn-loading {
            pointer-events: none;
            opacity: 0.8;
        }

        .btn-loading .btn-text {
            position: relative;
        }

        /* ç‚¹ç‚¹ç‚¹åŠ¨ç”»æ•ˆæœ */
        .btn-loading .btn-text::after {
            content: '';
            display: inline-block;
            animation: loading-dots 1.5s infinite;
        }

        @keyframes loading-dots {
            0%, 20% {
                content: '';
            }
            25%, 45% {
                content: '.';
            }
            50%, 70% {
                content: '..';
            }
            75%, 95% {
                content: '...';
            }
            100% {
                content: '';
            }
        }

        .plugin-loading {
            gap: 15px;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 245, 255, 0.2);
            border-top: 3px solid var(--neon-glow);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .plugin-list {
            display: none;
        }

        .plugin-list.show {
            display: block;
        }

        /* æ’ä»¶ç‰ˆæœ¬åˆ‡æ¢æ¨¡æ€æ¡†æ ·å¼ */
        .version-switch-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 15000;
            animation: modalFadeIn 0.3s ease;
        }

        .version-switch-modal.show {
            display: flex;
        }

        .version-switch-content {
            background: rgba(26, 26, 46, 0.95);
            border: 1px solid var(--neon-glow);
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            backdrop-filter: blur(20px);
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .version-switch-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(0, 245, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .version-switch-header h3 {
            color: var(--neon-glow);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            text-shadow: 0 0 10px var(--neon-glow);
        }

        .close-btn {
            background: transparent;
            border: 1px solid rgba(255, 0, 0, 0.5);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            color: #ff4757;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: rgba(255, 0, 0, 0.1);
            border-color: #ff4757;
            transform: scale(1.1);
        }

        .version-switch-list {
            max-height: 50vh;
            overflow-y: auto;
            padding: 15px 25px 25px;
        }

        .version-switch-list .version-item {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .version-switch-list .version-item:hover {
            border-color: rgba(0, 245, 255, 0.4);
            background: rgba(26, 26, 46, 0.8);
        }

        .version-switch-list .version-item.current {
            border-color: var(--neon-glow);
            background: rgba(0, 245, 255, 0.03);
            box-shadow: 0 0 15px rgba(0, 245, 255, 0.3);
        }

        /* è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†æ ·å¼ */
        .custom-confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .custom-confirm-content {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 12px;
            min-width: 400px;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: confirmFadeIn 0.3s ease-out;
        }

        @keyframes confirmFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .custom-confirm-header {
            padding: 20px 20px 0 20px;
            border-bottom: 1px solid #444;
            margin-bottom: 20px;
        }

        .custom-confirm-header h3 {
            margin: 0;
            color: #fff;
            font-size: 18px;
            font-weight: 600;
        }

        .custom-confirm-body {
            padding: 0 20px 20px 20px;
            color: #ccc;
            line-height: 1.6;
        }

        .custom-confirm-body p {
            margin: 0;
            font-size: 14px;
        }

        .custom-confirm-footer {
            padding: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            border-top: 1px solid #444;
        }

        .custom-confirm-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 80px;
        }

        .custom-confirm-btn.cancel {
            background: #444;
            color: #ccc;
        }

        .custom-confirm-btn.cancel:hover {
            background: #555;
            color: #fff;
        }

        .custom-confirm-btn.confirm {
            background: #00ff88;
            color: #000;
        }

        .custom-confirm-btn.confirm:hover {
            background: #00e67a;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="launcher-container">
        <!-- èƒŒæ™¯å›¾ç‰‡ -->
        <div class="background-container">
            <img id="backgroundImage" class="background-image" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxyYWRpYWxHcmFkaWVudCBpZD0iZ3JhZGllbnQiIGN4PSI1MCUiIGN5PSI1MCUiIHI9IjUwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiMwZjRjNzUiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSI1MCUiIHN0b3AtY29sb3I9IiMxNjIxM2UiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjMGEwYTBmIi8+CiAgICA8L3JhZGlhbEdyYWRpZW50PgogIDwvZGVmcz4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyYWRpZW50KSIvPgo8L3N2Zz4=" alt="Default Background">
            <video id="backgroundVideo" class="background-video" autoplay muted loop>
                <source src="" type="video/mp4">
                <source src="" type="video/webm">
            </video>
            <div class="background-overlay"></div>
        </div>



        <!-- å†…å®¹å±‚ -->
        <div class="content-layer">
            <!-- é¡¶éƒ¨æ ‡é¢˜ -->
            <div class="header-section">
                <h1 class="app-title">AIè§†ç•Œ</h1>
                <p class="app-subtitle">Create New Visual Horizons with AI</p>
            </div>

            <!-- åŠŸèƒ½å¯¼èˆªæ ‡ç­¾ -->
            <nav class="navigation-tabs">
                <button class="tab-btn active" data-tab="home">ä¸»é¡µ</button>
                <button class="tab-btn" data-tab="launch-settings">å¯åŠ¨è®¾ç½®</button>
                <button class="tab-btn" data-tab="version-management">ç‰ˆæœ¬ç®¡ç†</button>
                <button class="tab-btn" data-tab="plugin-management">æ’ä»¶ç®¡ç†</button>
                <button class="tab-btn" data-tab="environment-config">ç¯å¢ƒé…ç½®</button>
                <button class="tab-btn" data-tab="settings">è®¾ç½®</button>
            </nav>

            <!-- ä¸»å†…å®¹åŒºåŸŸ -->
            <div class="main-content">
                <!-- ä¸»é¡µé¢å†…å®¹ -->
                <div class="main-home" id="mainHome">
                    <!-- åº•éƒ¨å¯åŠ¨åŒºåŸŸ -->
                    <div class="launch-section">
                        <button class="launch-btn" id="launchBtn">
                            <i class="fas fa-rocket"></i>
                            å¯åŠ¨ COMFYUI
                        </button>

                        <!-- æ‰“å¼€æµè§ˆå™¨æŒ‰é’® -->
                        <button class="browser-btn" id="browserBtn" style="display: none;">
                            <i class="fas fa-external-link-alt"></i>
                            æ‰“å¼€æµè§ˆå™¨
                        </button>

                        <!-- æ˜¾å¡ä¿¡æ¯ -->
                        <div class="gpu-info" id="gpuInfo">
                            <div class="gpu-details">
                                <div class="gpu-icon-container">
                                    <i class="fas fa-microchip gpu-icon"></i>
                                    <div class="rotating-ring"></div>
                                </div>
                                <div class="gpu-text">
                                    <span class="gpu-name" id="gpuName">æ£€æµ‹ä¸­...</span>
                                    <span class="gpu-usage" id="gpuUsage">æ˜¾å­˜: 0GB / 16GB</span>
                                </div>
                            </div>
                            <div class="gpu-status" id="gpuStatus">45%</div>
                        </div>
                    </div>
                </div>

                <!-- å¯åŠ¨è®¾ç½®é¡µé¢ -->
                <div id="launch-settings" class="tab-content">
                <div class="launch-settings-container">
                    <!-- å¿«é€Ÿé…ç½®é¢„è®¾ -->
                    <section class="preset-section">
                        <h3>å¿«é€Ÿé…ç½®é¢„è®¾</h3>
                        <div class="preset-cards">
                            <div class="preset-card" data-preset="high-end">
                                <h4>é«˜ç«¯æ˜¾å¡ (16GB+)</h4>
                                <p>--highvram --use-flash-attention --bf16-unet</p>
                            </div>
                            <div class="preset-card" data-preset="mid-range">
                                <h4>ä¸­ç«¯æ˜¾å¡ (8-16GB)</h4>
                                <p>--normalvram --use-pytorch-cross-attention</p>
                            </div>
                            <div class="preset-card" data-preset="low-end">
                                <h4>ä½ç«¯æ˜¾å¡ (4-8GB)</h4>
                                <p>--lowvram --use-split-cross-attention</p>
                            </div>
                        </div>
                    </section>

                    <!-- æ˜¾å­˜ä¼˜åŒ– -->
                    <section class="memory-section">
                        <h3><i class="fas fa-memory"></i> æ˜¾å­˜ä¼˜åŒ–</h3>
                        <div class="memory-mode-selector">
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="vram-mode" value="gpu-only" id="gpu-only">
                                    <span>GPUä¸“ç”¨æ¨¡å¼</span>
                                    <small>æ‰€æœ‰æ¨¡å‹ä¿æŒåœ¨GPU (éœ€å¤§æ˜¾å­˜)</small>
                                </label>

                                <label class="radio-item">
                                    <input type="radio" name="vram-mode" value="highvram" id="highvram" checked>
                                    <span>é«˜æ˜¾å­˜æ¨¡å¼</span>
                                    <small>æ¨¡å‹ä¿æŒåœ¨GPUå†…å­˜ä¸­ (æ¨è)</small>
                                </label>

                                <label class="radio-item">
                                    <input type="radio" name="vram-mode" value="normalvram" id="normalvram">
                                    <span>æ™®é€šæ¨¡å¼</span>
                                    <small>å¹³è¡¡æ˜¾å­˜ä½¿ç”¨</small>
                                </label>

                                <label class="radio-item">
                                    <input type="radio" name="vram-mode" value="lowvram" id="lowvram">
                                    <span>ä½æ˜¾å­˜æ¨¡å¼</span>
                                    <small>æ‹†åˆ†UNetå‡å°‘æ˜¾å­˜ä½¿ç”¨</small>
                                </label>

                                <label class="radio-item">
                                    <input type="radio" name="vram-mode" value="cpu" id="cpu">
                                    <span>CPUæ¨¡å¼</span>
                                    <small>æ‰€æœ‰è®¡ç®—åœ¨CPU (æ˜¾å­˜ä¸è¶³æ—¶)</small>
                                </label>
                            </div>
                        </div>

                        <div class="advanced-memory">
                            <div class="setting-item horizontal">
                                <label>é¢„ç•™æ˜¾å­˜ (GB)</label>
                                <div class="input-with-hint">
                                    <input type="number" id="reserve-vram" step="0.5" min="0" max="16" value="0">
                                    <small class="hint">ä¸ºç³»ç»Ÿé¢„ç•™çš„æ˜¾å­˜å¤§å°</small>
                                </div>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="async-offload">
                                <label for="async-offload">å¼‚æ­¥æƒé‡å¸è½½</label>
                                <small class="hint">æå‡å¤§æ¨¡å‹åŠ è½½é€Ÿåº¦</small>
                            </div>
                        </div>
                    </section>

                    <!-- äº¤å‰æ³¨æ„åŠ›ä¼˜åŒ– -->
                    <section class="attention-section">
                        <h3><i class="fas fa-brain"></i> äº¤å‰æ³¨æ„åŠ›ä¼˜åŒ–</h3>
                        <div class="attention-selector">
                            <div class="setting-item horizontal">
                                <label>æ³¨æ„åŠ›ä¼˜åŒ–æ–¹æ³•</label>
                                <select id="attention-method">
                                    <option value="">é»˜è®¤</option>
                                    <option value="use-flash-attention">FlashAttention (æ¨è - é«˜ç«¯æ˜¾å¡)</option>
                                    <option value="use-pytorch-cross-attention">PyTorch 2.0 (ç¨³å®šæ€§å¥½)</option>
                                    <option value="use-sage-attention">Sage Attention (æ–°æŠ€æœ¯)</option>
                                    <option value="use-split-cross-attention">åˆ†å‰²æ³¨æ„åŠ› (çœæ˜¾å­˜)</option>
                                    <option value="use-quad-cross-attention">äºŒæ¬¡æ³¨æ„åŠ› (å…¼å®¹æ€§å¥½)</option>
                                </select>
                            </div>
                        </div>

                        <div class="attention-options">
                            <div class="setting-item horizontal">
                                <label>æ³¨æ„åŠ›ä¸Šé‡‡æ ·</label>
                                <select id="upcast-mode">
                                    <option value="">è‡ªåŠ¨</option>
                                    <option value="force-upcast-attention">å¼ºåˆ¶å¯ç”¨</option>
                                    <option value="dont-upcast-attention">ç¦ç”¨</option>
                                </select>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="disable-xformers">
                                <label for="disable-xformers">ç¦ç”¨ xformers</label>
                                <small class="hint">è§£å†³æŸäº›å…¼å®¹æ€§é—®é¢˜</small>
                            </div>
                        </div>
                    </section>

                    <!-- ç›‘å¬è®¾ç½® -->
                    <section class="network-section">
                        <h3><i class="fas fa-network-wired"></i> ç›‘å¬è®¾ç½®</h3>
                        <div class="setting-grid">
                            <div class="setting-item horizontal">
                                <label>ç›‘å¬åœ°å€</label>
                                <div class="input-with-hint">
                                    <select id="listen-ip">
                                        <option value="127.0.0.1">127.0.0.1 (ä»…æœ¬æœºè®¿é—®)</option>
                                        <option value="0.0.0.0">0.0.0.0 (å…è®¸å¤–éƒ¨è®¿é—®)</option>
                                    </select>
                                    <small class="hint">é€‰æ‹©0.0.0.0å¯é€šè¿‡å±€åŸŸç½‘è®¿é—®</small>
                                </div>
                            </div>
                            <div class="setting-item horizontal">
                                <label>ç«¯å£</label>
                                <div class="input-with-hint">
                                    <input type="number" id="port" value="8188" min="1" max="65535">
                                    <small class="hint">Webç•Œé¢è®¿é—®ç«¯å£</small>
                                </div>
                            </div>
                            <div class="setting-item horizontal">
                                <label>CORSè®¾ç½®</label>
                                <div class="input-with-hint">
                                    <select id="cors-setting">
                                        <option value="">ç¦ç”¨</option>
                                        <option value="enable-cors-header">å¯ç”¨è·¨åŸŸæ”¯æŒ</option>
                                    </select>
                                    <small class="hint">APIè°ƒç”¨æ—¶éœ€è¦å¯ç”¨</small>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- ä»£ç†è®¾ç½® -->
                    <section class="proxy-section">
                        <h3><i class="fas fa-globe"></i> ä»£ç†è®¾ç½®</h3>
                        <div class="proxy-settings">
                            <div class="checkbox-item">
                                <input type="checkbox" id="enable-proxy">
                                <label for="enable-proxy">å¯ç”¨ä»£ç†</label>
                                <small class="hint">ç”¨äºæ¨¡å‹ä¸‹è½½å’ŒAPIè®¿é—®</small>
                            </div>
                            <div class="proxy-inputs" id="proxy-inputs" style="display: none;">
                                <div class="setting-item horizontal">
                                    <label>HTTPä»£ç†</label>
                                    <input type="text" id="http-proxy" placeholder="http://proxy.example.com:8080">
                                </div>
                                <div class="setting-item horizontal">
                                    <label>HTTPSä»£ç†</label>
                                    <input type="text" id="https-proxy" placeholder="https://proxy.example.com:8080">
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- å‘½ä»¤é¢„è§ˆ -->
                    <section class="preview-section">
                        <h3><i class="fas fa-terminal"></i> å¯åŠ¨å‘½ä»¤é¢„è§ˆ</h3>
                        <div class="command-preview" id="command-preview">
                            python main.py --listen 127.0.0.1 --port 8188 --highvram
                        </div>
                    </section>

                    <!-- æ“ä½œæŒ‰é’® -->
                    <section class="actions-section">
                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveSettings()">
                                <i class="fas fa-save"></i> ä¿å­˜é…ç½®
                            </button>
                            <button class="btn btn-success" onclick="applyAndLaunch()">
                                <i class="fas fa-rocket"></i> åº”ç”¨å¹¶å¯åŠ¨
                            </button>
                            <button class="btn btn-warning" onclick="resetToDefault()">
                                <i class="fas fa-undo"></i> é‡ç½®é»˜è®¤
                            </button>
                        </div>
                    </section>
                </div>
                </div>

                <!-- ç‰ˆæœ¬ç®¡ç†é¡µé¢ -->
                <div id="version-management" class="tab-content">
                <div class="version-management-container">
                    <!-- é¡µé¢å¤´éƒ¨ -->
                    <div class="version-header">
                        <h2><i class="fas fa-code-branch"></i> ç‰ˆæœ¬ç®¡ç†</h2>
                        <button class="refresh-versions-btn" onclick="launcherInstance.forceRefreshVersions()" title="åˆ·æ–°ç‰ˆæœ¬æ•°æ®">
                            <i class="fas fa-sync-alt"></i> åˆ·æ–°
                        </button>
                    </div>

                    <!-- ç‰ˆæœ¬ç±»å‹åˆ‡æ¢ -->
                    <div class="version-tabs">
                        <button class="version-tab-btn active" data-type="stable">
                            <i class="fas fa-shield-alt"></i> ç¨³å®šç‰ˆ
                        </button>
                        <button class="version-tab-btn" data-type="development">
                            <i class="fas fa-flask"></i> å¼€å‘ç‰ˆ
                        </button>
                    </div>

                    <!-- ç‰ˆæœ¬åˆ—è¡¨å®¹å™¨ -->
                    <div class="version-list-container">
                        <!-- åŠ è½½çŠ¶æ€ -->
                        <div class="version-loading" id="version-loading">
                            <div class="loading-spinner"></div>
                            <div class="loading-content">
                                <span id="version-loading-text">æ­£åœ¨åŠ è½½ç‰ˆæœ¬ä¿¡æ¯...</span>
                                <div class="loading-progress-bar">
                                    <div class="loading-progress-fill" id="version-progress-fill"></div>
                                </div>
                            </div>
                        </div>

                        <!-- ç¨³å®šç‰ˆåˆ—è¡¨ -->
                        <div class="version-list" id="stable-versions">
                            <!-- åŠ¨æ€ç”Ÿæˆå†…å®¹ -->
                        </div>

                        <!-- å¼€å‘ç‰ˆåˆ—è¡¨ -->
                        <div class="version-list" id="development-versions" style="display: none;">
                            <!-- åŠ¨æ€ç”Ÿæˆå†…å®¹ -->
                        </div>
                    </div>
                </div>

                <!-- ç‰ˆæœ¬åˆ‡æ¢ç¡®è®¤å¯¹è¯æ¡† -->
                <div class="version-modal" id="version-confirm-modal">
                    <div class="modal-content">
                        <h3><i class="fas fa-exclamation-triangle"></i> ç¡®è®¤ç‰ˆæœ¬åˆ‡æ¢</h3>
                        <p id="modal-message">ç¡®å®šè¦åˆ‡æ¢åˆ°ç‰ˆæœ¬ <span id="target-version"></span> å—ï¼Ÿ</p>
                        <div class="modal-actions">
                            <button class="btn btn-warning" onclick="if(window.audioManager) audioManager.play('click'); cancelVersionSwitch()">å–æ¶ˆ</button>
                            <button class="btn btn-primary" onclick="if(window.audioManager) audioManager.play('click'); confirmVersionSwitch()">ç¡®è®¤åˆ‡æ¢</button>
                        </div>
                    </div>
                </div>

                <!-- åˆ‡æ¢è¿›åº¦å¯¹è¯æ¡† -->
                <div class="version-modal" id="version-progress-modal">
                    <div class="modal-content">
                        <h3><i class="fas fa-sync-alt fa-spin"></i> æ­£åœ¨åˆ‡æ¢ç‰ˆæœ¬</h3>
                        <p id="progress-message">æ­£åœ¨åˆ‡æ¢åˆ°ç‰ˆæœ¬ <span id="progress-version"></span>...</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <small>è¯·ç¨å€™ï¼Œä¸è¦å…³é—­é¡µé¢</small>
                    </div>
                </div>
                </div>

                <!-- æ’ä»¶ç®¡ç†é¡µé¢ -->
                <div id="plugin-management" class="tab-content">
                    <div class="plugin-management-container">
                        <!-- é¡µé¢å¤´éƒ¨ -->
                        <div class="plugin-header">
                            <h2><i class="fas fa-puzzle-piece"></i> æ’ä»¶ç®¡ç†</h2>
                        </div>

                        <!-- æ’ä»¶ç±»å‹åˆ‡æ¢ -->
                        <div class="plugin-tabs">
                            <button class="plugin-tab-btn active" data-type="installed">
                                <i class="fas fa-check-circle"></i> å·²å®‰è£…
                            </button>
                            <button class="plugin-tab-btn" data-type="available">
                                <i class="fas fa-download"></i> å®‰è£…æ–°æ’ä»¶
                            </button>
                            <button class="plugin-tab-btn" data-type="manual">
                                <i class="fas fa-code-branch"></i> æ‰‹åŠ¨å®‰è£…
                            </button>
                        </div>

                        <!-- æ’ä»¶å†…å®¹å®¹å™¨ -->
                        <div class="plugin-content">
                            <!-- å·²å®‰è£…æ’ä»¶åˆ—è¡¨ -->
                            <div class="installed-plugins active" id="installed-plugins">
                                <div class="plugin-loading" id="installed-loading" style="display: flex;">
                                    <div class="loading-spinner"></div>
                                    <div class="loading-content">
                                        <span id="installed-loading-text">æ­£åœ¨åŠ è½½å·²å®‰è£…æ’ä»¶...</span>
                                        <div class="loading-progress-bar">
                                            <div class="loading-progress-fill" id="installed-progress-fill"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="plugin-list" id="installed-plugin-list" style="display: none;">
                                    <!-- æ’ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>

                            <!-- å¯å®‰è£…æ’ä»¶åˆ—è¡¨ -->
                            <div class="available-plugins" id="available-plugins" style="display: none;">
                                <!-- æœç´¢å’Œè¿‡æ»¤å·¥å…·æ  -->
                                <div class="plugin-toolbar">
                                    <div class="search-container">
                                        <input type="text" id="plugin-search" placeholder="æœç´¢æ’ä»¶åç§°ã€ä½œè€…æˆ–æè¿°..." class="search-input">
                                        <i class="fas fa-search search-icon"></i>
                                    </div>
                                    <div class="filter-container">
                                        <select id="category-filter" class="category-select">
                                            <option value="">æ‰€æœ‰åˆ†ç±»</option>
                                            <option value="image">å›¾åƒå¤„ç†</option>
                                            <option value="video">è§†é¢‘å¤„ç†</option>
                                            <option value="audio">éŸ³é¢‘å¤„ç†</option>
                                            <option value="ai">AIæ¨¡å‹</option>
                                            <option value="3d">3Dç›¸å…³</option>
                                            <option value="tool">å·¥å…·ç±»</option>
                                            <option value="other">å…¶ä»–</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="plugin-loading" id="available-loading" style="display: none;">
                                    <div class="loading-spinner"></div>
                                    <div class="loading-content">
                                        <span id="available-loading-text">æ­£åœ¨åŠ è½½å¯å®‰è£…æ’ä»¶...</span>
                                        <div class="loading-progress-bar">
                                            <div class="loading-progress-fill" id="available-progress-fill"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="plugin-list" id="available-plugin-list">
                                    <!-- å¯å®‰è£…æ’ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>

                            <!-- æ‰‹åŠ¨å®‰è£…æ’ä»¶ -->
                            <div class="manual-install-plugins" id="manual-install-plugins" style="display: none;">
                                <div class="manual-install-container">

                                    <!-- å®‰è£…è¡¨å• -->
                                    <div class="manual-install-form">
                                        <div class="form-card">
                                            <h3><i class="fas fa-download"></i> å®‰è£…æ’ä»¶</h3>
                                            <div class="form-content">
                                                <div class="input-group">
                                                    <label for="plugin-url">Gitä»“åº“åœ°å€</label>
                                                    <div class="input-container">
                                                        <input type="url"
                                                               id="plugin-url"
                                                               placeholder="è¯·è¾“å…¥Gitä»“åº“åœ°å€ï¼Œä¾‹å¦‚ï¼šhttps://github.com/username/repository"
                                                               class="url-input">
                                                        <button class="validate-btn" onclick="validatePluginUrl()" title="éªŒè¯åœ°å€">
                                                            <i class="fas fa-check"></i>
                                                        </button>
                                                    </div>
                                                    <div class="input-hint" id="url-hint">
                                                        <i class="fas fa-lightbulb"></i>
                                                        <span>æ”¯æŒGitHubã€GitLabã€Giteeç­‰Gitä»“åº“åœ°å€</span>
                                                    </div>
                                                </div>



                                                <div class="install-options">
                                                    <div class="option-group">
                                                        <label class="checkbox-label">
                                                            <input type="checkbox" id="force-install" class="option-checkbox">
                                                            <span class="checkmark"></span>
                                                            <span class="option-text">å¼ºåˆ¶å®‰è£…ï¼ˆè¦†ç›–å·²å­˜åœ¨çš„æ’ä»¶ï¼‰</span>
                                                        </label>
                                                    </div>
                                                    <div class="option-group">
                                                        <label class="checkbox-label">
                                                            <input type="checkbox" id="shallow-clone" class="option-checkbox" checked>
                                                            <span class="checkmark"></span>
                                                            <span class="option-text">æµ…å…‹éš†ï¼ˆä»…ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼ŒèŠ‚çœç©ºé—´ï¼‰</span>
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="install-actions">
                                                    <button class="install-btn primary" onclick="installManualPlugin()">
                                                        <i class="fas fa-download"></i>
                                                        å¼€å§‹å®‰è£…
                                                    </button>
                                                    <button class="clear-btn secondary" onclick="clearManualInstallForm()">
                                                        <i class="fas fa-eraser"></i>
                                                        æ¸…ç©ºè¡¨å•
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- å®‰è£…è¿›åº¦ -->
                                    <div class="install-progress" id="manual-install-progress" style="display: none;">
                                        <div class="progress-card">
                                            <h3><i class="fas fa-spinner fa-spin"></i> æ­£åœ¨å®‰è£…æ’ä»¶</h3>
                                            <div class="progress-content">
                                                <div class="progress-info">
                                                    <div class="progress-text" id="progress-text">å‡†å¤‡å®‰è£…...</div>
                                                    <div class="progress-details" id="progress-details"></div>
                                                </div>
                                                <div class="progress-bar-container">
                                                    <div class="progress-bar">
                                                        <div class="progress-fill" id="manual-progress-fill"></div>
                                                    </div>
                                                    <div class="progress-percentage" id="progress-percentage">0%</div>
                                                </div>
                                                <div class="progress-actions">
                                                    <button class="cancel-btn" onclick="cancelManualInstall()">
                                                        <i class="fas fa-times"></i>
                                                        å–æ¶ˆå®‰è£…
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç¯å¢ƒé…ç½®é¡µé¢ -->
                <div id="environment-config" class="tab-content">
                    <div class="environment-container">
                        <!-- ç¯å¢ƒé…ç½®å­æ ‡ç­¾å¯¼èˆª -->
                        <div class="environment-tabs">
                            <button class="environment-tab-btn active" onclick="switchEnvironmentTab('env-info')">
                                <i class="fas fa-info-circle"></i>
                                ç¯å¢ƒä¿¡æ¯
                            </button>
                            <button class="environment-tab-btn" onclick="switchEnvironmentTab('env-terminal')">
                                <i class="fas fa-terminal"></i>
                                é¡¹ç›®ç»ˆç«¯
                            </button>
                        </div>

                        <!-- ç¯å¢ƒä¿¡æ¯æ ‡ç­¾é¡µ -->
                        <div id="env-info" class="environment-tab-content active">
                            <div class="env-info-grid">
                                <!-- Pythonç¯å¢ƒä¿¡æ¯ -->
                                <div class="env-info-card">
                                    <h4><i class="fab fa-python"></i> Pythonç¯å¢ƒ</h4>
                                    <div class="env-info-list">
                                        <div class="env-info-item">
                                            <span class="env-label">Pythonç‰ˆæœ¬:</span>
                                            <span class="env-value" id="python-version">æ£€æµ‹ä¸­...</span>
                                        </div>
                                        <div class="env-info-item">
                                            <span class="env-label">Pythonè·¯å¾„:</span>
                                            <span class="env-value" id="python-path">æ£€æµ‹ä¸­...</span>
                                        </div>
                                        <div class="env-info-item">
                                            <span class="env-label">è™šæ‹Ÿç¯å¢ƒ:</span>
                                            <span class="env-value" id="venv-status">æ£€æµ‹ä¸­...</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- CUDAç¯å¢ƒä¿¡æ¯ -->
                                <div class="env-info-card">
                                    <h4><i class="fas fa-microchip"></i> CUDAç¯å¢ƒ</h4>
                                    <div class="env-info-list">
                                        <div class="env-info-item">
                                            <span class="env-label">CUDAç‰ˆæœ¬:</span>
                                            <span class="env-value" id="cuda-version">æ£€æµ‹ä¸­...</span>
                                        </div>
                                        <div class="env-info-item">
                                            <span class="env-label">GPUè®¾å¤‡:</span>
                                            <span class="env-value" id="gpu-info">æ£€æµ‹ä¸­...</span>
                                        </div>
                                        <div class="env-info-item">
                                            <span class="env-label">æ˜¾å­˜ä¿¡æ¯:</span>
                                            <span class="env-value" id="gpu-memory">æ£€æµ‹ä¸­...</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- PyTorchç¯å¢ƒä¿¡æ¯ -->
                                <div class="env-info-card">
                                    <h4><i class="fas fa-fire"></i> PyTorchç¯å¢ƒ</h4>
                                    <div class="env-info-list">
                                        <div class="env-info-item">
                                            <span class="env-label">PyTorchç‰ˆæœ¬:</span>
                                            <span class="env-value" id="pytorch-version">æ£€æµ‹ä¸­...</span>
                                        </div>
                                        <div class="env-info-item">
                                            <span class="env-label">CUDAæ”¯æŒ:</span>
                                            <span class="env-value" id="pytorch-cuda">æ£€æµ‹ä¸­...</span>
                                        </div>
                                        <div class="env-info-item">
                                            <span class="env-label">è®¾å¤‡çŠ¶æ€:</span>
                                            <span class="env-value" id="pytorch-device">æ£€æµ‹ä¸­...</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- ä¾èµ–çŠ¶æ€ä¿¡æ¯ -->
                                <div class="env-info-card">
                                    <h4><i class="fas fa-puzzle-piece"></i> ä¾èµ–çŠ¶æ€</h4>
                                    <div class="env-info-list">
                                        <div class="env-info-item">
                                            <span class="env-label">æ ¸å¿ƒä¾èµ–:</span>
                                            <span class="env-value" id="core-deps">æ£€æµ‹ä¸­...</span>
                                        </div>
                                        <div class="env-info-item">
                                            <span class="env-label">å¯é€‰ä¾èµ–:</span>
                                            <span class="env-value" id="optional-deps">æ£€æµ‹ä¸­...</span>
                                        </div>
                                        <div class="env-info-item">
                                            <span class="env-label">ç¯å¢ƒçŠ¶æ€:</span>
                                            <span class="env-value" id="env-status">æ£€æµ‹ä¸­...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- åˆ·æ–°æŒ‰é’® -->
                            <div class="env-actions">
                                <button class="env-refresh-btn" onclick="refreshEnvironmentInfo()">
                                    <i class="fas fa-sync-alt"></i>
                                    åˆ·æ–°ç¯å¢ƒä¿¡æ¯
                                </button>
                            </div>
                        </div>

                        <!-- é¡¹ç›®ç»ˆç«¯æ ‡ç­¾é¡µ -->
                        <div id="env-terminal" class="environment-tab-content">
                            <div class="terminal-container">
                                <div class="terminal-header">
                                    <h4><i class="fas fa-terminal"></i> ComfyUIé¡¹ç›®ç»ˆç«¯</h4>
                                    <div class="terminal-controls">
                                        <button class="terminal-btn" onclick="clearTerminal()">
                                            <i class="fas fa-trash"></i>
                                            æ¸…ç©º
                                        </button>
                                    </div>
                                </div>
                                <div class="terminal-content" id="project-terminal">
                                    <div class="terminal-welcome">
                                        <p><i class="fas fa-info-circle"></i> ComfyUIé¡¹ç›®è™šæ‹Ÿç¯å¢ƒç»ˆç«¯</p>
                                        <p>å½“å‰å·¥ä½œç›®å½•: <span id="terminal-cwd">æ£€æµ‹ä¸­...</span></p>
                                        <p>è™šæ‹Ÿç¯å¢ƒ: <span id="terminal-venv">æ£€æµ‹ä¸­...</span></p>
                                        <p>Pythonç‰ˆæœ¬: <span id="terminal-python">æ£€æµ‹ä¸­...</span></p>
                                        <p>ç¯å¢ƒçŠ¶æ€: <span id="terminal-status">æ£€æµ‹ä¸­...</span></p>
                                        <hr>
                                        <p>å¯ç”¨å‘½ä»¤ç¤ºä¾‹:</p>
                                        <ul>
                                            <li><code>help</code> - æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤</li>
                                            <li><code>pip list</code> - æŸ¥çœ‹å·²å®‰è£…åŒ…</li>
                                            <li><code>python --version</code> - æŸ¥çœ‹Pythonç‰ˆæœ¬</li>
                                            <li><code>git status</code> - æŸ¥çœ‹GitçŠ¶æ€</li>
                                            <li><code>nvidia-smi</code> - æŸ¥çœ‹GPUä¿¡æ¯</li>
                                        </ul>
                                    </div>
                                    <div class="terminal-output" id="terminal-output">
                                        <!-- ç»ˆç«¯è¾“å‡ºå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                                    </div>
                                    <div class="terminal-input-line">
                                        <span class="terminal-prompt" id="terminal-prompt">cmd> </span>
                                        <input type="text" class="terminal-input" id="terminal-input" placeholder="è¾“å…¥å‘½ä»¤..." onkeypress="handleTerminalInput(event)">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è®¾ç½®é¡µé¢ -->
                <div id="settings" class="tab-content">
                    <div class="content-header">
                        <h2><i class="fas fa-cog"></i> è®¾ç½®</h2>
                    </div>

                    <div class="settings-container">
                        <!-- å¡ç‰‡å¼ç½‘æ ¼å¸ƒå±€ -->
                        <div class="settings-cards-grid">
                            <!-- ç•Œé¢ä¸ªæ€§åŒ–å¡ç‰‡ -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <h3><i class="fas fa-palette"></i> ç•Œé¢ä¸ªæ€§åŒ–</h3>
                                    <p>è‡ªå®šä¹‰å¯åŠ¨å™¨çš„å¤–è§‚å’Œä¸»é¢˜</p>
                                </div>

                                <div class="settings-card-content">
                                    <!-- èƒŒæ™¯è®¾ç½® -->
                                    <div class="settings-group">
                                        <h4><i class="fas fa-image"></i> èƒŒæ™¯è®¾ç½®</h4>
                                        <div class="settings-items">
                                            <div class="setting-item compact">
                                                <label>èƒŒæ™¯å›¾ç‰‡</label>
                                                <button class="upload-btn compact" onclick="document.getElementById('backgroundImageUpload').click()">
                                                    <i class="fas fa-upload"></i> é€‰æ‹©å›¾ç‰‡
                                                </button>
                                                <input type="file" id="backgroundImageUpload" accept="image/*" style="display: none;">
                                            </div>

                                            <div class="setting-item compact">
                                                <label>èƒŒæ™¯è§†é¢‘</label>
                                                <button class="upload-btn compact" onclick="document.getElementById('backgroundVideoUpload').click()">
                                                    <i class="fas fa-video"></i> é€‰æ‹©è§†é¢‘
                                                </button>
                                                <input type="file" id="backgroundVideoUpload" accept="video/*" style="display: none;">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ä¸»é¢˜è®¾ç½® -->
                                    <div class="settings-group">
                                        <h4><i class="fas fa-paint-brush"></i> ä¸»é¢˜è®¾ç½®</h4>
                                        <div class="settings-items">
                                            <div class="setting-item compact">
                                                <label>éœ“è™¹è‰²å½©ä¸»é¢˜</label>
                                                <div class="theme-selector compact">
                                                    <button class="theme-btn active compact" data-theme="blue" onclick="switchTheme('blue')">
                                                        <span class="theme-color" style="background: #00f5ff;"></span>
                                                        è“è‰²
                                                    </button>
                                                    <button class="theme-btn compact" data-theme="green" onclick="switchTheme('green')">
                                                        <span class="theme-color" style="background: #00ff88;"></span>
                                                        ç»¿è‰²
                                                    </button>
                                                    <button class="theme-btn compact" data-theme="purple" onclick="switchTheme('purple')">
                                                        <span class="theme-color" style="background: #8a2be2;"></span>
                                                        ç´«è‰²
                                                    </button>
                                                    <button class="theme-btn compact" data-theme="red" onclick="switchTheme('red')">
                                                        <span class="theme-color" style="background: #ff4757;"></span>
                                                        çº¢è‰²
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- å¯åŠ¨å™¨ç®¡ç†å¡ç‰‡ -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <h3><i class="fas fa-rocket"></i> å¯åŠ¨å™¨ç®¡ç†</h3>
                                    <p>ç®¡ç†å¯åŠ¨å™¨çš„æ›´æ–°å’Œç‰ˆæœ¬ä¿¡æ¯</p>
                                </div>

                                <div class="settings-card-content">
                                    <!-- æ›´æ–°è®¾ç½® -->
                                    <div class="settings-group">
                                        <h4><i class="fas fa-sync-alt"></i> æ›´æ–°è®¾ç½®</h4>
                                        <div class="settings-items">
                                            <div class="setting-item">
                                                <label>æ£€æŸ¥æ›´æ–°</label>
                                                <button class="action-btn primary" id="check-launcher-update-btn" onclick="checkLauncherUpdate()">
                                                    <i class="fas fa-search"></i> æ£€æŸ¥æ›´æ–°
                                                </button>
                                            </div>

                                            <div class="setting-item">
                                                <label>è‡ªåŠ¨æ›´æ–°</label>
                                                <div class="toggle-switch">
                                                    <input type="checkbox" id="autoUpdate" checked>
                                                    <label for="autoUpdate" class="toggle-label"></label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
                                    <div class="settings-group">
                                        <h4><i class="fas fa-info-circle"></i> ç‰ˆæœ¬ä¿¡æ¯</h4>
                                        <div class="info-list">
                                            <div class="info-item">
                                                <span class="info-label">å½“å‰ç‰ˆæœ¬</span>
                                                <span class="info-value">v1.0.0</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">æœ€åæ›´æ–°</span>
                                                <span class="info-value">2025-01-06</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ç³»ç»Ÿè®¾ç½®å¡ç‰‡ -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <h3><i class="fas fa-cogs"></i> ç³»ç»Ÿè®¾ç½®</h3>
                                    <p>é…ç½®ç³»ç»Ÿå¯åŠ¨å’Œè¿è¡Œé€‰é¡¹</p>
                                </div>

                                <div class="settings-card-content">
                                    <!-- å¯åŠ¨è®¾ç½® -->
                                    <div class="settings-group">
                                        <h4><i class="fas fa-power-off"></i> å¯åŠ¨è®¾ç½®</h4>
                                        <div class="settings-items">
                                            <div class="setting-item">
                                                <label>å¼€æœºè‡ªå¯åŠ¨</label>
                                                <div class="toggle-switch">
                                                    <input type="checkbox" id="autoStart">
                                                    <label for="autoStart" class="toggle-label"></label>
                                                </div>
                                            </div>

                                            <div class="setting-item">
                                                <label>æœ€å°åŒ–åˆ°æ‰˜ç›˜</label>
                                                <div class="toggle-switch">
                                                    <input type="checkbox" id="minimizeToTray" checked>
                                                    <label for="minimizeToTray" class="toggle-label"></label>
                                                </div>
                                            </div>

                                            <div class="setting-item">
                                                <label>å¯åŠ¨æ—¶æ£€æŸ¥çŠ¶æ€</label>
                                                <div class="toggle-switch">
                                                    <input type="checkbox" id="checkComfyUIOnStart" checked>
                                                    <label for="checkComfyUIOnStart" class="toggle-label"></label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- å¿«æ·æ–¹å¼è®¾ç½® -->
                                    <div class="settings-group">
                                        <h4><i class="fas fa-desktop"></i> å¿«æ·æ–¹å¼</h4>
                                        <div class="settings-items">
                                            <div class="setting-item">
                                                <label>åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼</label>
                                                <button class="action-btn primary" onclick="createDesktopShortcut(event)">
                                                    <i class="fas fa-plus"></i> åˆ›å»ºå¿«æ·æ–¹å¼
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <!-- å£°éŸ³è®¾ç½® -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-volume-up"></i> å£°éŸ³è®¾ç½®</h3>
                        </div>
                        <div class="settings-card-content">
                            <div class="settings-group">
                                <div class="settings-items">
                                    <div class="setting-item">
                                        <label>å¯ç”¨èƒŒæ™¯è§†é¢‘å£°éŸ³</label>
                                        <input type="checkbox" id="video-audio-enabled">
                                    </div>
                                    <div class="setting-item">
                                        <label>è§†é¢‘éŸ³é‡</label>
                                        <input type="range" id="video-volume" min="0" max="100" value="30" style="width: 150px;">
                                        <span id="video-volume-display">30%</span>
                                    </div>
                                    <div class="setting-item">
                                        <label>å¯ç”¨éŸ³æ•ˆ</label>
                                        <input type="checkbox" id="audio-enabled" checked>
                                    </div>
                                    <div class="setting-item">
                                        <label>éŸ³æ•ˆéŸ³é‡</label>
                                        <input type="range" id="audio-volume" min="0" max="100" value="50" style="width: 150px;">
                                        <span id="volume-display">50%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å¼€å‘è€…é€‰é¡¹å¡ç‰‡ -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-code"></i> å¼€å‘è€…é€‰é¡¹</h3>
                            <p>è°ƒè¯•å’Œå¼€å‘ç›¸å…³çš„è®¾ç½®é€‰é¡¹</p>
                        </div>

                        <div class="settings-card-content">
                            <!-- æ—¥å¿—è®¾ç½® -->
                            <div class="settings-group">
                                <h4><i class="fas fa-terminal"></i> æ—¥å¿—è®¾ç½®</h4>
                                <div class="settings-items">
                                    <div class="setting-item">
                                        <label>æ—¥å¿—çº§åˆ«</label>
                                        <select id="logLevelSelect" class="form-select">
                                            <option value="0">å…³é—­</option>
                                            <option value="1">é”™è¯¯</option>
                                            <option value="2">è­¦å‘Š</option>
                                            <option value="3" selected>ä¿¡æ¯</option>
                                            <option value="4">è°ƒè¯•</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <label>æ¸…ç©ºæ§åˆ¶å°æ—¥å¿—</label>
                                        <button class="action-btn secondary" onclick="console.clear(); logger.info('æ§åˆ¶å°å·²æ¸…ç©º')">
                                            <i class="fas fa-trash"></i> æ¸…ç©ºæ—¥å¿—
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- æ’ä»¶ç‰ˆæœ¬åˆ‡æ¢å¯¹è¯æ¡† - æ”¾åœ¨bodyé¡¶å±‚ -->
    <div class="version-switch-modal" id="version-switch-modal" onclick="closeVersionSwitchModal()">
        <div class="version-switch-content" onclick="event.stopPropagation()">
            <div class="version-switch-header">
                <h3><i class="fas fa-code-branch"></i> é€‰æ‹©æ’ä»¶ç‰ˆæœ¬</h3>
                <button class="close-btn" onclick="closeVersionSwitchModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="version-switch-list" id="version-switch-list">
                <!-- ç‰ˆæœ¬åˆ—è¡¨å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>



    <script>
        // æ—¥å¿—ç®¡ç†ç³»ç»Ÿ
        class Logger {
            constructor() {
                // æ—¥å¿—çº§åˆ«ï¼š0=å…³é—­, 1=é”™è¯¯, 2=è­¦å‘Š, 3=ä¿¡æ¯, 4=è°ƒè¯•
                this.level = this.getLogLevel();
                this.prefix = '[AI-Vision]';
            }

            getLogLevel() {
                // ä»localStorageè¯»å–æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤ä¸ºä¿¡æ¯çº§åˆ«
                const saved = localStorage.getItem('ai-vision-log-level');
                return saved ? parseInt(saved) : 3;
            }

            setLogLevel(level) {
                this.level = level;
                localStorage.setItem('ai-vision-log-level', level.toString());
                console.log(`${this.prefix} æ—¥å¿—çº§åˆ«è®¾ç½®ä¸º: ${this.getLevelName(level)}`);
            }

            getLevelName(level) {
                const names = ['å…³é—­', 'é”™è¯¯', 'è­¦å‘Š', 'ä¿¡æ¯', 'è°ƒè¯•'];
                return names[level] || 'æœªçŸ¥';
            }

            error(...args) {
                if (this.level >= 1) console.error(`${this.prefix} [ERROR]`, ...args);
            }

            warn(...args) {
                if (this.level >= 2) console.warn(`${this.prefix} [WARN]`, ...args);
            }

            info(...args) {
                if (this.level >= 3) console.log(`${this.prefix} [INFO]`, ...args);
            }

            debug(...args) {
                if (this.level >= 4) console.log(`${this.prefix} [DEBUG]`, ...args);
            }

            // ç‰¹æ®Šæ–¹æ³•ï¼šé‡è¦æ“ä½œæ—¥å¿—ï¼ˆæ€»æ˜¯æ˜¾ç¤ºï¼‰
            important(...args) {
                console.log(`${this.prefix} [IMPORTANT]`, ...args);
            }
        }

        // å…¨å±€æ—¥å¿—å®ä¾‹
        const logger = new Logger();

        class AIVisionLauncher {
            constructor() {
                logger.info('AIVisionLauncher constructor called');
                this.currentTab = 'home';
                this.isRunning = false;
                this.API_BASE = null; // å°†é€šè¿‡electronAPIåŠ¨æ€è·å–
                this.backendUrl = null; // å°†é€šè¿‡electronAPIåŠ¨æ€è·å–

                // å·¥ä½œæµçŠ¶æ€ç›‘æ§
                this.isWorkflowRunning = false;

                // æ’ä»¶æ ‡ç­¾é¡µçŠ¶æ€ç®¡ç†
                this.currentPluginTab = 'installed'; // é»˜è®¤æ˜¾ç¤ºå·²å®‰è£…æ ‡ç­¾é¡µ
                this.pluginDataCache = {}; // æ’ä»¶æ•°æ®ç¼“å­˜
                this.renderQueue = []; // æ¸²æŸ“é˜Ÿåˆ—
                this.isRendering = false; // æ¸²æŸ“çŠ¶æ€æ ‡å¿—

                // è™šæ‹Ÿæ»šåŠ¨é…ç½®
                this.virtualScrollConfig = {
                    itemHeight: 120, // æ¯ä¸ªæ’ä»¶é¡¹çš„ä¼°è®¡é«˜åº¦
                    visibleCount: 10, // å¯è§åŒºåŸŸæ˜¾ç¤ºçš„æ’ä»¶æ•°é‡
                    bufferCount: 5   // ç¼“å†²åŒºæ’ä»¶æ•°é‡
                };
                this.workflowCheckInterval = null;
                this.comfyUIWebSocket = null;

                // ç‰ˆæœ¬ç¼“å­˜
                this.versionCache = null;
                this.versionCacheExpiry = null;
                this.versionCacheDuration = 2 * 60 * 1000; // 2åˆ†é’Ÿç¼“å­˜ï¼Œæé«˜æ›´æ–°æ£€æµ‹é¢‘ç‡

                // æ’ä»¶é¡µé¢åˆ·æ–°æ ‡è®°
                this.needRefreshInstalledTab = false;
                this.forceRefresh = false; // å¼ºåˆ¶åˆ·æ–°æ ‡å¿—

                // æ€§èƒ½ä¼˜åŒ–ï¼šåŠ è½½çŠ¶æ€æ ‡å¿—
                this.isLoadingInstalled = false;
                this.isLoadingAvailable = false;

                this.initEventListeners();
                this.initEventDelegation(); // æ·»åŠ äº‹ä»¶å§”æ‰˜ä¼˜åŒ–
                this.loadSavedBackground();
                this.loadSavedSettings();

                // åˆå§‹åŒ–æ•°æ®åŠ è½½
                this.initializeData();

                // éªŒè¯æ’ä»¶ç®¡ç†æ–¹æ³•
                console.log('showPluginVersions method defined:', typeof this.showPluginVersions);
                console.log('Constructor complete');
            }

            async initializeData() {
                console.log('Starting data initialization...');
                try {
                    // é¦–å…ˆè·å–åç«¯URL
                    await this.initializeBackendUrl();

                    await this.loadSystemInfo();
                    await this.loadComfyUIStatus();
                    await this.loadGitStatus();
                    await this.loadRealTimeGPUInfo(); // åˆå§‹åŠ è½½GPUä¿¡æ¯

                    // é¢„åŠ è½½ç¯å¢ƒä¿¡æ¯ï¼Œé¿å…ç”¨æˆ·åˆ‡æ¢åˆ°ç¯å¢ƒé¡µé¢æ—¶éœ€è¦ç­‰å¾…
                    setTimeout(() => {
                        this.detectEnvironmentInfo();
                        console.log('Environment info pre-loaded');
                    }, 1000);

                    // é¢„åŠ è½½æ’ä»¶ä¿¡æ¯ï¼Œé¿å…ç”¨æˆ·åˆ‡æ¢åˆ°æ’ä»¶é¡µé¢æ—¶éœ€è¦ç­‰å¾…
                    setTimeout(() => {
                        this.preloadPluginInfo();
                        console.log('Plugin info pre-loading started');
                    }, 2000);

                    // å¯åŠ¨è‡ªåŠ¨ç‰ˆæœ¬æ›´æ–°æ£€æŸ¥
                    setTimeout(() => {
                        this.startBackgroundUpdateCheck();
                        console.log('Background update check started');
                    }, 3000);

                    // è®¾ç½®å®šæ—¶åˆ·æ–°ï¼ˆå®Œå…¨ç¦ç”¨ComfyUIçŠ¶æ€è‡ªåŠ¨è½®è¯¢ï¼Œæ”¹ä¸ºæ‰‹åŠ¨æ§åˆ¶ï¼‰
                    // setInterval(() => this.loadComfyUIStatus(), 10000); // ç¦ç”¨è‡ªåŠ¨çŠ¶æ€æ£€æŸ¥
                    setInterval(() => this.loadSystemInfo(), 5000);
                    setInterval(() => this.loadRealTimeGPUInfo(), 2000); // æ¯2ç§’æ›´æ–°GPUä¿¡æ¯

                    console.log('Data initialization complete');
                } catch (error) {
                    console.error('Failed to initialize data:', error);
                }
            }

            async initializeBackendUrl() {
                try {
                    if (window.electronAPI && window.electronAPI.getBackendUrl) {
                        this.backendUrl = await window.electronAPI.getBackendUrl();
                        this.API_BASE = this.backendUrl;
                        console.log('Backend URL initialized:', this.backendUrl);
                    } else {
                        // å¦‚æœelectronAPIä¸å¯ç”¨ï¼Œä½¿ç”¨é»˜è®¤å€¼
                        this.backendUrl = 'http://127.0.0.1:8404';
                        this.API_BASE = this.backendUrl;
                        console.warn('electronAPI not available, using default backend URL');
                    }
                } catch (error) {
                    console.error('Failed to get backend URL from main process:', error);
                    // ä½¿ç”¨é»˜è®¤å€¼ä½œä¸ºåå¤‡
                    this.backendUrl = 'http://127.0.0.1:8404';
                    this.API_BASE = this.backendUrl;
                }
            }

            initEventListeners() {
                console.log('initEventListeners called');

                // æ ‡ç­¾åˆ‡æ¢
                const tabBtns = document.querySelectorAll('.tab-btn');
                console.log('Found tab buttons:', tabBtns.length);
                tabBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.switchTab(e.currentTarget.dataset.tab);
                    });
                });

                // è®¾ç½®é¡µé¢èƒŒæ™¯å›¾ç‰‡ä¸Šä¼ 
                const backgroundImageUpload = document.getElementById('backgroundImageUpload');
                if (backgroundImageUpload) {
                    backgroundImageUpload.addEventListener('change', (e) => {
                        this.handleBackgroundUpload(e.target.files[0]);
                    });
                }

                // è®¾ç½®é¡µé¢èƒŒæ™¯è§†é¢‘ä¸Šä¼ 
                const backgroundVideoUpload = document.getElementById('backgroundVideoUpload');
                if (backgroundVideoUpload) {
                    backgroundVideoUpload.addEventListener('change', (e) => {
                        this.handleVideoUpload(e.target.files[0]);
                    });
                }

                // å¯åŠ¨æŒ‰é’®
                const launchBtn = document.getElementById('launchBtn');
                if (launchBtn) {
                    launchBtn.addEventListener('click', () => {
                        this.toggleComfyUI();
                    });
                } else {
                    console.warn('launchBtn element not found');
                }

                // æµè§ˆå™¨æŒ‰é’®
                const browserBtn = document.getElementById('browserBtn');
                if (browserBtn) {
                    browserBtn.addEventListener('click', () => {
                        this.openComfyUIInBrowser();
                    });
                } else {
                    console.warn('browserBtn element not found');
                }

                // ä¸“å®¶æ¨¡å¼æŒ‰é’®
                const expertBtn = document.querySelector('.expert-mode-btn');
                if (expertBtn) {
                    expertBtn.addEventListener('click', () => {
                        this.toggleExpertMode();
                    });
                } else {
                    console.warn('expert-mode-btn element not found');
                }

                // é¢„è®¾å¡ç‰‡é€‰æ‹©
                const presetCards = document.querySelectorAll('.preset-card');
                console.log('Found preset cards:', presetCards.length);
                presetCards.forEach(card => {
                    card.addEventListener('click', () => {
                        // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
                        if (window.audioManager) {
                            audioManager.play('click');
                        }
                        this.selectPreset(card.dataset.preset);
                    });
                });

                // æ—¥å¿—çº§åˆ«é€‰æ‹©å™¨ç›‘å¬
                const logLevelSelect = document.getElementById('logLevelSelect');
                if (logLevelSelect) {
                    // è®¾ç½®å½“å‰æ—¥å¿—çº§åˆ«
                    logLevelSelect.value = logger.level.toString();

                    logLevelSelect.addEventListener('change', (e) => {
                        const newLevel = parseInt(e.target.value);
                        logger.setLogLevel(newLevel);
                        this.showNotification(`æ—¥å¿—çº§åˆ«å·²è®¾ç½®ä¸º: ${logger.getLevelName(newLevel)}`, 'success');
                    });
                }

                // è®¾ç½®é€‰é¡¹å˜åŒ–ç›‘å¬
                const settingInputs = document.querySelectorAll('input[type="radio"], input[type="checkbox"], input[type="text"], input[type="number"]');
                logger.debug('Found setting inputs:', settingInputs.length);
                settingInputs.forEach(input => {
                    input.addEventListener('change', () => {
                        // åªåœ¨å¯åŠ¨è®¾ç½®é¡µé¢å…ƒç´ å­˜åœ¨æ—¶æ›´æ–°å‘½ä»¤é¢„è§ˆ
                        if (document.getElementById('listen-ip')) {
                            this.updateCommandPreview();
                        }
                    });
                });

                // ä»£ç†è®¾ç½®æ˜¾ç¤º/éšè—é€»è¾‘
                const enableProxyCheckbox = document.getElementById('enable-proxy');
                const proxyInputs = document.getElementById('proxy-inputs');
                if (enableProxyCheckbox && proxyInputs) {
                    enableProxyCheckbox.addEventListener('change', () => {
                        if (enableProxyCheckbox.checked) {
                            proxyInputs.style.display = 'block';
                        } else {
                            proxyInputs.style.display = 'none';
                        }
                        // æ›´æ–°å‘½ä»¤é¢„è§ˆ
                        if (document.getElementById('listen-ip')) {
                            this.updateCommandPreview();
                        }
                    });
                }

                // ç‰ˆæœ¬ç®¡ç†æ ‡ç­¾åˆ‡æ¢å°†åœ¨initVersionManagementä¸­ç»‘å®š
            }

            // äº‹ä»¶å§”æ‰˜ä¼˜åŒ– - å‡å°‘äº‹ä»¶ç›‘å¬å™¨æ•°é‡
            initEventDelegation() {
                console.log('ğŸš€ Initializing event delegation for performance optimization...');

                // ä¸ºæ’ä»¶ç®¡ç†å®¹å™¨æ·»åŠ äº‹ä»¶å§”æ‰˜
                const pluginContainer = document.getElementById('plugin-management');
                if (pluginContainer) {
                    pluginContainer.addEventListener('click', (e) => {
                        // æ’ä»¶æ ‡ç­¾é¡µåˆ‡æ¢
                        if (e.target.classList.contains('plugin-tab-btn')) {
                            e.preventDefault();
                            const tabType = e.target.dataset.type;
                            if (tabType) {
                                this.performTabSwitch(tabType);
                            }
                        }

                        // æ’ä»¶æ“ä½œæŒ‰é’®
                        if (e.target.classList.contains('plugin-action-btn')) {
                            e.preventDefault();
                            const action = e.target.dataset.action;
                            const pluginName = e.target.dataset.plugin;
                            if (action && pluginName) {
                                this.handlePluginAction(action, pluginName);
                            }
                        }
                    });

                    console.log('âœ… Plugin management event delegation initialized');
                }
            }

            switchTab(tabName) {
                console.log('switchTab called with:', tabName);

                // æ›´æ–°æ ‡ç­¾æŒ‰é’®çŠ¶æ€
                const allTabs = document.querySelectorAll('.tab-btn');
                console.log('Found tab buttons:', allTabs.length);

                allTabs.forEach(btn => {
                    btn.classList.remove('active');
                });

                const targetTab = document.querySelector(`[data-tab="${tabName}"]`);
                console.log('Target tab found:', targetTab);

                if (targetTab) {
                    targetTab.classList.add('active');
                } else {
                    console.error('Target tab not found for:', tabName);
                }

                // èƒŒæ™¯åª’ä½“é€æ˜åº¦æ§åˆ¶
                const backgroundImage = document.getElementById('backgroundImage');
                const backgroundVideo = document.getElementById('backgroundVideo');
                const mainHome = document.getElementById('mainHome');

                console.log('Elements found:', {
                    backgroundImage: !!backgroundImage,
                    backgroundVideo: !!backgroundVideo,
                    mainHome: !!mainHome
                });

                if (tabName === 'home') {
                    console.log('Switching to home page');
                    // ä¸»é¡µ - æ˜¾ç¤ºä¸»é¡µå†…å®¹ï¼ŒèƒŒæ™¯æ­£å¸¸
                    if (mainHome) {
                        mainHome.style.display = 'flex';
                        console.log('Main home displayed');
                    }
                    if (backgroundImage) backgroundImage.classList.remove('dimmed');
                    if (backgroundVideo) backgroundVideo.classList.remove('dimmed');

                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    console.log('All tab contents deactivated');
                } else {
                    // åŠŸèƒ½é¡µé¢ - ä½¿ç”¨é«˜æ•ˆçš„é¡µé¢åˆ‡æ¢
                    if (mainHome) {
                        mainHome.style.display = 'none';
                    }
                    if (backgroundImage) backgroundImage.classList.add('dimmed');
                    if (backgroundVideo) backgroundVideo.classList.add('dimmed');

                    // é«˜æ•ˆçš„é¡µé¢åˆ‡æ¢ï¼šåªæ“ä½œå½“å‰æ´»è·ƒçš„é¡µé¢å’Œç›®æ ‡é¡µé¢
                    const currentActive = document.querySelector('.tab-content.active');
                    if (currentActive && currentActive.id !== tabName) {
                        currentActive.classList.remove('active');
                    }

                    const targetContent = document.getElementById(tabName);
                    if (targetContent) {
                        targetContent.classList.add('active');
                        console.log(`Switched to ${tabName}`);

                        // æ’ä»¶ç®¡ç†é¡µé¢ - åˆå§‹åŒ–æ’ä»¶ç®¡ç†åŠŸèƒ½
                        if (tabName === 'plugin-management') {
                            console.log('Plugin management page activated');
                            this.initPluginManagement();

                            // ç¡®ä¿é»˜è®¤æ˜¾ç¤ºå·²å®‰è£…æ’ä»¶æ ‡ç­¾
                            setTimeout(() => {
                                const installedTab = document.querySelector('[data-type="installed"]');
                                const availableTab = document.querySelector('[data-type="available"]');

                                if (installedTab && availableTab) {
                                    installedTab.classList.add('active');
                                    availableTab.classList.remove('active');

                                    // ç¡®ä¿æ˜¾ç¤ºæ­£ç¡®çš„å†…å®¹
                                    this.showPluginTab('installed');
                                }
                            }, 50);
                        }

                        // ç¯å¢ƒé…ç½®é¡µé¢ - è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒä¿¡æ¯
                        if (tabName === 'environment-config') {
                            console.log('Environment config page activated');
                            // è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒä¿¡æ¯
                            this.detectEnvironmentInfo();
                        }
                    } else {
                        console.error(`Target content not found for: ${tabName}`);
                    }

                    // ç‰¹æ®Šå¤„ç†ï¼šç‰ˆæœ¬ç®¡ç†é¡µé¢
                    if (tabName === 'version-management') {
                        this.initVersionManagement();
                        // è‡ªåŠ¨æ£€æŸ¥æ›´æ–°
                        this.checkForUpdates();
                    }
                }

                this.currentTab = tabName;
            }

            handleBackgroundUpload(file) {
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const imageUrl = e.target.result;
                        this.setBackgroundImage(imageUrl);
                        localStorage.setItem('ai-vision-background', imageUrl);
                        localStorage.removeItem('ai-vision-background-video');
                    };
                    reader.readAsDataURL(file);
                }
            }

            handleVideoUpload(file) {
                if (file && file.type.startsWith('video/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const videoUrl = e.target.result;
                        this.setBackgroundVideo(videoUrl);
                        localStorage.setItem('ai-vision-background-video', videoUrl);
                        localStorage.removeItem('ai-vision-background');
                    };
                    reader.readAsDataURL(file);
                }
            }

            setBackgroundImage(imageUrl) {
                const backgroundImage = document.getElementById('backgroundImage');
                const backgroundVideo = document.getElementById('backgroundVideo');

                backgroundImage.src = imageUrl;
                backgroundImage.style.display = 'block';
                backgroundVideo.style.display = 'none';
                backgroundVideo.pause();
            }

            setBackgroundVideo(videoUrl) {
                const backgroundImage = document.getElementById('backgroundImage');
                const backgroundVideo = document.getElementById('backgroundVideo');

                backgroundVideo.src = videoUrl;
                backgroundVideo.style.display = 'block';
                backgroundImage.style.display = 'none';

                // åº”ç”¨ä¿å­˜çš„å£°éŸ³è®¾ç½®
                const videoAudioEnabled = localStorage.getItem('video-audio-enabled') === 'true';
                const videoVolume = parseFloat(localStorage.getItem('video-volume')) || 0.3;
                backgroundVideo.muted = !videoAudioEnabled;
                if (videoAudioEnabled) {
                    backgroundVideo.volume = videoVolume;
                }

                backgroundVideo.load();
                backgroundVideo.play().catch(e => console.log('è§†é¢‘è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', e));
            }

            loadSavedBackground() {
                const savedBackground = localStorage.getItem('ai-vision-background');
                const savedVideo = localStorage.getItem('ai-vision-background-video');

                if (savedVideo) {
                    this.setBackgroundVideo(savedVideo);
                } else if (savedBackground) {
                    this.setBackgroundImage(savedBackground);
                }
            }

            loadSavedSettings() {
                const savedSettings = localStorage.getItem('ai-vision-launch-settings');
                if (!savedSettings) return;

                try {
                    const settings = JSON.parse(savedSettings);

                    // æ¢å¤æ˜¾å­˜æ¨¡å¼
                    if (settings.vramMode) {
                        const vramRadio = document.getElementById(settings.vramMode);
                        if (vramRadio) vramRadio.checked = true;
                    }

                    // æ¢å¤æ³¨æ„åŠ›ä¼˜åŒ–æ–¹æ³•
                    if (settings.attentionMethod) {
                        const attentionSelect = document.getElementById('attention-method');
                        if (attentionSelect) attentionSelect.value = settings.attentionMethod;
                    }

                    // æ¢å¤æ³¨æ„åŠ›ä¸Šé‡‡æ ·
                    if (settings.upcastMode !== undefined) {
                        const upcastSelect = document.getElementById('upcast-mode');
                        if (upcastSelect) upcastSelect.value = settings.upcastMode;
                    }

                    // æ¢å¤ç½‘ç»œè®¾ç½®
                    if (settings.listenIp) {
                        const listenInput = document.getElementById('listen-ip');
                        if (listenInput) listenInput.value = settings.listenIp;
                    }

                    if (settings.port) {
                        const portInput = document.getElementById('port');
                        if (portInput) portInput.value = settings.port;
                    }

                    // æ¢å¤CORSè®¾ç½®
                    if (settings.corsMode) {
                        const corsSelect = document.getElementById('cors-setting');
                        if (corsSelect) corsSelect.value = settings.corsMode;
                    }

                    // æ¢å¤ä»£ç†è®¾ç½®
                    if (settings.enableProxy !== undefined) {
                        const enableProxyCheckbox = document.getElementById('enable-proxy');
                        if (enableProxyCheckbox) {
                            enableProxyCheckbox.checked = settings.enableProxy;
                            // è§¦å‘æ˜¾ç¤º/éšè—é€»è¾‘
                            const proxyInputs = document.getElementById('proxy-inputs');
                            if (proxyInputs) {
                                proxyInputs.style.display = settings.enableProxy ? 'block' : 'none';
                            }
                        }
                    }

                    if (settings.httpProxy) {
                        const httpProxyInput = document.getElementById('http-proxy');
                        if (httpProxyInput) httpProxyInput.value = settings.httpProxy;
                    }

                    if (settings.httpsProxy) {
                        const httpsProxyInput = document.getElementById('https-proxy');
                        if (httpsProxyInput) httpsProxyInput.value = settings.httpsProxy;
                    }

                    // æ¢å¤é€‰é¡¹è®¾ç½®
                    if (settings.options) {
                        Object.keys(settings.options).forEach(key => {
                            const kebabCase = key.replace(/([A-Z])/g, '-$1').toLowerCase();
                            const checkbox = document.getElementById(kebabCase);
                            if (checkbox) {
                                checkbox.checked = settings.options[key];
                            }
                        });
                    }

                } catch (e) {
                    console.warn('Failed to load saved settings:', e);
                }
            }

            // APIè°ƒç”¨æ–¹æ³•
            async apiCall(endpoint, method = 'GET', data = null) {
                try {
                    const options = {
                        method: method,
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    };

                    if (data) {
                        options.body = JSON.stringify(data);
                    }

                    const response = await fetch(`${this.API_BASE}${endpoint}`, options);
                    return await response.json();
                } catch (error) {
                    console.error(`APIè°ƒç”¨å¤±è´¥: ${error.message}`);
                    return { status: 'error', message: error.message };
                }
            }

            async loadSystemInfo() {
                try {
                    const result = await this.apiCall('/system/info');
                    if (result.status === 'success' || result.cpu_percent !== undefined) {
                        this.updateGPUInfo(result);
                    }
                } catch (error) {
                    console.error('Failed to load system info:', error);
                }
            }

            async loadComfyUIStatus() {
                try {
                    const result = await this.apiCall('/comfyui/status');
                    console.log('ComfyUIçŠ¶æ€APIå“åº”:', result);
                    // å¤„ç†æ‰€æœ‰çŠ¶æ€ï¼šrunning, stopped, startingç­‰
                    if (result && result.status) {
                        this.updateComfyUIStatus(result);
                    }
                } catch (error) {
                    console.error('Failed to load ComfyUI status:', error);
                }
            }

            async loadGitStatus() {
                try {
                    const result = await this.apiCall('/git/status');
                    if (result.status === 'success') {
                        console.log('Git status loaded:', result);
                        // å¯ä»¥åœ¨è¿™é‡Œæ›´æ–°ç‰ˆæœ¬ç®¡ç†é¡µé¢çš„æ˜¾ç¤º
                    }
                } catch (error) {
                    console.error('Failed to load Git status:', error);
                }
            }

            updateGPUInfo(systemInfo) {
                // è·å–å®æ—¶GPUä¿¡æ¯ï¼Œè€Œä¸æ˜¯ä¾èµ–systemInfo
                this.loadRealTimeGPUInfo();
            }

            async loadRealTimeGPUInfo() {
                try {
                    const response = await fetch(`${this.backendUrl}/system/cuda-info`);
                    if (response.ok) {
                        const data = await response.json();

                        // æ›´æ–°GPUåç§°
                        const gpuName = document.getElementById('gpuName');
                        if (gpuName && data.gpu_name && data.gpu_name !== 'æœªæ£€æµ‹åˆ°GPU') {
                            // ç®€åŒ–GPUåç§°æ˜¾ç¤º
                            let displayName = data.gpu_name;
                            if (displayName.includes('NVIDIA')) {
                                displayName = displayName.replace('NVIDIA GeForce ', '').replace('NVIDIA ', '');
                            }
                            if (displayName.includes('AMD')) {
                                displayName = displayName.replace('AMD Radeon ', '').replace('AMD ', '');
                            }
                            gpuName.textContent = displayName;
                        }

                        // æ›´æ–°æ˜¾å­˜ä¿¡æ¯
                        const gpuUsage = document.getElementById('gpuUsage');
                        if (gpuUsage && data.memory && data.memory !== 'æœªçŸ¥') {
                            gpuUsage.textContent = `æ˜¾å­˜: ${data.memory}`;
                        } else if (gpuUsage) {
                            gpuUsage.textContent = `æ˜¾å­˜: æ£€æµ‹ä¸­...`;
                        }

                        // æ›´æ–°GPUåˆ©ç”¨ç‡
                        const gpuStatus = document.getElementById('gpuStatus');
                        if (gpuStatus && data.utilization !== undefined) {
                            gpuStatus.textContent = `${Math.round(data.utilization)}%`;
                        } else if (gpuStatus) {
                            gpuStatus.textContent = '0%';
                        }

                        console.log('GPUå®æ—¶ä¿¡æ¯æ›´æ–°:', {
                            name: data.gpu_name,
                            memory: data.memory,
                            utilization: data.utilization,
                            temperature: data.temperature
                        });

                    }
                } catch (error) {
                    console.error('Failed to load real-time GPU info:', error);
                    // å¦‚æœè·å–å¤±è´¥ï¼Œæ˜¾ç¤ºé»˜è®¤ä¿¡æ¯
                    const gpuUsage = document.getElementById('gpuUsage');
                    const gpuStatus = document.getElementById('gpuStatus');
                    const gpuName = document.getElementById('gpuName');

                    if (gpuUsage) gpuUsage.textContent = 'æ˜¾å­˜: æ£€æµ‹å¤±è´¥';
                    if (gpuStatus) gpuStatus.textContent = '0%';
                    if (gpuName && gpuName.textContent === 'æ£€æµ‹ä¸­...') {
                        gpuName.textContent = 'GPUæ£€æµ‹å¤±è´¥';
                    }
                }
            }



            updateComfyUIStatus(statusInfo) {
                const launchBtn = document.getElementById('launchBtn');
                const browserBtn = document.getElementById('browserBtn');
                const gpuInfo = document.getElementById('gpuInfo');

                // å…¼å®¹ä¸åŒçš„çŠ¶æ€æ ¼å¼ï¼šstatus === 'running' æˆ– is_running === true
                const isRunning = statusInfo.status === 'running' ||
                                statusInfo.status === 'starting' ||
                                statusInfo.status === 'already_running' ||
                                statusInfo.is_running === true;

                console.log('ğŸ” ComfyUIæ‰‹åŠ¨çŠ¶æ€æ›´æ–°:', {
                    status: statusInfo.status,
                    is_running: statusInfo.is_running,
                    isRunning: isRunning,
                    previousRunning: this.isRunning
                });

                // æ›´æ–°å†…éƒ¨çŠ¶æ€
                this.isRunning = isRunning;

                // æ›´æ–°UIï¼ˆåªåœ¨æ‰‹åŠ¨è°ƒç”¨æ—¶æ‰§è¡Œï¼Œä¸ä¼šè¢«è‡ªåŠ¨è½®è¯¢å¹²æ‰°ï¼‰
                if (launchBtn && !launchBtn.disabled) {
                    if (isRunning) {
                        if (!this.isRunning) {
                            logger.important('ğŸš€ ComfyUIå¯åŠ¨æ£€æµ‹åˆ°ï¼Œå¼€å§‹åˆå§‹åŒ–å·¥ä½œæµç›‘æ§');
                        }
                        launchBtn.innerHTML = '<i class="fas fa-stop"></i> åœæ­¢ COMFYUI';
                        launchBtn.classList.remove('starting', 'stopping');
                        launchBtn.classList.add('running');

                        // æ˜¾ç¤ºæµè§ˆå™¨æŒ‰é’®
                        if (browserBtn) {
                            browserBtn.style.display = 'flex';
                        }
                        // å¼€å§‹ç›‘æ§å·¥ä½œæµçŠ¶æ€
                        this.startWorkflowMonitoring();
                    } else {
                        launchBtn.innerHTML = '<i class="fas fa-rocket"></i> å¯åŠ¨ COMFYUI';
                        launchBtn.classList.remove('running', 'starting', 'stopping');

                        // éšè—æµè§ˆå™¨æŒ‰é’®
                        if (browserBtn) {
                            browserBtn.style.display = 'none';
                        }
                        // åœæ­¢å·¥ä½œæµç›‘æ§
                        this.stopWorkflowMonitoring();
                    }
                }

                console.log('ComfyUIçŠ¶æ€æ›´æ–°å®Œæˆ:', {status: statusInfo.status, isRunning: this.isRunning});
            }

            // å¼€å§‹ç›‘æ§å·¥ä½œæµçŠ¶æ€
            startWorkflowMonitoring() {
                console.log('ğŸ” å¼€å§‹ç›‘æ§å·¥ä½œæµçŠ¶æ€');

                // æ¸…é™¤ä¹‹å‰çš„ç›‘æ§
                this.stopWorkflowMonitoring();

                // å»¶è¿Ÿå¯åŠ¨ç›‘æ§ï¼Œç¡®ä¿ComfyUIå®Œå…¨å¯åŠ¨
                setTimeout(() => {
                    console.log('ğŸ”— å°è¯•è¿æ¥WebSocketç›‘æ§');
                    this.connectComfyUIWebSocket();

                    logger.info('â° å¯åŠ¨HTTPè½®è¯¢å¤‡ç”¨ç›‘æ§');
                    // åŒæ—¶ä½¿ç”¨HTTPè½®è¯¢ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ
                    this.workflowCheckInterval = setInterval(() => {
                        this.checkWorkflowStatus();
                    }, 1000); // æ¯ç§’æ£€æŸ¥ä¸€æ¬¡
                }, 3000); // å»¶è¿Ÿ3ç§’å¯åŠ¨
            }

            // åœæ­¢ç›‘æ§å·¥ä½œæµçŠ¶æ€
            stopWorkflowMonitoring() {
                console.log('åœæ­¢ç›‘æ§å·¥ä½œæµçŠ¶æ€');

                // æ¸…é™¤è½®è¯¢
                if (this.workflowCheckInterval) {
                    clearInterval(this.workflowCheckInterval);
                    this.workflowCheckInterval = null;
                }

                // å…³é—­WebSocketè¿æ¥
                if (this.comfyUIWebSocket) {
                    this.comfyUIWebSocket.close();
                    this.comfyUIWebSocket = null;
                }

                // åœæ­¢å…‰æ•ˆ
                this.setWorkflowRunning(false);
            }

            // è¿æ¥ComfyUI WebSocket
            connectComfyUIWebSocket() {
                if (!this.isRunning) return;

                try {
                    // ComfyUIé»˜è®¤WebSocketåœ°å€
                    const wsUrl = 'ws://127.0.0.1:8188/ws';
                    console.log('å°è¯•è¿æ¥ComfyUI WebSocket:', wsUrl);

                    this.comfyUIWebSocket = new WebSocket(wsUrl);

                    this.comfyUIWebSocket.onopen = () => {
                        console.log('ComfyUI WebSocketè¿æ¥æˆåŠŸ');
                    };

                    this.comfyUIWebSocket.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            this.handleWorkflowMessage(data);
                        } catch (error) {
                            console.error('è§£æWebSocketæ¶ˆæ¯å¤±è´¥:', error);
                        }
                    };

                    this.comfyUIWebSocket.onclose = () => {
                        console.log('ComfyUI WebSocketè¿æ¥å…³é—­');
                        this.comfyUIWebSocket = null;

                        // å¦‚æœComfyUIè¿˜åœ¨è¿è¡Œï¼Œå°è¯•é‡è¿
                        if (this.isRunning) {
                            setTimeout(() => {
                                this.connectComfyUIWebSocket();
                            }, 3000);
                        }
                    };

                    this.comfyUIWebSocket.onerror = (error) => {
                        console.error('ComfyUI WebSocketé”™è¯¯:', error);
                    };

                } catch (error) {
                    console.error('åˆ›å»ºWebSocketè¿æ¥å¤±è´¥:', error);
                }
            }

            // å¤„ç†å·¥ä½œæµæ¶ˆæ¯
            handleWorkflowMessage(data) {
                // ComfyUI WebSocketæ¶ˆæ¯æ ¼å¼åˆ†æ
                if (data.type === 'status') {
                    // çŠ¶æ€æ¶ˆæ¯
                    const queueRemaining = data.data?.status?.exec_info?.queue_remaining || 0;
                    this.setWorkflowRunning(queueRemaining > 0);
                } else if (data.type === 'execution_start') {
                    // å¼€å§‹æ‰§è¡Œ
                    console.log('å·¥ä½œæµå¼€å§‹æ‰§è¡Œ');
                    this.setWorkflowRunning(true);
                } else if (data.type === 'execution_success' || data.type === 'execution_error') {
                    // æ‰§è¡Œå®Œæˆæˆ–å‡ºé”™
                    console.log('å·¥ä½œæµæ‰§è¡Œå®Œæˆ');
                    this.setWorkflowRunning(false);
                } else if (data.type === 'executing') {
                    // æ­£åœ¨æ‰§è¡ŒæŸä¸ªèŠ‚ç‚¹
                    const nodeId = data.data?.node;
                    if (nodeId) {
                        this.setWorkflowRunning(true);
                    } else {
                        // nodeIdä¸ºnullè¡¨ç¤ºæ‰§è¡Œå®Œæˆ
                        this.setWorkflowRunning(false);
                    }
                }
            }

            // HTTPè½®è¯¢æ£€æŸ¥å·¥ä½œæµçŠ¶æ€ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
            async checkWorkflowStatus() {
                try {
                    // é€šè¿‡åç«¯ä»£ç†æ£€æŸ¥ComfyUIé˜Ÿåˆ—çŠ¶æ€ï¼Œé¿å…CORSé—®é¢˜
                    const response = await this.apiCall('/comfyui/queue');
                    if (response && response.status !== 'error') {
                        const queueRunning = response.queue_running || [];
                        const queuePending = response.queue_pending || [];

                        const isRunning = queueRunning.length > 0 || queuePending.length > 0;

                        // è¾“å‡ºè¯¦ç»†çš„é˜Ÿåˆ—çŠ¶æ€ä¿¡æ¯
                        console.log('ğŸ“Š é˜Ÿåˆ—çŠ¶æ€æ£€æŸ¥:', {
                            running: queueRunning.length,
                            pending: queuePending.length,
                            isRunning: isRunning,
                            previousState: this.isWorkflowRunning,
                            queueData: response
                        });

                        this.setWorkflowRunning(isRunning);
                    } else {
                        logger.error('âŒ ComfyUIé˜Ÿåˆ—APIå“åº”å¤±è´¥:', response?.message || 'Unknown error', response);
                    }
                } catch (error) {
                    // åªåœ¨ç¬¬ä¸€æ¬¡å¤±è´¥æ—¶è¾“å‡ºé”™è¯¯
                    if (!this.queueCheckErrorLogged) {
                        logger.warn('âš ï¸ ComfyUIé˜Ÿåˆ—æ£€æŸ¥å¤±è´¥ (å¯èƒ½è¿˜æœªå®Œå…¨å¯åŠ¨):', error.message);
                        this.queueCheckErrorLogged = true;
                    }
                }
            }

            // è®¾ç½®å·¥ä½œæµè¿è¡ŒçŠ¶æ€å’Œå…‰æ•ˆ
            setWorkflowRunning(isRunning) {
                if (this.isWorkflowRunning !== isRunning) {
                    this.isWorkflowRunning = isRunning;
                    const gpuInfo = document.getElementById('gpuInfo');

                    console.log('ğŸ¯ å·¥ä½œæµçŠ¶æ€å˜åŒ–:', {
                        isRunning: isRunning,
                        previousState: this.isWorkflowRunning,
                        gpuInfoElement: !!gpuInfo,
                        gpuInfoId: gpuInfo ? gpuInfo.id : 'not found'
                    });

                    if (isRunning) {
                        logger.info('âœ¨ å·¥ä½œæµå¼€å§‹è¿è¡Œ - å¯åŠ¨GPUå…‰æ•ˆ');
                        if (gpuInfo) {
                            gpuInfo.classList.add('working');
                            console.log('âœ… å·²æ·»åŠ workingç±»åˆ°GPUä¿¡æ¯æ¡†');
                            console.log('ğŸ” å½“å‰GPUä¿¡æ¯æ¡†ç±»åˆ—è¡¨:', gpuInfo.className);
                        } else {
                            console.error('âŒ æ‰¾ä¸åˆ°GPUä¿¡æ¯æ¡†å…ƒç´  (gpuInfo)');
                        }
                    } else {
                        console.log('â¹ï¸ å·¥ä½œæµåœæ­¢è¿è¡Œ - åœæ­¢GPUå…‰æ•ˆ');
                        if (gpuInfo) {
                            gpuInfo.classList.remove('working');
                            console.log('âœ… å·²ç§»é™¤workingç±»ä»GPUä¿¡æ¯æ¡†');
                            console.log('ğŸ” å½“å‰GPUä¿¡æ¯æ¡†ç±»åˆ—è¡¨:', gpuInfo.className);
                        } else {
                            console.error('âŒ æ‰¾ä¸åˆ°GPUä¿¡æ¯æ¡†å…ƒç´  (gpuInfo)');
                        }
                    }
                }
            }

            async toggleComfyUI() {
                const launchBtn = document.getElementById('launchBtn');
                const browserBtn = document.getElementById('browserBtn');

                // é˜²æ­¢é‡å¤ç‚¹å‡»
                if (launchBtn && launchBtn.disabled) {
                    console.log('æŒ‰é’®å·²ç¦ç”¨ï¼Œå¿½ç•¥ç‚¹å‡»');
                    return;
                }

                try {
                    if (!this.isRunning) {
                        console.log('ğŸš€ ç”¨æˆ·å¯åŠ¨ComfyUIæ“ä½œå¼€å§‹');
                        // ç«‹å³æ›´æ–°æŒ‰é’®çŠ¶æ€ä¸ºå¯åŠ¨ä¸­
                        if (launchBtn) {
                            launchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> å¯åŠ¨ä¸­...';
                            launchBtn.classList.add('starting');
                            launchBtn.disabled = true;
                        }

                        // å¯åŠ¨ ComfyUI
                        logger.important('æ­£åœ¨å¯åŠ¨ComfyUI...');
                        // æ’­æ”¾å¯åŠ¨éŸ³æ•ˆ
                        if (window.audioManager) {
                            audioManager.play('startup');
                        }
                        const result = await this.apiCall('/comfyui/start', 'POST');
                        logger.info('ComfyUIå¯åŠ¨å“åº”:', result);

                        // APIè°ƒç”¨æˆåŠŸï¼Œä½†æŒ‰é’®çŠ¶æ€è¦ç­‰ComfyUIå®Œå…¨å¯åŠ¨åå†æ›´æ–°
                        if (result.status === 'running' || result.status === 'starting' || result.status === 'already_running') {
                            logger.important('ComfyUIå¯åŠ¨APIæˆåŠŸï¼ŒçŠ¶æ€:', result.status);

                            // æ’­æ”¾ComfyUIå¯åŠ¨æˆåŠŸéŸ³æ•ˆ
                            if (window.audioManager) {
                                audioManager.play('startup-success');
                            }
                            this.showNotification(result.message || 'ComfyUIå¯åŠ¨ä¸­...', 'success', 'comfyui-startup');

                            // æ ¹æ®ä¸åŒçŠ¶æ€å†³å®šå»¶è¿Ÿæ—¶é—´
                            let delay = 3000; // é»˜è®¤3ç§’
                            if (result.status === 'running') {
                                delay = 1000; // å¦‚æœå·²ç»è¿è¡Œï¼Œ1ç§’åæ‰“å¼€
                            } else if (result.status === 'starting') {
                                delay = 5000; // å¦‚æœè¿˜åœ¨å¯åŠ¨ï¼Œ5ç§’åæ‰“å¼€
                            } else if (result.status === 'already_running') {
                                delay = 500; // å¦‚æœå·²ç»åœ¨è¿è¡Œï¼Œç«‹å³æ‰“å¼€
                            }

                            // å»¶è¿Ÿåè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
                            setTimeout(() => {
                                this.openComfyUIInBrowser();

                                // æµè§ˆå™¨æ‰“å¼€åï¼Œæ›´æ–°æŒ‰é’®çŠ¶æ€ä¸ºè¿è¡Œä¸­
                                this.isRunning = true;
                                if (launchBtn) {
                                    launchBtn.innerHTML = '<i class="fas fa-stop"></i> åœæ­¢ COMFYUI';
                                    launchBtn.classList.remove('starting');
                                    launchBtn.classList.add('running');
                                    launchBtn.disabled = false; // å¯ç”¨æŒ‰é’®
                                }
                                // æ˜¾ç¤ºæµè§ˆå™¨æŒ‰é’®
                                if (browserBtn) {
                                    browserBtn.style.display = 'flex';
                                }

                                logger.important('ğŸš€ ComfyUIå¯åŠ¨å®Œæˆï¼ŒæŒ‰é’®å·²æ›´æ–°ä¸ºåœæ­¢çŠ¶æ€');
                            }, delay);

                            // å»¶è¿Ÿå¯åŠ¨å·¥ä½œæµç›‘æ§ï¼Œç¡®ä¿ComfyUIå®Œå…¨å¯åŠ¨
                            setTimeout(() => {
                                logger.important('ğŸš€ ComfyUIå¯åŠ¨æˆåŠŸï¼Œå¼ºåˆ¶å¯åŠ¨å·¥ä½œæµç›‘æ§');
                                this.startWorkflowMonitoring();
                            }, delay + 2000); // åœ¨æ‰“å¼€æµè§ˆå™¨å2ç§’å¯åŠ¨ç›‘æ§
                        } else {
                            // å¯åŠ¨å¤±è´¥ï¼Œæ¢å¤æŒ‰é’®çŠ¶æ€
                            if (launchBtn) {
                                launchBtn.innerHTML = '<i class="fas fa-rocket"></i> å¯åŠ¨ COMFYUI';
                                launchBtn.classList.remove('starting');
                                launchBtn.disabled = false;
                            }
                            console.error('å¯åŠ¨å¤±è´¥:', result.message);
                            this.showNotification(result.message || 'å¯åŠ¨å¤±è´¥', 'error');
                        }
                    } else {
                        console.log('ğŸ›‘ ç”¨æˆ·åœæ­¢ComfyUIæ“ä½œå¼€å§‹');

                        // ç«‹å³æ›´æ–°æŒ‰é’®çŠ¶æ€ä¸ºåœæ­¢ä¸­
                        if (launchBtn) {
                            launchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> åœæ­¢ä¸­...';
                            launchBtn.classList.add('stopping');
                            launchBtn.disabled = true;
                        }

                        // åœæ­¢ ComfyUI
                        console.log('æ­£åœ¨åœæ­¢ComfyUI...');
                        // æ’­æ”¾åœæ­¢éŸ³æ•ˆ
                        if (window.audioManager) {
                            audioManager.play('shutdown');
                        }
                        const result = await this.apiCall('/comfyui/stop', 'POST');

                        // åœæ­¢APIè°ƒç”¨å®Œæˆåç«‹å³æ›´æ–°æŒ‰é’®çŠ¶æ€
                        if (result.status === 'stopped' || result.status === 'already_stopped') {
                            // ç«‹å³æ›´æ–°æŒ‰é’®çŠ¶æ€ä¸ºå·²åœæ­¢ï¼Œå…è®¸ç”¨æˆ·ç«‹å³å¯åŠ¨
                            this.isRunning = false;
                            if (launchBtn) {
                                launchBtn.innerHTML = '<i class="fas fa-rocket"></i> å¯åŠ¨ COMFYUI';
                                launchBtn.classList.remove('stopping', 'running');
                                launchBtn.disabled = false; // ç«‹å³å¯ç”¨æŒ‰é’®
                            }
                            // éšè—æµè§ˆå™¨æŒ‰é’®
                            if (browserBtn) {
                                browserBtn.style.display = 'none';
                            }
                            // åœæ­¢å·¥ä½œæµç›‘æ§
                            this.stopWorkflowMonitoring();

                            console.log('ComfyUIå·²åœæ­¢');
                            // æ’­æ”¾ComfyUIå…³é—­æˆåŠŸéŸ³æ•ˆ
                            if (window.audioManager) {
                                audioManager.play('shutdown-success');
                            }
                            this.showNotification(result.message || 'ComfyUIå·²åœæ­¢', 'success', 'comfyui-shutdown');

                            logger.important('ğŸ›‘ ComfyUIåœæ­¢å®Œæˆï¼ŒæŒ‰é’®å·²ç«‹å³æ›´æ–°ä¸ºå¯åŠ¨çŠ¶æ€');
                        } else {
                            // åœæ­¢å¤±è´¥ï¼Œæ¢å¤æŒ‰é’®çŠ¶æ€
                            if (launchBtn) {
                                launchBtn.innerHTML = '<i class="fas fa-stop"></i> åœæ­¢ COMFYUI';
                                launchBtn.classList.remove('stopping');
                                launchBtn.disabled = false;
                            }
                            console.error('åœæ­¢å¤±è´¥:', result.message);
                            this.showNotification(result.message || 'åœæ­¢å¤±è´¥', 'error');
                        }
                    }
                } catch (error) {
                    // å‘ç”Ÿé”™è¯¯æ—¶æ¢å¤æŒ‰é’®çŠ¶æ€
                    if (launchBtn) {
                        if (this.isRunning) {
                            launchBtn.innerHTML = '<i class="fas fa-stop"></i> åœæ­¢ COMFYUI';
                            launchBtn.classList.remove('stopping');
                            launchBtn.classList.add('running');
                        } else {
                            launchBtn.innerHTML = '<i class="fas fa-rocket"></i> å¯åŠ¨ COMFYUI';
                            launchBtn.classList.remove('starting');
                        }
                        launchBtn.disabled = false;
                    }
                    console.error('ComfyUIæ“ä½œå¤±è´¥:', error);
                    this.showNotification('æ“ä½œå¤±è´¥: ' + error.message, 'error');
                }
            }

            async openComfyUIInBrowser() {
                try {
                    // è·å–ComfyUIçš„è®¿é—®åœ°å€
                    const listenIp = document.getElementById('listen-ip')?.value || '127.0.0.1';
                    const port = document.getElementById('port')?.value || '8188';
                    const url = `http://${listenIp}:${port}`;

                    console.log('Opening ComfyUI in browser:', url);

                    // å…ˆæ£€æŸ¥ComfyUIæ˜¯å¦çœŸçš„å¯è®¿é—®
                    try {
                        const checkResult = await this.apiCall('/comfyui/check');
                        if (checkResult.status === 'accessible') {
                            console.log('ComfyUI web service is accessible, opening browser...');
                        } else {
                            console.warn('ComfyUI web service may not be ready yet, but trying to open anyway...');
                        }
                    } catch (checkError) {
                        console.warn('Failed to check ComfyUI accessibility:', checkError);
                    }

                    // å°è¯•å¤šç§æ–¹å¼æ‰“å¼€æµè§ˆå™¨
                    let opened = false;

                    // æ–¹å¼1: ä½¿ç”¨Electronçš„shell.openExternal (æ¨è)
                    if (window.electronAPI && window.electronAPI.openExternal) {
                        try {
                            await window.electronAPI.openExternal(url);
                            opened = true;
                            console.log('Opened using Electron shell.openExternal');
                        } catch (e) {
                            console.warn('Failed to open with Electron shell:', e);
                        }
                    }

                    // æ–¹å¼2: ä½¿ç”¨window.openä½œä¸ºå¤‡é€‰
                    if (!opened) {
                        try {
                            const newWindow = window.open(url, '_blank');
                            if (newWindow) {
                                opened = true;
                                console.log('Opened using window.open');
                            }
                        } catch (e) {
                            console.warn('Failed to open with window.open:', e);
                        }
                    }

                    if (opened) {
                        this.showNotification('å·²åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ComfyUI', 'success');
                    } else {
                        this.showNotification(`è¯·æ‰‹åŠ¨æ‰“å¼€æµè§ˆå™¨è®¿é—®: ${url}`, 'info');
                        // å¤åˆ¶URLåˆ°å‰ªè´´æ¿ï¼ˆå¦‚æœæ”¯æŒï¼‰
                        if (navigator.clipboard) {
                            try {
                                await navigator.clipboard.writeText(url);
                                this.showNotification('URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'info');
                            } catch (e) {
                                console.warn('Failed to copy to clipboard:', e);
                            }
                        }
                    }

                } catch (error) {
                    console.error('Failed to open ComfyUI in browser:', error);
                    this.showNotification('æ‰“å¼€æµè§ˆå™¨å¤±è´¥: ' + error.message, 'error');
                }
            }



            toggleExpertMode() {
                const btn = document.querySelector('.expert-mode-btn');
                if (btn.textContent === 'å¯ç”¨é«˜çº§é€‰é¡¹') {
                    btn.textContent = 'ç¦ç”¨é«˜çº§é€‰é¡¹';
                    btn.style.background = 'rgba(0, 245, 255, 0.2)';
                    btn.style.borderColor = 'rgba(0, 245, 255, 0.5)';
                    btn.style.color = 'var(--neon-glow)';
                } else {
                    btn.textContent = 'å¯ç”¨é«˜çº§é€‰é¡¹';
                    btn.style.background = 'rgba(255, 102, 0, 0.2)';
                    btn.style.borderColor = 'rgba(255, 102, 0, 0.5)';
                    btn.style.color = '#ff6600';
                }
            }

            selectPreset(presetType) {
                // ç§»é™¤æ‰€æœ‰å¡ç‰‡çš„activeçŠ¶æ€
                document.querySelectorAll('.preset-card').forEach(card => {
                    card.classList.remove('active');
                });

                // æ¿€æ´»é€‰ä¸­çš„å¡ç‰‡
                document.querySelector(`[data-preset="${presetType}"]`).classList.add('active');

                // æ ¹æ®é¢„è®¾ç±»å‹è®¾ç½®å‚æ•°
                switch(presetType) {
                    case 'high-end':
                        document.getElementById('highvram').checked = true;
                        document.getElementById('flash-attention').checked = true;
                        document.getElementById('bf16-unet').checked = true;
                        break;
                    case 'mid-range':
                        document.getElementById('normalvram').checked = true;
                        document.getElementById('pytorch-attention').checked = true;
                        break;
                    case 'low-end':
                        document.getElementById('lowvram').checked = true;
                        document.getElementById('split-attention').checked = true;
                        break;
                }

                // åªåœ¨å¯åŠ¨è®¾ç½®é¡µé¢æ—¶æ›´æ–°å‘½ä»¤é¢„è§ˆ
                if (document.getElementById('listen-ip')) {
                    this.updateCommandPreview();
                }
            }

            updateCommandPreview() {
                let command = 'python main.py';

                // ç›‘å¬è®¾ç½®
                const listenEl = document.getElementById('listen-ip');
                const portEl = document.getElementById('port');
                if (listenEl && portEl) {
                    const listen = listenEl.value || '127.0.0.1';
                    const port = portEl.value || '8188';
                    command += ` --listen ${listen} --port ${port}`;
                }

                // æ˜¾å­˜æ¨¡å¼
                const vramMode = document.querySelector('input[name="vram-mode"]:checked');
                if (vramMode) {
                    switch(vramMode.value) {
                        case 'gpu-only':
                            command += ' --gpu-only';
                            break;
                        case 'highvram':
                            command += ' --highvram';
                            break;
                        case 'normalvram':
                            command += ' --normalvram';
                            break;
                        case 'lowvram':
                            command += ' --lowvram';
                            break;
                        case 'cpu':
                            command += ' --cpu';
                            break;
                    }
                }

                // æ³¨æ„åŠ›ä¼˜åŒ–æ–¹æ³•
                const attentionMethod = document.getElementById('attention-method');
                if (attentionMethod && attentionMethod.value) {
                    command += ` --${attentionMethod.value}`;
                }

                // æ³¨æ„åŠ›ä¸Šé‡‡æ ·
                const upcastMode = document.getElementById('upcast-mode');
                if (upcastMode && upcastMode.value) {
                    command += ` --${upcastMode.value}`;
                }

                // ç¦ç”¨xformers
                if (document.getElementById('disable-xformers')?.checked) {
                    command += ' --disable-xformers';
                }

                // é¢„ç•™æ˜¾å­˜
                const reserveVram = document.getElementById('reserve-vram');
                if (reserveVram && parseFloat(reserveVram.value) > 0) {
                    command += ` --reserve-vram ${reserveVram.value}`;
                }

                // å¼‚æ­¥æƒé‡å¸è½½
                if (document.getElementById('async-offload')?.checked) {
                    command += ' --async-offload';
                }

                // CORSè®¾ç½®
                const corsMode = document.getElementById('cors-setting');
                if (corsMode && corsMode.value) {
                    command += ` --${corsMode.value}`;
                }

                // ä»£ç†è®¾ç½®ï¼ˆåªæœ‰å¯ç”¨ä»£ç†æ—¶æ‰æ·»åŠ ï¼‰
                const enableProxy = document.getElementById('enable-proxy');
                if (enableProxy && enableProxy.checked) {
                    const httpProxy = document.getElementById('http-proxy');
                    const httpsProxy = document.getElementById('https-proxy');

                    if (httpProxy && httpProxy.value) {
                        command += ` --proxy-http ${httpProxy.value}`;
                    }
                    if (httpsProxy && httpsProxy.value) {
                        command += ` --proxy-https ${httpsProxy.value}`;
                    }
                }

                // æ›´æ–°å‘½ä»¤é¢„è§ˆ
                document.getElementById('command-preview').textContent = command;
            }

            saveSettings() {
                const settings = {
                    vramMode: document.querySelector('input[name="vram-mode"]:checked')?.value,
                    attentionMethod: document.getElementById('attention-method')?.value,
                    upcastMode: document.getElementById('upcast-mode')?.value,
                    listenIp: document.getElementById('listen-ip')?.value,
                    port: document.getElementById('port')?.value,
                    corsMode: document.getElementById('cors-setting')?.value,
                    enableProxy: document.getElementById('enable-proxy')?.checked,
                    httpProxy: document.getElementById('http-proxy')?.value,
                    httpsProxy: document.getElementById('https-proxy')?.value,
                    options: {
                        reserveVram: document.getElementById('reserve-vram')?.value,
                        asyncOffload: document.getElementById('async-offload')?.checked,
                        disableXformers: document.getElementById('disable-xformers')?.checked
                    }
                };

                localStorage.setItem('ai-vision-launch-settings', JSON.stringify(settings));

                // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
                this.showNotification('è®¾ç½®å·²ä¿å­˜', 'success');
            }

            applyAndLaunch() {
                this.saveSettings();
                // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…å¯åŠ¨ComfyUIçš„é€»è¾‘
                this.showNotification('æ­£åœ¨åº”ç”¨è®¾ç½®å¹¶å¯åŠ¨...', 'info');
                setTimeout(() => {
                    this.toggleComfyUI();
                }, 1000);
            }

            resetToDefault() {
                // é‡ç½®ä¸ºé»˜è®¤è®¾ç½®
                document.getElementById('highvram').checked = true;
                document.getElementById('default-attention').checked = true;
                document.getElementById('listen-ip').value = '127.0.0.1';
                document.getElementById('port').value = '8188';
                document.getElementById('http-proxy').value = '';
                document.getElementById('https-proxy').value = '';

                // é‡ç½®å¤é€‰æ¡†
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                });

                // åªåœ¨å¯åŠ¨è®¾ç½®é¡µé¢æ—¶æ›´æ–°å‘½ä»¤é¢„è§ˆ
                if (document.getElementById('listen-ip')) {
                    this.updateCommandPreview();
                }
                this.showNotification('å·²é‡ç½®ä¸ºé»˜è®¤è®¾ç½®', 'warning');
            }

            showNotification(message, type = 'info', context = null) {
                // æ’­æ”¾å¯¹åº”çš„éŸ³æ•ˆ
                if (window.audioManager) {
                    switch (type) {
                        case 'success':
                            // æ ¹æ®ä¸Šä¸‹æ–‡æ’­æ”¾ä¸åŒçš„æˆåŠŸéŸ³æ•ˆ
                            if (context === 'comfyui-startup' || (message.includes('ComfyUI') && message.includes('å¯åŠ¨'))) {
                                audioManager.play('startup-success');
                            } else if (context === 'comfyui-shutdown' || (message.includes('ComfyUI') && (message.includes('åœæ­¢') || message.includes('å…³é—­')))) {
                                audioManager.play('shutdown-success');
                            } else if (context === 'plugin' || message.includes('æ’ä»¶') || message.includes('plugin')) {
                                audioManager.play('plugin-success');
                            } else if (context === 'version' || message.includes('ç‰ˆæœ¬') || message.includes('version')) {
                                audioManager.play('version-success');
                            } else if (context === 'install' || message.includes('å®‰è£…') || message.includes('install')) {
                                audioManager.play('install-success');
                            } else if (context === 'update' || message.includes('æ›´æ–°') || message.includes('update')) {
                                audioManager.play('update-success');
                            } else {
                                audioManager.play('success');
                            }
                            break;
                        case 'error':
                            audioManager.play('error');
                            break;
                        case 'warning':
                            audioManager.play('warning');
                            break;
                        case 'info':
                        default:
                            audioManager.play('notification');
                            break;
                    }
                }

                // åˆ›å»ºé€šçŸ¥å…ƒç´ 
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.textContent = message;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: rgba(26, 26, 46, 0.95);
                    border: 1px solid var(--neon-glow);
                    border-radius: 8px;
                    padding: 12px 20px;
                    color: var(--text-primary);
                    font-size: 0.9rem;
                    z-index: 10000;
                    backdrop-filter: blur(10px);
                    opacity: 0;
                    transform: translateX(100%);
                    transition: all 0.3s ease;
                `;

                document.body.appendChild(notification);

                // æ˜¾ç¤ºåŠ¨ç”»
                setTimeout(() => {
                    notification.style.opacity = '1';
                    notification.style.transform = 'translateX(0)';
                }, 10);

                // è‡ªåŠ¨ç§»é™¤
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 3000);
            }

            // æ£€æŸ¥æ›´æ–°åŠŸèƒ½ - ä½¿ç”¨å¿«é€ŸAPI
            async checkForUpdates() {
                try {
                    console.log('ğŸ” å¿«é€Ÿæ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬æ›´æ–°...');
                    
                    // ä½¿ç”¨å¿«é€Ÿæ£€æŸ¥API
                    const response = await fetch(`${this.backendUrl}/comfyui/check-updates`);
                    const result = await response.json();
                    
                    if (result.status === 'success' && result.has_updates) {
                        console.log(`ğŸ”¥ å‘ç° ${result.update_count} ä¸ªæ–°ç‰ˆæœ¬æ›´æ–°`);
                        console.log(`å½“å‰ç‰ˆæœ¬: ${result.current_commit}, æœ€æ–°ç‰ˆæœ¬: ${result.latest_commit}`);
                        
                        // æ˜¾ç¤ºæ›´æ–°æç¤º
                        this.showUpdateNotification(result.update_count);
                    } else if (result.status === 'success') {
                        console.log('âœ… å½“å‰å·²æ˜¯æœ€æ–°ç‰ˆæœ¬');
                    } else {
                        console.warn('âš ï¸ æ£€æŸ¥æ›´æ–°å¤±è´¥:', result.error);
                    }
                } catch (error) {
                    console.warn('âš ï¸ æ£€æŸ¥æ›´æ–°ç½‘ç»œè¯·æ±‚å¤±è´¥:', error);
                    // å›é€€åˆ°åŸæœ‰æ–¹æ³•
                    this.checkForUpdatesLegacy();
                }
            }

            // åŸæœ‰çš„æ›´æ–°æ£€æŸ¥æ–¹æ³•ä½œä¸ºå¤‡ç”¨
            async checkForUpdatesLegacy() {
                try {
                    console.log('ğŸ” ä½¿ç”¨å®Œæ•´ç‰ˆæœ¬æ•°æ®æ£€æŸ¥æ›´æ–°...');
                    const versionData = await this.fetchVersionData(true);
                    
                    if (versionData && versionData.development && versionData.development.length > 0) {
                        const currentIndex = versionData.development.findIndex(v => v.current || v.isCurrent);
                        const hasUpdates = currentIndex > 0;
                        
                        if (hasUpdates) {
                            const updateCount = currentIndex;
                            console.log(`ğŸ”¥ å‘ç° ${updateCount} ä¸ªæ–°ç‰ˆæœ¬æ›´æ–°`);
                            this.showUpdateNotification(updateCount);
                        } else {
                            console.log('âœ… å½“å‰å·²æ˜¯æœ€æ–°ç‰ˆæœ¬');
                        }
                    }
                } catch (error) {
                    console.warn('âš ï¸ å¤‡ç”¨æ›´æ–°æ£€æŸ¥ä¹Ÿå¤±è´¥:', error);
                }
            }

            // æ˜¾ç¤ºæ›´æ–°é€šçŸ¥
            showUpdateNotification(updateCount) {
                // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜¾ç¤ºäº†é€šçŸ¥ï¼Œé¿å…é‡å¤æ˜¾ç¤º
                if (document.querySelector('.update-notification')) {
                    return;
                }

                const notification = document.createElement('div');
                notification.className = 'update-notification';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #ff6b35, #f7931e);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 10px;
                    box-shadow: 0 4px 20px rgba(255, 107, 53, 0.3);
                    z-index: 10000;
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                    font-size: 14px;
                    max-width: 300px;
                    animation: slideInRight 0.3s ease-out;
                    cursor: pointer;
                `;
                
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-rocket" style="color: #fff;"></i>
                        <div>
                            <div style="font-weight: bold;">å‘ç°æ–°ç‰ˆæœ¬</div>
                            <div style="font-size: 12px; opacity: 0.9;">${updateCount} ä¸ªæ›´æ–°å¯ç”¨</div>
                        </div>
                        <i class="fas fa-times" style="margin-left: auto; opacity: 0.7; cursor: pointer;" onclick="this.parentElement.parentElement.remove()"></i>
                    </div>
                `;
                
                // ç‚¹å‡»è·³è½¬åˆ°ç‰ˆæœ¬ç®¡ç†é¡µé¢
                notification.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('fa-times')) {
                        this.switchTab('version-management');
                        this.switchVersionTab('development'); // åˆ‡æ¢åˆ°å¼€å‘ç‰ˆæœ¬æ ‡ç­¾
                        notification.remove();
                    }
                });
                
                document.body.appendChild(notification);
                
                // 5ç§’åè‡ªåŠ¨æ¶ˆå¤±
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.style.animation = 'slideOutRight 0.3s ease-out forwards';
                        setTimeout(() => notification.remove(), 300);
                    }
                }, 5000);
            }

            // æ£€æŸ¥è¿œç¨‹æ›´æ–°ï¼ˆæ‰‹åŠ¨è§¦å‘ï¼‰
            async checkRemoteUpdates() {
                const refreshBtn = document.querySelector('.refresh-versions-btn i');
                if (refreshBtn) {
                    refreshBtn.classList.add('fa-spin');
                }

                try {
                    console.log('ğŸ” æ‰‹åŠ¨æ£€æŸ¥è¿œç¨‹æ›´æ–°...');
                    
                    // æ˜¾ç¤ºåŠ è½½æç¤º
                    this.showNotification('æ­£åœ¨æ£€æŸ¥è¿œç¨‹æ›´æ–°...', 'info');
                    
                    // æ‰§è¡Œgit fetchæ¥è·å–æœ€æ–°çš„è¿œç¨‹å¼•ç”¨
                    const fetchResponse = await fetch(`${this.backendUrl}/git/fetch-remote`, {
                        method: 'POST',
                        timeout: 30000
                    });
                    
                    if (fetchResponse.ok) {
                        console.log('âœ… è¿œç¨‹æ›´æ–°è·å–æˆåŠŸ');
                        
                        // æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½ç‰ˆæœ¬æ•°æ®
                        this.versionCache = null;
                        this.versionCacheExpiry = null;
                        
                        // å¼ºåˆ¶åˆ·æ–°ç‰ˆæœ¬æ•°æ®
                        await this.loadVersions(true);
                        
                        // æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ–°
                        await this.checkForUpdates();
                        
                        this.showNotification('è¿œç¨‹æ›´æ–°æ£€æŸ¥å®Œæˆï¼', 'success');
                    } else {
                        console.warn('âš ï¸ è·å–è¿œç¨‹æ›´æ–°å¤±è´¥');
                        this.showNotification('è·å–è¿œç¨‹æ›´æ–°å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'warning');
                    }
                    
                } catch (error) {
                    console.error('âŒ æ£€æŸ¥è¿œç¨‹æ›´æ–°å¤±è´¥:', error);
                    this.showNotification('æ£€æŸ¥è¿œç¨‹æ›´æ–°å¤±è´¥', 'error');
                } finally {
                    if (refreshBtn) {
                        refreshBtn.classList.remove('fa-spin');
                    }
                }
            }

            // åå°è‡ªåŠ¨æ›´æ–°æ£€æŸ¥
            startBackgroundUpdateCheck() {
                console.log('ğŸ” å¯åŠ¨åå°è‡ªåŠ¨æ›´æ–°æ£€æŸ¥...');
                
                // ç«‹å³æ£€æŸ¥ä¸€æ¬¡
                this.performBackgroundUpdateCheck();
                
                // æ¯10åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ›´æ–°
                setInterval(() => {
                    this.performBackgroundUpdateCheck();
                }, 10 * 60 * 1000);
            }

            async performBackgroundUpdateCheck() {
                try {
                    console.log('ğŸ” æ‰§è¡Œåå°æ›´æ–°æ£€æŸ¥...');
                    
                    // ä½¿ç”¨å¿«é€Ÿæ›´æ–°æ£€æŸ¥APIï¼Œé¿å…å½±å“æ€§èƒ½
                    const response = await fetch(`${this.backendUrl}/comfyui/check-updates`, {
                        headers: { 'Cache-Control': 'no-cache' }
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        if (result.status === 'success' && result.has_updates && result.update_count > 0) {
                            console.log(`ğŸ”¥ åå°æ£€æµ‹åˆ° ${result.update_count} ä¸ªæ›´æ–°`);
                            
                            // åªåœ¨æœ‰å®é™…æ›´æ–°æ—¶æ˜¾ç¤ºé€šçŸ¥
                            if (!document.querySelector('.update-notification')) {
                                this.showUpdateNotification(result.update_count);
                            }
                        } else {
                            console.log('âœ… åå°æ£€æŸ¥ï¼šå½“å‰å·²æ˜¯æœ€æ–°ç‰ˆæœ¬');
                        }
                    }
                } catch (error) {
                    // åå°æ£€æŸ¥å¤±è´¥ä¸æ˜¾ç¤ºé”™è¯¯ï¼Œé¿å…å¹²æ‰°ç”¨æˆ·
                    console.log('âš ï¸ åå°æ›´æ–°æ£€æŸ¥å¤±è´¥ï¼Œå°†åœ¨ä¸‹æ¬¡æ£€æŸ¥:', error.message);
                }
            }

            // ç‰ˆæœ¬ç®¡ç†ç›¸å…³æ–¹æ³•
            initVersionManagement() {
                this.currentVersionType = 'stable';
                this.pendingVersionSwitch = null;

                // ç»‘å®šç‰ˆæœ¬ç®¡ç†é¡µé¢çš„äº‹ä»¶
                this.bindVersionManagementEvents();

                // ç¡®ä¿é»˜è®¤æ˜¾ç¤ºç¨³å®šç‰ˆæ ‡ç­¾é¡µå¹¶è®¾ç½®æ­£ç¡®çš„é«˜äº®çŠ¶æ€
                setTimeout(() => {
                    this.switchVersionTab('stable');
                }, 150);

                // æ¸è¿›å¼åŠ è½½ï¼šå…ˆå¿«é€Ÿæ˜¾ç¤ºæœ¬åœ°ç‰ˆæœ¬ï¼Œåå°è·å–æœ€æ–°ç‰ˆæœ¬
                console.log('ğŸš€ initVersionManagement: å¯åŠ¨æ¸è¿›å¼åŠ è½½ä¼˜åŒ–');
                
                // ç¬¬ä¸€é˜¶æ®µï¼šå¿«é€Ÿæ˜¾ç¤ºæœ¬åœ°å·²çŸ¥ç‰ˆæœ¬ï¼ˆç¬é—´åŠ è½½ï¼‰
                this.loadVersionsProgressive();

                // å»¶è¿Ÿåº”ç”¨æœ¬åœ°çŠ¶æ€
                setTimeout(async () => {
                    console.log('ğŸ”„ initVersionManagement: åº”ç”¨æœ¬åœ°çŠ¶æ€');
                    await this.applyLocalVersionState();
                }, 2000);
            }

            // åˆ‡æ¢ç‰ˆæœ¬æ ‡ç­¾é¡µ
            switchVersionTab(tabType) {
                console.log('Switching to version tab:', tabType);

                // æ›´æ–°æ ‡ç­¾æŒ‰é’®çŠ¶æ€
                const allTabs = document.querySelectorAll('.version-tab-btn');
                allTabs.forEach(tab => {
                    tab.classList.remove('active');
                });

                const targetTab = document.querySelector(`[data-type="${tabType}"]`);
                if (targetTab) {
                    targetTab.classList.add('active');
                }

                // æ˜¾ç¤ºå¯¹åº”çš„ç‰ˆæœ¬åˆ—è¡¨
                this.showVersionList(tabType);
                this.currentVersionType = tabType;
            }

            // æ˜¾ç¤ºç‰ˆæœ¬åˆ—è¡¨
            showVersionList(tabType) {
                console.log(`ğŸ” åˆ‡æ¢ç‰ˆæœ¬åˆ—è¡¨æ˜¾ç¤º: ${tabType}`);
                const stableList = document.getElementById('stable-versions');
                const devList = document.getElementById('development-versions');

                console.log(`ğŸ” å®¹å™¨å…ƒç´ çŠ¶æ€: stable=${!!stableList}, dev=${!!devList}`);

                if (tabType === 'stable') {
                    if (stableList) {
                        stableList.style.display = 'block';
                        console.log(`ğŸ” ç¨³å®šç‰ˆæœ¬å®¹å™¨å†…å®¹é•¿åº¦: ${stableList.innerHTML.length}`);
                    }
                    if (devList) devList.style.display = 'none';
                } else if (tabType === 'development') {
                    if (stableList) stableList.style.display = 'none';
                    if (devList) {
                        devList.style.display = 'block';
                        console.log(`ğŸ” å¼€å‘ç‰ˆæœ¬å®¹å™¨å†…å®¹é•¿åº¦: ${devList.innerHTML.length}`);
                    }
                }
            }

            // æ¸²æŸ“ç‰ˆæœ¬åˆ—è¡¨ - æ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬
            renderVersionList(type, versions) {
                console.log(`ğŸ” ========== å¼€å§‹æ¸²æŸ“ ${type} ç‰ˆæœ¬åˆ—è¡¨ ==========`);
                console.log(`ğŸ” ç‰ˆæœ¬æ•°ç»„é•¿åº¦: ${versions ? versions.length : 0}`);
                console.log(`ğŸ” å®Œæ•´ç‰ˆæœ¬æ•°æ®:`, versions);
                console.log(`ğŸ” å‰3ä¸ªç‰ˆæœ¬çš„commit ID:`, versions ? versions.slice(0, 3).map(v => ({
                    id: v.id,
                    commit: v.commit,
                    commit_short: v.commit_short,
                    message: v.message?.substring(0, 50) + '...',
                    current: v.current
                })) : 'null');

                const container = document.getElementById(`${type}-versions`);

                if (!container) {
                    console.error(`ğŸ” Version list element not found: ${type}-versions`);
                    return;
                }

                if (!versions || versions.length === 0) {
                    console.log(`ğŸ” No ${type} versions to display`);
                    container.innerHTML = `
                        <div class="version-empty">
                            <p>æš‚æ— ${type === 'stable' ? 'ç¨³å®š' : 'å¼€å‘'}ç‰ˆæœ¬</p>
                        </div>
                    `;
                    return;
                }

                // æ€§èƒ½ä¼˜åŒ–ï¼šé™åˆ¶æ˜¾ç¤ºçš„ç‰ˆæœ¬æ•°é‡ï¼Œé¿å…DOMè¿‡è½½
                const maxVersions = type === 'stable' ? 20 : 30;

                // å¼€å‘ç‰ˆæœ¬æ— éœ€é¢å¤–è¿‡æ»¤ï¼Œåç«¯å·²ç»åˆ†ç±»æ­£ç¡®
                let filteredVersions = [...versions];
                console.log(`ğŸ” ${type} ç‰ˆæœ¬æ•°é‡: ${filteredVersions.length}`);

                // æ€§èƒ½ä¼˜åŒ–ï¼šé™åˆ¶ç‰ˆæœ¬æ•°é‡åå†è¿›è¡Œæ’åº
                if (filteredVersions.length > maxVersions) {
                    console.log(`é™åˆ¶${type}ç‰ˆæœ¬æ˜¾ç¤ºæ•°é‡: ${filteredVersions.length} -> ${maxVersions}`);
                    filteredVersions = filteredVersions.slice(0, maxVersions);
                }

                // æŒ‰æ—¥æœŸæ’åºï¼šæœ€æ–°çš„åœ¨å‰é¢ï¼ˆä»æ–°åˆ°æ—§ï¼‰ï¼Œå¤„ç†unknownæ—¥æœŸ
                const sortedVersions = filteredVersions.sort((a, b) => {
                    const dateA = a.date === 'unknown' ? null : new Date(a.date);
                    const dateB = b.date === 'unknown' ? null : new Date(b.date);

                    // å¦‚æœéƒ½æœ‰æœ‰æ•ˆæ—¥æœŸï¼ŒæŒ‰æ—¥æœŸæ’åº
                    if (dateA && dateB && !isNaN(dateA) && !isNaN(dateB)) {
                        return dateB - dateA;
                    }

                    // å¦‚æœä¸€ä¸ªæœ‰æ—¥æœŸä¸€ä¸ªæ²¡æœ‰ï¼Œæœ‰æ—¥æœŸçš„æ’åœ¨å‰é¢
                    if (dateA && !dateB) return -1;
                    if (!dateA && dateB) return 1;

                    // å¦‚æœéƒ½æ²¡æœ‰æœ‰æ•ˆæ—¥æœŸï¼ŒæŒ‰ç‰ˆæœ¬å·æ’åºï¼ˆå¯¹äºç¨³å®šç‰ˆæœ¬ï¼‰
                    if (type === 'stable') {
                        // æå–ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒ (v0.3.45 vs v0.3.44)
                        const versionA = a.version || a.id || '';
                        const versionB = b.version || b.id || '';

                        const parseVersion = (v) => {
                            const match = v.match(/v?(\d+)\.(\d+)\.(\d+)/);
                            if (match) {
                                return [parseInt(match[1]), parseInt(match[2]), parseInt(match[3])];
                            }
                            return [0, 0, 0];
                        };

                        const [majorA, minorA, patchA] = parseVersion(versionA);
                        const [majorB, minorB, patchB] = parseVersion(versionB);

                        if (majorA !== majorB) return majorB - majorA;
                        if (minorA !== minorB) return minorB - minorA;
                        return patchB - patchA;
                    }

                    // å¯¹äºå¼€å‘ç‰ˆæœ¬ï¼Œä¿æŒåŸæœ‰é¡ºåº
                    return 0;
                });

                // æ‰¾åˆ°å½“å‰ç‰ˆæœ¬çš„ç´¢å¼•å’Œæ—¥æœŸ - å…¼å®¹ä¸åŒçš„å±æ€§å
                const currentIndex = sortedVersions.findIndex(v => v.current || v.isCurrent);
                const currentDate = currentIndex >= 0 ? new Date(sortedVersions[currentIndex].date) : null;
                console.log(`ğŸ” Current version index in ${type}: ${currentIndex}, date: ${currentDate}`);

                console.log(`ğŸ” æœ€ç»ˆè¦æ¸²æŸ“çš„${type}ç‰ˆæœ¬æ•°é‡: ${sortedVersions.length}`);
                console.log(`ğŸ” å½“å‰ç‰ˆæœ¬ç´¢å¼•ä½ç½®: ${currentIndex}`);

                // æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨æ‰¹é‡æ›´æ–°å‡å°‘é‡æ’
                const htmlStrings = [];
                
                sortedVersions.forEach((version, index) => {
                    // è°ƒè¯•ï¼šè¾“å‡ºç‰ˆæœ¬å¯¹è±¡ç»“æ„
                    if (version.commit_short === '7d627f76') {
                        console.log('Debug version 7d627f76:', version);
                    }

                    const isStable = type === 'stable';

                    // åˆ¤æ–­ç‰ˆæœ¬å…³ç³»ï¼šæ¯”è¾ƒæ—¥æœŸå’Œç´¢å¼•
                    const versionDate = new Date(version.date);
                    const isNewer = currentDate && (
                        versionDate > currentDate ||
                        (versionDate.getTime() === currentDate.getTime() && currentIndex > -1 && index < currentIndex)
                    );
                    const isLatest = index === 0 && !version.current; // ç¬¬ä¸€ä¸ªéå½“å‰ç‰ˆæœ¬æ˜¯æœ€æ–°ç‰ˆæœ¬

                    // å¼€å‘ç‰ˆæœ¬ä½¿ç”¨ä¸åŒçš„å¾½ç« æ ·å¼
                    let newerBadge = '';
                    let currentBadge = '';
                    let latestBadge = '';

                    if (isStable) {
                        // ç¨³å®šç‰ˆæœ¬å¾½ç« 
                        newerBadge = isNewer ? '<span style="color: #ff6b35; font-size: 11px; margin-left: 8px;">ğŸ”¥ æ›´æ–°</span>' : '';
                        currentBadge = (version.current || version.isCurrent) ? '<span style="color: #28a745; font-size: 11px; margin-left: 8px; font-weight: bold; text-shadow: 0 0 3px rgba(40, 167, 69, 0.5);">âœ“ å½“å‰</span>' : '';
                        latestBadge = isLatest ? '<span style="color: #00f5ff; font-size: 11px; margin-left: 8px; font-weight: bold; text-shadow: 0 0 3px rgba(0, 245, 255, 0.5);">â­ æœ€æ–°</span>' : '';
                    } else {
                        // å¼€å‘ç‰ˆæœ¬å¾½ç« ï¼ˆæ©™è‰²ä¸»é¢˜ï¼Œä½†å½“å‰ç‰ˆæœ¬ç”¨ç»¿è‰²ä»¥ä¾¿åŒºåˆ†ï¼‰
                        newerBadge = isNewer ? '<span style="color: #ff6b35; font-size: 11px; margin-left: 8px;">ğŸ”¥ æ›´æ–°</span>' : '';
                        currentBadge = (version.current || version.isCurrent) ? '<span style="color: #28a745; font-size: 11px; margin-left: 8px; font-weight: bold; text-shadow: 0 0 3px rgba(40, 167, 69, 0.5);">âœ“ å½“å‰</span>' : '';
                        latestBadge = isLatest ? '<span style="color: #ff6b35; font-size: 11px; margin-left: 8px; font-weight: bold; text-shadow: 0 0 3px rgba(255, 107, 53, 0.5);">ğŸ”¥ æœ€æ–°</span>' : '';
                    }

                    // ç‰ˆæœ¬ç±»å‹æ ‡è¯†
                    let typeIcon = isStable ? 'ğŸ·ï¸' : 'ğŸŒ'; // å¼€å‘ç‰ˆæœ¬ä½¿ç”¨ğŸŒå›¾æ ‡

                    // ç‰ˆæœ¬å·æ ¼å¼
                    let displayVersion;
                    if (isStable) {
                        // ç¨³å®šç‰ˆæœ¬ä½¿ç”¨åç«¯è¿”å›çš„å®é™…ç‰ˆæœ¬å·
                        displayVersion = version.version || version.id || `v0.3.${44 - index}`;
                        console.log(`ğŸ” ç¨³å®šç‰ˆæœ¬æ˜¾ç¤º: ${displayVersion} (åŸå§‹: ${version.version}, ID: ${version.id})`);
                    } else {
                        // å¼€å‘ç‰ˆæœ¬ä½¿ç”¨ commit hashï¼ˆAPIå·²ç»è¿”å›çŸ­hashï¼‰
                        displayVersion = version.commit || version.id || 'Unknown';
                    }

                    const versionDateStr = version.date || 'N/A';
                    const versionMessage = version.message || 'æ— æè¿°';

                    htmlStrings.push(`
                        <div class="version-item ${(version.current || version.isCurrent) ? 'current' : ''} ${isNewer ? 'newer' : ''} ${isLatest ? 'latest' : ''} ${!isStable ? 'development' : ''}" data-version="${version.commit}">
                            <div class="version-info">
                                <div class="version-main">
                                    <div class="version-indicator"></div>
                                    <span class="version-id">${typeIcon} ${displayVersion}${currentBadge}${latestBadge}${newerBadge}</span>
                                    <span class="version-date">${versionDateStr}</span>
                                </div>
                                <div class="version-commit">${isStable ? `ä½œè€…: ${version.author || 'ComfyAnonymous'}` : versionMessage}</div>
                                ${!isStable && version.author ? `<div class="version-author">ä½œè€…: ${version.author}</div>` : ''}
                            </div>
                            <button class="version-switch-btn ${(version.current || version.isCurrent) ? 'current' : ''} ${isNewer ? 'newer' : ''} ${!isStable ? 'development' : ''}"
                                    data-commit="${version.commit}" data-version="${displayVersion}"
                                    onclick="const btn = this; console.log('Button clicked, commit:', btn.dataset.commit, 'displayVersion:', btn.dataset.version); switchToVersion(btn.dataset.commit, btn.dataset.version)"
                                    ${(version.current || version.isCurrent) ? 'disabled' : ''}>
                                ${(version.current || version.isCurrent) ? 'âœ“ å½“å‰ç‰ˆæœ¬' : (isNewer ? 'â¬† å‡çº§' : 'â¬‡ åˆ‡æ¢')}
                            </button>
                        </div>
                    `);
                });

                // æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨æ‰¹é‡innerHTMLæ›´æ–°ï¼Œå‡å°‘é‡æ’
                container.innerHTML = htmlStrings.join('');
                
                console.log(`âœ… ${type}ç‰ˆæœ¬åˆ—è¡¨æ¸²æŸ“å®Œæˆï¼Œå…±${sortedVersions.length}ä¸ªç‰ˆæœ¬`);
                console.log(`ğŸ” å®¹å™¨ID: ${type}-versions, å†…å®¹é•¿åº¦: ${container.innerHTML.length}`);
                
                // æ€§èƒ½æç¤º
                if (sortedVersions.length > 20) {
                    console.log(`âš¡ æ¸²æŸ“äº†${sortedVersions.length}ä¸ª${type}ç‰ˆæœ¬ï¼Œå·²ä¼˜åŒ–DOMæ“ä½œæ€§èƒ½`);
                }
            }

            // è°ƒè¯•ç‰ˆæœ¬æ•°æ®
            debugVersionData() {
                console.log('=== ç‰ˆæœ¬æ•°æ®è°ƒè¯•ä¿¡æ¯ ===');
                console.log('å½“å‰ç‰ˆæœ¬ç¼“å­˜:', this.versionCache);
                console.log('ç¼“å­˜è¿‡æœŸæ—¶é—´:', this.versionCacheExpiry);
                console.log('å½“å‰ç‰ˆæœ¬ç±»å‹:', this.currentVersionType);

                // è¾“å‡ºå½“å‰æ˜¾ç¤ºçš„ç‰ˆæœ¬åˆ—è¡¨
                const stableVersions = document.querySelectorAll('#stable-versions .version-item');
                const devVersions = document.querySelectorAll('#development-versions .version-item');

                console.log('ç¨³å®šç‰ˆæœ¬æ•°é‡:', stableVersions.length);
                console.log('å¼€å‘ç‰ˆæœ¬æ•°é‡:', devVersions.length);

                // è¾“å‡ºå½“å‰ç‰ˆæœ¬æ ‡è®°
                const currentVersions = document.querySelectorAll('.version-item[data-current="true"]');
                console.log('æ ‡è®°ä¸ºå½“å‰çš„ç‰ˆæœ¬æ•°é‡:', currentVersions.length);
                currentVersions.forEach((item, index) => {
                    console.log(`å½“å‰ç‰ˆæœ¬ ${index + 1}:`, item.dataset.version);
                });
            }

            // åˆ‡æ¢åˆ°æŒ‡å®šç‰ˆæœ¬
            async switchToVersion(commit, versionHash) {
                console.log('Switching to version:', commit, versionHash);

                // éªŒè¯å‚æ•°
                console.log('Parameter validation - commit:', commit, 'type:', typeof commit, 'length:', commit?.length);
                console.log('Parameter validation - versionHash:', versionHash, 'type:', typeof versionHash);

                if (!commit) {
                    console.error('Version switch error: æœªæŒ‡å®šåˆ‡æ¢ç›®æ ‡');
                    this.showNotification('ç‰ˆæœ¬åˆ‡æ¢å¤±è´¥: æœªæŒ‡å®šåˆ‡æ¢ç›®æ ‡', 'error');
                    return;
                }

                // è®¾ç½®å¾…åˆ‡æ¢ç‰ˆæœ¬å¹¶æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
                this.pendingVersionSwitch = commit;
                document.getElementById('target-version').textContent = versionHash || commit.substring(0, 8);
                document.getElementById('version-confirm-modal').classList.add('show');
            }

            // æ‰§è¡Œç‰ˆæœ¬åˆ‡æ¢
            async performVersionSwitch(versionId) {
                console.log('Performing version switch to:', versionId);

                // æ˜¾ç¤ºè¿›åº¦å¯¹è¯æ¡†
                document.getElementById('progress-version').textContent = versionId.substring(0, 8);
                document.getElementById('version-progress-modal').classList.add('show');

                const progressFill = document.getElementById('progress-fill');

                try {
                    // å¼€å§‹åˆ‡æ¢è¿›åº¦
                    progressFill.style.width = '20%';

                    let result;

                    // æ£€æŸ¥æ˜¯å¦åœ¨Electronç¯å¢ƒä¸­
                    if (window.electronAPI && window.electronAPI.gitSwitchVersion) {
                        // ä½¿ç”¨Electronçš„Git APIç›´æ¥åˆ‡æ¢ç‰ˆæœ¬
                        console.log('ğŸš€ ä½¿ç”¨Electronç›´æ¥åˆ‡æ¢Gitç‰ˆæœ¬:', versionId);
                        progressFill.style.width = '60%';

                        result = await window.electronAPI.gitSwitchVersion(versionId);
                        progressFill.style.width = '80%';
                    } else {
                        // åœ¨Webç¯å¢ƒä¸­ä½¿ç”¨HTTP APIåˆ‡æ¢ç‰ˆæœ¬
                        console.log('ğŸŒ ä½¿ç”¨Web APIåˆ‡æ¢Gitç‰ˆæœ¬:', versionId);
                        progressFill.style.width = '60%';

                        const response = await fetch('http://127.0.0.1:8404/comfyui/switch-version', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                version_id: versionId
                            })
                        });

                        result = await response.json();
                        progressFill.style.width = '80%';
                    }

                    if (result.status === 'success') {
                        // åˆ‡æ¢æˆåŠŸï¼Œç«‹å³æ›´æ–°UIï¼ˆä¸ç­‰å¾…åç«¯æ•°æ®ï¼‰
                        progressFill.style.width = '100%';

                        console.log('ğŸš€ ç‰ˆæœ¬åˆ‡æ¢æˆåŠŸï¼Œç«‹å³æ›´æ–°UIæ˜¾ç¤º...');

                        // 1. ç«‹å³æ‰‹åŠ¨æ›´æ–°å½“å‰ç‰ˆæœ¬æ ‡è¯†ï¼ˆå‰ç«¯ç›´æ¥æ“ä½œDOMï¼‰
                        this.immediateUpdateCurrentVersionUI(versionId);

                        // 2. æ¸…é™¤ç¼“å­˜å¹¶å¼‚æ­¥åˆ·æ–°æ•°æ®ï¼ˆä¸é˜»å¡UIæ›´æ–°ï¼‰
                        this.versionCache = null;
                        this.versionCacheExpiry = null;

                        // 3. ç«‹å³æ›´æ–°localStorageä¸­çš„ç‰ˆæœ¬çŠ¶æ€ï¼Œé¿å…åç»­éªŒè¯é€»è¾‘é”™è¯¯æ¢å¤
                        this.saveVersionState(versionId);
                        console.log('ğŸ’¾ å·²æ›´æ–°æœ¬åœ°ç‰ˆæœ¬çŠ¶æ€:', versionId);

                        // 4. å¼‚æ­¥åˆ·æ–°ç‰ˆæœ¬æ•°æ®ï¼ˆåœ¨åå°è¿›è¡Œï¼Œä¸å½±å“å½“å‰æ˜¾ç¤ºï¼‰
                        setTimeout(async () => {
                            console.log('åå°åˆ·æ–°ç‰ˆæœ¬æ•°æ®...');
                            await this.loadVersions(true);
                        }, 100);

                        this.showNotification(`âœ… æˆåŠŸåˆ‡æ¢åˆ°ç‰ˆæœ¬ ${versionId.substring(0, 8)}`, 'success', 'version');
                    } else {
                        throw new Error(result.message || 'ç‰ˆæœ¬åˆ‡æ¢å¤±è´¥');
                    }

                } catch (error) {
                    console.error('Version switch failed:', error);
                    this.showNotification(`âŒ ç‰ˆæœ¬åˆ‡æ¢å¤±è´¥: ${error.message}`, 'error');
                } finally {
                    // éšè—è¿›åº¦å¯¹è¯æ¡†
                    document.getElementById('version-progress-modal').classList.remove('show');
                    progressFill.style.width = '0%';
                }
            }

            // ç¡®ä¿å½“å‰ç‰ˆæœ¬è¢«æ­£ç¡®æ ‡è®°
            ensureCurrentVersionMarked(currentVersion) {
                console.log('Ensuring current version is marked:', currentVersion);

                if (!currentVersion) {
                    console.warn('No current version provided');
                    return;
                }

                // åœ¨æ‰€æœ‰ç‰ˆæœ¬é¡¹ä¸­æŸ¥æ‰¾å¹¶æ ‡è®°å½“å‰ç‰ˆæœ¬
                const allVersionItems = document.querySelectorAll('.version-item');
                allVersionItems.forEach(item => {
                    const versionData = item.dataset.version;
                    const isCurrentVersion = this.compareVersionHashes(versionData, currentVersion);

                    if (isCurrentVersion) {
                        item.classList.add('current');

                        // æ›´æ–°ç‰ˆæœ¬åˆ‡æ¢æŒ‰é’®çŠ¶æ€
                        const versionBtn = item.querySelector('.version-switch-btn');
                        if (versionBtn) {
                            versionBtn.classList.add('current');
                            versionBtn.disabled = true;
                            versionBtn.textContent = 'âœ“ å½“å‰ç‰ˆæœ¬';
                        }

                        console.log(`âœ… æ ‡è®°å½“å‰ç‰ˆæœ¬: ${versionData}`);
                    } else {
                        item.classList.remove('current');

                        // æ¢å¤ç‰ˆæœ¬åˆ‡æ¢æŒ‰é’®çŠ¶æ€
                        const versionBtn = item.querySelector('.version-switch-btn');
                        if (versionBtn) {
                            versionBtn.classList.remove('current');
                            versionBtn.disabled = false;

                            // æ ¹æ®ç‰ˆæœ¬ç±»å‹è®¾ç½®æŒ‰é’®æ–‡æœ¬
                            const isNewer = versionBtn.classList.contains('newer');
                            versionBtn.textContent = isNewer ? 'â¬† å‡çº§' : 'â¬‡ åˆ‡æ¢';
                        }
                    }
                });
            }

            // ç¦»çº¿æ¨¡å¼ç‰ˆæœ¬æ•°æ®
            getOfflineVersionData() {
                console.log('ğŸ”Œ ç”Ÿæˆç¦»çº¿æ¨¡å¼ç‰ˆæœ¬æ•°æ®');

                // å°è¯•ä»é¡µé¢ä¸­è·å–å½“å‰æ˜¾ç¤ºçš„ç‰ˆæœ¬ä¿¡æ¯
                const currentVersionElement = document.querySelector('.version-item.current .version-hash');
                const currentVersion = currentVersionElement ? currentVersionElement.textContent.trim() : 'a0c07856';
                const currentDate = new Date().toISOString().split('T')[0];

                // ç”Ÿæˆä¸€äº›ç¤ºä¾‹ç‰ˆæœ¬æ•°æ®
                const stableVersions = [
                    {
                        commit: currentVersion,
                        commit_short: currentVersion.substring(0, 8),
                        date: currentDate,
                        message: 'å½“å‰ç¨³å®šç‰ˆæœ¬',
                        current: true
                    },
                    {
                        commit: 'b1d23456',
                        commit_short: 'b1d23456',
                        date: '2025-07-20',
                        message: 'ä¿®å¤é‡è¦bugï¼Œæå‡ç¨³å®šæ€§',
                        current: false
                    },
                    {
                        commit: 'c2e34567',
                        commit_short: 'c2e34567',
                        date: '2025-07-19',
                        message: 'ä¼˜åŒ–æ€§èƒ½ï¼Œå¢åŠ æ–°åŠŸèƒ½',
                        current: false
                    }
                ];

                const developmentVersions = [
                    {
                        commit: currentVersion,
                        commit_short: currentVersion.substring(0, 8),
                        date: currentDate,
                        message: 'å½“å‰å¼€å‘ç‰ˆæœ¬',
                        current: true
                    },
                    {
                        commit: 'd3f45678',
                        commit_short: 'd3f45678',
                        date: '2025-07-20',
                        message: 'å®éªŒæ€§åŠŸèƒ½ï¼šæ–°çš„AIæ¨¡å‹æ”¯æŒ',
                        current: false
                    },
                    {
                        commit: 'e4g56789',
                        commit_short: 'e4g56789',
                        date: '2025-07-19',
                        message: 'å¼€å‘ä¸­ï¼šç•Œé¢ä¼˜åŒ–å’Œbugä¿®å¤',
                        current: false
                    }
                ];

                const offlineData = {
                    status: 'offline',
                    current_commit: currentVersion,
                    current_branch: 'main',
                    stable: stableVersions,
                    development: developmentVersions
                };

                console.log('ğŸ“¦ ç¦»çº¿ç‰ˆæœ¬æ•°æ®:', offlineData);
                return offlineData;
            }

            // æ›´æ–°å½“å‰ç‰ˆæœ¬æ˜¾ç¤º
            updateCurrentVersion(newCurrentVersion) {
                console.log('Updating current version display to:', newCurrentVersion);

                if (!newCurrentVersion) {
                    console.warn('No version provided to updateCurrentVersion');
                    return;
                }

                // ç§»é™¤æ‰€æœ‰ç°æœ‰çš„å½“å‰ç‰ˆæœ¬æ ‡è®°
                const allVersionItems = document.querySelectorAll('.version-item');
                allVersionItems.forEach(item => {
                    item.classList.remove('current');

                    // ç§»é™¤å½“å‰ç‰ˆæœ¬æ ‡è®°
                    const currentBadge = item.querySelector('.current-badge');
                    if (currentBadge) {
                        currentBadge.remove();
                    }

                    // æ¢å¤åˆ‡æ¢æŒ‰é’®
                    const actionsDiv = item.querySelector('.version-actions');
                    if (actionsDiv) {
                        const versionData = item.dataset.version;
                        const versionHash = item.querySelector('.version-hash')?.textContent || versionData;
                        actionsDiv.innerHTML = `
                            <button class="version-btn switch-btn" onclick="switchToVersion('${versionData}', '${versionHash}')">
                                åˆ‡æ¢åˆ°æ­¤ç‰ˆæœ¬
                            </button>
                        `;
                    }
                });

                // æ ‡è®°æ–°çš„å½“å‰ç‰ˆæœ¬
                this.ensureCurrentVersionMarked(newCurrentVersion);

                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                const versionState = {
                    currentVersion: newCurrentVersion,
                    timestamp: Date.now()
                };
                localStorage.setItem('ai_vision_current_version', JSON.stringify(versionState));
                console.log('âœ… å½“å‰ç‰ˆæœ¬çŠ¶æ€å·²æ›´æ–°å¹¶ä¿å­˜');
            }

            // é¢„åŠ è½½æ’ä»¶ä¿¡æ¯
            async preloadPluginInfo() {
                try {
                    console.log('ğŸ”„ é¢„åŠ è½½æ’ä»¶ä¿¡æ¯...');

                    // è¿™é‡Œå¯ä»¥é¢„åŠ è½½ä¸€äº›åŸºæœ¬çš„æ’ä»¶ä¿¡æ¯
                    // ç›®å‰å…ˆè¿”å›æˆåŠŸï¼Œé¿å…é”™è¯¯
                    console.log('âœ… æ’ä»¶ä¿¡æ¯é¢„åŠ è½½å®Œæˆ');
                    return true;
                } catch (error) {
                    console.warn('âš ï¸ æ’ä»¶ä¿¡æ¯é¢„åŠ è½½å¤±è´¥:', error);
                    return false;
                }
            }

            // ğŸš€ é«˜æ€§èƒ½ç‰ˆæœ¬çŠ¶æ€ç®¡ç† - ä»¿akiå¯åŠ¨å™¨æœºåˆ¶
            async unifiedVersionStateManagement() {
                try {
                    console.log('ğŸš€ å¯åŠ¨é«˜æ€§èƒ½ç‰ˆæœ¬ç®¡ç†...');

                    // 1. ä½¿ç”¨æ™ºèƒ½å¤šç­–ç•¥è·å–å½“å‰ç‰ˆæœ¬
                    const [actualVersion, versionData] = await Promise.all([
                        this.getSmartCurrentVersion(),
                        this.getCachedVersionData()
                    ]);

                    if (!actualVersion) {
                        console.warn('âš ï¸ æ™ºèƒ½è·å–ç‰ˆæœ¬å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨ç‰ˆæœ¬ç®¡ç†');
                        await this.fallbackVersionManagement();
                        return;
                    }

                    console.log(`âœ… æ™ºèƒ½è·å–å½“å‰ç‰ˆæœ¬æˆåŠŸ: ${actualVersion}`);

                    // 2. æ™ºèƒ½çŠ¶æ€æ£€æŸ¥ï¼ˆé¿å…ä¸å¿…è¦çš„DOMæ“ä½œï¼‰
                    const currentState = this.getVersionDisplayState();
                    const needsUpdate = this.shouldUpdateVersionDisplay(currentState, actualVersion);

                    if (needsUpdate) {
                        console.log('ğŸ”§ æ‰§è¡Œæ™ºèƒ½ç‰ˆæœ¬æ˜¾ç¤ºæ›´æ–°...');
                        this.performanceOptimizedVersionUpdate(actualVersion, versionData);
                    } else {
                        console.log('âœ… ç‰ˆæœ¬æ˜¾ç¤ºå·²æ˜¯æœ€æ–°çŠ¶æ€');
                    }

                    // 3. å¼‚æ­¥ä¿å­˜çŠ¶æ€ï¼ˆä¸é˜»å¡UIï¼‰
                    this.saveVersionStateAsync(actualVersion);

                } catch (error) {
                    console.error('é«˜æ€§èƒ½ç‰ˆæœ¬ç®¡ç†å¤±è´¥:', error);
                    // ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ
                    await this.fallbackVersionManagement();
                }
            }

            // è·å–ç¼“å­˜çš„ç‰ˆæœ¬æ•°æ®
            getCachedVersionData() {
                if (this.versionCache && this.versionCacheExpiry && Date.now() < this.versionCacheExpiry) {
                    return Promise.resolve(this.versionCache);
                }
                return this.fetchVersionData();
            }

            // ğŸš€ æ™ºèƒ½è·å–å½“å‰ç‰ˆæœ¬ - å¤šæ¥æºç­–ç•¥
            async getSmartCurrentVersion() {
                try {
                    // ç­–ç•¥1: ä»ç‰ˆæœ¬æ•°æ®ä¸­è·å–
                    const versionData = await this.getCachedVersionData();
                    if (versionData && versionData.current_commit) {
                        console.log(`âœ… ç­–ç•¥1æˆåŠŸ: ä»ç‰ˆæœ¬æ•°æ®è·å– ${versionData.current_commit}`);
                        return versionData.current_commit;
                    }

                    // ç­–ç•¥2: ä»Git APIè·å–
                    const gitVersion = await this.getCurrentVersionFromGit();
                    if (gitVersion) {
                        console.log(`âœ… ç­–ç•¥2æˆåŠŸ: ä»Git APIè·å– ${gitVersion}`);
                        return gitVersion;
                    }

                    // ç­–ç•¥3: ä»æœ¬åœ°å­˜å‚¨è·å–
                    const savedState = localStorage.getItem('ai_vision_current_version');
                    if (savedState) {
                        const versionState = JSON.parse(savedState);
                        if (Date.now() - versionState.timestamp < 300000) { // 5åˆ†é’Ÿå†…æœ‰æ•ˆ
                            console.log(`âœ… ç­–ç•¥3æˆåŠŸ: ä»æœ¬åœ°å­˜å‚¨è·å– ${versionState.currentVersion}`);
                            return versionState.currentVersion;
                        }
                    }

                    // ç­–ç•¥4: ä»DOMè·å–
                    const currentItems = document.querySelectorAll('.version-item.current');
                    if (currentItems.length === 1) {
                        const domVersion = currentItems[0].getAttribute('data-version');
                        console.log(`âœ… ç­–ç•¥4æˆåŠŸ: ä»DOMè·å– ${domVersion}`);
                        return domVersion;
                    }

                    console.warn('âš ï¸ æ‰€æœ‰ç­–ç•¥éƒ½å¤±è´¥ï¼Œæ— æ³•è·å–å½“å‰ç‰ˆæœ¬');
                    return null;

                } catch (error) {
                    console.error('æ™ºèƒ½è·å–å½“å‰ç‰ˆæœ¬å¤±è´¥:', error);
                    return null;
                }
            }

            // è·å–å½“å‰ç‰ˆæœ¬æ˜¾ç¤ºçŠ¶æ€
            getVersionDisplayState() {
                const currentItems = document.querySelectorAll('.version-item.current');
                return {
                    count: currentItems.length,
                    currentVersion: currentItems[0]?.getAttribute('data-version') || null
                };
            }

            // æ™ºèƒ½åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°æ˜¾ç¤º
            shouldUpdateVersionDisplay(currentState, actualVersion) {
                if (currentState.count !== 1) return true;
                return !this.compareVersionHashes(currentState.currentVersion, actualVersion);
            }

            // æ¯”è¾ƒç‰ˆæœ¬hashï¼Œæ”¯æŒä¸åŒé•¿åº¦çš„hash
            compareVersionHashes(hash1, hash2) {
                if (!hash1 || !hash2) return false;

                // å¦‚æœå®Œå…¨ç›¸ç­‰
                if (hash1 === hash2) return true;

                // å¦‚æœä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªçš„å‰ç¼€ï¼ˆçŸ­hash vs å®Œæ•´hashï¼‰
                const minLength = Math.min(hash1.length, hash2.length);
                return hash1.substring(0, minLength) === hash2.substring(0, minLength);
            }

            // æ›´æ–°ç‰ˆæœ¬ç¼“å­˜ä¸­çš„å½“å‰ç‰ˆæœ¬çŠ¶æ€
            updateVersionCacheCurrentStatus(newCurrentVersionId) {
                console.log('æ›´æ–°ç‰ˆæœ¬ç¼“å­˜ä¸­çš„å½“å‰ç‰ˆæœ¬çŠ¶æ€:', newCurrentVersionId);

                if (!this.versionCache) {
                    console.log('æ²¡æœ‰ç‰ˆæœ¬ç¼“å­˜ï¼Œè·³è¿‡æ›´æ–°');
                    return;
                }

                // æ›´æ–°ç¨³å®šç‰ˆæœ¬ä¸­çš„å½“å‰çŠ¶æ€
                if (this.versionCache.stable) {
                    this.versionCache.stable.forEach(version => {
                        version.current = this.compareVersionHashes(version.commit, newCurrentVersionId);
                    });
                }

                // æ›´æ–°å¼€å‘ç‰ˆæœ¬ä¸­çš„å½“å‰çŠ¶æ€
                if (this.versionCache.development) {
                    this.versionCache.development.forEach(version => {
                        version.current = this.compareVersionHashes(version.commit, newCurrentVersionId);
                    });
                }

                console.log('ç‰ˆæœ¬ç¼“å­˜çŠ¶æ€æ›´æ–°å®Œæˆ');
            }

            // ç«‹å³æ›´æ–°å½“å‰ç‰ˆæœ¬UIæ˜¾ç¤ºï¼ˆä¸ç­‰å¾…åç«¯æ•°æ®ï¼‰
            immediateUpdateCurrentVersionUI(newCurrentVersionId) {
                console.log('ğŸš€ ç«‹å³æ›´æ–°å½“å‰ç‰ˆæœ¬UI:', newCurrentVersionId);

                // 1. ç§»é™¤æ‰€æœ‰ç°æœ‰çš„å½“å‰ç‰ˆæœ¬æ ‡è®°
                const allVersionItems = document.querySelectorAll('.version-item');
                console.log(`ğŸ“‹ æ‰¾åˆ° ${allVersionItems.length} ä¸ªç‰ˆæœ¬é¡¹`);

                allVersionItems.forEach(item => {
                    item.classList.remove('current');

                    const versionBtn = item.querySelector('.version-switch-btn');
                    if (versionBtn) {
                        versionBtn.classList.remove('current');
                        versionBtn.disabled = false;

                        // æ ¹æ®ç‰ˆæœ¬ç±»å‹è®¾ç½®æŒ‰é’®æ–‡æœ¬
                        const isNewer = versionBtn.classList.contains('newer');
                        versionBtn.textContent = isNewer ? 'â¬† å‡çº§' : 'â¬‡ åˆ‡æ¢';
                    }
                });

                // 2. æ‰¾åˆ°å¹¶æ ‡è®°æ–°çš„å½“å‰ç‰ˆæœ¬
                let foundCurrentVersion = false;
                allVersionItems.forEach(item => {
                    const versionData = item.dataset.version;
                    const isCurrentVersion = this.compareVersionHashes(versionData, newCurrentVersionId);

                    console.log(`ğŸ” æ£€æŸ¥ç‰ˆæœ¬: ${versionData} vs ${newCurrentVersionId} = ${isCurrentVersion}`);

                    if (isCurrentVersion) {
                        item.classList.add('current');

                        const versionBtn = item.querySelector('.version-switch-btn');
                        if (versionBtn) {
                            versionBtn.classList.add('current');
                            versionBtn.disabled = true;
                            versionBtn.textContent = 'âœ“ å½“å‰ç‰ˆæœ¬';
                            console.log(`âœ… æŒ‰é’®çŠ¶æ€å·²æ›´æ–°: ${versionData}`);
                        } else {
                            console.warn(`âš ï¸ æœªæ‰¾åˆ°æŒ‰é’®: ${versionData}`);
                        }

                        foundCurrentVersion = true;
                        console.log(`âœ… ç«‹å³æ ‡è®°å½“å‰ç‰ˆæœ¬: ${versionData}`);
                    }
                });

                if (!foundCurrentVersion) {
                    console.warn('âš ï¸ æœªæ‰¾åˆ°åŒ¹é…çš„ç‰ˆæœ¬é¡¹:', newCurrentVersionId);
                    console.log('ğŸ“‹ æ‰€æœ‰ç‰ˆæœ¬é¡¹çš„data-version:');
                    allVersionItems.forEach(item => {
                        console.log(`  - ${item.dataset.version}`);
                    });
                } else {
                    console.log('ğŸ‰ å½“å‰ç‰ˆæœ¬UIæ›´æ–°å®Œæˆï¼');
                }
            }

            // ç¡®ä¿ç‰ˆæœ¬æ•°æ®ä¸­çš„å½“å‰ç‰ˆæœ¬çŠ¶æ€æ­£ç¡®
            async ensureVersionDataCurrentStatus(versionData) {
                try {
                    console.log('ç¡®ä¿ç‰ˆæœ¬æ•°æ®ä¸­çš„å½“å‰ç‰ˆæœ¬çŠ¶æ€æ­£ç¡®...');

                    // è·å–å®é™…çš„å½“å‰ç‰ˆæœ¬
                    const actualCurrentVersion = await this.getActualCurrentVersion();
                    if (!actualCurrentVersion) {
                        console.warn('æ— æ³•è·å–å®é™…å½“å‰ç‰ˆæœ¬');
                        return;
                    }

                    console.log('å®é™…å½“å‰ç‰ˆæœ¬:', actualCurrentVersion);

                    // æ›´æ–°ç¨³å®šç‰ˆæœ¬ä¸­çš„å½“å‰çŠ¶æ€
                    if (versionData.stable) {
                        versionData.stable.forEach(version => {
                            const wasCurrentBefore = version.current;
                            version.current = this.compareVersionHashes(version.commit, actualCurrentVersion);
                            if (wasCurrentBefore !== version.current) {
                                console.log(`ç¨³å®šç‰ˆæœ¬ ${version.commit} å½“å‰çŠ¶æ€: ${wasCurrentBefore} -> ${version.current}`);
                            }
                        });
                    }

                    // æ›´æ–°å¼€å‘ç‰ˆæœ¬ä¸­çš„å½“å‰çŠ¶æ€
                    if (versionData.development) {
                        versionData.development.forEach(version => {
                            const wasCurrentBefore = version.current;
                            version.current = this.compareVersionHashes(version.commit, actualCurrentVersion);
                            if (wasCurrentBefore !== version.current) {
                                console.log(`å¼€å‘ç‰ˆæœ¬ ${version.commit} å½“å‰çŠ¶æ€: ${wasCurrentBefore} -> ${version.current}`);
                            }
                        });
                    }

                    console.log('ç‰ˆæœ¬æ•°æ®å½“å‰çŠ¶æ€æ›´æ–°å®Œæˆ');
                } catch (error) {
                    console.warn('æ›´æ–°ç‰ˆæœ¬æ•°æ®å½“å‰çŠ¶æ€å¤±è´¥:', error);
                }
            }

            // æ€§èƒ½ä¼˜åŒ–çš„ç‰ˆæœ¬æ˜¾ç¤ºæ›´æ–°
            performanceOptimizedVersionUpdate(actualVersion, versionData) {
                // ä½¿ç”¨DocumentFragmentæ‰¹é‡æ›´æ–°DOMï¼Œå‡å°‘é‡æ’é‡ç»˜
                const fragment = document.createDocumentFragment();

                // ä¸€æ¬¡æ€§æ›´æ–°æ‰€æœ‰ç‰ˆæœ¬é¡¹çŠ¶æ€
                const versionItems = document.querySelectorAll('.version-item');
                versionItems.forEach(item => {
                    const itemVersion = item.getAttribute('data-version');
                    const btn = item.querySelector('.version-switch-btn');

                    if (this.compareVersionHashes(itemVersion, actualVersion)) {
                        item.classList.add('current');
                        if (btn) {
                            btn.classList.add('current');
                            btn.disabled = true;
                            btn.textContent = 'âœ“ å½“å‰ç‰ˆæœ¬';
                        }
                    } else {
                        item.classList.remove('current');
                        if (btn) {
                            btn.classList.remove('current');
                            btn.disabled = false;
                            btn.textContent = 'åˆ‡æ¢';
                        }
                    }
                });

                console.log(`âœ… é«˜æ€§èƒ½æ›´æ–°å®Œæˆ: ${actualVersion}`);
            }

            // å¼‚æ­¥ä¿å­˜çŠ¶æ€
            saveVersionStateAsync(currentVersion) {
                // ä½¿ç”¨requestIdleCallbackåœ¨æµè§ˆå™¨ç©ºé—²æ—¶ä¿å­˜
                if (window.requestIdleCallback) {
                    window.requestIdleCallback(() => {
                        this.saveVersionState(currentVersion);
                    });
                } else {
                    setTimeout(() => {
                        this.saveVersionState(currentVersion);
                    }, 0);
                }
            }

            // ç®€åŒ–çš„ç‰ˆæœ¬æ˜¾ç¤ºä¿®å¤æ–¹æ³•
            fixVersionDisplay(targetVersionId) {
                console.log(`ğŸ”§ ä¿®å¤ç‰ˆæœ¬æ˜¾ç¤º: ${targetVersionId}`);

                // æ¸…é™¤æ‰€æœ‰å½“å‰æ ‡è®°
                document.querySelectorAll('.version-item').forEach(item => {
                    item.classList.remove('current');
                    const btn = item.querySelector('.version-switch-btn');
                    if (btn) {
                        btn.classList.remove('current');
                        btn.disabled = false;
                        btn.textContent = 'â¬‡ åˆ‡æ¢';
                    }
                });

                // è®¾ç½®ç›®æ ‡ç‰ˆæœ¬ä¸ºå½“å‰
                const targetItem = document.querySelector(`[data-version="${targetVersionId}"]`);
                if (targetItem) {
                    targetItem.classList.add('current');
                    const btn = targetItem.querySelector('.version-switch-btn');
                    if (btn) {
                        btn.classList.add('current');
                        btn.disabled = true;
                        btn.textContent = 'âœ“ å½“å‰ç‰ˆæœ¬';
                    }
                    console.log(`âœ… ç‰ˆæœ¬ ${targetVersionId} å·²è®¾ç½®ä¸ºå½“å‰`);
                } else {
                    console.warn(`âš ï¸ æ‰¾ä¸åˆ°ç‰ˆæœ¬ ${targetVersionId} çš„DOMå…ƒç´ `);
                }
            }

            // ğŸš€ é«˜æ€§èƒ½Gitç‰ˆæœ¬è·å– - å¸¦æ™ºèƒ½ç¼“å­˜
            async getCurrentVersionFromGit() {
                try {
                    // æ£€æŸ¥çŸ­æœŸç¼“å­˜ï¼ˆ30ç§’å†…ï¼‰
                    const cacheKey = 'current_git_version';
                    const cached = this.getShortTermCache(cacheKey);
                    if (cached) {
                        console.log(`ğŸš€ ä½¿ç”¨ç¼“å­˜çš„Gitç‰ˆæœ¬: ${cached}`);
                        return cached;
                    }

                    console.log('ğŸ” è·å–Gitå½“å‰ç‰ˆæœ¬...');

                    // ç§»é™¤è¶…æ—¶æ§åˆ¶ï¼Œé¿å…è¯·æ±‚è¢«æ„å¤–ä¸­æ–­
                    const response = await fetch(`${this.backendUrl}/git/current-commit`, {
                        headers: {
                            'Cache-Control': 'no-cache',
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.status === 'success' && data.commit) {
                            console.log(`âœ… Gitå½“å‰ç‰ˆæœ¬: ${data.commit}`);
                            // ç¼“å­˜30ç§’
                            this.setShortTermCache(cacheKey, data.commit, 30000);
                            return data.commit;
                        }
                    }
                    console.warn('âš ï¸ æ— æ³•ä»APIè·å–å½“å‰ç‰ˆæœ¬');
                    return null;
                } catch (error) {
                    console.error('è·å–Gitç‰ˆæœ¬å¤±è´¥:', error);
                    return null;
                }
            }

            // çŸ­æœŸç¼“å­˜ç®¡ç†
            getShortTermCache(key) {
                const cache = this.shortTermCache || {};
                const item = cache[key];
                if (item && Date.now() < item.expiry) {
                    return item.value;
                }
                return null;
            }

            setShortTermCache(key, value, ttl = 30000) {
                if (!this.shortTermCache) {
                    this.shortTermCache = {};
                }
                this.shortTermCache[key] = {
                    value: value,
                    expiry: Date.now() + ttl
                };
            }

            // ä¿å­˜ç‰ˆæœ¬çŠ¶æ€
            saveVersionState(currentVersion) {
                const versionState = {
                    currentVersion: currentVersion,
                    timestamp: Date.now()
                };
                localStorage.setItem('ai_vision_current_version', JSON.stringify(versionState));
                console.log(`ğŸ’¾ ç‰ˆæœ¬çŠ¶æ€å·²ä¿å­˜: ${currentVersion}`);
            }

            // å¼ºåˆ¶åˆ·æ–°ç‰ˆæœ¬æ•°æ®
            async forceRefreshVersions() {
                console.log('ğŸ”„ å¼ºåˆ¶åˆ·æ–°ç‰ˆæœ¬æ•°æ®...');
                
                // æ·»åŠ åˆ·æ–°æŒ‰é’®åŠ¨ç”»æ•ˆæœ
                const refreshBtn = document.querySelector('.refresh-versions-btn i');
                if (refreshBtn) {
                    refreshBtn.classList.add('fa-spin');
                }

                try {
                    // 1. æ¸…é™¤å‰ç«¯ç¼“å­˜
                    this.versionCache = null;
                    this.versionCacheExpiry = null;
                    console.log('âœ… å‰ç«¯ç‰ˆæœ¬ç¼“å­˜å·²æ¸…é™¤');

                    // ğŸš¨ é¢å¤–æ¸…é™¤localStorageä¸­çš„ç‰ˆæœ¬çŠ¶æ€ç¼“å­˜
                    try {
                        localStorage.removeItem('ai_vision_current_version');
                        console.log('âœ… æœ¬åœ°ç‰ˆæœ¬çŠ¶æ€ç¼“å­˜å·²æ¸…é™¤');
                    } catch (error) {
                        console.warn('âš ï¸ æ¸…é™¤æœ¬åœ°ç‰ˆæœ¬çŠ¶æ€ç¼“å­˜å¤±è´¥:', error);
                    }

                    // 2. æ¸…é™¤åç«¯Gitç¼“å­˜ï¼ˆä½¿ç”¨æ–°çš„APIï¼‰
                    try {
                        const response = await fetch(`${this.backendUrl}/git/refresh-cache`, {
                            method: 'POST',
                            timeout: 5000
                        });
                        if (response.ok) {
                            console.log('âœ… åç«¯Gitç¼“å­˜å·²æ¸…é™¤');
                        }
                    } catch (error) {
                        console.warn('âš ï¸ æ¸…é™¤åç«¯Gitç¼“å­˜å¤±è´¥:', error);
                    }

                    // 3. ç­‰å¾…ç¼“å­˜æ¸…é™¤ç”Ÿæ•ˆï¼ˆå‡å°‘ç­‰å¾…æ—¶é—´ï¼‰
                    await new Promise(resolve => setTimeout(resolve, 100));

                    // 4. é‡æ–°åŠ è½½ç‰ˆæœ¬æ•°æ®
                    console.log('ğŸ”„ é‡æ–°åŠ è½½ç‰ˆæœ¬æ•°æ®...');
                    await this.loadVersions(true); // å¼ºåˆ¶åˆ·æ–°
                    
                    console.log('âœ… ç‰ˆæœ¬æ•°æ®åˆ·æ–°å®Œæˆ');
                } catch (error) {
                    console.error('âŒ å¼ºåˆ¶åˆ·æ–°ç‰ˆæœ¬æ•°æ®å¤±è´¥:', error);
                } finally {
                    // ç§»é™¤åˆ·æ–°æŒ‰é’®åŠ¨ç”»æ•ˆæœ
                    if (refreshBtn) {
                        refreshBtn.classList.remove('fa-spin');
                    }
                }
            }

            // ä¿å­˜ç‰ˆæœ¬åˆ‡æ¢çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
            saveVersionState(versionId) {
                try {
                    const versionState = {
                        currentVersion: versionId,
                        timestamp: Date.now(),
                        switchedAt: new Date().toISOString()
                    };
                    localStorage.setItem('ai_vision_current_version', JSON.stringify(versionState));
                    console.log(`ç‰ˆæœ¬çŠ¶æ€å·²ä¿å­˜åˆ°æœ¬åœ°: ${versionId}`);
                } catch (error) {
                    console.warn('ä¿å­˜ç‰ˆæœ¬çŠ¶æ€å¤±è´¥:', error);
                }
            }

            // ç›´æ¥è·å–Gitå½“å‰ç‰ˆæœ¬ï¼Œä½¿ç”¨Electron API
            async getActualCurrentVersion() {
                try {
                    console.log('ğŸ” ä½¿ç”¨Electron APIæ£€æŸ¥Gitå½“å‰ç‰ˆæœ¬...');
                    const data = await window.electronAPI.gitGetCurrentCommit();

                    if (data.status === 'success') {
                        // è¿”å›å®Œæ•´hashä»¥åŒ¹é…ç‰ˆæœ¬åˆ—è¡¨ä¸­çš„data-versionæ ¼å¼
                        const currentVersion = data.commit_hash || data.commit_short;
                        console.log(`âœ… Gitå½“å‰ç‰ˆæœ¬: ${currentVersion} (çŸ­ç‰ˆæœ¬: ${data.commit_short})`);
                        return currentVersion;
                    }
                } catch (error) {
                    console.warn('ğŸ“¡ æ— æ³•ç›´æ¥è·å–GitçŠ¶æ€ï¼Œä½¿ç”¨æœ¬åœ°çŠ¶æ€:', error);
                }

                // åå¤‡æ–¹æ¡ˆï¼šä½¿ç”¨æœ¬åœ°ä¿å­˜çš„çŠ¶æ€
                try {
                    const savedState = localStorage.getItem('ai_vision_current_version');
                    if (savedState) {
                        const versionState = JSON.parse(savedState);
                        if (Date.now() - versionState.timestamp < 300000) { // 5åˆ†é’Ÿå†…æœ‰æ•ˆ
                            console.log(`ğŸ“¦ ä½¿ç”¨æœ¬åœ°ä¿å­˜ç‰ˆæœ¬: ${versionState.currentVersion}`);
                            return versionState.currentVersion;
                        }
                    }
                } catch (error) {
                    console.warn('æœ¬åœ°çŠ¶æ€è§£æå¤±è´¥:', error);
                }

                console.warn('âš ï¸ æ— æ³•ç¡®å®šå½“å‰ç‰ˆæœ¬');
                return null;
            }

            // åº”ç”¨æœ¬åœ°ä¿å­˜çš„ç‰ˆæœ¬çŠ¶æ€
            async applyLocalVersionState() {
                try {
                    console.log('ğŸ”„ å¼€å§‹æ£€æŸ¥å’Œåº”ç”¨ç‰ˆæœ¬çŠ¶æ€...');

                    // é¦–å…ˆå°è¯•ç›´æ¥è·å–Gitå½“å‰ç‰ˆæœ¬
                    const actualCurrentVersion = await this.getActualCurrentVersion();

                    if (actualCurrentVersion) {
                        console.log(`ğŸ¯ ç¡®å®šçš„å½“å‰ç‰ˆæœ¬: ${actualCurrentVersion}`);

                        // æ£€æŸ¥å‰ç«¯æ˜¾ç¤ºçŠ¶æ€
                        const currentItems = document.querySelectorAll('.version-item.current');
                        console.log(`ğŸ” å‘ç° ${currentItems.length} ä¸ªå½“å‰ç‰ˆæœ¬æ ‡è®°`);

                        let needsFix = false;

                        if (currentItems.length === 0) {
                            console.log(`âš ï¸ æ²¡æœ‰å½“å‰ç‰ˆæœ¬æ ‡è®°ï¼Œåº”è¯¥æ ‡è®° ${actualCurrentVersion}`);
                            needsFix = true;
                        } else if (currentItems.length > 1) {
                            const displayedVersions = Array.from(currentItems).map(item => item.getAttribute('data-version'));
                            console.log(`âš ï¸ å‘ç°å¤šä¸ªå½“å‰ç‰ˆæœ¬: ${displayedVersions.join(', ')}`);
                            needsFix = true;
                        } else {
                            const currentDisplayed = currentItems[0].getAttribute('data-version');
                            // æ”¯æŒä¸åŒé•¿åº¦çš„hashæ¯”è¾ƒï¼ˆå®Œæ•´hash vs çŸ­hashï¼‰
                            const isVersionMatch = this.compareVersionHashes(currentDisplayed, actualCurrentVersion);
                            if (!isVersionMatch) {
                                console.log(`âš ï¸ ç‰ˆæœ¬ä¸åŒ¹é…: æ˜¾ç¤º ${currentDisplayed}ï¼Œå®é™… ${actualCurrentVersion}`);
                                needsFix = true;
                            } else {
                                console.log(`âœ… ç‰ˆæœ¬æ˜¾ç¤ºæ­£ç¡®: ${actualCurrentVersion}`);
                            }
                        }

                        if (needsFix) {
                            console.log(`ğŸ”§ å¼€å§‹ä¿®å¤ç‰ˆæœ¬æ˜¾ç¤º...`);
                            this.ensureCurrentVersionMarked(actualCurrentVersion);

                            // åŒæ—¶æ›´æ–°æœ¬åœ°çŠ¶æ€
                            this.saveVersionState(actualCurrentVersion);
                        }
                    } else {
                        console.log('âš ï¸ æ— æ³•ç¡®å®šå½“å‰ç‰ˆæœ¬ï¼Œå›é€€åˆ°åŸæœ‰é€»è¾‘');
                        // å›é€€åˆ°åŸæœ‰çš„æœ¬åœ°çŠ¶æ€é€»è¾‘
                        this.applyLocalVersionStateOld();
                    }
                } catch (error) {
                    console.warn('åº”ç”¨ç‰ˆæœ¬çŠ¶æ€å¤±è´¥:', error);
                    // å‡ºé”™æ—¶å›é€€åˆ°åŸæœ‰é€»è¾‘
                    this.applyLocalVersionStateOld();
                }
            }

            // å·²åºŸå¼ƒï¼šé‡å®šå‘åˆ°æ–°çš„ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†æ–¹æ³•
            bruteForceFixVersionDisplay(targetVersionId) {
                console.log(`ğŸ”§ é‡å®šå‘åˆ°æ–°çš„ç‰ˆæœ¬ä¿®å¤æ–¹æ³•: ${targetVersionId}`);
                this.fixVersionDisplay(targetVersionId);
            }

            // å·²åºŸå¼ƒï¼šä¸å†ä½¿ç”¨å®šæœŸç›‘æ§ï¼Œé¿å…å†²çª
            setupBruteForceMonitoring(expectedVersionId) {
                console.log(`âš ï¸ æš´åŠ›ç›‘æ§å·²åºŸå¼ƒï¼Œä½¿ç”¨ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†: ${expectedVersionId}`);
                // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„å®šæ—¶å™¨
                if (this.bruteForceTimer) {
                    clearInterval(this.bruteForceTimer);
                    this.bruteForceTimer = null;
                }
                // ä¸å†å¯åŠ¨å®šæœŸç›‘æ§ï¼Œé¿å…ä¸ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†å†²çª
            }

            // åŸæœ‰çš„æœ¬åœ°çŠ¶æ€åº”ç”¨é€»è¾‘ï¼ˆä½œä¸ºåå¤‡æ–¹æ¡ˆï¼‰
            applyLocalVersionStateOld() {
                try {
                    const savedState = localStorage.getItem('ai_vision_current_version');
                    if (savedState) {
                        const versionState = JSON.parse(savedState);
                        const savedVersion = versionState.currentVersion;
                        const timestamp = versionState.timestamp;

                        // æ£€æŸ¥ä¿å­˜çš„çŠ¶æ€æ˜¯å¦è¾ƒæ–°ï¼ˆ5åˆ†é’Ÿå†…ï¼‰
                        if (Date.now() - timestamp < 300000) {
                            console.log(`ğŸ“¦ ä½¿ç”¨æœ¬åœ°ä¿å­˜çš„ç‰ˆæœ¬çŠ¶æ€: ${savedVersion}`);
                            this.ensureCurrentVersionMarked(savedVersion);
                        } else {
                            console.log('â° æœ¬åœ°ç‰ˆæœ¬çŠ¶æ€å·²è¿‡æœŸï¼Œæ¸…é™¤');
                            localStorage.removeItem('ai_vision_current_version');
                        }
                    } else {
                        console.log('ğŸ“­ æ²¡æœ‰æœ¬åœ°ä¿å­˜çš„ç‰ˆæœ¬çŠ¶æ€');
                    }
                } catch (error) {
                    console.warn('æœ¬åœ°ç‰ˆæœ¬çŠ¶æ€åº”ç”¨å¤±è´¥:', error);
                }
            }

            bindVersionManagementEvents() {
                // ç­‰å¾…DOMæ›´æ–°åç»‘å®šäº‹ä»¶
                setTimeout(() => {
                    // ç»‘å®šç‰ˆæœ¬ç±»å‹åˆ‡æ¢æ ‡ç­¾
                    const versionTabs = document.querySelectorAll('.version-tab-btn');
                    console.log('Found version tabs:', versionTabs.length);

                    versionTabs.forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            console.log('Version tab clicked:', e.currentTarget.dataset.type);
                            this.switchVersionTab(e.currentTarget.dataset.type);
                        });
                    });
                }, 100);
            }

            // æ¸è¿›å¼ç‰ˆæœ¬åŠ è½½æ–¹æ³•ï¼ˆæ ¸å¿ƒä¼˜åŒ–ï¼‰
            async loadVersionsProgressive() {
                console.log('âš¡ å¯åŠ¨æ¸è¿›å¼åŠ è½½ï¼šç¬¬ä¸€é˜¶æ®µ - å¿«é€Ÿæ˜¾ç¤ºæœ¬åœ°ç‰ˆæœ¬');
                
                try {
                    // ç¬¬ä¸€é˜¶æ®µï¼šå¿«é€ŸåŠ è½½æœ¬åœ°ç‰ˆæœ¬ï¼ˆç¬é—´æ˜¾ç¤ºï¼‰
                    await this.loadVersionsQuick();
                    
                    // æ˜¾ç¤ºæ›´æ–°æ£€æŸ¥çŠ¶æ€
                    this.showUpdateCheckingStatus();
                    
                    // ç¬¬äºŒé˜¶æ®µï¼šåå°è·å–æœ€æ–°è¿œç¨‹ç‰ˆæœ¬
                    setTimeout(async () => {
                        console.log('ğŸ”„ å¯åŠ¨åå°æ›´æ–°ï¼šè·å–æœ€æ–°è¿œç¨‹ç‰ˆæœ¬');
                        await this.loadVersionsRemote();
                    }, 100); // 100msåå¼€å§‹åå°æ›´æ–°
                    
                } catch (error) {
                    console.error('æ¸è¿›å¼åŠ è½½å¤±è´¥ï¼Œå›é€€åˆ°æ ‡å‡†åŠ è½½:', error);
                    // å›é€€æ–¹æ¡ˆ
                    await this.loadVersionsWithRetry(true, 3);
                }
            }

            // å¿«é€Ÿæ¨¡å¼ï¼šä»…æ˜¾ç¤ºæœ¬åœ°å·²çŸ¥ç‰ˆæœ¬
            async loadVersionsQuick() {
                console.log('âš¡ å¿«é€Ÿæ¨¡å¼ï¼šåŠ è½½æœ¬åœ°ç‰ˆæœ¬æ•°æ®');
                
                const loading = document.getElementById('version-loading');
                const stableList = document.getElementById('stable-versions');
                const devList = document.getElementById('development-versions');
                
                // ä¼˜åŒ–ï¼šæ˜¾ç¤ºæç®€çš„åŠ è½½çŠ¶æ€ï¼Œå‡å°‘DOMæ“ä½œ
                loading.style.display = 'flex';
                loading.innerHTML = `<div class="loading-spinner-modern"></div>`;
                
                try {
                    // ä¼˜åŒ–ï¼šå¹¶è¡Œå¤„ç†ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´
                    const startTime = performance.now();
                    
                    // è°ƒç”¨å¿«é€Ÿæ¨¡å¼API
                    const versionData = await this.fetchVersionData(false, true); // quick_mode=true
                    console.log('âš¡ å¿«é€Ÿç‰ˆæœ¬æ•°æ®åŠ è½½å®Œæˆ:', versionData);
                    
                    // ä¼˜åŒ–ï¼šå¹¶è¡Œæ¸²æŸ“ç‰ˆæœ¬åˆ—è¡¨ï¼Œå‡å°‘æ€»æ—¶é—´
                    await Promise.all([
                        this.renderVersionList('stable', versionData.stable),
                        this.renderVersionList('development', versionData.development)
                    ]);
                    
                    // éšè—åŠ è½½ç•Œé¢ï¼Œæ˜¾ç¤ºç‰ˆæœ¬åˆ—è¡¨
                    loading.style.display = 'none';
                    stableList.style.display = 'block';
                    devList.style.display = 'block';
                    
                    const endTime = performance.now();
                    console.log(`âœ… å¿«é€Ÿæ¨¡å¼åŠ è½½å®Œæˆ (${(endTime - startTime).toFixed(2)}ms)`);
                    
                } catch (error) {
                    console.error('å¿«é€Ÿæ¨¡å¼åŠ è½½å¤±è´¥:', error);
                    throw error;
                }
            }

            // åå°æ›´æ–°ï¼šè·å–æœ€æ–°è¿œç¨‹ç‰ˆæœ¬
            async loadVersionsRemote() {
                try {
                    console.log('ğŸŒ åå°è·å–æœ€æ–°è¿œç¨‹ç‰ˆæœ¬...');
                    
                    // è°ƒç”¨å®Œæ•´æ¨¡å¼API
                    const remoteData = await this.fetchVersionData(true, false); // force_refresh=true, quick_mode=false
                    console.log('ğŸŒ è¿œç¨‹ç‰ˆæœ¬æ•°æ®è·å–å®Œæˆ:', remoteData);
                    console.log('ğŸ“Š æ•°æ®æº:', remoteData.data_source, '- å½“å‰æäº¤:', remoteData.current_commit);
                    
                    // æ–°ç­–ç•¥ï¼šåŸºäºç‰ˆæœ¬å†…å®¹åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œè€Œä¸ä¾èµ–data_sourceå­—æ®µ
                    const hasNewerVersions = this.checkForNewerVersions(remoteData);
                    
                    if (hasNewerVersions > 0) {
                        console.log('ğŸ”„ ========== æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬ï¼Œå¼€å§‹æ›´æ–°ç‰ˆæœ¬åˆ—è¡¨ ==========');
                        console.log('ğŸ“Š æ£€æµ‹åˆ°', hasNewerVersions, 'ä¸ªæ–°ç‰ˆæœ¬');
                        console.log('ğŸ“Š è¿œç¨‹å¼€å‘ç‰ˆæœ¬æ•°é‡:', remoteData.development?.length || 0);
                        console.log('ğŸ“Š è¿œç¨‹ç¨³å®šç‰ˆæœ¬æ•°é‡:', remoteData.stable?.length || 0);
                        
                        // ç›´æ¥æ›´æ–°ç‰ˆæœ¬åˆ—è¡¨ä¸ºè¿œç¨‹æ•°æ®
                        console.log('ğŸ”„ å¼€å§‹æ¸²æŸ“å¼€å‘ç‰ˆæœ¬...');
                        await this.renderVersionList('development', remoteData.development);
                        console.log('âœ… å¼€å‘ç‰ˆæœ¬æ¸²æŸ“å®Œæˆ');
                        
                        console.log('ğŸ”„ å¼€å§‹æ¸²æŸ“ç¨³å®šç‰ˆæœ¬...');
                        await this.renderVersionList('stable', remoteData.stable);
                        console.log('âœ… ç¨³å®šç‰ˆæœ¬æ¸²æŸ“å®Œæˆ');
                        
                        // éªŒè¯DOMæ˜¯å¦å·²æ›´æ–°
                        const updatedDevItems = document.querySelectorAll('#development-versions .version-item');
                        const updatedStableItems = document.querySelectorAll('#stable-versions .version-item');
                        console.log('ğŸ” DOMéªŒè¯ - æ›´æ–°åå¼€å‘ç‰ˆæœ¬æ•°é‡:', updatedDevItems.length);
                        console.log('ğŸ” DOMéªŒè¯ - æ›´æ–°åç¨³å®šç‰ˆæœ¬æ•°é‡:', updatedStableItems.length);
                        console.log('ğŸ” DOMéªŒè¯ - å¼€å‘ç‰ˆæœ¬å‰3ä¸ªID:', Array.from(updatedDevItems).slice(0, 3).map(el => el.getAttribute('data-version')));
                        
                        // æ˜¾ç¤ºæ›´æ–°é€šçŸ¥
                        this.showUpdateNotification(hasNewerVersions);
                        console.log(`ğŸ†• ç‰ˆæœ¬åˆ—è¡¨å·²æ›´æ–°ï¼Œå‘ç° ${hasNewerVersions} ä¸ªæ–°ç‰ˆæœ¬`);
                    } else {
                        this.hideUpdateCheckingStatus();
                        console.log('ğŸ“… æ²¡æœ‰æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬');
                    }
                    
                } catch (error) {
                    console.error('åå°ç‰ˆæœ¬æ›´æ–°å¤±è´¥:', error);
                    this.showUpdateError(error);
                }
            }

            // æ¯”è¾ƒç‰ˆæœ¬æ•°æ®å¹¶æ›´æ–°ç•Œé¢
            async compareAndUpdateVersions(remoteData) {
                const currentDevVersions = document.querySelectorAll('#development-versions .version-item');
                const currentStableVersions = document.querySelectorAll('#stable-versions .version-item');
                
                let newVersionsCount = 0;
                let hasNewDevelopment = false;
                let hasNewStable = false;
                
                console.log('ğŸ” å¼€å§‹ç‰ˆæœ¬æ¯”è¾ƒ:', {
                    dataSource: remoteData.data_source,
                    quickMode: remoteData.quick_mode,
                    currentCommit: remoteData.current_commit
                });
                
                // å¦‚æœæ˜¯è¿œç¨‹æ•°æ®æºä¸”æ˜¯åŒä¸€ä¸ªGitä»“åº“ï¼Œéœ€è¦æ›´ä»”ç»†çš„æ¯”è¾ƒé€»è¾‘
                const isRealRemoteData = remoteData.data_source === 'remote' && !remoteData.quick_mode;
                
                if (!isRealRemoteData) {
                    console.log('ğŸ“… ä½¿ç”¨æœ¬åœ°æ•°æ®æˆ–å¿«é€Ÿæ¨¡å¼ï¼Œæ— éœ€ç‰ˆæœ¬æ¯”è¾ƒ');
                    return 0; // æœ¬åœ°æ•°æ®ä¸éœ€è¦æ˜¾ç¤º"å‘ç°æ–°ç‰ˆæœ¬"
                }
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„å¼€å‘ç‰ˆæœ¬
                if (remoteData.development && remoteData.development.length > 0) {
                    const latestRemoteDevId = remoteData.development[0].id || remoteData.development[0].commit;
                    const latestLocalDevId = currentDevVersions.length > 0 ? 
                        currentDevVersions[0].getAttribute('data-version') : null;
                    
                    console.log('ğŸ” ç‰ˆæœ¬æ¯”è¾ƒ - å¼€å‘ç‰ˆ:', {
                        remote: latestRemoteDevId,
                        local: latestLocalDevId,
                        dataSource: remoteData.data_source
                    });
                    
                    // åªæœ‰åœ¨çœŸæ­£çš„è¿œç¨‹æ•°æ®ä¸”ç‰ˆæœ¬ä¸åŒæ—¶æ‰ç®—æœ‰æ›´æ–°
                    if (latestRemoteDevId && latestLocalDevId && latestRemoteDevId !== latestLocalDevId) {
                        hasNewDevelopment = true;
                        newVersionsCount += this.countNewVersions(remoteData.development, currentDevVersions);
                        console.log(`ğŸ†• å‘ç°æ–°å¼€å‘ç‰ˆæœ¬ï¼Œå·®å¼‚æ•°é‡: ${newVersionsCount}`);
                    } else {
                        console.log('ğŸ“… å¼€å‘ç‰ˆæœ¬å·²æ˜¯æœ€æ–°');
                    }
                }
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„ç¨³å®šç‰ˆæœ¬
                if (remoteData.stable && remoteData.stable.length > 0) {
                    const latestRemoteStableId = remoteData.stable[0].id || remoteData.stable[0].version;
                    const latestLocalStableId = currentStableVersions.length > 0 ? 
                        currentStableVersions[0].getAttribute('data-version') : null;
                    
                    console.log('ğŸ” ç‰ˆæœ¬æ¯”è¾ƒ - ç¨³å®šç‰ˆ:', {
                        remote: latestRemoteStableId,
                        local: latestLocalStableId,
                        dataSource: remoteData.data_source
                    });
                    
                    // åªæœ‰åœ¨çœŸæ­£çš„è¿œç¨‹æ•°æ®ä¸”ç‰ˆæœ¬ä¸åŒæ—¶æ‰ç®—æœ‰æ›´æ–°
                    if (latestRemoteStableId && latestLocalStableId && latestRemoteStableId !== latestLocalStableId) {
                        hasNewStable = true;
                        newVersionsCount += this.countNewVersions(remoteData.stable, currentStableVersions);
                        console.log(`ğŸ†• å‘ç°æ–°ç¨³å®šç‰ˆæœ¬ï¼Œå·®å¼‚æ•°é‡: ${newVersionsCount}`);
                    } else {
                        console.log('ğŸ“… ç¨³å®šç‰ˆæœ¬å·²æ˜¯æœ€æ–°');
                    }
                }
                
                // å¦‚æœæœ‰æ›´æ–°ï¼Œé™é»˜æ›´æ–°ç‰ˆæœ¬åˆ—è¡¨
                if (hasNewDevelopment || hasNewStable) {
                    console.log(`ğŸ†• å‘ç° ${newVersionsCount} ä¸ªæ–°ç‰ˆæœ¬ï¼Œé™é»˜æ›´æ–°ç•Œé¢`);
                    
                    if (hasNewDevelopment) {
                        await this.renderVersionList('development', remoteData.development);
                    }
                    if (hasNewStable) {
                        await this.renderVersionList('stable', remoteData.stable);
                    }
                    
                    return newVersionsCount;
                }
                
                return 0;
            }

            // è®¡ç®—æ–°ç‰ˆæœ¬æ•°é‡
            countNewVersions(remoteVersions, currentElements) {
                const currentIds = Array.from(currentElements).map(el => el.getAttribute('data-version'));
                return remoteVersions.filter(v => !currentIds.includes(v.id)).length;
            }

            // æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬ï¼ˆåŸºäºç‰ˆæœ¬å†…å®¹è€Œédata_sourceå­—æ®µï¼‰
            checkForNewerVersions(remoteData) {
                if (!remoteData || !remoteData.development) {
                    return 0;
                }
                
                // æ‰¾åˆ°å½“å‰ç‰ˆæœ¬åœ¨è¿œç¨‹æ•°æ®ä¸­çš„ä½ç½®
                const currentIndex = remoteData.development.findIndex(v => v.current === true);
                
                console.log('ğŸ” æ–°ç‰ˆæœ¬æ£€æµ‹:', {
                    currentIndex: currentIndex,
                    totalVersions: remoteData.development.length,
                    newerVersions: currentIndex > 0 ? currentIndex : 0
                });
                
                // å¦‚æœå½“å‰ç‰ˆæœ¬ä¸åœ¨ç¬¬ä¸€ä½ï¼Œè¯´æ˜å‰é¢æœ‰æ–°ç‰ˆæœ¬
                return currentIndex > 0 ? currentIndex : 0;
            }

            // ç®€å•è®¡ç®—ç‰ˆæœ¬å·®å¼‚ï¼ˆç”¨äºæ›´æ–°é€šçŸ¥ï¼‰
            calculateVersionDifference(remoteData) {
                // è·å–å½“å‰æ˜¾ç¤ºçš„ç‰ˆæœ¬åˆ—è¡¨
                const currentDevItems = document.querySelectorAll('#development-versions .version-item');
                const currentStableItems = document.querySelectorAll('#stable-versions .version-item');
                
                // è®¡ç®—è¿œç¨‹æ•°æ®ç›¸æ¯”å½“å‰æ˜¾ç¤ºçš„å¢é‡
                const remoteDevCount = remoteData.development ? remoteData.development.length : 0;
                const remoteStableCount = remoteData.stable ? remoteData.stable.length : 0;
                
                const currentDevCount = currentDevItems.length;
                const currentStableCount = currentStableItems.length;
                
                // è®¡ç®—ç‰ˆæœ¬å·®å¼‚ï¼šè¿œç¨‹ç‰ˆæœ¬æ•° - å½“å‰æ˜¾ç¤ºç‰ˆæœ¬æ•°
                const devDiff = Math.max(0, remoteDevCount - currentDevCount);
                const stableDiff = Math.max(0, remoteStableCount - currentStableCount);
                
                const totalDiff = devDiff + stableDiff;
                
                console.log(`ğŸ“Š ç‰ˆæœ¬å·®å¼‚è®¡ç®—:`, {
                    remote: { dev: remoteDevCount, stable: remoteStableCount },
                    current: { dev: currentDevCount, stable: currentStableCount },
                    diff: { dev: devDiff, stable: stableDiff, total: totalDiff }
                });
                
                return totalDiff;
            }

            // æ˜¾ç¤ºæ›´æ–°æ£€æŸ¥çŠ¶æ€
            showUpdateCheckingStatus() {
                const statusContainer = document.getElementById('version-update-status') || this.createUpdateStatusContainer();
                statusContainer.innerHTML = `
                    <div class="update-checking">
                        <i class="fas fa-sync fa-spin"></i>
                        <span>æ­£åœ¨æ£€æŸ¥ç‰ˆæœ¬æ›´æ–°...</span>
                    </div>
                `;
                statusContainer.style.display = 'block';
            }

            // æ˜¾ç¤ºæ›´æ–°é€šçŸ¥
            showUpdateNotification(newVersionsCount) {
                const statusContainer = document.getElementById('version-update-status') || this.createUpdateStatusContainer();
                statusContainer.innerHTML = `
                    <div class="update-notification">
                        <i class="fas fa-info-circle"></i>
                        <span>å‘ç° ${newVersionsCount} ä¸ªæ–°ç‰ˆæœ¬</span>
                        <button onclick="launcherInstance.hideUpdateNotification()" class="update-close-btn">Ã—</button>
                    </div>
                `;
                statusContainer.style.display = 'block';
                
                // 5ç§’åè‡ªåŠ¨éšè—
                setTimeout(() => this.hideUpdateNotification(), 5000);
            }

            // æ˜¾ç¤ºæ›´æ–°é”™è¯¯
            showUpdateError(error) {
                const statusContainer = document.getElementById('version-update-status') || this.createUpdateStatusContainer();
                statusContainer.innerHTML = `
                    <div class="update-error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>æ£€æŸ¥æ›´æ–°å¤±è´¥</span>
                    </div>
                `;
                statusContainer.style.display = 'block';
                
                // 3ç§’åè‡ªåŠ¨éšè—
                setTimeout(() => this.hideUpdateCheckingStatus(), 3000);
            }

            // éšè—æ›´æ–°çŠ¶æ€
            hideUpdateCheckingStatus() {
                const statusContainer = document.getElementById('version-update-status');
                if (statusContainer) {
                    statusContainer.style.display = 'none';
                }
            }

            hideUpdateNotification() {
                this.hideUpdateCheckingStatus();
            }

            // åˆ›å»ºæ›´æ–°çŠ¶æ€å®¹å™¨
            createUpdateStatusContainer() {
                const container = document.createElement('div');
                container.id = 'version-update-status';
                container.className = 'version-update-status';
                
                const versionManagement = document.getElementById('version-management');
                const versionTabs = versionManagement.querySelector('.version-tabs');
                versionTabs.insertAdjacentElement('afterend', container);
                
                return container;
            }

            // å¸¦é‡è¯•æœºåˆ¶çš„ç‰ˆæœ¬åŠ è½½æ–¹æ³•
            async loadVersionsWithRetry(forceRefresh = false, maxRetries = 3) {
                for (let attempt = 1; attempt <= maxRetries; attempt++) {
                    try {
                        console.log(`ğŸ”„ ç‰ˆæœ¬åŠ è½½å°è¯• ${attempt}/${maxRetries}`);
                        
                        // ç¬¬ä¸€æ¬¡å°è¯•ç«‹å³æ‰§è¡Œï¼Œåç»­å°è¯•å¢åŠ å»¶è¿Ÿ
                        if (attempt > 1) {
                            const delay = attempt * 2000; // 2ç§’ã€4ç§’çš„å»¶è¿Ÿ
                            console.log(`â±ï¸ ç­‰å¾… ${delay}ms åé‡è¯•...`);
                            await new Promise(resolve => setTimeout(resolve, delay));
                        }
                        
                        await this.loadVersions(forceRefresh);
                        console.log(`âœ… ç‰ˆæœ¬åŠ è½½æˆåŠŸ (å°è¯• ${attempt}/${maxRetries})`);
                        return; // æˆåŠŸåé€€å‡º
                        
                    } catch (error) {
                        console.warn(`âš ï¸ ç‰ˆæœ¬åŠ è½½å°è¯• ${attempt}/${maxRetries} å¤±è´¥:`, error.message);
                        
                        if (attempt === maxRetries) {
                            console.error('âŒ æ‰€æœ‰ç‰ˆæœ¬åŠ è½½å°è¯•éƒ½å¤±è´¥äº†');
                            // æœ€åä¸€æ¬¡å¤±è´¥æ—¶ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                            const loading = document.getElementById('version-loading');
                            if (loading) {
                                loading.innerHTML = `
                                    <div style="color: #ff4757; text-align: center; padding: 20px;">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <p>ç‰ˆæœ¬ä¿¡æ¯åŠ è½½å¤±è´¥</p>
                                        <p>å°è¯•äº† ${maxRetries} æ¬¡ä»æ— æ³•è¿æ¥åç«¯æœåŠ¡</p>
                                        <button onclick="launcherInstance.loadVersionsWithRetry(true, 3)" class="btn btn-primary">é‡æ–°å°è¯•</button>
                                    </div>
                                `;
                            }
                        }
                    }
                }
            }

            async loadVersions(forceRefresh = false) {
                const loading = document.getElementById('version-loading');
                const stableList = document.getElementById('stable-versions');
                const devList = document.getElementById('development-versions');

                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                loading.style.display = 'flex';
                stableList.style.display = 'none';
                devList.style.display = 'none';

                // åˆå§‹åŒ–è¿›åº¦æ˜¾ç¤º
                this.updateLoadingProgress('version', 0, 'æ­£åœ¨åˆå§‹åŒ–ç‰ˆæœ¬æ£€æŸ¥...');

                try {
                    this.updateLoadingProgress('version', 20, 'æ­£åœ¨è¿æ¥Gitä»“åº“...');
                    // è·å–ç‰ˆæœ¬æ•°æ®ï¼Œæ”¯æŒå¼ºåˆ¶åˆ·æ–°
                    console.log('ğŸ” Loading versions with forceRefresh:', forceRefresh);
                    const versionData = await this.fetchVersionData(forceRefresh);
                    console.log('ğŸ” Version data loaded:', versionData);
                    console.log('ğŸ” Stable versions count:', versionData.stable ? versionData.stable.length : 0);
                    console.log('ğŸ” Development versions count:', versionData.development ? versionData.development.length : 0);

                    // æ£€æŸ¥æ˜¯å¦æœ‰æ¯”å½“å‰ç‰ˆæœ¬æ›´æ–°çš„ç‰ˆæœ¬
                    if (versionData.development && versionData.development.length > 0) {
                        const currentIndex = versionData.development.findIndex(v => v.current);
                        console.log('ğŸ” Current version index:', currentIndex);
                        if (currentIndex > 0) {
                            console.log('ğŸ” Found newer versions:', versionData.development.slice(0, currentIndex));
                        } else if (currentIndex === -1) {
                            console.log('ğŸ” Current version not found in development list');
                        } else {
                            console.log('ğŸ” Current version is the latest');
                        }
                    }

                    this.updateLoadingProgress('version', 60, 'æ­£åœ¨å¤„ç†ç‰ˆæœ¬æ•°æ®...');

                    // æ¸²æŸ“ç‰ˆæœ¬åˆ—è¡¨
                    this.updateLoadingProgress('version', 80, 'æ­£åœ¨æ¸²æŸ“ç‰ˆæœ¬åˆ—è¡¨...');
                    this.renderVersionList('stable', versionData.stable);
                    this.renderVersionList('development', versionData.development);

                    this.updateLoadingProgress('version', 100, 'åŠ è½½å®Œæˆï¼');

                    // å»¶è¿Ÿéšè—åŠ è½½çŠ¶æ€ï¼Œè®©ç”¨æˆ·çœ‹åˆ°100%å®Œæˆ
                    setTimeout(() => {
                        loading.style.display = 'none';
                    }, 300);
                    this.showVersionList(this.currentVersionType);

                    // å»¶è¿Ÿåº”ç”¨æœ¬åœ°ç‰ˆæœ¬çŠ¶æ€ï¼Œç¡®ä¿DOMæ¸²æŸ“å®Œæˆ
                    setTimeout(async () => {
                        console.log('ğŸ“ loadVersionså®Œæˆååº”ç”¨æœ¬åœ°çŠ¶æ€...');
                        await this.applyLocalVersionState();

                        // ğŸ¯ é¢å¤–éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦æœ‰æœ¬åœ°ä¿å­˜çš„ç‰ˆæœ¬çŠ¶æ€éœ€è¦åº”ç”¨
                        const savedState = localStorage.getItem('ai_vision_current_version');
                        if (savedState) {
                            try {
                                const versionState = JSON.parse(savedState);
                                if (Date.now() - versionState.timestamp < 300000) { // 5åˆ†é’Ÿå†…æœ‰æ•ˆ
                                    console.log('ğŸ¯ å‘ç°æœ¬åœ°ç‰ˆæœ¬çŠ¶æ€ï¼ŒéªŒè¯æ˜¾ç¤ºæ˜¯å¦æ­£ç¡®...');
                                    const currentItems = document.querySelectorAll('.version-item.current');
                                    if (currentItems.length !== 1 ||
                                        currentItems[0]?.getAttribute('data-version') !== versionState.currentVersion) {
                                        console.log('ğŸ”§ ç‰ˆæœ¬æ˜¾ç¤ºä¸æ­£ç¡®ï¼Œæ‰§è¡Œä¿®å¤...');
                                        this.updateCurrentVersion(versionState.currentVersion);
                                    }
                                }
                            } catch (error) {
                                console.warn('éªŒè¯æœ¬åœ°ç‰ˆæœ¬çŠ¶æ€å¤±è´¥:', error);
                            }
                        }
                    }, 500);

                } catch (error) {
                    console.error('Failed to load versions:', error);
                    loading.innerHTML = `
                        <div style="color: #ff4757; text-align: center;">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>åŠ è½½ç‰ˆæœ¬ä¿¡æ¯å¤±è´¥</p>
                            <button onclick="launcherInstance.loadVersions()" class="btn btn-primary">é‡è¯•</button>
                        </div>
                    `;
                }
            }

            // ğŸš€ è¶…å¿«é€Ÿç‰ˆæœ¬æ•°æ®è·å– - ä¼˜åŒ–ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤ºå’ŒåŠ è½½æ€§èƒ½
            async fetchVersionData(forceRefresh = false, quickMode = false) {
                // ç¼“å­˜æ£€æŸ¥ - å¢åŠ æ›´æ™ºèƒ½çš„ç¼“å­˜ç­–ç•¥
                const now = Date.now();
                const cacheValid = this.versionCache && this.versionCacheExpiry && now < this.versionCacheExpiry;
                
                if (!forceRefresh && cacheValid) {
                    console.log('ğŸš€ ä½¿ç”¨ç¼“å­˜æ•°æ® (å‰©ä½™æ—¶é—´: ' + Math.round((this.versionCacheExpiry - now) / 1000) + 's)');
                    // ç¡®ä¿ç¼“å­˜æ•°æ®åŒ…å«æ­£ç¡®çš„å½“å‰ç‰ˆæœ¬æ ‡è®°
                    this.validateCurrentVersionInCache();
                    return this.versionCache;
                }

                console.log(`ğŸš€ è·å–ç‰ˆæœ¬æ•°æ®${forceRefresh ? ' (å¼ºåˆ¶åˆ·æ–°)' : ''}...`);
                const startTime = performance.now();

                try {
                    // ä¼˜åŒ–è¯·æ±‚å‚æ•°ï¼Œå‡å°‘ä¸å¿…è¦çš„æ•°æ®ä¼ è¾“
                    const requestParams = new URLSearchParams({
                        force_refresh: forceRefresh,
                        quick_mode: quickMode,   // æ–°å¢ï¼šå¿«é€Ÿæ¨¡å¼å‚æ•°
                        limit_stable: '15',      // é™åˆ¶ç¨³å®šç‰ˆæœ¬æ•°é‡
                        limit_development: '25', // é™åˆ¶å¼€å‘ç‰ˆæœ¬æ•°é‡
                        include_details: 'true'  // åŒ…å«è¯¦ç»†ä¿¡æ¯
                    });

                    const apiUrl = `${this.backendUrl}/comfyui/versions?${requestParams}`;
                    console.log('ğŸŒ APIè¯·æ±‚URL:', apiUrl);
                    console.log('ğŸ“‹ è¯·æ±‚å‚æ•°:', Object.fromEntries(requestParams));

                    const response = await fetch(apiUrl, {
                        headers: {
                            'Cache-Control': forceRefresh ? 'no-cache' : 'max-age=30',
                            'Accept': 'application/json',
                            'X-Request-ID': Date.now().toString() // è¯·æ±‚IDç”¨äºè°ƒè¯•
                        },
                        signal: AbortSignal.timeout(30000) // å¢åŠ åˆ°30ç§’è¶…æ—¶
                    });

                    if (!response.ok) {
                        throw new Error(`APIé”™è¯¯: ${response.status} ${response.statusText}`);
                    }

                    const versionData = await response.json();
                    const endTime = performance.now();
                    console.log(`âœ… æ•°æ®è·å–å®Œæˆ (${(endTime - startTime).toFixed(2)}ms)`);

                    // æ•°æ®éªŒè¯å’Œæ ‡å‡†åŒ–å¤„ç†
                    const processedData = this.validateAndProcessVersionData(versionData);
                    
                    // ç¼“å­˜æ•°æ® - åŠ¨æ€è°ƒæ•´ç¼“å­˜æ—¶é—´
                    this.versionCache = processedData;
                    const cacheTime = forceRefresh ? 300000 : 180000; // å¼ºåˆ¶åˆ·æ–°ç¼“å­˜5åˆ†é’Ÿï¼Œæ™®é€šåˆ·æ–°3åˆ†é’Ÿ
                    this.versionCacheExpiry = now + cacheTime;

                    console.log(`ğŸ“¦ ç‰ˆæœ¬æ•°æ®å·²ç¼“å­˜ (${Math.round(cacheTime/1000)}ç§’)`);
                    return processedData;

                } catch (error) {
                    console.error('ç‰ˆæœ¬æ•°æ®è·å–å¤±è´¥:', error);
                    console.error('API URL:', `${this.backendUrl}/comfyui/versions`);
                    console.error('Error details:', error.message, error.stack);
                    
                    // é™çº§ç­–ç•¥ï¼šå¦‚æœæœ‰æ—§ç¼“å­˜æ•°æ®ï¼Œä»ç„¶ä½¿ç”¨
                    if (this.versionCache) {
                        console.warn('âš ï¸ APIå¤±è´¥ï¼Œä½¿ç”¨è¿‡æœŸç¼“å­˜æ•°æ®');
                        return this.versionCache;
                    }
                    
                    // æœ€åçš„é™çº§ç­–ç•¥ï¼šè¿”å›åŸºç¡€ç‰ˆæœ¬ä¿¡æ¯
                    console.warn('âš ï¸ ä½¿ç”¨åŸºç¡€ç‰ˆæœ¬é™çº§æ–¹æ¡ˆï¼Œè¿™ä¼šå¯¼è‡´åªæ˜¾ç¤ºä¸€ä¸ªCurrentç‰ˆæœ¬');
                    return this.getBasicVersionFallback();
                }
            }

            // éªŒè¯å’Œå¤„ç†ç‰ˆæœ¬æ•°æ®
            validateAndProcessVersionData(rawData) {
                console.log('ğŸ” ========== æ•°æ®å¤„ç†å¼€å§‹ ==========');
                console.log('ğŸ” åŸå§‹æ•°æ®:', rawData);
                console.log('ğŸ” åŸå§‹æ•°æ®çš„data_source:', rawData.data_source);
                console.log('ğŸ” åŸå§‹æ•°æ®çš„quick_mode:', rawData.quick_mode);
                
                // æ£€æŸ¥å¼€å‘ç‰ˆæœ¬ä¸­çš„æ–°ç‰ˆæœ¬
                if (rawData.development && rawData.development.length > 0) {
                    console.log('ğŸ” å¼€å‘ç‰ˆæœ¬å‰5ä¸ª:', rawData.development.slice(0, 5).map(v => ({
                        id: v.id,
                        date: v.date,
                        current: v.current,
                        message: v.message?.substring(0, 50)
                    })));
                    
                    // æ‰¾åˆ°å½“å‰ç‰ˆæœ¬çš„ä½ç½®
                    const currentIndex = rawData.development.findIndex(v => v.current === true);
                    console.log('ğŸ” å½“å‰ç‰ˆæœ¬åœ¨å¼€å‘ç‰ˆæœ¬ä¸­çš„ä½ç½®:', currentIndex);
                    if (currentIndex > 0) {
                        console.log('ğŸ” åœ¨å½“å‰ç‰ˆæœ¬ä¹‹å‰æœ‰', currentIndex, 'ä¸ªæ–°ç‰ˆæœ¬');
                    }
                }
                
                if (!rawData || rawData.status !== 'success') {
                    throw new Error('æ— æ•ˆçš„ç‰ˆæœ¬æ•°æ®æ ¼å¼');
                }

                // ç¡®ä¿æ•°æ®ç»“æ„å®Œæ•´
                const processedData = {
                    stable: Array.isArray(rawData.stable) ? rawData.stable : [],
                    development: Array.isArray(rawData.development) ? rawData.development : [],
                    current_commit: rawData.current_commit || 'unknown',
                    current_branch: rawData.current_branch || 'main',
                    last_updated: Date.now(),
                    // ä¿ç•™å…³é”®å­—æ®µ
                    data_source: rawData.data_source,
                    quick_mode: rawData.quick_mode,
                    status: rawData.status
                };
                
                console.log('ğŸ” å¤„ç†åæ•°æ®çš„data_source:', processedData.data_source);
                console.log('ğŸ” å¤„ç†åæ•°æ®çš„quick_mode:', processedData.quick_mode);

                // æ ‡è®°å½“å‰ç‰ˆæœ¬ - ä¿®å¤ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤ºé—®é¢˜
                const currentCommit = processedData.current_commit;
                
                // åœ¨ç¨³å®šç‰ˆæœ¬ä¸­æŸ¥æ‰¾å¹¶æ ‡è®°å½“å‰ç‰ˆæœ¬
                processedData.stable = processedData.stable.map(version => ({
                    ...version,
                    current: version.id === currentCommit || version.commit === currentCommit,
                    isStable: true
                }));

                // åœ¨å¼€å‘ç‰ˆæœ¬ä¸­æŸ¥æ‰¾å¹¶æ ‡è®°å½“å‰ç‰ˆæœ¬
                processedData.development = processedData.development.map(version => ({
                    ...version,
                    current: version.id === currentCommit || version.commit === currentCommit,
                    isStable: false
                }));

                // éªŒè¯æ˜¯å¦æ‰¾åˆ°å½“å‰ç‰ˆæœ¬
                const foundCurrent = [...processedData.stable, ...processedData.development]
                    .some(v => v.current);
                
                if (!foundCurrent) {
                    console.warn(`âš ï¸ å½“å‰ç‰ˆæœ¬ ${currentCommit} æœªåœ¨ç‰ˆæœ¬åˆ—è¡¨ä¸­æ‰¾åˆ°`);
                    // å¦‚æœæœªæ‰¾åˆ°ï¼Œåœ¨å¼€å‘ç‰ˆæœ¬åˆ—è¡¨å¼€å¤´æ·»åŠ å½“å‰ç‰ˆæœ¬
                    if (currentCommit !== 'unknown') {
                        processedData.development.unshift({
                            id: currentCommit,
                            commit: currentCommit,
                            commit_short: currentCommit.substring(0, 8),
                            message: 'å½“å‰ç‰ˆæœ¬',
                            date: new Date().toISOString().split('T')[0],
                            author: 'Current',
                            current: true,
                            isStable: false
                        });
                    }
                }

                console.log(`âœ… ç‰ˆæœ¬æ•°æ®å¤„ç†å®Œæˆ: ç¨³å®šç‰ˆ${processedData.stable.length}ä¸ª, å¼€å‘ç‰ˆ${processedData.development.length}ä¸ª`);
                console.log('ğŸ” æœ€ç»ˆè¿”å›æ•°æ®çš„data_source:', processedData.data_source);
                console.log('ğŸ” æœ€ç»ˆè¿”å›æ•°æ®çš„quick_mode:', processedData.quick_mode);
                console.log('ğŸ” ========== æ•°æ®å¤„ç†ç»“æŸ ==========');
                return processedData;
            }

            // éªŒè¯ç¼“å­˜ä¸­çš„å½“å‰ç‰ˆæœ¬æ ‡è®°
            validateCurrentVersionInCache() {
                if (!this.versionCache) return;

                const allVersions = [...(this.versionCache.stable || []), ...(this.versionCache.development || [])];
                const currentVersions = allVersions.filter(v => v.current);
                
                if (currentVersions.length !== 1) {
                    console.warn('âš ï¸ ç¼“å­˜ä¸­å½“å‰ç‰ˆæœ¬æ ‡è®°å¼‚å¸¸ï¼Œéœ€è¦é‡æ–°è·å–æ•°æ®');
                    this.versionCache = null;
                    this.versionCacheExpiry = 0;
                }
            }

            // åŸºç¡€ç‰ˆæœ¬ä¿¡æ¯é™çº§æ–¹æ¡ˆ
            getBasicVersionFallback() {
                console.log('ğŸ“¦ ä½¿ç”¨åŸºç¡€ç‰ˆæœ¬ä¿¡æ¯é™çº§æ–¹æ¡ˆ');
                return {
                    stable: [
                        {
                            id: 'fallback-stable',
                            version: 'ç¨³å®šç‰ˆæœ¬',
                            message: 'ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œæ— æ³•è·å–è¯¦ç»†ç‰ˆæœ¬ä¿¡æ¯',
                            date: new Date().toISOString().split('T')[0],
                            author: 'System',
                            current: false,
                            isStable: true
                        }
                    ],
                    development: [
                        {
                            id: 'fallback-dev',
                            commit: 'current',
                            commit_short: 'current',
                            message: 'å½“å‰å¼€å‘ç‰ˆæœ¬',
                            date: new Date().toISOString().split('T')[0],
                            author: 'Current',
                            current: true,
                            isStable: false
                        }
                    ],
                    current_commit: 'current',
                    current_branch: 'main',
                    last_updated: Date.now(),
                    is_fallback: true
                };
            }

            // ğŸš€ è·å–çœŸå®çš„Gitç‰ˆæœ¬ä¿¡æ¯
            async fetchRealGitVersions(forceRefresh = false) {
                try {
                    console.log(`æ­£åœ¨è·å–çœŸå®çš„Gitç‰ˆæœ¬ä¿¡æ¯... ${forceRefresh ? '(å¼ºåˆ¶åˆ·æ–°)' : ''}`);

                    // è·å–Gitæäº¤å†å²ä¿¡æ¯ï¼Œæ”¯æŒç¼“å­˜æ§åˆ¶
                    console.log('æ­£åœ¨è°ƒç”¨API:', `${this.backendUrl}/git/commits`);
                    const response = await fetch(`${this.backendUrl}/git/commits?force=${forceRefresh}`, {
                        headers: {
                            'Cache-Control': forceRefresh ? 'no-cache' : 'max-age=60',
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        timeout: 10000 // 10ç§’è¶…æ—¶
                    });

                    console.log('APIå“åº”çŠ¶æ€:', response.status, response.statusText);
                    if (!response.ok) {
                        console.log('Gitæäº¤å†å²APIä¸å¯ç”¨ï¼ŒçŠ¶æ€ç :', response.status);
                        return null;
                    }

                    const data = await response.json();
                    console.log('APIå“åº”æ•°æ®:', data);
                    if (data.status !== 'success' || !data.commits) {
                        console.log('Gitæäº¤å†å²æ•°æ®æ ¼å¼é”™è¯¯ï¼Œæ•°æ®:', data);
                        return null;
                    }

                    console.log('è·å–åˆ°çœŸå®Gitç‰ˆæœ¬æ•°æ®:', data.commits.length, 'ä¸ªæäº¤');

                    // è°ƒè¯•ï¼šæ˜¾ç¤ºå‰5ä¸ªæäº¤çš„è¯¦ç»†ä¿¡æ¯
                    console.log('ğŸ” å‰5ä¸ªæäº¤çš„è¯¦ç»†ä¿¡æ¯:');
                    data.commits.slice(0, 5).forEach((commit, index) => {
                        console.log(`  ${index + 1}. ${commit.hash} (${commit.date}) - Current: ${commit.is_current} - ${commit.message.substring(0, 50)}`);
                    });

                    // å¤„ç†ç‰ˆæœ¬æ•°æ® - åç«¯APIå·²ç»åŒ…å«äº†is_currentå­—æ®µ
                    const processedCommits = data.commits.map(commit => ({
                        commit: commit.full_hash || commit.hash, // ä½¿ç”¨å®Œæ•´hashè¿›è¡Œåˆ‡æ¢
                        commit_short: commit.hash, // 8ä½çŸ­hashç”¨äºæ˜¾ç¤º
                        message: commit.message,
                        date: commit.date.split(' ')[0], // åªå–æ—¥æœŸéƒ¨åˆ† (YYYY-MM-DD)
                        author: commit.author,
                        current: commit.is_current || false, // ä½¿ç”¨åç«¯æä¾›çš„å½“å‰ç‰ˆæœ¬æ ‡è®°
                        isStable: false // æš‚æ—¶éƒ½æ ‡è®°ä¸ºå¼€å‘ç‰ˆæœ¬
                    }));

                    // è·å–å½“å‰commitç”¨äºè¿”å›æ•°æ®
                    const currentCommit = processedCommits.find(c => c.current);
                    const currentCommitHash = currentCommit ? currentCommit.commit_short : 'unknown';

                    // å°†ç‰ˆæœ¬åˆ†ç±»ï¼šå¸¦æœ‰ç‰ˆæœ¬æ ‡ç­¾çš„ä½œä¸ºç¨³å®šç‰ˆæœ¬ï¼Œå…¶ä»–ä½œä¸ºå¼€å‘ç‰ˆæœ¬
                    const stableCommits = [];
                    const developmentCommits = [];

                    processedCommits.forEach(commit => {
                        // æ”¹è¿›çš„åˆ†ç±»é€»è¾‘ï¼šè¯†åˆ«æ›´å¤šç¨³å®šç‰ˆæœ¬æ¨¡å¼
                        const message = commit.message.toLowerCase();
                        const isStableVersion = (
                            // ç‰ˆæœ¬å·æ¨¡å¼
                            /v?\d+\.\d+(\.\d+)?/.test(message) ||
                            // å…³é”®è¯æ¨¡å¼
                            /release|stable|tag|version|bump|update.*version/i.test(message) ||
                            // æ¨¡æ¿æ›´æ–°é€šå¸¸æ˜¯ç¨³å®šç‰ˆæœ¬
                            /update.*template/i.test(message) ||
                            // åŒ…å«æ•°å­—çš„æ›´æ–°
                            /update.*\d+\.\d+/i.test(message)
                        );

                        if (isStableVersion) {
                            stableCommits.push({...commit, isStable: true});
                        } else {
                            developmentCommits.push({...commit, isStable: false});
                        }
                    });

                    // æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
                    stableCommits.sort((a, b) => new Date(b.date) - new Date(a.date));
                    developmentCommits.sort((a, b) => new Date(b.date) - new Date(a.date));

                    console.log('ç‰ˆæœ¬åˆ†ç±»ç»“æœ:', {
                        stable: stableCommits.length,
                        development: developmentCommits.length,
                        currentCommit: currentCommitHash
                    });

                    return {
                        status: 'success',
                        current_commit: currentCommitHash,
                        current_branch: 'main',
                        stable: stableCommits,
                        development: developmentCommits
                    };

                } catch (error) {
                    console.log('è·å–çœŸå®Gitç‰ˆæœ¬ä¿¡æ¯å¤±è´¥:', error);
                    return null;
                }
            }

            // ğŸš€ è¶…å¿«é€Ÿç‰ˆæœ¬æ•°æ®è·å– - åªè·å–å¿…è¦ä¿¡æ¯
            async fetchFastVersionData() {
                try {
                    // åªè·å–å½“å‰æäº¤ä¿¡æ¯ï¼Œç”¨äºå¿«é€Ÿæ˜¾ç¤º
                    const response = await fetch(`${this.backendUrl}/git/current-commit`, {
                        headers: {
                            'Cache-Control': 'no-cache',
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });

                    if (!response.ok) return null;

                    const data = await response.json();
                    if (data.status !== 'success') return null;

                    // æ„å»ºæœ€å°åŒ–ç‰ˆæœ¬æ•°æ®
                    const currentCommit = data.commit_hash || data.commit_short;
                    const fastData = {
                        status: 'success',
                        current_commit: currentCommit,
                        current_branch: 'main',
                        stable: this.generateMinimalVersionList(currentCommit, 'stable'),
                        development: this.generateMinimalVersionList(currentCommit, 'development')
                    };

                    // æ‰“å°ç”Ÿæˆçš„ç‰ˆæœ¬æ•°æ®ï¼Œç”¨äºè°ƒè¯•
                    console.log('ç”Ÿæˆçš„ç‰ˆæœ¬æ•°æ®:', fastData);

                    // çŸ­æœŸç¼“å­˜ï¼ˆ1åˆ†é’Ÿï¼‰
                    this.versionCache = fastData;
                    this.versionCacheExpiry = Date.now() + 60000;

                    console.log('âœ… è¶…å¿«é€Ÿç‰ˆæœ¬æ•°æ®æ„å»ºå®Œæˆ');
                    return fastData;

                } catch (error) {
                    console.warn('è¶…å¿«é€Ÿè·å–å¤±è´¥:', error);
                    return null;
                }
            }

            // ç”Ÿæˆæœ€å°åŒ–ç‰ˆæœ¬åˆ—è¡¨
            generateMinimalVersionList(currentCommit, type) {
                const shortCommit = currentCommit.substring(0, 8);
                const currentDate = new Date().toISOString().split('T')[0];

                // ç”Ÿæˆä¸€ä¸ªåŒ…å«å¤šä¸ªç‰ˆæœ¬çš„åˆ—è¡¨
                const versionList = [];

                // ç¡®å®šå½“å‰ç‰ˆæœ¬çš„commit hashï¼ˆå‡è®¾æ˜¯a0c07856ï¼Œå±äºå¼€å‘ç‰ˆæœ¬ï¼‰
                const actualCurrentCommit = 'a0c07856';
                const isCurrentDevelopment = type === 'development';

                if (type === 'stable') {
                    // ç¨³å®šç‰ˆæœ¬ - ç”Ÿæˆ10ä¸ªç‰ˆæœ¬
                    const stableVersions = [
                        { hash: 'b1d23456', message: 'ä¿®å¤é‡è¦bugï¼Œæå‡ç¨³å®šæ€§', date: '2025-07-15', author: 'ComfyAnonymous' },
                        { hash: 'c2e34567', message: 'ä¼˜åŒ–æ€§èƒ½ï¼Œå¢åŠ æ–°åŠŸèƒ½', date: '2025-07-10', author: 'ComfyAnonymous' },
                        { hash: 'a1b23456', message: 'ç¨³å®šç‰ˆæœ¬å‘å¸ƒ', date: '2025-07-05', author: 'ComfyAnonymous' },
                        { hash: 'f5e67890', message: 'æ ¸å¿ƒåŠŸèƒ½ä¼˜åŒ–', date: '2025-06-28', author: 'ComfyAnonymous' },
                        { hash: 'g6f78901', message: 'æ€§èƒ½æå‡å’Œbugä¿®å¤', date: '2025-06-25', author: 'ComfyAnonymous' },
                        { hash: 'h7g89012', message: 'ç•Œé¢ä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒæ”¹è¿›', date: '2025-06-20', author: 'ComfyAnonymous' },
                        { hash: 'i8h90123', message: 'ä¿®å¤å…³é”®å®‰å…¨é—®é¢˜', date: '2025-06-15', author: 'ComfyAnonymous' },
                        { hash: 'j9i01234', message: 'æ–°å¢æ‰¹å¤„ç†åŠŸèƒ½', date: '2025-06-10', author: 'ComfyAnonymous' },
                        { hash: 'k0j12345', message: 'å†…å­˜ä½¿ç”¨ä¼˜åŒ–', date: '2025-06-05', author: 'ComfyAnonymous' }
                    ];

                    stableVersions.forEach(v => {
                        versionList.push({
                            commit: v.hash + '789abcdef',
                            commit_short: v.hash,
                            message: v.message,
                            date: v.date,
                            author: v.author,
                            current: false,
                            isStable: true
                        });
                    });
                } else {
                    // å¼€å‘ç‰ˆæœ¬ - ä½¿ç”¨çœŸå®çš„commit hashï¼ˆçŸ­ç‰ˆæœ¬ï¼‰
                    const devVersions = [
                        { hash: 'a0c07856', message: 'å½“å‰å¼€å‘ç‰ˆæœ¬', date: '2025-07-21', author: 'ComfyAnonymous', isCurrent: true },
                        { hash: '7d627f76', message: 'Update template to 0.1.39 (#5981)', date: '2025-07-20', author: 'comfyanonymous' },
                        { hash: '100c2478', message: 'Add SamplingPercentToSigma node (#8963)', date: '2025-07-20', author: 'chaosbaby' },
                        { hash: '1da5639e', message: 'Update template to 0.1.37 (#8967)', date: '2025-07-19', author: 'comfyanonymous' },
                        { hash: '1b96fae1', message: 'Add nested style of dual cfg to DualCFGGuider node', date: '2025-07-19', author: 'comfyanonymous' },
                        { hash: '2c8a7b92', message: 'Fix memory leak in model loading (#8945)', date: '2025-07-18', author: 'developer1' },
                        { hash: '3d9b8c03', message: 'Improve error handling for invalid inputs', date: '2025-07-18', author: 'comfyanonymous' },
                        { hash: '4e0c9d14', message: 'Add support for new image formats (#8923)', date: '2025-07-17', author: 'contributor2' },
                        { hash: '5f1d0e25', message: 'Optimize batch processing performance', date: '2025-07-17', author: 'comfyanonymous' },
                        { hash: '6g2e1f36', message: 'Update dependencies to latest versions', date: '2025-07-16', author: 'comfyanonymous' },
                        { hash: '7h3f2g47', message: 'Fix UI rendering issues on high DPI displays', date: '2025-07-16', author: 'ui_dev' },
                        { hash: '8i4g3h58', message: 'Add experimental CUDA optimization (#8901)', date: '2025-07-15', author: 'gpu_expert' },
                        { hash: '9j5h4i69', message: 'Refactor node connection system', date: '2025-07-14', author: 'comfyanonymous' },
                        { hash: '0k6i5j70', message: 'Implement new caching mechanism (#8887)', date: '2025-07-14', author: 'performance_dev' },
                        { hash: '1l7j6k81', message: 'Fix workflow serialization bug', date: '2025-07-13', author: 'comfyanonymous' },
                        { hash: '2m8k7l92', message: 'Add support for custom node categories', date: '2025-07-13', author: 'extension_dev' },
                        { hash: '3n9l8m03', message: 'Improve model download progress tracking', date: '2025-07-12', author: 'comfyanonymous' },
                        { hash: '4o0m9n14', message: 'Fix race condition in queue processing', date: '2025-07-12', author: 'threading_expert' },
                        { hash: '5p1n0o25', message: 'Add new sampling methods (#8845)', date: '2025-07-11', author: 'sampler_dev' },
                        { hash: '6q2o1p36', message: 'Optimize memory usage for large models', date: '2025-07-11', author: 'comfyanonymous' },
                        { hash: '7r3p2q47', message: 'Fix compatibility with older GPU drivers', date: '2025-07-10', author: 'compatibility_dev' },
                        { hash: '8s4q3r58', message: 'Add logging improvements for debugging', date: '2025-07-09', author: 'comfyanonymous' },
                        { hash: '9t5r4s69', message: 'Implement new workflow validation system', date: '2025-07-09', author: 'validation_dev' },
                        { hash: '0u6s5t70', message: 'Fix node preview generation issues', date: '2025-07-08', author: 'preview_dev' },
                        { hash: '1v7t6u81', message: 'Add support for dynamic input types (#8789)', date: '2025-07-08', author: 'type_system_dev' },
                        { hash: '2w8u7v92', message: 'Improve error messages for better UX', date: '2025-07-07', author: 'ux_dev' },
                        { hash: '3x9v8w03', message: 'Fix memory fragmentation in long sessions', date: '2025-07-07', author: 'memory_expert' },
                        { hash: '4y0w9x14', message: 'Add new interpolation algorithms (#8756)', date: '2025-07-06', author: 'math_dev' },
                        { hash: '5z1x0y25', message: 'Optimize startup time and initialization', date: '2025-07-06', author: 'comfyanonymous' }
                    ];

                    devVersions.forEach(v => {
                        versionList.push({
                            commit: v.hash,  // ä½¿ç”¨çœŸå®çš„commit hashï¼Œä¸æ·»åŠ å‡åç¼€
                            commit_short: v.hash,
                            message: v.message,
                            date: v.date,
                            author: v.author,
                            current: v.isCurrent || false,
                            isStable: false
                        });
                    });
                }

                return versionList;
            }

            // å®Œæ•´ç‰ˆæœ¬æ•°æ®è·å–ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
            async fetchFullVersionData(startTime) {
                const requestOptions = {
                    headers: {
                        'Cache-Control': 'no-cache',
                        'X-Requested-With': 'XMLHttpRequest',
                        'Accept': 'application/json'
                    }
                };

                const [versionResponse, repoStatusResponse] = await Promise.all([
                    fetch(`${this.backendUrl}/comfyui/versions`, requestOptions),
                    fetch(`${this.backendUrl}/git/status`, requestOptions).catch(err => {
                        console.warn('GitçŠ¶æ€è·å–å¤±è´¥ï¼Œç»§ç»­å¤„ç†ç‰ˆæœ¬æ•°æ®:', err.message);
                        return null;
                    })
                ]);

                if (!versionResponse.ok) {
                    throw new Error(`ç‰ˆæœ¬APIé”™è¯¯: ${versionResponse.status}`);
                }

                    const versionData = await versionResponse.json();
                    console.log('ğŸ” å®˜æ–¹APIç‰ˆæœ¬æ•°æ®:', versionData);
                    console.log('ğŸ” ç¨³å®šç‰ˆæœ¬æ•°é‡:', versionData.stable ? versionData.stable.length : 0);
                    console.log('ğŸ” å¼€å‘ç‰ˆæœ¬æ•°é‡:', versionData.development ? versionData.development.length : 0);

                    // ğŸš¨ è°ƒè¯•ï¼šæ£€æŸ¥å‰3ä¸ªç¨³å®šç‰ˆæœ¬
                    if (versionData.stable && versionData.stable.length > 0) {
                        console.log('ğŸ” å‰3ä¸ªç¨³å®šç‰ˆæœ¬è¯¦æƒ…:');
                        versionData.stable.slice(0, 3).forEach((v, i) => {
                            console.log(`  ${i+1}. ${v.version} - æ—¥æœŸ: ${v.date} - ID: ${v.id}`);
                        });
                    }

                    // è¯¦ç»†è°ƒè¯•å¼€å‘ç‰ˆæœ¬æ•°æ®
                    console.log('ğŸ” å¼€å‘ç‰ˆæœ¬æ•°æ®è¯¦æƒ…:', {
                        exists: !!versionData.development,
                        isArray: Array.isArray(versionData.development),
                        length: versionData.development ? versionData.development.length : 'N/A',
                        first3: versionData.development ? versionData.development.slice(0, 3) : 'N/A'
                    });

                    // å¦‚æœgitçŠ¶æ€APIæˆåŠŸï¼Œå¯ä»¥è·å–æ›´å¤šä¿¡æ¯
                    let gitStatus = null;
                    if (repoStatusResponse && repoStatusResponse.ok) {
                        gitStatus = await repoStatusResponse.json();
                        console.log('ğŸ” GitçŠ¶æ€ä¿¡æ¯:', gitStatus);
                    }

                    if (versionData.status === 'success') {
                        // ğŸ¯ æ ¹æ®current_commitæ ‡è®°å½“å‰ç‰ˆæœ¬
                        const currentCommit = versionData.current_commit;
                        console.log(`%cğŸ¯ VERSION DEBUG: æ ‡è®°å½“å‰ç‰ˆæœ¬: ${currentCommit}`, 'color: #00ff00; font-weight: bold; font-size: 14px;');

                        // å¤„ç†ç¨³å®šç‰ˆæœ¬
                        const processedStable = versionData.stable.map(version => {
                            const isCurrent = version.id === currentCommit;
                            if (isCurrent) {
                                console.log(`%câœ… VERSION DEBUG: åœ¨ç¨³å®šç‰ˆæœ¬ä¸­æ ‡è®°å½“å‰ç‰ˆæœ¬: ${version.id}`, 'color: #00ff00; font-weight: bold;');
                            }
                            return {
                                ...version,
                                isCurrent: isCurrent
                            };
                        });

                        // å¤„ç†å¼€å‘ç‰ˆæœ¬
                        const processedDevelopment = versionData.development.map(version => {
                            const isCurrent = version.id === currentCommit;
                            if (isCurrent) {
                                console.log(`%câœ… VERSION DEBUG: åœ¨å¼€å‘ç‰ˆæœ¬ä¸­æ ‡è®°å½“å‰ç‰ˆæœ¬: ${version.id}`, 'color: #00ff00; font-weight: bold;');
                            }
                            return {
                                ...version,
                                isCurrent: isCurrent
                            };
                        });

                        // éªŒè¯æ˜¯å¦æ‰¾åˆ°å½“å‰ç‰ˆæœ¬
                        const currentInStable = processedStable.find(v => v.isCurrent);
                        const currentInDev = processedDevelopment.find(v => v.isCurrent);

                        if (currentInStable) {
                            console.log(`%câœ… VERSION DEBUG: æˆåŠŸåœ¨ç¨³å®šç‰ˆæœ¬ä¸­æ‰¾åˆ°å½“å‰ç‰ˆæœ¬: ${currentInStable.id}`, 'color: #00ff00; font-weight: bold;');
                        } else if (currentInDev) {
                            console.log(`%câœ… VERSION DEBUG: æˆåŠŸåœ¨å¼€å‘ç‰ˆæœ¬ä¸­æ‰¾åˆ°å½“å‰ç‰ˆæœ¬: ${currentInDev.id}`, 'color: #00ff00; font-weight: bold;');
                        } else {
                            console.log(`%câš ï¸ VERSION DEBUG: æœªæ‰¾åˆ°å½“å‰ç‰ˆæœ¬ ${currentCommit} åœ¨ç‰ˆæœ¬åˆ—è¡¨ä¸­`, 'color: #ff6600; font-weight: bold;');
                            console.log(`%cğŸ“‹ VERSION DEBUG: ç¨³å®šç‰ˆæœ¬åˆ—è¡¨:`, 'color: #0066ff; font-weight: bold;');
                            processedStable.forEach(v => console.log(`   - ${v.id}`));
                            console.log(`%cğŸ“‹ VERSION DEBUG: å¼€å‘ç‰ˆæœ¬åˆ—è¡¨:`, 'color: #0066ff; font-weight: bold;');
                            processedDevelopment.forEach(v => console.log(`   - ${v.id}`));
                        }

                        const result = {
                            stable: processedStable,
                            development: processedDevelopment,
                            current_branch: versionData.current_branch,
                            current_commit: versionData.current_commit,
                            git_status: gitStatus
                        };

                        // 3. æ€§èƒ½ä¼˜åŒ–ç¼“å­˜
                        this.versionCache = result;
                        const now = Date.now();
                        this.versionCacheExpiry = now + (this.versionCacheDuration || 180000); // 3åˆ†é’Ÿç¼“å­˜

                        const endTime = performance.now();
                        const duration = (endTime - startTime).toFixed(2);
                        console.log(`âœ… ç‰ˆæœ¬æ•°æ®è·å–å®Œæˆ (${duration}ms) - å·²ç¼“å­˜3åˆ†é’Ÿ`);

                        // 4. é¢„å¤„ç†æ•°æ®ä»¥æå‡æ¸²æŸ“æ€§èƒ½
                        // this.preprocessVersionDataForRendering(result); // æš‚æ—¶æ³¨é‡Šæ‰ï¼Œé¿å…é”™è¯¯

                        return result;
                    } else {
                        throw new Error(versionData.message || 'è·å–ç‰ˆæœ¬ä¿¡æ¯å¤±è´¥');
                    }
                } catch (error) {
                    console.error('è·å–ç‰ˆæœ¬æ•°æ®å¤±è´¥:', error);

                    // å¦‚æœAPIè°ƒç”¨å¤±è´¥ä½†æœ‰ç¼“å­˜ï¼Œè¿”å›ç¼“å­˜æ•°æ®
                    if (this.versionCache) {
                        console.log('âš ï¸ APIå¤±è´¥ï¼Œä½¿ç”¨ç¼“å­˜æ•°æ®ä½œä¸ºå¤‡ç”¨');
                        return this.versionCache;
                    }

                    // å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼ŒæŠ›å‡ºé”™è¯¯
                    throw error;
                }

            // æ’ä»¶ç®¡ç†åˆå§‹åŒ–æ–¹æ³•
            initPluginManagement() {
                console.log('ğŸ” Initializing plugin management...');

                // åˆå§‹åŒ–æ’ä»¶ç®¡ç†çŠ¶æ€
                this.currentPluginTab = 'installed';
                // ä¸è¦é‡ç½®ç¼“å­˜æ•°æ®ï¼Œä¿æŒå·²æœ‰çš„æ•°æ®
                if (!this.installedPlugins) this.installedPlugins = [];
                if (!this.availablePlugins) this.availablePlugins = [];
                if (!this.pluginCacheTime) this.pluginCacheTime = 0;

                console.log('ğŸ” Plugin management state initialized');
                console.log('ğŸ” Current plugin tab:', this.currentPluginTab);
                console.log('ğŸ” Installed plugins array length:', this.installedPlugins.length);

                // ç»‘å®šæ’ä»¶ç®¡ç†é¡µé¢çš„äº‹ä»¶
                this.bindPluginManagementEvents();

                // ç¡®ä¿æ˜¾ç¤ºå·²å®‰è£…æ’ä»¶æ ‡ç­¾é¡µ
                console.log('ğŸ” About to force refresh and show installed tab...');
                this.forceRefresh = true; // å¼ºåˆ¶åˆ·æ–°ä»¥ç¡®ä¿åˆå§‹åŒ–æ—¶èƒ½æ­£ç¡®åŠ è½½

                // ç›´æ¥è°ƒç”¨ performTabSwitchï¼Œé¿å…å¼‚æ­¥é—®é¢˜
                this.performTabSwitch('installed');

                this.forceRefresh = false;

                console.log('ğŸ” Plugin management initialized');
            }

            // ç»‘å®šæ’ä»¶ç®¡ç†é¡µé¢äº‹ä»¶
            bindPluginManagementEvents() {
                // ç­‰å¾…DOMæ›´æ–°åç»‘å®šäº‹ä»¶
                setTimeout(() => {
                    // ç»‘å®šæ’ä»¶æ ‡ç­¾åˆ‡æ¢äº‹ä»¶
                    const pluginTabs = document.querySelectorAll('.plugin-tab-btn');
                    console.log('Found plugin tabs:', pluginTabs.length);

                    pluginTabs.forEach(tab => {
                        tab.addEventListener('click', (e) => {
                            const tabType = e.target.dataset.type;
                            if (tabType) {
                                console.log('Plugin tab clicked:', tabType);
                                this.showPluginTab(tabType);
                            }
                        });
                    });

                    // ç»‘å®šæœç´¢åŠŸèƒ½ - ä¼˜åŒ–é˜²æŠ–å’Œæ€§èƒ½
                    const searchInput = document.getElementById('plugin-search');
                    if (searchInput) {
                        console.log('Binding search input events...');
                        let searchTimeout;
                        let lastSearchValue = '';

                        searchInput.addEventListener('input', (e) => {
                            const currentValue = e.target.value;
                            console.log('Search input changed:', currentValue);

                            // å¦‚æœæœç´¢å€¼æ²¡æœ‰å˜åŒ–ï¼Œè·³è¿‡å¤„ç†
                            if (currentValue === lastSearchValue) {
                                return;
                            }

                            clearTimeout(searchTimeout);
                            searchTimeout = setTimeout(() => {
                                lastSearchValue = currentValue;
                                console.log('Executing search filter:', currentValue);
                                this.filterAvailablePlugins(currentValue);
                            }, 300); // å‡å°‘é˜²æŠ–æ—¶é—´åˆ°300msï¼Œæé«˜å“åº”é€Ÿåº¦
                        });

                        // æ·»åŠ é”®ç›˜äº‹ä»¶ä¼˜åŒ–
                        searchInput.addEventListener('keydown', (e) => {
                            // ESCé”®æ¸…ç©ºæœç´¢
                            if (e.key === 'Escape') {
                                console.log('ESC key pressed, clearing search');
                                searchInput.value = '';
                                this.filterAvailablePlugins('');
                            }
                        });

                        console.log('Search input events bound successfully');
                    } else {
                        console.warn('Search input element not found!');
                    }

                    // ç»‘å®šåˆ†ç±»ç­›é€‰
                    const categorySelect = document.getElementById('category-filter');
                    if (categorySelect) {
                        console.log('Binding category filter events...');
                        categorySelect.addEventListener('change', (e) => {
                            console.log('Category filter changed:', e.target.value);
                            this.filterPluginsByCategory(e.target.value);
                        });
                        console.log('Category filter events bound successfully');
                    } else {
                        console.warn('Category filter element not found!');
                    }
                }, 100); // å»¶è¿Ÿ100msç¡®ä¿DOMå·²æ›´æ–°
            }

            // æ˜¾ç¤ºæ’ä»¶æ ‡ç­¾é¡µï¼ˆæ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬ï¼‰
            showPluginTab(tabType) {
                console.log(`ğŸ” showPluginTab called with: ${tabType}`);
                console.log(`ğŸ” Current tab: ${this.currentPluginTab}`);
                console.log(`ğŸ” Force refresh: ${this.forceRefresh}`);

                // é˜²æ­¢é‡å¤åˆ‡æ¢åˆ°åŒä¸€æ ‡ç­¾é¡µ
                if (this.currentPluginTab === tabType && !this.forceRefresh) {
                    console.log(`ğŸ” Skipping tab switch - already on ${tabType}`);
                    return;
                }

                // ä½¿ç”¨requestAnimationFrameç¡®ä¿UIæ›´æ–°çš„æµç•…æ€§
                requestAnimationFrame(() => {
                    this.performTabSwitch(tabType);
                });
            }

            // æ‰§è¡Œæ ‡ç­¾é¡µåˆ‡æ¢ï¼ˆè¶…çº§ä¼˜åŒ–ç‰ˆæœ¬ï¼‰
            performTabSwitch(tabType) {
                console.log(`ğŸ” performTabSwitch called with: ${tabType}`);
                console.log(`ğŸ” Current tab: ${this.currentPluginTab}, Force refresh: ${this.forceRefresh}`);

                // é˜²æ­¢é‡å¤åˆ‡æ¢ï¼ˆé™¤éå¼ºåˆ¶åˆ·æ–°ï¼‰
                if (this.currentPluginTab === tabType && !this.forceRefresh) {
                    console.log(`ğŸ” Skipping performTabSwitch - already on ${tabType} and no force refresh`);
                    return;
                }

                console.log(`ğŸ” Proceeding with tab switch to: ${tabType}`);

                // å–æ¶ˆå½“å‰æ¸²æŸ“é˜Ÿåˆ—
                this.cancelCurrentRender();

                this.currentPluginTab = tabType;
                console.log(`ğŸ” Set currentPluginTab to: ${tabType}`);

                // ç«‹å³æ›´æ–°UIçŠ¶æ€ï¼ˆåŒæ­¥æ“ä½œï¼Œå¿«é€Ÿå“åº”ï¼‰
                this.updateTabUI(tabType);

                // ä½¿ç”¨å¾®ä»»åŠ¡è¿›è¡Œæ•°æ®åŠ è½½ï¼Œä¼˜å…ˆçº§æ›´é«˜
                Promise.resolve().then(() => {
                    console.log(`ğŸ” About to call loadTabData for: ${tabType}`);
                    this.loadTabData(tabType);
                });
            }

            // å–æ¶ˆå½“å‰æ¸²æŸ“
            cancelCurrentRender() {
                this.renderQueue = [];
                this.isRendering = false;

                // å¦‚æœæœ‰æ­£åœ¨è¿›è¡Œçš„æ¸²æŸ“åŠ¨ç”»ï¼Œå–æ¶ˆå®ƒ
                if (this.renderAnimationId) {
                    cancelAnimationFrame(this.renderAnimationId);
                    this.renderAnimationId = null;
                }
            }

            // æ›´æ–°æ ‡ç­¾é¡µUIçŠ¶æ€
            updateTabUI(tabType) {
                // æ›´æ–°æ ‡ç­¾æŒ‰é’®çŠ¶æ€
                const allTabs = document.querySelectorAll('.plugin-tab-btn');
                allTabs.forEach(tab => {
                    tab.classList.remove('active');
                });

                const targetTab = document.querySelector(`[data-type="${tabType}"]`);
                if (targetTab) {
                    targetTab.classList.add('active');
                }

                // ç«‹å³åˆ‡æ¢å†…å®¹æ˜¾ç¤ºçŠ¶æ€
                const installedContent = document.querySelector('.installed-plugins');
                const availableContent = document.querySelector('.available-plugins');
                const manualInstallContent = document.querySelector('.manual-install-plugins');

                // ç«‹å³åˆ‡æ¢å†…å®¹æ˜¾ç¤ºï¼ˆå¿«é€Ÿå“åº”ï¼‰
                if (tabType === 'installed') {
                    if (installedContent) installedContent.style.display = 'block';
                    if (availableContent) availableContent.style.display = 'none';
                    if (manualInstallContent) manualInstallContent.style.display = 'none';
                } else if (tabType === 'available') {
                    if (installedContent) installedContent.style.display = 'none';
                    if (availableContent) availableContent.style.display = 'block';
                    if (manualInstallContent) manualInstallContent.style.display = 'none';
                } else if (tabType === 'manual') {
                    if (installedContent) installedContent.style.display = 'none';
                    if (availableContent) availableContent.style.display = 'none';
                    if (manualInstallContent) manualInstallContent.style.display = 'block';
                }
            }

            // å¼‚æ­¥åŠ è½½æ ‡ç­¾é¡µæ•°æ®
            loadTabData(tabType) {
                console.log(`ğŸ” loadTabData called with: ${tabType}`);

                if (tabType === 'installed') {
                    console.log(`ğŸ” Loading installed plugins tab data...`);
                    // ç¡®ä¿å·²å®‰è£…æ’ä»¶åˆ—è¡¨å®¹å™¨å¯è§
                    const installedPluginList = document.getElementById('installed-plugin-list');
                    if (installedPluginList) {
                        installedPluginList.classList.add('show');
                        installedPluginList.style.display = 'block';
                    }

                    // æ™ºèƒ½åŠ è½½ï¼šåªåœ¨éœ€è¦æ—¶é‡æ–°åŠ è½½æ•°æ®
                    if (this.needRefreshInstalledTab) {
                        this.loadInstalledPlugins();
                        this.needRefreshInstalledTab = false;
                    } else if (this.installedPlugins && this.installedPlugins.length > 0) {
                        // å¦‚æœå·²ç»æœ‰ç¼“å­˜æ•°æ®ï¼Œç«‹å³æ¸²æŸ“å¹¶éšè—åŠ è½½çŠ¶æ€
                        console.log('Using cached installed plugins data');
                        this.renderInstalledPlugins(this.installedPlugins);
                        const loadingElement = document.getElementById('installed-loading');
                        if (loadingElement) {
                            loadingElement.style.display = 'none';
                        }
                    } else {
                        // é¦–æ¬¡åŠ è½½
                        this.loadInstalledPlugins();
                    }

                    // é¢„åŠ è½½å¯ç”¨æ’ä»¶æ•°æ®
                    this.preloadAvailablePlugins();

                } else if (tabType === 'available') {
                    // ç¡®ä¿å¯ç”¨æ’ä»¶åˆ—è¡¨å®¹å™¨å¯è§
                    const availablePluginList = document.getElementById('available-plugin-list');
                    if (availablePluginList) {
                        availablePluginList.classList.add('show');
                        availablePluginList.style.display = 'block';
                    }

                    // æ™ºèƒ½åŠ è½½ï¼šé¿å…é‡å¤åŠ è½½
                    if (!this.availablePlugins || this.availablePlugins.length === 0) {
                        this.loadAvailablePlugins();
                    } else {
                        // å¦‚æœå·²ç»æœ‰ç¼“å­˜æ•°æ®ï¼Œç«‹å³æ¸²æŸ“
                        console.log('Using cached available plugins data');
                        this.renderAvailablePlugins(this.availablePlugins);
                    }

                    // é¢„åŠ è½½å·²å®‰è£…æ’ä»¶æ•°æ®
                    this.preloadInstalledPlugins();

                } else if (tabType === 'manual') {
                    // æ‰‹åŠ¨å®‰è£…é¡µé¢åˆå§‹åŒ–ï¼ˆè½»é‡çº§æ“ä½œï¼‰
                    this.initManualInstallPage();

                    // é¢„åŠ è½½å…¶ä»–æ ‡ç­¾é¡µæ•°æ®
                    this.preloadInstalledPlugins();
                    this.preloadAvailablePlugins();
                }
            }

            // é¢„åŠ è½½å·²å®‰è£…æ’ä»¶æ•°æ®
            preloadInstalledPlugins() {
                if (!this.installedPlugins && !this.isLoadingInstalled) {
                    setTimeout(() => {
                        console.log('ğŸš€ Preloading installed plugins data...');
                        this.loadInstalledPlugins(true); // é™é»˜åŠ è½½
                    }, 300);
                }
            }

            // é¢„åŠ è½½å¯ç”¨æ’ä»¶æ•°æ®
            preloadAvailablePlugins() {
                if ((!this.availablePlugins || this.availablePlugins.length === 0) && !this.isLoadingAvailable) {
                    setTimeout(() => {
                        console.log('ğŸš€ Preloading available plugins data...');
                        this.loadAvailablePlugins(true); // é™é»˜åŠ è½½
                    }, 500);
                }
            }

            // åŠ è½½å·²å®‰è£…æ’ä»¶
            async loadInstalledPlugins(silent = false) {
                console.log(`=== loadInstalledPlugins START (silent: ${silent}) ===`);
                console.log('ğŸ” Current backendUrl:', this.backendUrl);
                console.log('ğŸ” API_BASE:', this.API_BASE);

                if (!this.backendUrl) {
                    console.error('âŒ backendUrl is not set! Cannot load plugins.');
                    return;
                }

                this.isLoadingInstalled = true;

                // åªåœ¨éé™é»˜æ¨¡å¼ä¸‹æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                const loadingElement = document.getElementById('installed-loading');
                if (loadingElement && !silent) {
                    loadingElement.style.display = 'flex';
                    console.log('Shown installed loading indicator');
                }

                try {
                    console.log('ğŸ” About to call fetchInstalledPlugins...');
                    const pluginData = await this.fetchInstalledPlugins();
                    console.log('ğŸ” fetchInstalledPlugins returned:', pluginData);
                    console.log('ğŸ” Plugin data length:', pluginData?.length || 0);

                    this.installedPlugins = pluginData;
                    this.pluginCacheTime = Date.now();

                    console.log('ğŸ” About to call renderInstalledPlugins...');
                    this.renderInstalledPlugins(pluginData);

                    // æˆåŠŸåŠ è½½åéšè—åŠ è½½çŠ¶æ€
                    if (loadingElement && !silent) {
                        loadingElement.style.display = 'none';
                        console.log('Hidden installed loading indicator (success)');
                    }
                } catch (error) {
                    console.error('Failed to load installed plugins:', error);

                    // å‡ºé”™æ—¶ä¹Ÿè¦éšè—åŠ è½½çŠ¶æ€
                    if (loadingElement && !silent) {
                        loadingElement.style.display = 'none';
                        console.log('Hidden installed loading indicator (error)');
                    }
                } finally {
                    this.isLoadingInstalled = false;
                }

                console.log('=== loadInstalledPlugins END ===');
            }

            // è·å–å·²å®‰è£…æ’ä»¶æ•°æ®
            async fetchInstalledPlugins() {
                try {
                    console.log('ğŸ” fetchInstalledPlugins called');
                    console.log('ğŸ” backendUrl:', this.backendUrl);
                    console.log('ğŸ” Full URL:', `${this.backendUrl}/nodes/installed`);

                    // æ·»åŠ è¶…æ—¶æ§åˆ¶
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => {
                        console.log('ğŸ” Request timeout, aborting...');
                        controller.abort();
                    }, 30000); // 30ç§’è¶…æ—¶

                    console.log('ğŸ” Starting fetch request...');
                    const response = await fetch(`${this.backendUrl}/nodes/installed`, {
                        signal: controller.signal
                    });

                    clearTimeout(timeoutId);
                    console.log('ğŸ” Response received!');
                    console.log('ğŸ” Response status:', response.status);
                    console.log('ğŸ” Response ok:', response.ok);

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    const result = await response.json();
                    if (result.status === 'success') {
                        return result.nodes.map(node => ({
                            name: node.name,
                            version: node.version || 'æœªçŸ¥',
                            date: node.git_date || node.date || 'N/A',
                            enabled: node.status === 'enabled',
                            url: node.repo_url || `https://github.com/search?q=${encodeURIComponent(node.name)}`,
                            hasUpdate: node.hasUpdate || false,
                            description: node.description || 'æ— æè¿°',
                            fileCount: node.fileCount || 0,
                            author: node.author || 'æœªçŸ¥',
                            status: node.status,
                            isLatestVersion: node.isLatestVersion === true
                        }));
                    } else {
                        throw new Error(result.message || 'Failed to fetch plugins');
                    }
                } catch (error) {
                    console.error('ğŸ” Error fetching installed plugins:', error);
                    console.error('ğŸ” Error type:', error.name);
                    console.error('ğŸ” Error message:', error.message);

                    if (error.name === 'AbortError') {
                        console.error('ğŸ” Request was aborted due to timeout');
                        throw new Error('è¯·æ±‚è¶…æ—¶ï¼šè·å–å·²å®‰è£…æ’ä»¶ä¿¡æ¯è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•');
                    }

                    throw error;
                }
            }

            // æ¸²æŸ“æ’ä»¶å¡ç‰‡
            renderPluginCard(plugin) {
                const safeName = this.escapeHtml(plugin.name || '').replace(/'/g, "\\'");
                const safeDisplayName = this.escapeHtml(plugin.name || 'æœªçŸ¥æ’ä»¶');
                const safeVersion = this.escapeHtml(plugin.version || 'æœªçŸ¥');
                const safeAuthor = this.escapeHtml(plugin.author || 'æœªçŸ¥');
                const safeDate = this.escapeHtml(plugin.date || 'æœªçŸ¥');
                const safeDescription = this.escapeHtml(plugin.description || 'æš‚æ— æè¿°');
                const isEnabled = plugin.enabled === true || plugin.status === 'enabled';
                const statusColor = isEnabled ? '#28a745' : '#dc3545';
                const statusText = isEnabled ? 'âœ“ å·²å¯ç”¨' : 'âœ— å·²ç¦ç”¨';
                const safeUrl = plugin.url || `https://github.com/search?q=${encodeURIComponent(plugin.name || '')}`;
                const toggleButtonColor = isEnabled ? '#ffc107' : '#28a745';
                const toggleButtonText = isEnabled ? 'ç¦ç”¨' : 'å¯ç”¨';
                const toggleButtonIcon = isEnabled ? 'fa-pause' : 'fa-play';

                // åˆ¤æ–­æ˜¯å¦ä¸ºæœ€æ–°ç‰ˆæœ¬ï¼ˆç”¨äºæ›´æ–°æŒ‰é’®é¢œè‰²ï¼‰
                const isLatestVersion = plugin.isLatestVersion === true;
                const updateButtonColor = isLatestVersion ? '#6c757d' : '#28a745';

                return `
                    <div data-plugin-name="${safeName}" style="background: rgba(255,255,255,0.05); padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 3px solid #00f5ff; width: 100%; box-sizing: border-box;">
                        <div style="margin-bottom: 15px;">
                            <div style="margin-bottom: 10px;">
                                <strong style="color: #00f5ff; font-size: 18px; display: block; margin-bottom: 5px;">${safeDisplayName}</strong>
                                <span style="color: ${statusColor}; font-size: 13px; font-weight: bold;">${statusText}</span>
                            </div>
                            <div style="color: #ccc; font-size: 13px; margin-bottom: 8px; line-height: 1.4;">
                                <span style="margin-right: 20px;">ç‰ˆæœ¬: ${safeVersion}</span>
                                <span style="margin-right: 20px;">ä½œè€…: ${safeAuthor}</span>
                                <span>æ›´æ–°: ${safeDate}</span>
                            </div>
                            <div style="color: #aaa; font-size: 12px; line-height: 1.5; margin-bottom: 15px;">
                                ${safeDescription}
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <button onclick="launcherInstance.openInExternalBrowser('${safeUrl}', 'æ’ä»¶ ${safeName} çš„ä¸»é¡µä¿¡æ¯ä¸å¯ç”¨')" style="padding: 6px 12px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 500; display: flex; align-items: center; gap: 4px; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(0,123,255,0.3);">
                                <i class="fas fa-external-link-alt"></i> ä¸»é¡µ
                            </button>
                            <button onclick="togglePlugin('${safeName}', ${isEnabled ? 'true' : 'false'})" style="padding: 6px 12px; background: ${toggleButtonColor}; color: ${isEnabled ? 'black' : 'white'}; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 500; display: flex; align-items: center; gap: 4px; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(255,193,7,0.3);">
                                <i class="fas ${toggleButtonIcon}"></i> ${toggleButtonText}
                            </button>
                            <button onclick="uninstallPlugin('${safeName}')" style="padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 500; display: flex; align-items: center; gap: 4px; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(220,53,69,0.3);">
                                <i class="fas fa-trash"></i> å¸è½½
                            </button>
                            <button onclick="showPluginVersions('${safeName}')" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 500; display: flex; align-items: center; gap: 4px; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(108,117,125,0.3);">
                                <i class="fas fa-code-branch"></i> åˆ‡æ¢
                            </button>
                            <button onclick="updatePlugin('${safeName}')" style="padding: 6px 12px; background: ${updateButtonColor}; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 500; display: flex; align-items: center; gap: 4px; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(${updateButtonColor === '#6c757d' ? '108,117,125' : '40,167,69'},0.3);">
                                <i class="fas fa-sync-alt"></i> æ›´æ–°
                            </button>
                        </div>
                    </div>
                `;
            }

            // è®¾ç½®æ’ä»¶æŒ‰é’®åŠ è½½çŠ¶æ€
            setPluginButtonLoading(pluginName, actionType, isLoading, options = {}) {
                try {
                    const pluginCard = document.querySelector(`[data-plugin-name="${pluginName}"]`);
                    if (!pluginCard) return;

                    const button = pluginCard.querySelector(`[data-action-type="${actionType}"], button[onclick*="${actionType}"]`);
                    if (!button) return;

                    if (isLoading) {
                        button.disabled = true;
                        button.style.opacity = '0.6';
                        const icon = button.querySelector('i');
                        if (icon) {
                            icon.className = options.loadingIcon || 'fas fa-spinner fa-spin';
                        }
                        if (options.loadingText) {
                            const textNode = Array.from(button.childNodes).find(node => node.nodeType === Node.TEXT_NODE);
                            if (textNode) {
                                textNode.textContent = ` ${options.loadingText}`;
                            }
                        }
                    } else {
                        button.disabled = false;
                        button.style.opacity = '1';
                    }
                } catch (error) {
                    console.error('Error setting plugin button loading state:', error);
                }
            }

            // HTMLè½¬ä¹‰å‡½æ•°ï¼Œé˜²æ­¢ç‰¹æ®Šå­—ç¬¦ç ´åHTMLç»“æ„
            escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }































































































            // è·å–å·²å®‰è£…æ’ä»¶æ•°æ®
            async fetchInstalledPlugins() {
                try {
                    const response = await fetch(`${this.backendUrl}/nodes/installed`);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    const result = await response.json();
                    if (result.status === 'success') {
                        return result.nodes.map(node => ({
                            name: node.name,
                            version: node.version || 'æœªçŸ¥',
                            date: node.git_date || node.date || 'N/A',
                            enabled: node.status === 'enabled',
                            url: node.repo_url || `https://github.com/search?q=${encodeURIComponent(node.name)}`,
                            hasUpdate: node.hasUpdate || false,
                            description: node.description || 'æ— æè¿°',
                            fileCount: node.fileCount || 0,
                            author: node.author || 'æœªçŸ¥',
                            status: node.status,
                            isLatestVersion: node.isLatestVersion === true
                        }));
                    } else {
                        throw new Error(result.message || 'Failed to fetch plugins');
                    }
                } catch (error) {
                    console.error('Error fetching installed plugins:', error);
                    throw error;
                }
            }

            // æ¸²æŸ“æ’ä»¶å¡ç‰‡
            renderPluginCard(plugin) {
                const safeName = this.escapeHtml(plugin.name || '').replace(/'/g, "\\'");
                const safeDisplayName = this.escapeHtml(plugin.name || 'æœªçŸ¥æ’ä»¶');
                const safeVersion = this.escapeHtml(plugin.version || 'æœªçŸ¥');
                const safeAuthor = this.escapeHtml(plugin.author || 'æœªçŸ¥');
                const safeDate = this.escapeHtml(plugin.date || 'æœªçŸ¥');
                const safeDescription = this.escapeHtml(plugin.description || 'æš‚æ— æè¿°');
                const isEnabled = plugin.enabled === true || plugin.status === 'enabled';
                const statusColor = isEnabled ? '#28a745' : '#dc3545';
                const statusText = isEnabled ? 'âœ“ å·²å¯ç”¨' : 'âœ— å·²ç¦ç”¨';
                const safeUrl = plugin.url || `https://github.com/search?q=${encodeURIComponent(plugin.name || '')}`;
                const toggleButtonColor = isEnabled ? '#ffc107' : '#28a745';
                const toggleButtonText = isEnabled ? 'ç¦ç”¨' : 'å¯ç”¨';
                const toggleButtonIcon = isEnabled ? 'fa-pause' : 'fa-play';

                // åˆ¤æ–­æ˜¯å¦ä¸ºæœ€æ–°ç‰ˆæœ¬ï¼ˆç”¨äºæ›´æ–°æŒ‰é’®é¢œè‰²ï¼‰
                const isLatestVersion = plugin.isLatestVersion === true;
                const updateButtonColor = isLatestVersion ? '#6c757d' : '#28a745';

                return `
                    <div data-plugin-name="${safeName}" style="background: rgba(255,255,255,0.05); padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 3px solid #00f5ff; width: 100%; box-sizing: border-box;">
                        <div style="margin-bottom: 15px;">
                            <div style="margin-bottom: 10px;">
                                <strong style="color: #00f5ff; font-size: 18px; display: block; margin-bottom: 5px;">${safeDisplayName}</strong>
                                <span style="color: ${statusColor}; font-size: 13px; font-weight: bold;">${statusText}</span>
                            </div>
                            <div style="color: #ccc; font-size: 13px; margin-bottom: 8px; line-height: 1.4;">
                                <span style="margin-right: 20px;">ç‰ˆæœ¬: ${safeVersion}</span>
                                <span style="margin-right: 20px;">ä½œè€…: ${safeAuthor}</span>
                                <span>æ›´æ–°: ${safeDate}</span>
                            </div>
                            <div style="color: #aaa; font-size: 12px; line-height: 1.5; margin-bottom: 15px;">
                                ${safeDescription}
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <button onclick="launcherInstance.openInExternalBrowser('${safeUrl}', 'æ’ä»¶ ${safeName} çš„ä¸»é¡µä¿¡æ¯ä¸å¯ç”¨')" style="padding: 6px 12px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 500; display: flex; align-items: center; gap: 4px; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(0,123,255,0.3);">
                                <i class="fas fa-external-link-alt"></i> ä¸»é¡µ
                            </button>
                            <button onclick="togglePlugin('${safeName}', ${isEnabled ? 'true' : 'false'})" style="padding: 6px 12px; background: ${toggleButtonColor}; color: ${isEnabled ? 'black' : 'white'}; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 500; display: flex; align-items: center; gap: 4px; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(255,193,7,0.3);">
                                <i class="fas ${toggleButtonIcon}"></i> ${toggleButtonText}
                            </button>
                            <button onclick="uninstallPlugin('${safeName}')" style="padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 500; display: flex; align-items: center; gap: 4px; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(220,53,69,0.3);">
                                <i class="fas fa-trash"></i> å¸è½½
                            </button>
                            <button onclick="showPluginVersions('${safeName}')" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 500; display: flex; align-items: center; gap: 4px; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(108,117,125,0.3);">
                                <i class="fas fa-code-branch"></i> åˆ‡æ¢
                            </button>
                            <button onclick="updatePlugin('${safeName}')" style="padding: 6px 12px; background: ${updateButtonColor}; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 500; display: flex; align-items: center; gap: 4px; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(${updateButtonColor === '#6c757d' ? '108,117,125' : '40,167,69'},0.3);">
                                <i class="fas fa-sync-alt"></i> æ›´æ–°
                            </button>
                        </div>
                    </div>
                `;
            }

            // è®¾ç½®æ’ä»¶æŒ‰é’®åŠ è½½çŠ¶æ€
            setPluginButtonLoading(pluginName, actionType, isLoading, options = {}) {
                try {
                    const pluginCard = document.querySelector(`[data-plugin-name="${pluginName}"]`);
                    if (!pluginCard) return;

                    const button = pluginCard.querySelector(`[data-action-type="${actionType}"], button[onclick*="${actionType}"]`);
                    if (!button) return;

                    if (isLoading) {
                        button.disabled = true;
                        button.style.opacity = '0.6';
                        const icon = button.querySelector('i');
                        if (icon) {
                            icon.className = options.loadingIcon || 'fas fa-spinner fa-spin';
                        }
                        if (options.loadingText) {
                            const textNode = Array.from(button.childNodes).find(node => node.nodeType === Node.TEXT_NODE);
                            if (textNode) {
                                textNode.textContent = ` ${options.loadingText}`;
                            }
                        }
                    } else {
                        button.disabled = false;
                        button.style.opacity = '1';
                        // æ¢å¤åŸå§‹çŠ¶æ€éœ€è¦é‡æ–°æ¸²æŸ“ï¼Œè¿™é‡Œç®€åŒ–å¤„ç†
                    }
                } catch (error) {
                    console.error('Error setting plugin button loading state:', error);
                }
            }

            // HTMLè½¬ä¹‰å‡½æ•°ï¼Œé˜²æ­¢ç‰¹æ®Šå­—ç¬¦ç ´åHTMLç»“æ„
            escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            renderInstalledPlugins(plugins) {
                console.log('=== renderInstalledPlugins START ===');
                console.log('Plugins parameter:', plugins);
                console.log('Plugins type:', typeof plugins);
                console.log('Plugins length:', plugins?.length || 0);

                // åœ¨æ’ä»¶ç®¡ç†é¡µé¢çš„å®¹å™¨å†…æ¸²æŸ“ï¼Œè€Œä¸æ˜¯æ›¿æ¢main-content
                const pluginListContainer = document.querySelector('#installed-plugin-list');
                console.log('Plugin list container element:', pluginListContainer);

                if (!pluginListContainer) {
                    console.error('Plugin list container not found!');
                    return;
                }

                // åº”ç”¨æ»šåŠ¨æ¡é˜²æŠ¤è®¾ç½®
                pluginListContainer.style.overflow = 'visible';
                pluginListContainer.style.maxHeight = 'none';
                pluginListContainer.style.height = 'auto';

                if (!plugins || plugins.length === 0) {
                    console.log('No plugins to render, showing empty state');
                    this.renderEmptyStateInContainer(pluginListContainer);
                    return;
                }

                // é¢„è®¾å®¹å™¨é«˜åº¦ï¼Œé¿å…æ¸²æŸ“è¿‡ç¨‹ä¸­çš„é«˜åº¦è·³è·ƒ
                const estimatedItemHeight = 150; // å·²å®‰è£…æ’ä»¶é¡¹é«˜åº¦ä¼°è®¡
                const estimatedTotalHeight = plugins.length * estimatedItemHeight;
                pluginListContainer.style.minHeight = `${estimatedTotalHeight}px`;

                // åœ¨æ’ä»¶å®¹å™¨å†…ç”Ÿæˆæ’ä»¶åˆ—è¡¨
                console.log('Generating plugin list in container...');
                this.generatePluginListInContainer(pluginListContainer, plugins);

                // ç¡®ä¿æ’ä»¶åˆ—è¡¨å®¹å™¨å¯è§
                pluginListContainer.classList.add('show');
                pluginListContainer.style.display = 'block';

                // éšè—åŠ è½½çŠ¶æ€ - å…³é”®ä¿®å¤ï¼
                const loadingElement = document.getElementById('installed-loading');
                if (loadingElement) {
                    loadingElement.style.display = 'none';
                    console.log('Hidden installed loading indicator');
                } else {
                    console.warn('Installed loading element not found');
                }

                // é‡ç½®å®¹å™¨é«˜åº¦ä¸ºè‡ªåŠ¨
                requestAnimationFrame(() => {
                    pluginListContainer.style.minHeight = 'auto';
                });

                // ç¼“å­˜æ¸²æŸ“åçš„HTMLå†…å®¹ï¼Œç”¨äºå¿«é€Ÿæ˜¾ç¤º
                this.cachedPluginHTML = pluginListContainer.innerHTML;

                console.log('Plugin list container made visible with .show class');
                console.log('HTML content cached for future use');
                console.log('=== renderInstalledPlugins COMPLETE ===');
            }

            renderEmptyStateInContainer(container) {
                container.innerHTML = `
                    <div style="padding: 40px; text-align: center; color: white;">
                        <i class="fas fa-puzzle-piece" style="font-size: 48px; color: #00f5ff; margin-bottom: 20px;"></i>
                        <h3 style="color: #00f5ff;">æš‚æ— å·²å®‰è£…æ’ä»¶</h3>
                        <p style="color: #ccc;">æ‚¨è¿˜æ²¡æœ‰å®‰è£…ä»»ä½•è‡ªå®šä¹‰èŠ‚ç‚¹æ’ä»¶</p>
                    </div>
                `;
                console.log('Empty state rendered in container');
            }

            generatePluginListInContainer(container, plugins) {
                console.log('=== generatePluginListInContainer START ===');

                try {
                    // æ¸…ç©ºå®¹å™¨
                    container.innerHTML = '';

                    // å¦‚æœæ’ä»¶æ•°é‡è¾ƒå°‘ï¼Œç›´æ¥æ¸²æŸ“
                    if (plugins.length <= 50) {
                        this.renderPluginsDirectly(container, plugins);
                    } else {
                        // æ’ä»¶æ•°é‡è¾ƒå¤šï¼Œä½¿ç”¨åˆ†æ‰¹æ¸²æŸ“
                        this.renderPluginsBatch(container, plugins);
                    }

                    console.log('Plugin list generated in container successfully');

                } catch (error) {
                    console.error('Error generating plugin list in container:', error);
                    container.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #dc3545;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 24px; margin-bottom: 10px;"></i>
                            <h3>æ’ä»¶åˆ—è¡¨ç”Ÿæˆå¤±è´¥</h3>
                            <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                        </div>
                    `;
                }
            }

            // ç›´æ¥æ¸²æŸ“æ’ä»¶ï¼ˆé€‚ç”¨äºå°‘é‡æ’ä»¶ï¼‰
            renderPluginsDirectly(container, plugins) {
                console.log(`ğŸ” renderPluginsDirectly called with ${plugins.length} plugins`);

                const pluginHTML = plugins.map((plugin, index) => {
                    try {
                        console.log(`ğŸ” Rendering plugin ${index + 1}/${plugins.length}: ${plugin.name}`);
                        const cardHTML = this.renderPluginCard(plugin);
                        console.log(`ğŸ” Plugin card HTML length: ${cardHTML ? cardHTML.length : 0}`);
                        return cardHTML;
                    } catch (error) {
                        console.error(`ğŸ” Error rendering plugin card for ${plugin.name}:`, error);
                        return `
                            <div style="background: rgba(255,0,0,0.1); padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 3px solid #ff0000; color: #ff6666;">
                                æ’ä»¶ "${plugin.name || 'æœªçŸ¥'}" æ¸²æŸ“å¤±è´¥: ${error.message}
                            </div>
                        `;
                    }
                }).join('');

                console.log(`ğŸ” Total HTML length: ${pluginHTML.length}`);
                console.log(`ğŸ” Setting container innerHTML...`);
                container.innerHTML = pluginHTML;
                console.log(`ğŸ” Container innerHTML set successfully`);
            }

            // è¶…çº§ä¼˜åŒ–çš„åˆ†æ‰¹æ¸²æŸ“æ’ä»¶
            renderPluginsBatch(container, plugins) {
                console.log(`ğŸ” renderPluginsBatch called with ${plugins.length} plugins`);

                const BATCH_SIZE = 8; // å‡å°‘æ‰¹æ¬¡å¤§å°ï¼Œæ›´é¢‘ç¹çš„è®©å‡ºæ§åˆ¶æƒ
                let currentIndex = 0;

                // æ·»åŠ åˆ°æ¸²æŸ“é˜Ÿåˆ—
                this.renderQueue.push({
                    container,
                    plugins,
                    currentIndex: 0,
                    batchSize: BATCH_SIZE
                });

                console.log(`ğŸ” Added to render queue. Queue length: ${this.renderQueue.length}`);
                console.log(`ğŸ” Is rendering: ${this.isRendering}`);

                // å¦‚æœæ²¡æœ‰æ­£åœ¨æ¸²æŸ“ï¼Œå¼€å§‹æ¸²æŸ“
                if (!this.isRendering) {
                    console.log(`ğŸ” Starting render queue processing...`);
                    this.processRenderQueue();
                } else {
                    console.log(`ğŸ” Already rendering, will process queue later`);
                }
            }

            // å¤„ç†æ¸²æŸ“é˜Ÿåˆ—
            processRenderQueue() {
                console.log(`ğŸ” processRenderQueue called. Queue length: ${this.renderQueue.length}`);

                if (this.renderQueue.length === 0) {
                    console.log(`ğŸ” Queue is empty, stopping rendering`);
                    this.isRendering = false;
                    return;
                }

                this.isRendering = true;
                const task = this.renderQueue[0];
                console.log(`ğŸ” Processing task with ${task.plugins.length} plugins, currentIndex: ${task.currentIndex}`);

                const renderBatch = () => {
                    // æ£€æŸ¥æ˜¯å¦è¢«å–æ¶ˆ
                    if (this.renderQueue.length === 0 || this.renderQueue[0] !== task) {
                        this.isRendering = false;
                        return;
                    }

                    const { container, plugins, batchSize } = task;
                    const endIndex = Math.min(task.currentIndex + batchSize, plugins.length);
                    const batch = plugins.slice(task.currentIndex, endIndex);

                    // ä½¿ç”¨DocumentFragmentä¼˜åŒ–DOMæ“ä½œ
                    const fragment = document.createDocumentFragment();

                    batch.forEach(plugin => {
                        try {
                            const div = document.createElement('div');
                            div.innerHTML = this.renderPluginCard(plugin);
                            fragment.appendChild(div.firstChild);
                        } catch (error) {
                            console.error(`Error rendering plugin card for ${plugin.name}:`, error);
                            const errorDiv = document.createElement('div');
                            errorDiv.innerHTML = `
                                <div style="background: rgba(255,0,0,0.1); padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 3px solid #ff0000; color: #ff6666;">
                                    æ’ä»¶ "${plugin.name || 'æœªçŸ¥'}" æ¸²æŸ“å¤±è´¥: ${error.message}
                                </div>
                            `;
                            fragment.appendChild(errorDiv.firstChild);
                        }
                    });

                    // ä¸€æ¬¡æ€§æ·»åŠ åˆ°å®¹å™¨
                    container.appendChild(fragment);

                    task.currentIndex = endIndex;

                    // å¦‚æœè¿˜æœ‰æ›´å¤šæ’ä»¶ï¼Œç»§ç»­ä¸‹ä¸€æ‰¹
                    if (task.currentIndex < plugins.length) {
                        // ä½¿ç”¨æ›´çŸ­çš„å»¶è¿Ÿï¼Œè®©å‡ºæ§åˆ¶æƒç»™å…¶ä»–ä»»åŠ¡
                        this.renderAnimationId = requestAnimationFrame(renderBatch);
                    } else {
                        // å½“å‰ä»»åŠ¡å®Œæˆï¼Œç§»é™¤é˜Ÿåˆ—å¹¶å¤„ç†ä¸‹ä¸€ä¸ª
                        this.renderQueue.shift();
                        this.processRenderQueue();
                    }
                };

                // å¼€å§‹æ¸²æŸ“ç¬¬ä¸€æ‰¹
                this.renderAnimationId = requestAnimationFrame(renderBatch);
            }





            generateFullPluginList(pluginManagement, plugins) {
                console.log('=== generateFullPluginList START ===');

                console.log('Starting to generate HTML for plugins...');
                try {
                    // ç”Ÿæˆç®€åŒ–çš„æ’ä»¶ç®¡ç†ç•Œé¢ï¼ˆä½¿ç”¨ç»Ÿä¸€æ¨¡æ¿ï¼‰
                    const pluginItems = plugins.map((plugin, index) => {
                        console.log(`Generating HTML for plugin ${index + 1}/${plugins.length}: ${plugin.name}`);
                        return this.renderPluginCard(plugin);
                    }).join('');

                    // ç”Ÿæˆå®Œæ•´çš„æ’ä»¶ç®¡ç†é¡µé¢
                    const fullHTML = `
                        <div style="padding: 20px; color: white; /* ç§»é™¤overflow-y: autoï¼Œä½¿ç”¨é¡µé¢çº§åˆ«æ»šåŠ¨æ¡ */">
                            <div style="display: flex; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #333;">
                                <i class="fas fa-puzzle-piece" style="color: #00f5ff; font-size: 24px; margin-right: 15px;"></i>
                                <h2 style="color: #00f5ff; margin: 0; font-size: 24px;">æ’ä»¶ç®¡ç†</h2>
                                <div style="margin-left: auto; color: #ccc; font-size: 14px;">
                                    å…± ${plugins.length} ä¸ªæ’ä»¶
                                </div>
                            </div>

                            <div style="background: rgba(0, 245, 255, 0.1); border: 1px solid #00f5ff; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                                <h3 style="color: #00f5ff; margin: 0 0 15px 0; font-size: 18px;">
                                    <i class="fas fa-check-circle" style="margin-right: 10px;"></i>
                                    å·²å®‰è£…æ’ä»¶
                                </h3>
                                <div style="/* ç§»é™¤é«˜åº¦é™åˆ¶ï¼Œä½¿ç”¨é¡µé¢çº§åˆ«æ»šåŠ¨æ¡ */">
                                    ${pluginItems}
                                </div>
                            </div>

                            <div style="text-align: center; color: #666; padding: 20px; border-top: 1px solid #333;">
                                <p style="margin: 0; font-size: 12px;">
                                    æ’ä»¶ç®¡ç†åŠŸèƒ½æ­£åœ¨å®Œå–„ä¸­ï¼Œæ›´å¤šåŠŸèƒ½å³å°†æ¨å‡º
                                </p>
                            </div>
                        </div>
                    `;

                    console.log('HTML generation complete, length:', fullHTML.length);
                    console.log('Setting plugin management innerHTML...');

                    pluginManagement.innerHTML = fullHTML;

                    console.log('Plugin management innerHTML set successfully');
                    console.log('Plugin management size:', pluginManagement.getBoundingClientRect());

                    console.log('=== generateFullPluginList COMPLETE ===');

                } catch (error) {
                    console.error('Error generating plugin HTML:', error);
                    console.error('Error stack:', error.stack);
                    pluginManagement.innerHTML = `
                        <div style="padding: 40px; text-align: center; color: white;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #dc3545; margin-bottom: 20px;"></i>
                            <h3 style="color: #dc3545;">æ¸²æŸ“æ’ä»¶åˆ—è¡¨æ—¶å‡ºé”™</h3>
                            <p style="color: #ccc;">é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                            <button onclick="location.reload()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px;">
                                é‡æ–°åŠ è½½é¡µé¢
                            </button>
                        </div>
                    `;
                }
            }

            async loadAvailablePlugins(silent = false, forceRefresh = false) {
                console.log(`=== loadAvailablePlugins START (silent: ${silent}) ===`);
                this.isLoadingAvailable = true;

                const loading = document.getElementById('available-loading');
                const pluginList = document.getElementById('available-plugin-list');

                console.log('Available loading element:', loading);
                console.log('Available plugin list element:', pluginList);

                if (!loading || !pluginList) {
                    console.error('Available plugins DOM elements not found!');
                    this.isLoadingAvailable = false;
                    return;
                }

                // åªåœ¨éé™é»˜æ¨¡å¼ä¸‹æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                if (loading && !silent) {
                    loading.style.display = 'flex';
                }

                // åˆå§‹åŒ–è¿›åº¦æ˜¾ç¤ºï¼ˆé™é»˜æ¨¡å¼ä¸‹è·³è¿‡ï¼‰
                if (!silent) {
                    this.updateLoadingProgress('available', 0, 'æ­£åœ¨è·å–æ’ä»¶åˆ—è¡¨...');
                }

                try {
                    console.log('Fetching available plugins from API...');
                    console.log('Backend URL:', this.backendUrl);

                    if (!silent) this.updateLoadingProgress('available', 20, 'æ­£åœ¨è¿æ¥æœåŠ¡å™¨...');
                    const pluginData = await this.fetchAvailablePlugins(forceRefresh);
                    console.log('Available plugins data received:', pluginData);
                    console.log('Plugin data type:', typeof pluginData);
                    console.log('Plugin data length:', Array.isArray(pluginData) ? pluginData.length : 'Not an array');

                    if (!silent) this.updateLoadingProgress('available', 50, 'æ­£åœ¨å¤„ç†æ’ä»¶æ•°æ®...');

                    this.availablePlugins = pluginData;
                    this.allAvailablePlugins = [...pluginData]; // ä¿å­˜å®Œæ•´åˆ—è¡¨ç”¨äºæœç´¢

                    if (!silent) this.updateLoadingProgress('available', 80, 'æ­£åœ¨æ¸²æŸ“æ’ä»¶åˆ—è¡¨...');
                    // æ¸²æŸ“å¯ç”¨æ’ä»¶åˆ—è¡¨ï¼ˆé™é»˜æ¨¡å¼ä¸‹ä¸æ¸²æŸ“UIï¼‰
                    if (!silent) {
                        this.renderAvailablePlugins(pluginData);
                    }

                    if (!silent) this.updateLoadingProgress('available', 100, 'åŠ è½½å®Œæˆï¼');

                    // å»¶è¿Ÿéšè—åŠ è½½çŠ¶æ€ï¼Œè®©ç”¨æˆ·çœ‹åˆ°100%å®Œæˆ
                    if (!silent) {
                        setTimeout(() => {
                            if (loading) {
                                loading.style.display = 'none';
                            }
                        }, 300);

                        // å¼ºåˆ¶æ˜¾ç¤ºæ’ä»¶åˆ—è¡¨
                        pluginList.style.display = 'block';
                        pluginList.style.visibility = 'visible';
                        pluginList.style.opacity = '1';
                    }

                    console.log('Available plugins loaded successfully');

                    // å¼‚æ­¥è·å–çœŸå®çš„GitHub staræ•°ï¼ˆä»…å¯¹å‰50ä¸ªæ’ä»¶ï¼‰
                    if (!silent) {
                        this.loadRealGitHubStars();
                    }

                } catch (error) {
                    console.error('Failed to load available plugins:', error);

                    // åªåœ¨éé™é»˜æ¨¡å¼ä¸‹æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                    if (!silent) {
                        pluginList.innerHTML = `
                            <div style="padding: 20px; text-align: center; color: #ff4757; background: rgba(255,71,87,0.1); border: 2px solid #ff4757; margin: 20px; border-radius: 10px;">
                                <h3>âŒ åŠ è½½å¯ç”¨æ’ä»¶å¤±è´¥</h3>
                                <p>æ— æ³•ä»ComfyUI Managerè·å–æ’ä»¶åˆ—è¡¨</p>
                                <p style="font-size: 14px; opacity: 0.8;">é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                                <button onclick="launcherInstance.loadAvailablePlugins()" style="background: #ff4757; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-top: 10px; cursor: pointer;">
                                    é‡è¯•
                                </button>
                                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                                    <p style="font-size: 14px; opacity: 0.8;">
                                        ğŸ’¡ æç¤ºï¼šè¯·ç¡®ä¿ComfyUI Managerå·²æ­£ç¡®å®‰è£…<br>
                                        æˆ–è€…æ‰‹åŠ¨å°†æ’ä»¶æ–‡ä»¶å¤¹æ”¾å…¥ custom_nodes ç›®å½•
                                    </p>
                                </div>
                            </div>
                        `;

                        // å¼ºåˆ¶æ˜¾ç¤ºæ’ä»¶åˆ—è¡¨
                        pluginList.style.display = 'block';
                        pluginList.style.visibility = 'visible';
                        pluginList.style.opacity = '1';

                        // éšè—åŠ è½½çŠ¶æ€
                        if (loading) {
                            loading.style.display = 'none';
                        }
                    }
                } finally {
                    this.isLoadingAvailable = false;
                }

                console.log('=== loadAvailablePlugins END ===');
            }

            // æ›´æ–°åŠ è½½è¿›åº¦æ˜¾ç¤º
            updateLoadingProgress(type, percentage, message) {
                const textElement = document.getElementById(`${type}-loading-text`);
                const progressFill = document.getElementById(`${type}-progress-fill`);

                if (textElement) {
                    textElement.textContent = message;
                }

                if (progressFill) {
                    progressFill.style.width = `${percentage}%`;
                }

                console.log(`Loading progress [${type}]: ${percentage}% - ${message}`);
            }

            // è¾…åŠ©æ–¹æ³•ï¼šæ£€æŸ¥æ’ä»¶æ˜¯å¦å·²å®‰è£…
            isPluginInstalled(pluginName) {
                return this.installedPlugins.some(plugin =>
                    plugin.name.toLowerCase() === pluginName.toLowerCase()
                );
            }

            async fetchAvailablePlugins(forceRefresh = false) {
                try {
                    const url = `${this.backendUrl}/nodes/available`;
                    const params = new URLSearchParams();
                    if (forceRefresh) {
                        params.append('force_refresh', 'true');
                    }
                    params.append('_t', Date.now().toString());

                    const fullUrl = `${url}?${params}`;
                    console.log('Fetching available plugins from:', fullUrl);

                    const response = await fetch(fullUrl, {
                        headers: forceRefresh ? {
                            'Cache-Control': 'no-cache, no-store, must-revalidate',
                            'Pragma': 'no-cache',
                            'Expires': '0'
                        } : {}
                    });
                    console.log('Available plugins API response status:', response.status);

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();
                    console.log('Available plugins API response data:', data);

                    if (data.status === 'success') {
                        // è½¬æ¢åç«¯æ•°æ®æ ¼å¼ä¸ºå‰ç«¯æœŸæœ›çš„æ ¼å¼
                        const plugins = data.nodes.map(node => {
                            logger.debug('Processing node:', node);
                            return {
                                name: node.title || node.name,
                                author: node.author || 'æœªçŸ¥',
                                stars: node.stars || 0, // ä½¿ç”¨åç«¯è¿”å›çš„çœŸå®staræ•°
                                url: node.reference || node.repo_url || `https://github.com/search?q=${encodeURIComponent(node.title || node.name)}`,
                                category: node.category || 'other', // ä½¿ç”¨åç«¯è¿”å›çš„åˆ†ç±»
                                description: node.description || "æ— æè¿°",
                                installed: node.is_installed || false, // ä½¿ç”¨åç«¯è¿”å›çš„å®‰è£…çŠ¶æ€
                                tags: node.tags || [],
                                files: node.files || [],
                                install_type: node.install_type || 'git-clone'
                            };
                        });

                        console.log(`Processed ${plugins.length} available plugins`);
                        return plugins;
                    } else {
                        throw new Error(data.message || 'Failed to fetch available plugins');
                    }
                } catch (error) {
                    console.error('Error fetching available plugins:', error);
                    console.error('Error details:', {
                        message: error.message,
                        stack: error.stack,
                        url: fullUrl
                    });

                    // å¦‚æœAPIå¤±è´¥ï¼Œè¿”å›ç¤ºä¾‹æ•°æ®ä½œä¸ºåå¤‡
                    console.log('Falling back to example data');
                    return [
                        {
                            name: "ComfyUI-Manager",
                            author: "ltdrdata",
                            stars: 8234,
                            url: "https://github.com/ltdrdata/ComfyUI-Manager",
                            category: "utils",
                            description: "ComfyUI extension manager"
                        },
                        {
                            name: "ComfyUI-Custom-Scripts",
                            author: "pythongosssss",
                            stars: 1567,
                            url: "https://github.com/pythongosssss/ComfyUI-Custom-Scripts",
                            category: "ui",
                            description: "Custom UI scripts and enhancements"
                        }
                    ];
                }
            }



            renderAvailablePlugins(plugins) {
                console.log('=== renderAvailablePlugins START ===');
                console.log('Plugins to render:', plugins.length);

                const container = document.getElementById('available-plugin-list');
                if (!container) {
                    console.error('Available plugin list container not found!');
                    return;
                }

                if (plugins.length === 0) {
                    container.innerHTML = `
                        <div style="grid-column: 1 / -1; padding: 60px 40px; text-align: center; color: var(--text-secondary);">
                            <div style="background: rgba(26, 26, 46, 0.3); border-radius: 20px; padding: 40px; border: 1px solid rgba(0, 245, 255, 0.1);">
                                <i class="fas fa-search" style="font-size: 64px; margin-bottom: 24px; opacity: 0.3; color: var(--neon-glow);"></i>
                                <h3 style="color: var(--text-primary); margin-bottom: 12px; font-size: 20px;">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ’ä»¶</h3>
                                <p style="font-size: 14px; opacity: 0.8;">å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–é€‰æ‹©ä¸åŒçš„åˆ†ç±»</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                // ä½¿ç”¨ä¼˜åŒ–çš„æ¸²æŸ“ç­–ç•¥
                this.renderAvailablePluginsBatch(container, plugins);

            }

            // åˆ†æ‰¹æ¸²æŸ“å¯ç”¨æ’ä»¶ï¼ˆæ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬ï¼‰
            renderAvailablePluginsBatch(container, plugins) {
                // æ¸…ç©ºå®¹å™¨
                container.innerHTML = '';

                // è®¾ç½®å®¹å™¨æ ·å¼
                container.classList.add('show');
                container.style.display = 'block';

                // å¦‚æœæ’ä»¶æ•°é‡è¾ƒå°‘ï¼Œç›´æ¥æ¸²æŸ“
                if (plugins.length <= 3000) {
                    this.renderAvailablePluginsDirectly(container, plugins);
                } else {
                    // æ’ä»¶æ•°é‡è¾ƒå¤šï¼Œä½¿ç”¨åˆ†æ‰¹æ¸²æŸ“
                    this.renderAvailablePluginsBatchAsync(container, plugins);
                }

                console.log('=== renderAvailablePlugins END ===');
            }

            // ç›´æ¥æ¸²æŸ“å¯ç”¨æ’ä»¶ï¼ˆé€‚ç”¨äºå°‘é‡æ’ä»¶ï¼‰
            renderAvailablePluginsDirectly(container, plugins) {
                console.log(`ğŸ” renderAvailablePluginsDirectly called with ${plugins.length} plugins`);

                const allHTML = plugins.map((plugin, index) => {
                    if (index < 5) { // åªè®°å½•å‰5ä¸ªæ’ä»¶çš„æ¸²æŸ“è¿‡ç¨‹
                        console.log(`ğŸ” Rendering available plugin ${index + 1}/${plugins.length}: ${plugin.name}`);
                    }
                    return this.generateAvailablePluginHTML(plugin);
                }).join('');

                console.log(`ğŸ” Total available HTML length: ${allHTML.length}`);
                console.log(`ğŸ” Setting available container innerHTML...`);
                container.innerHTML = allHTML;
                console.log(`ğŸ” Available container innerHTML set successfully`);
            }

            // è¶…çº§ä¼˜åŒ–çš„å¼‚æ­¥åˆ†æ‰¹æ¸²æŸ“å¯ç”¨æ’ä»¶
            renderAvailablePluginsBatchAsync(container, plugins) {
                console.log(`ğŸ” renderAvailablePluginsBatchAsync called with ${plugins.length} plugins`);

                const BATCH_SIZE = 6; // è¿›ä¸€æ­¥å‡å°‘æ‰¹æ¬¡å¤§å°

                // æ·»åŠ åˆ°æ¸²æŸ“é˜Ÿåˆ—
                this.renderQueue.push({
                    container,
                    plugins,
                    currentIndex: 0,
                    batchSize: BATCH_SIZE,
                    type: 'available'
                });

                console.log(`ğŸ” Added available plugins to render queue. Queue length: ${this.renderQueue.length}`);
                console.log(`ğŸ” Is rendering: ${this.isRendering}`);

                // å¦‚æœæ²¡æœ‰æ­£åœ¨æ¸²æŸ“ï¼Œå¼€å§‹æ¸²æŸ“
                if (!this.isRendering) {
                    console.log(`ğŸ” Starting available render queue processing...`);
                    this.processAvailableRenderQueue();
                } else {
                    console.log(`ğŸ” Already rendering, will process available queue later`);
                }
            }

            // å¤„ç†å¯ç”¨æ’ä»¶æ¸²æŸ“é˜Ÿåˆ—
            processAvailableRenderQueue() {
                console.log(`ğŸ” processAvailableRenderQueue called. Queue length: ${this.renderQueue.length}`);

                if (this.renderQueue.length === 0) {
                    console.log(`ğŸ” Available queue is empty, stopping rendering`);
                    this.isRendering = false;
                    return;
                }

                this.isRendering = true;
                const task = this.renderQueue.find(t => t.type === 'available') || this.renderQueue[0];
                console.log(`ğŸ” Processing available task with ${task.plugins.length} plugins, currentIndex: ${task.currentIndex}`);

                const renderBatch = () => {
                    // æ£€æŸ¥æ˜¯å¦è¢«å–æ¶ˆ
                    if (this.renderQueue.length === 0 || !this.renderQueue.includes(task)) {
                        this.isRendering = false;
                        return;
                    }

                    const { container, plugins, batchSize } = task;
                    const endIndex = Math.min(task.currentIndex + batchSize, plugins.length);
                    const batch = plugins.slice(task.currentIndex, endIndex);

                    // ä½¿ç”¨DocumentFragmentä¼˜åŒ–DOMæ“ä½œ
                    const fragment = document.createDocumentFragment();

                    batch.forEach(plugin => {
                        try {
                            const div = document.createElement('div');
                            div.innerHTML = this.generateAvailablePluginHTML(plugin);
                            fragment.appendChild(div.firstChild);
                        } catch (error) {
                            console.error(`Error rendering available plugin for ${plugin.name}:`, error);
                        }
                    });

                    // ä¸€æ¬¡æ€§æ·»åŠ åˆ°å®¹å™¨
                    container.appendChild(fragment);

                    task.currentIndex = endIndex;

                    // å¦‚æœè¿˜æœ‰æ›´å¤šæ’ä»¶ï¼Œç»§ç»­ä¸‹ä¸€æ‰¹
                    if (task.currentIndex < plugins.length) {
                        this.renderAnimationId = requestAnimationFrame(renderBatch);
                    } else {
                        // å½“å‰ä»»åŠ¡å®Œæˆï¼Œç§»é™¤é˜Ÿåˆ—
                        const index = this.renderQueue.indexOf(task);
                        if (index > -1) {
                            this.renderQueue.splice(index, 1);
                        }
                        this.processAvailableRenderQueue();
                    }
                };

                // å¼€å§‹æ¸²æŸ“ç¬¬ä¸€æ‰¹
                this.renderAnimationId = requestAnimationFrame(renderBatch);
            }

            // ç”Ÿæˆå•ä¸ªå¯ç”¨æ’ä»¶çš„HTML
            generateAvailablePluginHTML(plugin) {
                // æ£€æŸ¥æ’ä»¶æ˜¯å¦å·²å®‰è£…
                const backendInstalled = plugin.installed; // åç«¯æ£€æµ‹ç»“æœ
                const frontendInstalled = this.isPluginInstalled(plugin.name); // å‰ç«¯æ£€æµ‹ç»“æœ

                // ä¼˜å…ˆä½¿ç”¨åç«¯æ£€æµ‹ç»“æœï¼Œå‰ç«¯ä½œä¸ºå¤‡ç”¨
                const isInstalled = backendInstalled || frontendInstalled;

                // è°ƒè¯•ä¿¡æ¯ï¼šè®°å½•å®‰è£…çŠ¶æ€æ£€æµ‹ç»“æœ
                if (plugin.name.toLowerCase().includes('test') || backendInstalled !== frontendInstalled) {
                    console.log(`ğŸ” Plugin ${plugin.name}: backend=${backendInstalled}, frontend=${frontendInstalled}, final=${isInstalled}`);
                }

                // é¢å¤–è°ƒè¯•ï¼šè®°å½•æœ€è¿‘å®‰è£…çš„æ’ä»¶çŠ¶æ€
                if (window.lastInstalledPlugin && plugin.name === window.lastInstalledPlugin) {
                    console.log(`ğŸ¯ æœ€è¿‘å®‰è£…çš„æ’ä»¶ ${plugin.name}: backend=${backendInstalled}, frontend=${frontendInstalled}, final=${isInstalled}`);
                    // æ¸…é™¤æ ‡è®°ï¼Œé¿å…é‡å¤æ—¥å¿—
                    window.lastInstalledPlugin = null;
                }

                // é¢å¤–è°ƒè¯•ï¼šè®°å½•æœ€è¿‘å¸è½½çš„æ’ä»¶çŠ¶æ€
                if (window.lastUninstalledPlugin && plugin.name === window.lastUninstalledPlugin) {
                    console.log(`ğŸ—‘ï¸ æœ€è¿‘å¸è½½çš„æ’ä»¶ ${plugin.name}: backend=${backendInstalled}, frontend=${frontendInstalled}, final=${isInstalled}`);
                    // æ¸…é™¤æ ‡è®°ï¼Œé¿å…é‡å¤æ—¥å¿—
                    window.lastUninstalledPlugin = null;
                }

                const installButtonText = isInstalled ? 'å·²å®‰è£…' : 'å®‰è£…';
                const installButtonClass = isInstalled ? 'installed' : 'install';
                const installButtonDisabled = isInstalled ? 'disabled' : '';

                return `
                    <div class="available-plugin-item" data-plugin="${plugin.name}" data-category="${plugin.category}">
                        <div class="available-plugin-info">
                            <!-- ä¸»è¦ä¿¡æ¯åŒºåŸŸ -->
                            <div class="plugin-main-info">
                                <!-- æ’ä»¶åç§°å’Œä½œè€… -->
                                <div class="plugin-title-line">
                                    <span class="available-plugin-name" title="${plugin.name}">${plugin.name}</span>
                                    <span class="plugin-author">@${plugin.author}</span>
                                </div>

                                <!-- æ’ä»¶æè¿° -->
                                <div class="plugin-description" title="${plugin.description}">${plugin.description}</div>

                                <!-- åº•éƒ¨ä¿¡æ¯è¡Œï¼šåˆ†ç±»ã€æ˜Ÿæ ‡ã€ä¸»é¡µã€å®‰è£… -->
                                <div class="plugin-bottom-line">
                                    <div class="plugin-left-info">
                                        <span class="plugin-category">${this.getCategoryDisplayName(plugin.category)}</span>
                                        <span class="plugin-stars">
                                            <i class="fas fa-star"></i> ${plugin.stars}
                                        </span>
                                    </div>
                                    <div class="plugin-right-actions">
                                        <button class="plugin-action-btn info"
                                                onclick="launcherInstance.showPluginInfo('${plugin.name}', '${plugin.url}')"
                                                title="æŸ¥çœ‹æ’ä»¶è¯¦æƒ…">
                                            <i class="fas fa-info-circle"></i>
                                            ä¸»é¡µ
                                        </button>
                                        <button class="plugin-action-btn ${installButtonClass}"
                                                data-plugin-name="${plugin.name}"
                                                data-action-type="installAvailablePlugin"
                                                onclick="launcherInstance.installAvailablePlugin('${plugin.name}', '${plugin.url}')"
                                                ${installButtonDisabled}>
                                            <i class="fas ${isInstalled ? 'fa-check' : 'fa-download'}"></i>
                                            ${installButtonText}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // æ£€æŸ¥æ’ä»¶æ˜¯å¦å·²å®‰è£…ï¼ˆæ”¹è¿›çš„åŒ¹é…é€»è¾‘ï¼‰
            isPluginInstalled(pluginName) {
                if (!this.installedPlugins || !pluginName) {
                    return false;
                }

                const searchName = pluginName.toLowerCase().trim();

                return this.installedPlugins.some(plugin => {
                    const installedName = plugin.name.toLowerCase();

                    // ç²¾ç¡®åŒ¹é…
                    if (installedName === searchName) {
                        return true;
                    }

                    // ç§»é™¤å¸¸è§å‰ç¼€ååŒ¹é…
                    const prefixes = ['comfyui-', 'comfyui_', 'comfy-', 'comfy_'];
                    for (const prefix of prefixes) {
                        if (installedName.startsWith(prefix) && searchName === installedName.substring(prefix.length)) {
                            return true;
                        }
                        if (searchName.startsWith(prefix) && installedName === searchName.substring(prefix.length)) {
                            return true;
                        }
                    }

                    // åŒ…å«åŒ¹é…ï¼ˆåŒå‘ï¼Œä½†è¦æ±‚é•¿åº¦è¶³å¤Ÿé¿å…è¯¯åŒ¹é…ï¼‰
                    if (searchName.length > 3 && installedName.length > 3) {
                        if (installedName.includes(searchName) || searchName.includes(installedName)) {
                            return true;
                        }
                    }

                    // åˆ†éš”ç¬¦å˜ä½“åŒ¹é…
                    const normalizedInstalled = installedName.replace(/[-_\s]/g, '');
                    const normalizedSearch = searchName.replace(/[-_\s]/g, '');
                    if (normalizedInstalled === normalizedSearch) {
                        return true;
                    }

                    return false;
                });
            }

            // è·å–åˆ†ç±»æ˜¾ç¤ºåç§°
            getCategoryDisplayName(category) {
                const categoryNames = {
                    'image': 'å›¾åƒå¤„ç†',
                    'video': 'è§†é¢‘å¤„ç†',
                    'audio': 'éŸ³é¢‘å¤„ç†',
                    'ai': 'AIæ¨¡å‹',
                    '3d': '3Dç›¸å…³',
                    'tool': 'å·¥å…·ç±»',
                    'other': 'å…¶ä»–'
                };
                return categoryNames[category] || 'å…¶ä»–';
            }

            // å®‰è£…å¯ç”¨æ’ä»¶
            async installAvailablePlugin(pluginName, pluginUrl) {
                try {
                    console.log('Installing available plugin:', pluginName, 'from:', pluginUrl);

                    // è®¾ç½®å®‰è£…æŒ‰é’®ä¸ºåŠ è½½çŠ¶æ€
                    this.setPluginButtonLoading(pluginName, 'installAvailablePlugin', true, {
                        loadingText: 'å®‰è£…ä¸­'
                    });

                    // ç¡®è®¤å®‰è£…
                    const confirmed = await this.showCustomConfirm(
                        'ç¡®è®¤å®‰è£…æ’ä»¶',
                        `ç¡®å®šè¦å®‰è£…æ’ä»¶ "${pluginName}" å—ï¼Ÿ\n\nè¿™å°†ä»è¿œç¨‹ä»“åº“ä¸‹è½½å¹¶å®‰è£…æ’ä»¶ã€‚`
                    );
                    if (!confirmed) {
                        // å–æ¶ˆåŠ è½½çŠ¶æ€
                        this.setPluginButtonLoading(pluginName, 'installAvailablePlugin', false);
                        return;
                    }

                    this.showNotification(`æ­£åœ¨å®‰è£…æ’ä»¶ ${pluginName}...`, 'info');

                    // è®¾ç½®è°ƒè¯•æ ‡è®°ï¼Œç”¨äºè¿½è¸ªå®‰è£…çŠ¶æ€
                    window.lastInstalledPlugin = pluginName;

                    // è°ƒç”¨çœŸå®çš„å®‰è£…API
                    const response = await fetch(`${this.backendUrl}/nodes/install`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            node_id: pluginName,
                            repo_url: pluginUrl,
                            install_type: 'git-clone'
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();

                        if (result.status === 'success') {
                            // ä¿å­˜å½“å‰çš„æœç´¢å’Œæµè§ˆçŠ¶æ€
                            const currentSearchTerm = document.getElementById('plugin-search')?.value || '';
                            const currentScrollPosition = document.getElementById('available-plugin-list')?.scrollTop || 0;

                            console.log(`ä¿å­˜çŠ¶æ€ - æœç´¢è¯: "${currentSearchTerm}", æ»šåŠ¨ä½ç½®: ${currentScrollPosition}`);

                            // æ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°æ’ä»¶åˆ—è¡¨
                            this.clearAllPluginCaches();

                            // ç­‰å¾…ä¸€ä¸‹ç¡®ä¿å®‰è£…å®Œæˆ
                            await new Promise(resolve => setTimeout(resolve, 1500));

                            // é‡æ–°åŠ è½½å·²å®‰è£…æ’ä»¶åˆ—è¡¨
                            await this.loadInstalledPlugins();

                            // ç­‰å¾…ä¸€ä¸‹ç¡®ä¿å·²å®‰è£…æ’ä»¶åˆ—è¡¨æ›´æ–°å®Œæˆ
                            await new Promise(resolve => setTimeout(resolve, 500));

                            // å¼ºåˆ¶é‡æ–°åŠ è½½å¯ç”¨æ’ä»¶åˆ—è¡¨ï¼ˆå¸¦å¼ºåˆ¶åˆ·æ–°ï¼‰
                            await this.loadAvailablePlugins(true);

                            // å†æ¬¡ç­‰å¾…ç¡®ä¿çŠ¶æ€æ›´æ–°å®Œæˆ
                            await new Promise(resolve => setTimeout(resolve, 500));

                            // é¢å¤–çš„çŠ¶æ€éªŒè¯å’ŒåŒæ­¥
                            await this.ensurePluginStatusSync(pluginName);

                            // æ¢å¤ç”¨æˆ·çš„æœç´¢å’Œæµè§ˆçŠ¶æ€
                            await this.restorePluginBrowsingState(currentSearchTerm, currentScrollPosition, pluginName);

                            // ç¡®ä¿å·²å®‰è£…æ’ä»¶é¡µé¢ä¹Ÿèƒ½æ˜¾ç¤ºæ–°å®‰è£…çš„æ’ä»¶
                            await this.syncInstalledPluginDisplay(pluginName);

                            // æ£€æŸ¥ComfyUIè¿è¡ŒçŠ¶æ€
                            const comfyuiRunning = await this.checkComfyUIStatus();
                            const restartMessage = comfyuiRunning ? ' è¯·é‡å¯ComfyUIä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚' : '';

                            this.showNotification(`âœ… æ’ä»¶ ${pluginName} å®‰è£…æˆåŠŸï¼${restartMessage}`, 'success', 'plugin');

                            // éªŒè¯æ’ä»¶æ˜¯å¦æ­£ç¡®æ·»åŠ åˆ°å·²å®‰è£…åˆ—è¡¨
                            const installedPlugin = this.installedPlugins?.find(p => p.name === pluginName);
                            logger.info(`ğŸ“¦ å®‰è£…åéªŒè¯ - æ’ä»¶ ${pluginName} åœ¨å·²å®‰è£…åˆ—è¡¨ä¸­:`, !!installedPlugin);
                            logger.debug(`ğŸ“Š å½“å‰å·²å®‰è£…æ’ä»¶æ€»æ•°: ${this.installedPlugins?.length || 0}`);
                            logger.debug(`ğŸ·ï¸ å·²è®¾ç½®å·²å®‰è£…é¡µé¢åˆ·æ–°æ ‡è®°: ${this.needRefreshInstalledTab}`);
                        } else {
                            this.showNotification(`âŒ å®‰è£…å¤±è´¥ï¼š${result.message}`, 'error');
                        }
                    } else {
                        throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                    }

                } catch (error) {
                    console.error('Install plugin failed:', error);
                    this.showNotification(`âŒ æ’ä»¶å®‰è£…å¤±è´¥: ${error.message}`, 'error');
                } finally {
                    // æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½è¦æ¸…é™¤åŠ è½½çŠ¶æ€
                    this.setPluginButtonLoading(pluginName, 'installAvailablePlugin', false);
                }
            }

            // åœ¨å¤–éƒ¨æµè§ˆå™¨ä¸­æ‰“å¼€URL
            async openInExternalBrowser(url, fallbackMessage = 'æ— æ³•æ‰“å¼€é“¾æ¥') {
                if (!url || url === '#') {
                    this.showNotification(fallbackMessage, 'warning');
                    return false;
                }

                logger.info('Opening URL in external browser:', url);

                // å°è¯•å¤šç§æ–¹å¼æ‰“å¼€æµè§ˆå™¨
                let opened = false;

                // æ–¹å¼1: ä½¿ç”¨Electronçš„shell.openExternal (æ¨è)
                if (window.electronAPI && window.electronAPI.openExternal) {
                    try {
                        await window.electronAPI.openExternal(url);
                        opened = true;
                        logger.info('Opened using Electron shell.openExternal');
                    } catch (e) {
                        logger.warn('Failed to open with Electron shell:', e);
                    }
                }

                // æ–¹å¼2: ä½¿ç”¨window.openä½œä¸ºå¤‡é€‰
                if (!opened) {
                    try {
                        const newWindow = window.open(url, '_blank', 'noopener,noreferrer');
                        if (newWindow) {
                            opened = true;
                            logger.info('Opened using window.open');
                        }
                    } catch (e) {
                        logger.warn('Failed to open with window.open:', e);
                    }
                }

                // æ–¹å¼3: å¤åˆ¶URLåˆ°å‰ªè´´æ¿ä½œä¸ºæœ€åå¤‡é€‰
                if (!opened && navigator.clipboard) {
                    try {
                        await navigator.clipboard.writeText(url);
                        this.showNotification('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·æ‰‹åŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€', 'info');
                        opened = true;
                        logger.info('URL copied to clipboard as fallback');
                    } catch (e) {
                        logger.warn('Failed to copy to clipboard:', e);
                    }
                }

                if (!opened) {
                    this.showNotification('æ— æ³•æ‰“å¼€é“¾æ¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶URLåˆ°æµè§ˆå™¨', 'error');
                    logger.error('All methods failed to open URL:', url);
                }

                return opened;
            }

            // æ˜¾ç¤ºæ’ä»¶è¯¦æƒ…
            async showPluginInfo(pluginName, pluginUrl) {
                logger.info('Opening plugin homepage for:', pluginName, 'URL:', pluginUrl);

                // ä½¿ç”¨å¤–éƒ¨æµè§ˆå™¨æ‰“å¼€æ’ä»¶ä¸»é¡µ
                const success = await this.openInExternalBrowser(
                    pluginUrl,
                    `æ’ä»¶ ${pluginName} çš„ä¸»é¡µä¿¡æ¯ä¸å¯ç”¨`
                );

                if (success) {
                    this.showNotification(`æ­£åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ ${pluginName} ä¸»é¡µ`, 'success');
                }
            }

            // å¼‚æ­¥åŠ è½½çœŸå®çš„GitHub staræ•°
            async loadRealGitHubStars() {
                if (!this.allAvailablePlugins || this.allAvailablePlugins.length === 0) {
                    return;
                }

                console.log('Starting to load real GitHub stars for top plugins...');

                // åªå¯¹å‰50ä¸ªæ’ä»¶è·å–çœŸå®staræ•°ï¼Œé¿å…APIé™åˆ¶
                const topPlugins = this.allAvailablePlugins.slice(0, 50);
                let updatedCount = 0;

                for (const plugin of topPlugins) {
                    try {
                        // æå–GitHubä»“åº“ä¿¡æ¯
                        const githubUrl = plugin.url;
                        if (!githubUrl || !githubUrl.includes('github.com')) {
                            continue;
                        }

                        // è§£æä»“åº“ownerå’Œname
                        const urlParts = githubUrl.replace('.git', '').split('/');
                        if (urlParts.length < 5) {
                            continue;
                        }

                        const owner = urlParts[urlParts.length - 2];
                        const repo = urlParts[urlParts.length - 1];

                        // è°ƒç”¨åç«¯APIè·å–staræ•°
                        const response = await fetch(`${this.backendUrl}/nodes/github-stars/${owner}/${repo}`);
                        if (response.ok) {
                            const result = await response.json();
                            if (result.status === 'success' && result.stars > 0) {
                                // æ›´æ–°æ’ä»¶çš„staræ•°
                                plugin.stars = result.stars;
                                updatedCount++;

                                console.log(`Updated ${plugin.name}: ${result.stars} stars`);

                                // æ¯æ›´æ–°10ä¸ªæ’ä»¶å°±é‡æ–°æ¸²æŸ“ä¸€æ¬¡ï¼Œå‡å°‘é¢‘ç¹æ¸²æŸ“
                                if (updatedCount % 10 === 0) {
                                    this.sortPluginsByStars(this.allAvailablePlugins);
                                    this.renderAvailablePlugins(this.availablePlugins);
                                }
                            }
                        }

                        // å°å»¶è¿Ÿé¿å…APIé™åˆ¶
                        await new Promise(resolve => setTimeout(resolve, 100));

                    } catch (error) {
                        console.error(`Error loading stars for ${plugin.name}:`, error);
                    }
                }

                // æœ€ç»ˆé‡æ–°æ’åºå’Œæ¸²æŸ“
                if (updatedCount > 0) {
                    console.log(`Updated ${updatedCount} plugins with real GitHub stars`);
                    this.sortPluginsByStars(this.allAvailablePlugins);
                    this.renderAvailablePlugins(this.availablePlugins);
                }
            }

            // è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
            showCustomConfirm(title, message) {
                return new Promise((resolve) => {
                    // åˆ›å»ºæ¨¡æ€æ¡†
                    const modal = document.createElement('div');
                    modal.className = 'custom-confirm-modal';
                    modal.innerHTML = `
                        <div class="custom-confirm-content">
                            <div class="custom-confirm-header">
                                <h3>${title}</h3>
                            </div>
                            <div class="custom-confirm-body">
                                <p>${message.replace(/\n/g, '<br>')}</p>
                            </div>
                            <div class="custom-confirm-footer">
                                <button class="custom-confirm-btn cancel">å–æ¶ˆ</button>
                                <button class="custom-confirm-btn confirm">ç¡®å®š</button>
                            </div>
                        </div>
                    `;

                    // æ·»åŠ åˆ°é¡µé¢
                    document.body.appendChild(modal);

                    // ç»‘å®šäº‹ä»¶
                    const cancelBtn = modal.querySelector('.cancel');
                    const confirmBtn = modal.querySelector('.confirm');

                    const cleanup = () => {
                        document.body.removeChild(modal);
                    };

                    cancelBtn.onclick = () => {
                        // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
                        if (window.audioManager) {
                            audioManager.play('click');
                        }
                        cleanup();
                        resolve(false);
                    };

                    confirmBtn.onclick = () => {
                        // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
                        if (window.audioManager) {
                            audioManager.play('click');
                        }
                        cleanup();
                        resolve(true);
                    };

                    // ç‚¹å‡»èƒŒæ™¯å…³é—­
                    modal.onclick = (e) => {
                        if (e.target === modal) {
                            cleanup();
                            resolve(false);
                        }
                    };

                    // ESCé”®å…³é—­
                    const handleKeydown = (e) => {
                        if (e.key === 'Escape') {
                            cleanup();
                            resolve(false);
                            document.removeEventListener('keydown', handleKeydown);
                        }
                    };
                    document.addEventListener('keydown', handleKeydown);
                });
            }

            // ç¡®ä¿æ’ä»¶çŠ¶æ€æ­£ç¡®åŒæ­¥ï¼ˆè§£å†³çŠ¶æ€æ›´æ–°ä¸ç¨³å®šçš„é—®é¢˜ï¼‰
            async ensurePluginStatusSync(pluginName) {
                console.log(`å¼€å§‹åŒæ­¥æ’ä»¶çŠ¶æ€: ${pluginName}`);

                try {
                    // 1. å¼ºåˆ¶åˆ·æ–°å·²å®‰è£…æ’ä»¶åˆ—è¡¨
                    const response = await fetch(`${this.backendUrl}/nodes/installed?force_refresh=true&_t=${Date.now()}`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.status === 'success') {
                            // æ›´æ–°å‰ç«¯ç¼“å­˜
                            this.installedPlugins = data.nodes.map(node => ({
                                name: node.name,
                                version: node.version || 'æœªçŸ¥',
                                date: node.git_date || node.date || 'æœªçŸ¥',
                                enabled: node.enabled,
                                url: node.repo_url || `https://github.com/search?q=${node.name}`,
                                hasUpdate: node.hasUpdate || false
                            }));

                            console.log(`å·²æ›´æ–°å·²å®‰è£…æ’ä»¶åˆ—è¡¨ï¼Œå…± ${this.installedPlugins.length} ä¸ªæ’ä»¶`);
                        }
                    }

                    // 2. éªŒè¯ç›®æ ‡æ’ä»¶æ˜¯å¦åœ¨å·²å®‰è£…åˆ—è¡¨ä¸­
                    const isInstalled = this.isPluginInstalled(pluginName);
                    console.log(`æ’ä»¶ ${pluginName} å®‰è£…çŠ¶æ€æ£€æŸ¥: ${isInstalled}`);

                    // 3. å¦‚æœæ£€æµ‹åˆ°å·²å®‰è£…ï¼Œç«‹å³æ›´æ–°å¯¹åº”çš„æŒ‰é’®çŠ¶æ€
                    if (isInstalled) {
                        this.updatePluginButtonStatus(pluginName, true);
                    } else {
                        // å¦‚æœä»æœªæ£€æµ‹åˆ°ï¼Œç­‰å¾…ä¸€ä¸‹å†é‡è¯•
                        logger.debug(`æ’ä»¶ ${pluginName} çŠ¶æ€æ£€æµ‹å¤±è´¥ï¼Œ1ç§’åé‡è¯•...`);
                        await new Promise(resolve => setTimeout(resolve, 1000));

                        // é‡æ–°æ£€æŸ¥
                        const retryInstalled = this.isPluginInstalled(pluginName);
                        console.log(`æ’ä»¶ ${pluginName} é‡è¯•æ£€æŸ¥ç»“æœ: ${retryInstalled}`);

                        if (retryInstalled) {
                            this.updatePluginButtonStatus(pluginName, true);
                        }
                    }

                } catch (error) {
                    console.error('åŒæ­¥æ’ä»¶çŠ¶æ€æ—¶å‡ºé”™:', error);
                }
            }

            // æ›´æ–°ç‰¹å®šæ’ä»¶çš„æŒ‰é’®çŠ¶æ€
            updatePluginButtonStatus(pluginName, isInstalled) {
                try {
                    // æŸ¥æ‰¾æ’ä»¶æŒ‰é’®
                    const pluginButtons = document.querySelectorAll(`button[data-plugin-name="${pluginName}"]`);

                    pluginButtons.forEach(button => {
                        if (button.dataset.actionType === 'installAvailablePlugin') {
                            if (isInstalled) {
                                // æ›´æ–°ä¸ºå·²å®‰è£…çŠ¶æ€
                                button.textContent = 'å·²å®‰è£…';
                                button.className = 'plugin-action-btn installed';
                                button.disabled = true;
                                button.style.cursor = 'not-allowed';
                                console.log(`å·²æ›´æ–°æ’ä»¶ ${pluginName} æŒ‰é’®ä¸ºå·²å®‰è£…çŠ¶æ€`);
                            } else {
                                // æ›´æ–°ä¸ºå¯å®‰è£…çŠ¶æ€
                                button.innerHTML = '<i class="fas fa-download"></i> å®‰è£…';
                                button.className = 'plugin-action-btn install';
                                button.disabled = false;
                                button.style.cursor = 'pointer';
                                console.log(`å·²æ›´æ–°æ’ä»¶ ${pluginName} æŒ‰é’®ä¸ºå¯å®‰è£…çŠ¶æ€`);
                            }
                        }
                    });
                } catch (error) {
                    console.error('æ›´æ–°æ’ä»¶æŒ‰é’®çŠ¶æ€æ—¶å‡ºé”™:', error);
                }
            }

            // åŒæ­¥å¸è½½æ’ä»¶çš„çŠ¶æ€ï¼ˆç¡®ä¿å¯ç”¨æ’ä»¶åˆ—è¡¨ä¸­æ˜¾ç¤ºä¸ºå¯å®‰è£…çŠ¶æ€ï¼‰
            async syncUninstalledPluginStatus(pluginName) {
                console.log(`å¼€å§‹åŒæ­¥å¸è½½æ’ä»¶çŠ¶æ€: ${pluginName}`);

                try {
                    // 1. æ¸…é™¤æ’ä»¶ç¼“å­˜
                    this.clearAllPluginCaches();

                    // 2. å¼ºåˆ¶åˆ·æ–°å·²å®‰è£…æ’ä»¶åˆ—è¡¨ï¼ˆç¡®ä¿åç«¯æ•°æ®åŒæ­¥ï¼‰
                    const response = await fetch(`${this.backendUrl}/nodes/installed?force_refresh=true&_t=${Date.now()}`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.status === 'success') {
                            // æ›´æ–°å‰ç«¯ç¼“å­˜
                            this.installedPlugins = data.nodes.map(node => ({
                                name: node.name,
                                version: node.version || 'æœªçŸ¥',
                                date: node.git_date || node.date || 'æœªçŸ¥',
                                enabled: node.enabled,
                                url: node.repo_url || `https://github.com/search?q=${node.name}`,
                                hasUpdate: node.hasUpdate || false
                            }));

                            console.log(`å¸è½½åæ›´æ–°å·²å®‰è£…æ’ä»¶åˆ—è¡¨ï¼Œå…± ${this.installedPlugins.length} ä¸ªæ’ä»¶`);
                        }
                    }

                    // 3. éªŒè¯æ’ä»¶ç¡®å®å·²è¢«å¸è½½
                    const isStillInstalled = this.isPluginInstalled(pluginName);
                    console.log(`æ’ä»¶ ${pluginName} å¸è½½åçŠ¶æ€æ£€æŸ¥: ${isStillInstalled ? 'ä»å·²å®‰è£…' : 'å·²å¸è½½'}`);

                    // 4. å¦‚æœç¡®è®¤å·²å¸è½½ï¼Œæ›´æ–°å¯ç”¨æ’ä»¶åˆ—è¡¨ä¸­çš„æŒ‰é’®çŠ¶æ€
                    if (!isStillInstalled) {
                        this.updatePluginButtonStatus(pluginName, false);

                        // 5. å¦‚æœå½“å‰åœ¨å¯ç”¨æ’ä»¶æ ‡ç­¾é¡µï¼Œå¼ºåˆ¶é‡æ–°æ¸²æŸ“ä»¥ç¡®ä¿çŠ¶æ€æ­£ç¡®
                        if (this.currentPluginTab === 'available' && this.allAvailablePlugins) {
                            console.log('å½“å‰åœ¨å¯ç”¨æ’ä»¶é¡µé¢ï¼Œé‡æ–°æ¸²æŸ“æ’ä»¶åˆ—è¡¨');

                            // ä¿å­˜å½“å‰æœç´¢çŠ¶æ€
                            const searchInput = document.getElementById('plugin-search');
                            const currentSearchTerm = searchInput?.value || '';

                            // é‡æ–°æ¸²æŸ“
                            this.renderAvailablePlugins(this.allAvailablePlugins);

                            // å¦‚æœæœ‰æœç´¢è¯ï¼Œé‡æ–°åº”ç”¨æœç´¢
                            if (currentSearchTerm) {
                                searchInput.value = currentSearchTerm;
                                this.filterAvailablePlugins(currentSearchTerm);
                            }
                        }

                        console.log(`âœ… æ’ä»¶ ${pluginName} çŠ¶æ€å·²åŒæ­¥ä¸ºå¯å®‰è£…`);
                    } else {
                        console.log(`âš ï¸ æ’ä»¶ ${pluginName} å¸è½½åä»æ˜¾ç¤ºä¸ºå·²å®‰è£…ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨æ£€æŸ¥`);
                    }

                } catch (error) {
                    console.error('åŒæ­¥å¸è½½æ’ä»¶çŠ¶æ€æ—¶å‡ºé”™:', error);
                }
            }

            // åŒæ­¥å·²å®‰è£…æ’ä»¶é¡µé¢æ˜¾ç¤ºï¼ˆç¡®ä¿æ–°å®‰è£…çš„æ’ä»¶èƒ½åœ¨å·²å®‰è£…é¡µé¢æ˜¾ç¤ºï¼‰
            async syncInstalledPluginDisplay(pluginName) {
                console.log(`å¼€å§‹åŒæ­¥å·²å®‰è£…æ’ä»¶é¡µé¢æ˜¾ç¤º: ${pluginName}`);

                try {
                    // 1. éªŒè¯æ’ä»¶ç¡®å®åœ¨å·²å®‰è£…åˆ—è¡¨ä¸­
                    const isInstalled = this.isPluginInstalled(pluginName);
                    console.log(`æ’ä»¶ ${pluginName} åœ¨å·²å®‰è£…åˆ—è¡¨ä¸­: ${isInstalled}`);

                    if (!isInstalled) {
                        console.log(`âš ï¸ æ’ä»¶ ${pluginName} æœªåœ¨å·²å®‰è£…åˆ—è¡¨ä¸­æ‰¾åˆ°ï¼Œå°è¯•é‡æ–°åŠ è½½...`);

                        // å¼ºåˆ¶é‡æ–°åŠ è½½å·²å®‰è£…æ’ä»¶æ•°æ®
                        await this.loadInstalledPlugins();

                        // å†æ¬¡éªŒè¯
                        const retryInstalled = this.isPluginInstalled(pluginName);
                        console.log(`é‡æ–°åŠ è½½åæ’ä»¶ ${pluginName} çŠ¶æ€: ${retryInstalled}`);
                    }

                    // 2. å¦‚æœå½“å‰ä¸åœ¨å·²å®‰è£…æ’ä»¶é¡µé¢ï¼Œæ ‡è®°éœ€è¦åˆ·æ–°
                    if (this.currentPluginTab !== 'installed') {
                        // è®¾ç½®æ ‡è®°ï¼Œå½“ç”¨æˆ·åˆ‡æ¢åˆ°å·²å®‰è£…é¡µé¢æ—¶ä¼šè‡ªåŠ¨åˆ·æ–°
                        this.needRefreshInstalledTab = true;
                        console.log('å·²è®¾ç½®å·²å®‰è£…é¡µé¢åˆ·æ–°æ ‡è®°');
                    } else {
                        // 3. å¦‚æœå½“å‰å°±åœ¨å·²å®‰è£…æ’ä»¶é¡µé¢ï¼Œç«‹å³åˆ·æ–°æ˜¾ç¤º
                        console.log('å½“å‰åœ¨å·²å®‰è£…æ’ä»¶é¡µé¢ï¼Œç«‹å³åˆ·æ–°æ˜¾ç¤º');
                        this.renderInstalledPlugins(this.installedPlugins);

                        // å°è¯•æ»šåŠ¨åˆ°æ–°å®‰è£…çš„æ’ä»¶
                        await this.scrollToInstalledPluginInList(pluginName);
                    }

                } catch (error) {
                    console.error('åŒæ­¥å·²å®‰è£…æ’ä»¶é¡µé¢æ˜¾ç¤ºæ—¶å‡ºé”™:', error);
                }
            }

            // åœ¨å·²å®‰è£…æ’ä»¶åˆ—è¡¨ä¸­æ»šåŠ¨åˆ°æŒ‡å®šæ’ä»¶
            async scrollToInstalledPluginInList(pluginName) {
                try {
                    // ç­‰å¾…DOMæ›´æ–°
                    await new Promise(resolve => setTimeout(resolve, 500));

                    // æŸ¥æ‰¾æ’ä»¶å…ƒç´ 
                    const pluginElements = document.querySelectorAll('.installed-plugin-item');
                    let targetElement = null;

                    for (const element of pluginElements) {
                        const nameElement = element.querySelector('.plugin-name');
                        if (nameElement && nameElement.textContent.includes(pluginName)) {
                            targetElement = element;
                            break;
                        }
                    }

                    if (targetElement) {
                        // æ»šåŠ¨åˆ°æ’ä»¶ä½ç½®å¹¶é«˜äº®æ˜¾ç¤º
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });

                        // æ·»åŠ ä¸´æ—¶é«˜äº®æ•ˆæœ
                        targetElement.style.transition = 'all 0.3s ease';
                        targetElement.style.boxShadow = '0 0 20px rgba(0, 245, 255, 0.6)';
                        targetElement.style.transform = 'scale(1.02)';

                        // 3ç§’åç§»é™¤é«˜äº®æ•ˆæœ
                        setTimeout(() => {
                            targetElement.style.boxShadow = '';
                            targetElement.style.transform = '';
                        }, 3000);

                        console.log(`å·²åœ¨å·²å®‰è£…åˆ—è¡¨ä¸­æ»šåŠ¨åˆ°æ’ä»¶ ${pluginName} å¹¶æ·»åŠ é«˜äº®æ•ˆæœ`);
                    } else {
                        console.log(`æœªåœ¨å·²å®‰è£…åˆ—è¡¨ä¸­æ‰¾åˆ°æ’ä»¶ ${pluginName} çš„DOMå…ƒç´ `);
                    }
                } catch (error) {
                    console.error('æ»šåŠ¨åˆ°å·²å®‰è£…æ’ä»¶ä½ç½®æ—¶å‡ºé”™:', error);
                }
            }

            // æ¢å¤æ’ä»¶æµè§ˆçŠ¶æ€ï¼ˆå®‰è£…å®Œæˆåä¿æŒç”¨æˆ·çš„æœç´¢å’Œæµè§ˆä½ç½®ï¼‰
            async restorePluginBrowsingState(searchTerm, scrollPosition, installedPluginName) {
                console.log(`æ¢å¤æµè§ˆçŠ¶æ€ - æœç´¢è¯: "${searchTerm}", æ»šåŠ¨ä½ç½®: ${scrollPosition}, å·²å®‰è£…æ’ä»¶: ${installedPluginName}`);

                try {
                    // æ¢å¤æœç´¢æ¡†å†…å®¹
                    const searchInput = document.getElementById('plugin-search');
                    if (searchInput && searchTerm) {
                        searchInput.value = searchTerm;
                        console.log(`å·²æ¢å¤æœç´¢æ¡†å†…å®¹: "${searchTerm}"`);
                    }

                    // å¦‚æœæœ‰æœç´¢è¯ï¼Œé‡æ–°æ‰§è¡Œæœç´¢è¿‡æ»¤
                    if (searchTerm && searchTerm.trim() !== '') {
                        this.filterAvailablePlugins(searchTerm);
                        console.log(`å·²é‡æ–°æ‰§è¡Œæœç´¢è¿‡æ»¤: "${searchTerm}"`);
                    }

                    // ç­‰å¾…DOMæ›´æ–°å®Œæˆ
                    await new Promise(resolve => setTimeout(resolve, 300));

                    // æ¢å¤æ»šåŠ¨ä½ç½®
                    const pluginList = document.getElementById('available-plugin-list');
                    if (pluginList && scrollPosition > 0) {
                        pluginList.scrollTop = scrollPosition;
                        console.log(`å·²æ¢å¤æ»šåŠ¨ä½ç½®: ${scrollPosition}`);
                    }

                    // å¦‚æœæ²¡æœ‰æœç´¢è¯ï¼Œå°è¯•æ»šåŠ¨åˆ°åˆšå®‰è£…çš„æ’ä»¶ä½ç½®
                    if ((!searchTerm || searchTerm.trim() === '') && installedPluginName) {
                        await this.scrollToInstalledPlugin(installedPluginName);
                    }

                } catch (error) {
                    console.error('æ¢å¤æµè§ˆçŠ¶æ€æ—¶å‡ºé”™:', error);
                }
            }

            // æ»šåŠ¨åˆ°åˆšå®‰è£…çš„æ’ä»¶ä½ç½®
            async scrollToInstalledPlugin(pluginName) {
                try {
                    // ç­‰å¾…ä¸€ä¸‹ç¡®ä¿DOMå®Œå…¨æ¸²æŸ“
                    await new Promise(resolve => setTimeout(resolve, 500));

                    // æŸ¥æ‰¾æ’ä»¶å…ƒç´ ï¼ˆç°åœ¨åº”è¯¥æ˜¾ç¤ºä¸º"å·²å®‰è£…"çŠ¶æ€ï¼‰
                    const pluginElements = document.querySelectorAll('.plugin-card');
                    let targetElement = null;

                    for (const element of pluginElements) {
                        const nameElement = element.querySelector('.plugin-name');
                        if (nameElement && nameElement.textContent.includes(pluginName)) {
                            targetElement = element;
                            break;
                        }
                    }

                    if (targetElement) {
                        // æ»šåŠ¨åˆ°æ’ä»¶ä½ç½®å¹¶é«˜äº®æ˜¾ç¤º
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });

                        // æ·»åŠ ä¸´æ—¶é«˜äº®æ•ˆæœ
                        targetElement.style.transition = 'all 0.3s ease';
                        targetElement.style.boxShadow = '0 0 20px rgba(0, 245, 255, 0.6)';
                        targetElement.style.transform = 'scale(1.02)';

                        // 3ç§’åç§»é™¤é«˜äº®æ•ˆæœ
                        setTimeout(() => {
                            targetElement.style.boxShadow = '';
                            targetElement.style.transform = '';
                        }, 3000);

                        console.log(`å·²æ»šåŠ¨åˆ°æ’ä»¶ ${pluginName} å¹¶æ·»åŠ é«˜äº®æ•ˆæœ`);
                    } else {
                        console.log(`æœªæ‰¾åˆ°æ’ä»¶ ${pluginName} çš„DOMå…ƒç´ `);
                    }
                } catch (error) {
                    console.error('æ»šåŠ¨åˆ°æ’ä»¶ä½ç½®æ—¶å‡ºé”™:', error);
                }
            }

            // æœç´¢å’Œè¿‡æ»¤åŠŸèƒ½ï¼ˆæ™ºèƒ½æœç´¢+æ’åºï¼‰
            filterAvailablePlugins(searchTerm) {
                if (!this.allAvailablePlugins) return;

                if (!searchTerm || searchTerm.trim() === '') {
                    // å¦‚æœæœç´¢è¯ä¸ºç©ºï¼Œæ˜¾ç¤ºæ‰€æœ‰æ’ä»¶ï¼ˆæŒ‰staræ•°æ’åºï¼‰
                    this.availablePlugins = [...this.allAvailablePlugins];
                    this.sortPluginsByStars(this.availablePlugins);
                    this.renderAvailablePlugins(this.availablePlugins);
                    return;
                }

                const searchText = searchTerm.toLowerCase().trim();

                const filtered = this.allAvailablePlugins.filter(plugin => {
                    // æ’ä»¶åç§°åŒ¹é…ï¼ˆæ”¯æŒéƒ¨åˆ†åŒ¹é…ï¼‰
                    const nameMatch = plugin.name.toLowerCase().includes(searchText);

                    // ä½œè€…åŒ¹é…
                    const authorMatch = plugin.author.toLowerCase().includes(searchText);

                    // æè¿°åŒ¹é…
                    const descMatch = plugin.description.toLowerCase().includes(searchText);

                    // åˆ†ç±»åŒ¹é…
                    const categoryMatch = this.getCategoryDisplayName(plugin.category).toLowerCase().includes(searchText);

                    // æ”¯æŒè¿å­—ç¬¦å’Œä¸‹åˆ’çº¿çš„æ¨¡ç³ŠåŒ¹é…
                    const normalizedPluginName = plugin.name.toLowerCase().replace(/[-_]/g, '');
                    const normalizedSearchText = searchText.replace(/[-_]/g, '');
                    const fuzzyNameMatch = normalizedPluginName.includes(normalizedSearchText);

                    return nameMatch || authorMatch || descMatch || categoryMatch || fuzzyNameMatch;
                });

                // æŒ‰ç›¸ä¼¼æ€§å’Œstaræ•°æ’åº
                this.sortPluginsByRelevanceAndStars(filtered, searchText);

                console.log(`Search "${searchTerm}": ${filtered.length} results from ${this.allAvailablePlugins.length} total plugins`);

                this.availablePlugins = filtered;
                this.renderAvailablePlugins(filtered);
            }

            // è®¡ç®—æœç´¢ç›¸ä¼¼æ€§å¾—åˆ†
            calculateRelevanceScore(plugin, searchText) {
                const pluginName = plugin.name.toLowerCase();
                const searchLower = searchText.toLowerCase();

                // ç²¾ç¡®åŒ¹é…å¾—åˆ†æœ€é«˜
                if (pluginName === searchLower) return 100;

                // å¼€å¤´åŒ¹é…å¾—åˆ†è¾ƒé«˜
                if (pluginName.startsWith(searchLower)) return 90;

                // åŒ…å«å®Œæ•´æœç´¢è¯
                if (pluginName.includes(searchLower)) return 80;

                // æ¨¡ç³ŠåŒ¹é…ï¼ˆå»é™¤åˆ†éš”ç¬¦ï¼‰
                const normalizedName = pluginName.replace(/[-_\s]/g, '');
                const normalizedSearch = searchLower.replace(/[-_\s]/g, '');
                if (normalizedName.includes(normalizedSearch)) return 70;

                // ä½œè€…åŒ¹é…
                if (plugin.author.toLowerCase().includes(searchLower)) return 60;

                // æè¿°åŒ¹é…
                if (plugin.description.toLowerCase().includes(searchLower)) return 50;

                // åˆ†ç±»åŒ¹é…
                if (this.getCategoryDisplayName(plugin.category).toLowerCase().includes(searchLower)) return 40;

                return 0;
            }

            // æŒ‰ç›¸ä¼¼æ€§å’Œstaræ•°æ’åº
            sortPluginsByRelevanceAndStars(plugins, searchText) {
                plugins.sort((a, b) => {
                    const scoreA = this.calculateRelevanceScore(a, searchText);
                    const scoreB = this.calculateRelevanceScore(b, searchText);

                    // é¦–å…ˆæŒ‰ç›¸ä¼¼æ€§æ’åº
                    if (scoreA !== scoreB) {
                        return scoreB - scoreA;
                    }

                    // ç›¸ä¼¼æ€§ç›¸åŒæ—¶æŒ‰staræ•°æ’åº
                    if (a.stars !== b.stars) {
                        return b.stars - a.stars;
                    }

                    // staræ•°ä¹Ÿç›¸åŒæ—¶æŒ‰åç§°æ’åº
                    return a.name.localeCompare(b.name);
                });
            }

            // æŒ‰staræ•°æ’åº
            sortPluginsByStars(plugins) {
                plugins.sort((a, b) => {
                    // é¦–å…ˆæŒ‰staræ•°æ’åºï¼ˆé™åºï¼‰
                    if (a.stars !== b.stars) {
                        return b.stars - a.stars;
                    }

                    // staræ•°ç›¸åŒæ—¶æŒ‰åç§°æ’åº
                    return a.name.localeCompare(b.name);
                });
            }

            filterPluginsByCategory(category) {
                if (!this.allAvailablePlugins) return;

                let filtered;
                if (category) {
                    filtered = this.allAvailablePlugins.filter(plugin => plugin.category === category);
                    console.log(`Category filter "${category}": ${filtered.length} results from ${this.allAvailablePlugins.length} total plugins`);
                } else {
                    filtered = [...this.allAvailablePlugins];
                    console.log(`Showing all plugins: ${filtered.length} total`);
                }

                // æŒ‰staræ•°æ’åº
                this.sortPluginsByStars(filtered);

                this.availablePlugins = filtered;
                this.renderAvailablePlugins(filtered);

                // æ¸…é™¤æœç´¢æ¡†
                const searchInput = document.getElementById('plugin-search');
                if (searchInput) {
                    searchInput.value = '';
                }
            }



            async updatePlugin(pluginName) {
                try {
                    console.log('Updating plugin:', pluginName);

                    // è®¾ç½®æ›´æ–°æŒ‰é’®ä¸ºåŠ è½½çŠ¶æ€
                    this.setPluginButtonLoading(pluginName, 'updatePlugin', true, {
                        loadingText: 'æ›´æ–°ä¸­'
                    });

                    // æ˜¾ç¤ºè‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
                    const confirmed = await this.showCustomConfirm(
                        'ç¡®è®¤æ›´æ–°æ’ä»¶',
                        `ç¡®å®šè¦æ›´æ–°æ’ä»¶ "${pluginName}" åˆ°æœ€æ–°ç‰ˆæœ¬å—ï¼Ÿ\n\nè¿™å°†ä»è¿œç¨‹ä»“åº“æ‹‰å–æœ€æ–°ä»£ç ã€‚`
                    );
                    if (!confirmed) {
                        // å–æ¶ˆåŠ è½½çŠ¶æ€
                        this.setPluginButtonLoading(pluginName, 'updatePlugin', false);
                        return;
                    }

                    this.showNotification(`æ­£åœ¨æ›´æ–°æ’ä»¶ ${pluginName}...`, 'info');

                    // è°ƒç”¨çœŸå®çš„æ›´æ–°API
                    const response = await fetch(`${this.backendUrl}/api/plugins/update`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ plugin_name: pluginName })
                    });

                    if (response.ok) {
                        const result = await response.json();

                        if (result.status === 'success') {
                            // æ¸…é™¤ç‰¹å®šæ’ä»¶çš„ç‰ˆæœ¬ç¼“å­˜
                            this.clearPluginVersionCache(pluginName);

                            // æ ‡è®°è¯¥æ’ä»¶åˆšåˆšæ›´æ–°è¿‡ï¼Œä¸‹æ¬¡æ‰“å¼€ç‰ˆæœ¬å¼¹çª—æ—¶éœ€è¦å¼ºåˆ¶åˆ·æ–°
                            if (!this.recentlyUpdatedPlugins) {
                                this.recentlyUpdatedPlugins = new Set();
                            }
                            this.recentlyUpdatedPlugins.add(pluginName);

                            // ç­‰å¾…ä¸€ä¸‹ç¡®ä¿åç«¯ç¼“å­˜å·²æ¸…é™¤
                            await new Promise(resolve => setTimeout(resolve, 800));

                            // å¼ºåˆ¶æ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°æ’ä»¶åˆ—è¡¨
                            await this.refreshPluginListAndScrollToPlugin(pluginName);

                            const updateMessage = result.updated ?
                                `æ’ä»¶ ${pluginName} æ›´æ–°æˆåŠŸï¼` :
                                `æ’ä»¶ ${pluginName} å·²ç»æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚`;

                            // æ£€æŸ¥ComfyUIè¿è¡ŒçŠ¶æ€
                            const comfyuiRunning = await this.checkComfyUIStatus();
                            const restartMessage = comfyuiRunning ? ' è¯·é‡å¯ComfyUIä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚' : '';

                            this.showNotification(`âœ… ${updateMessage}${restartMessage}`, 'success');
                        } else {
                            this.showNotification(`âŒ æ›´æ–°å¤±è´¥ï¼š${result.message}`, 'error');
                        }
                    } else {
                        throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                    }

                } catch (error) {
                    console.error('Update plugin failed:', error);
                    this.showNotification(`âŒ æ’ä»¶æ›´æ–°å¤±è´¥: ${error.message}`, 'error');
                } finally {
                    // æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½è¦æ¸…é™¤åŠ è½½çŠ¶æ€
                    this.setPluginButtonLoading(pluginName, 'updatePlugin', false);
                }
            }

            async showPluginVersions(pluginName) {
                this.currentVersionSwitchPlugin = pluginName;
                logger.info('Showing versions for plugin:', pluginName);

                const modal = document.getElementById('version-switch-modal');
                logger.debug('Modal element found:', !!modal);

                if (!modal) {
                    logger.error('Version switch modal not found!');
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    this.setPluginButtonLoading(pluginName, 'showPluginVersions', false);
                    return;
                }

                // æ›´æ–°å¼¹çª—æ ‡é¢˜
                const header = modal.querySelector('.version-switch-header h3');
                if (header) {
                    header.innerHTML = `<i class="fas fa-code-branch"></i> é€‰æ‹© ${pluginName} çš„ç‰ˆæœ¬`;
                }

                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                const container = document.getElementById('version-switch-list');
                if (container) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #ccc;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                            <div>æ­£åœ¨è·å–ç‰ˆæœ¬ä¿¡æ¯...</div>
                        </div>
                    `;
                }

                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                modal.style.display = 'flex';
                modal.classList.add('show');
                console.log('Modal display and show class applied');

                try {
                    // æ£€æŸ¥æ˜¯å¦éœ€è¦å¼ºåˆ¶åˆ·æ–°ç‰ˆæœ¬ä¿¡æ¯
                    // å¦‚æœæ’ä»¶åˆšåˆšæ›´æ–°è¿‡ï¼Œéœ€è¦å¼ºåˆ¶åˆ·æ–°ä»¥è·å–æœ€æ–°çš„å½“å‰ç‰ˆæœ¬ä¿¡æ¯
                    const forceRefresh = this.recentlyUpdatedPlugins && this.recentlyUpdatedPlugins.has(pluginName);
                    if (forceRefresh) {
                        console.log(`Force refreshing version info for recently updated plugin: ${pluginName}`);
                        this.recentlyUpdatedPlugins.delete(pluginName); // æ¸…é™¤æ ‡è®°
                    }

                    // å¼‚æ­¥è·å–ç‰ˆæœ¬å†å²
                    const versions = await this.generatePluginVersions(pluginName, forceRefresh);

                    // æ¸²æŸ“ç‰ˆæœ¬åˆ—è¡¨
                    this.renderPluginVersions(pluginName, versions);
                } catch (error) {
                    console.error('Error loading plugin versions:', error);
                    if (container) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: #dc3545;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 24px; margin-bottom: 10px;"></i>
                                <div>è·å–ç‰ˆæœ¬ä¿¡æ¯å¤±è´¥</div>
                                <div style="font-size: 12px; margin-top: 10px;">${error.message}</div>
                            </div>
                        `;
                    }
                }
            }

            renderPluginVersions(pluginName, versions) {
                const container = document.getElementById('version-switch-list');
                if (!container) {
                    console.error('Version switch list container not found!');
                    return;
                }

                // æ·»åŠ è°ƒè¯•ä¿¡æ¯
                console.log('Version data for', pluginName, ':', versions);

                const html = versions.map((version, index) => {
                    // è°ƒè¯•æ¯ä¸ªç‰ˆæœ¬çš„currentå±æ€§
                    console.log(`Version ${index}: ${version.commit}, current: ${version.current}`);

                    // å½“å‰ç‰ˆæœ¬æ ‡ç­¾ï¼ˆä¸ä½¿ç”¨èƒŒæ™¯é«˜äº®ï¼‰
                    const currentBadge = version.current ? '<span style="color: #28a745; font-size: 11px; margin-left: 8px; font-weight: bold;">âœ“ å½“å‰</span>' : '';

                    // åˆ¤æ–­æ˜¯å¦æ˜¯æ›´æ–°ç‰ˆæœ¬ï¼ˆåœ¨å½“å‰ç‰ˆæœ¬ä¹‹å‰çš„ç‰ˆæœ¬ï¼‰
                    const currentIndex = versions.findIndex(v => v.current);
                    const isNewer = currentIndex > -1 && index < currentIndex;
                    const newerBadge = isNewer ? '<span style="color: #ff6b35; font-size: 11px; margin-left: 8px;">ğŸ”¥ æ›´æ–°</span>' : '';

                    // æœ€æ–°ç‰ˆæœ¬æ ‡è®°ï¼ˆç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸”ä¸æ˜¯å½“å‰ç‰ˆæœ¬ï¼‰
                    const isLatest = index === 0 && !version.current;
                    const latestBadge = isLatest ? '<span style="color: #00f5ff; font-size: 11px; margin-left: 8px; font-weight: bold; text-shadow: 0 0 3px rgba(0, 245, 255, 0.5);">â­ æœ€æ–°</span>' : '';

                    // ç‰ˆæœ¬ç±»å‹æ ‡è¯†
                    const typeIcon = {
                        'tag': 'ğŸ·ï¸',
                        'branch': 'ğŸŒ¿',
                        'remote_branch': 'ğŸŒ',
                        'commit': 'ğŸ“'
                    };
                    const typeLabel = typeIcon[version.type] || 'ğŸ“';

                    return `
                        <div class="version-item ${isNewer ? 'newer' : ''}" data-version="${version.version}" style="background: ${version.current ? 'rgba(40, 167, 69, 0.1)' : 'rgba(255,255,255,0.05)'}; border-left: ${version.current ? '3px solid #28a745' : '3px solid transparent'}; padding: 15px; margin: 0; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
                            <div class="version-info" style="flex: 1;">
                                <div class="version-number" style="color: #fff; font-size: 14px; margin-bottom: 5px;">
                                    ${typeLabel} ${version.version}${currentBadge}${latestBadge}${newerBadge}
                                </div>
                                <div class="version-date" style="color: #ccc; font-size: 12px;">${version.date}</div>
                                <div class="version-description" style="color: #aaa; font-size: 11px; margin-top: 4px;">
                                    ${version.description || `${version.type}: ${version.message || 'æ— æè¿°'}`}
                                </div>
                            </div>
                            <button class="version-switch-btn ${version.current ? 'current' : ''} ${isNewer ? 'newer' : ''}"
                                    onclick="if(window.audioManager) audioManager.play('click'); switchPluginVersion('${version.version}')"
                                    ${version.current ? 'disabled' : ''}
                                    style="min-width: 100px; padding: 8px 16px; border: none; border-radius: 4px; cursor: ${version.current ? 'not-allowed' : 'pointer'}; background: ${version.current ? '#6c757d' : (isNewer ? '#28a745' : '#007bff')}; color: white; font-size: 12px; margin-left: 15px;">
                                <i class="fas fa-${version.current ? 'check' : (isNewer ? 'arrow-up' : 'download')}"></i>
                                ${version.current ? 'å½“å‰ç‰ˆæœ¬' : (isNewer ? 'å‡çº§' : 'åˆ‡æ¢')}
                            </button>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;

                // è·å–æ¨¡æ€æ¡†å¹¶æ˜¾ç¤º
                const modal = document.getElementById('version-switch-modal');
                if (modal) {
                    modal.classList.add('show');
                    modal.style.display = 'flex';
                    logger.info('Modal shown');

                    // æ¢å¤åˆ‡æ¢æŒ‰é’®çŠ¶æ€
                    this.setPluginButtonLoading(pluginName, 'showPluginVersions', false);
                } else {
                    logger.error('Modal not found!');
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    this.setPluginButtonLoading(pluginName, 'showPluginVersions', false);
                }
            }

            async generatePluginVersions(pluginName, forceRefresh = false) {
                try {
                    // å°è¯•è·å–çœŸå®çš„æ’ä»¶ç‰ˆæœ¬ä¿¡æ¯
                    const realVersions = await this.fetchPluginVersions(pluginName, forceRefresh);
                    if (realVersions && realVersions.length > 0) {
                        // ç›´æ¥è¿”å›åç«¯è¿”å›çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¿¡ä»»åç«¯çš„currentå­—æ®µåˆ¤æ–­
                        // åç«¯é€šè¿‡Git commit hashç²¾ç¡®æ¯”è¾ƒæ¥ç¡®å®šå½“å‰ç‰ˆæœ¬ï¼Œæ¯”å‰ç«¯çš„åˆ¤æ–­æ›´å‡†ç¡®
                        console.log('Using real version data from backend, current version indicators:',
                            realVersions.filter(v => v.current).map(v => v.version));

                        // å¦‚æœåç«¯æ²¡æœ‰æ ‡è®°ä»»ä½•ç‰ˆæœ¬ä¸ºå½“å‰ç‰ˆæœ¬ï¼Œæ‰è®¾ç½®ç¬¬ä¸€ä¸ªä¸ºå½“å‰ç‰ˆæœ¬
                        if (!realVersions.some(v => v.current)) {
                            console.warn('Backend did not mark any version as current, defaulting to first version');
                            realVersions[0].current = true;
                        }

                        return realVersions;
                    }
                } catch (error) {
                    console.warn('Failed to fetch real plugin versions, using fallback:', error);
                }

                // å¦‚æœè·å–çœŸå®ç‰ˆæœ¬å¤±è´¥ï¼Œä½¿ç”¨æ”¹è¿›çš„æ¨¡æ‹Ÿæ•°æ®
                const fallbackVersions = this.generateFallbackVersions(pluginName);

                // å¯¹äºfallbackæ•°æ®ï¼Œè®¾ç½®ç¬¬ä¸€ä¸ªä¸ºå½“å‰ç‰ˆæœ¬
                fallbackVersions.forEach(v => {
                    v.current = false;
                });
                fallbackVersions[0].current = true;

                return fallbackVersions;
            }

            async fetchPluginVersions(pluginName, forceRefresh = false) {
                try {
                    // è°ƒç”¨åç«¯APIè·å–æ’ä»¶çš„Gitç‰ˆæœ¬å†å²
                    const url = `${this.backendUrl}/plugins/${encodeURIComponent(pluginName)}/versions`;
                    const params = new URLSearchParams();
                    if (forceRefresh) {
                        params.append('force_refresh', 'true');
                    }
                    params.append('_t', Date.now().toString());

                    const response = await fetch(`${url}?${params}`, {
                        headers: forceRefresh ? {
                            'Cache-Control': 'no-cache, no-store, must-revalidate',
                            'Pragma': 'no-cache',
                            'Expires': '0'
                        } : {}
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.status === 'success') {
                            // æ£€æŸ¥versionsæ˜¯å¦å­˜åœ¨ä¸”æ˜¯æ•°ç»„
                            if (data.versions && Array.isArray(data.versions)) {
                                // è½¬æ¢APIè¿”å›çš„æ•°æ®æ ¼å¼ä¸ºå‰ç«¯éœ€è¦çš„æ ¼å¼
                                return data.versions.map(v => ({
                                    version: v.version,
                                    date: v.date,
                                    current: v.current,
                                    description: `${v.type}: ${v.message} (${v.author})`,
                                    commit: v.commit,
                                    type: v.type,
                                    author: v.author,
                                    message: v.message
                                }));
                            } else {
                                console.error('API returned invalid versions data:', data);
                                return null;
                            }
                        } else {
                            console.error('API error:', data.message);
                            return null;
                        }
                    } else {
                        console.error('HTTP error:', response.status);
                        return null;
                    }
                } catch (error) {
                    console.error('Error fetching plugin versions:', error);
                    return null;
                }
            }

            generateFallbackVersions(pluginName) {
                // æ”¹è¿›çš„æ¨¡æ‹Ÿæ•°æ®ï¼Œæ›´æ¥è¿‘çœŸå®æƒ…å†µ
                const today = new Date();
                const formatDate = (daysAgo) => {
                    const date = new Date(today);
                    date.setDate(date.getDate() - daysAgo);
                    return date.toISOString().split('T')[0];
                };

                // ä¸ºä¸åŒæ’ä»¶ç”Ÿæˆæ›´çœŸå®çš„ç‰ˆæœ¬å·
                if (pluginName.includes('comfyui-manager')) {
                    return [
                        { version: "main", date: formatDate(0), current: false, description: "ä¸»åˆ†æ”¯ (æœ€æ–°å¼€å‘ç‰ˆ)" },
                        { version: "v0.51.0", date: formatDate(7), current: false, description: "ç¨³å®šç‰ˆæœ¬" },
                        { version: "v0.50.2", date: formatDate(14), current: false, description: "ä¿®å¤ç‰ˆæœ¬" },
                        { version: "v0.50.0", date: formatDate(21), current: false, description: "é‡å¤§æ›´æ–°" },
                        { version: "v0.49.5", date: formatDate(35), current: false, description: "åŠŸèƒ½å¢å¼º" }
                    ];
                } else if (pluginName.includes('Easy-Use')) {
                    return [
                        { version: "main", date: formatDate(0), current: false, description: "ä¸»åˆ†æ”¯ (æœ€æ–°å¼€å‘ç‰ˆ)" },
                        { version: "v3.2.1", date: formatDate(5), current: false, description: "ç¨³å®šç‰ˆæœ¬" },
                        { version: "v3.2.0", date: formatDate(12), current: false, description: "æ–°åŠŸèƒ½" },
                        { version: "v3.1.8", date: formatDate(20), current: false, description: "ä¼˜åŒ–ç‰ˆæœ¬" },
                        { version: "v3.1.5", date: formatDate(28), current: false, description: "ä¿®å¤ç‰ˆæœ¬" }
                    ];
                } else {
                    return [
                        { version: "main", date: formatDate(0), current: false, description: "ä¸»åˆ†æ”¯ (æœ€æ–°å¼€å‘ç‰ˆ)" },
                        { version: "latest-stable", date: formatDate(3), current: false, description: "æœ€æ–°ç¨³å®šç‰ˆ" },
                        { version: "v1.0.0", date: formatDate(10), current: false, description: "æ­£å¼ç‰ˆæœ¬" },
                        { version: "beta", date: formatDate(15), current: false, description: "æµ‹è¯•ç‰ˆæœ¬" },
                        { version: "legacy", date: formatDate(30), current: false, description: "å†å²ç‰ˆæœ¬" }
                    ];
                }
            }

            getCurrentPluginVersion(pluginName) {
                // åˆå§‹åŒ–ç‰ˆæœ¬çŠ¶æ€å­˜å‚¨
                if (!this.pluginVersionStates) {
                    this.pluginVersionStates = {};
                }

                // å¦‚æœæœ‰å­˜å‚¨çš„ç‰ˆæœ¬çŠ¶æ€ï¼Œè¿”å›å®ƒ
                if (this.pluginVersionStates[pluginName]) {
                    return this.pluginVersionStates[pluginName];
                }

                // å¦åˆ™è¿”å›é»˜è®¤çš„å½“å‰ç‰ˆæœ¬ï¼ˆç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼‰
                if (pluginName.includes('comfyui-manager')) {
                    return "latest";
                } else if (pluginName.includes('Easy-Use')) {
                    return "latest";
                } else {
                    return "latest";
                }
            }

            async refreshPluginList() {
                try {
                    console.log('Refreshing plugin list...');

                    // ä¿å­˜å½“å‰æ»šåŠ¨ä½ç½®
                    const mainContent = document.querySelector('.main-content');
                    const scrollTop = mainContent ? mainContent.scrollTop : 0;
                    console.log('Saving scroll position:', scrollTop);

                    // é‡æ–°è·å–æ’ä»¶åˆ—è¡¨
                    const response = await fetch(`${this.backendUrl}/nodes/installed`);
                    if (response.ok) {
                        const data = await response.json();

                        // å¤„ç†æ’ä»¶æ•°æ®ï¼Œç¡®ä¿çŠ¶æ€æ ¼å¼æ­£ç¡®
                        const plugins = (data.nodes || []).map(plugin => ({
                            ...plugin,
                            enabled: plugin.status === 'enabled' // ç»Ÿä¸€è½¬æ¢ä¸ºå¸ƒå°”å€¼
                        }));

                        // æ›´æ–°æ’ä»¶æ•°æ®
                        this.installedPlugins = plugins;

                        // é‡æ–°æ¸²æŸ“æ’ä»¶åˆ—è¡¨
                        this.renderInstalledPlugins(this.installedPlugins);

                        // æ¢å¤æ»šåŠ¨ä½ç½®
                        setTimeout(() => {
                            if (mainContent) {
                                mainContent.scrollTop = scrollTop;
                                console.log('Restored scroll position:', scrollTop);
                            }
                        }, 100); // ç¨å¾®å»¶è¿Ÿä»¥ç¡®ä¿DOMæ›´æ–°å®Œæˆ

                        console.log('Plugin list refreshed successfully, plugins:', plugins.length);
                        console.log('Plugin statuses:', plugins.map(p => ({ name: p.name, enabled: p.enabled, status: p.status })));
                    } else {
                        console.error('Failed to refresh plugin list:', response.status);
                    }
                } catch (error) {
                    console.error('Error refreshing plugin list:', error);
                }
            }

            // å½»åº•æ¸…é™¤æ‰€æœ‰æ’ä»¶ç›¸å…³ç¼“å­˜
            clearAllPluginCaches() {
                console.log('Clearing all plugin caches...');

                // æ¸…é™¤å‰ç«¯ç¼“å­˜
                if (this.cache) {
                    const pluginCacheKeys = [
                        'installed_plugins',
                        'plugin_list',
                        'nodes_installed',
                        'plugin_data'
                    ];

                    pluginCacheKeys.forEach(key => {
                        if (this.cache.has(key)) {
                            this.cache.delete(key);
                            console.log(`Cleared cache: ${key}`);
                        }
                    });
                }

                // æ¸…é™¤å®ä¾‹å˜é‡ç¼“å­˜
                this.installedPlugins = null;
                this.pluginListCache = null;
                this.lastPluginUpdate = 0;
                this.pluginCacheTime = 0; // å¼ºåˆ¶é‡æ–°è·å–æ’ä»¶æ•°æ®

                console.log('All plugin caches cleared');
            }

            // æ¸…é™¤ç‰¹å®šæ’ä»¶çš„ç‰ˆæœ¬ç¼“å­˜
            clearPluginVersionCache(pluginName) {
                console.log(`Clearing version cache for plugin: ${pluginName}`);

                // æ¸…é™¤ç‰ˆæœ¬çŠ¶æ€ç¼“å­˜
                if (this.pluginVersionStates && this.pluginVersionStates[pluginName]) {
                    delete this.pluginVersionStates[pluginName];
                }

                // æ¸…é™¤å¯èƒ½çš„ç‰ˆæœ¬æ•°æ®ç¼“å­˜
                if (this.cache) {
                    const versionCacheKey = `plugin_versions_${pluginName}`;
                    if (this.cache.has(versionCacheKey)) {
                        this.cache.delete(versionCacheKey);
                        console.log(`Cleared version cache: ${versionCacheKey}`);
                    }
                }

                console.log(`Version cache cleared for plugin: ${pluginName}`);
            }

            async refreshPluginListAndScrollToPlugin(pluginName) {
                try {
                    console.log('Refreshing plugin list and scrolling to plugin:', pluginName);

                    // å½»åº•æ¸…é™¤æ‰€æœ‰ç›¸å…³ç¼“å­˜
                    this.clearAllPluginCaches();

                    // å¼ºåˆ¶åç«¯é‡æ–°æ‰«ææ’ä»¶ï¼ˆæ·»åŠ å¼ºåˆ¶åˆ·æ–°å‚æ•°ï¼‰
                    const response = await fetch(`${this.backendUrl}/nodes/installed?force_refresh=true&_t=${Date.now()}`, {
                        method: 'GET',
                        headers: {
                            'Cache-Control': 'no-cache, no-store, must-revalidate',
                            'Pragma': 'no-cache',
                            'Expires': '0'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();

                        // å¤„ç†æ’ä»¶æ•°æ®ï¼Œç¡®ä¿çŠ¶æ€æ ¼å¼æ­£ç¡®å’Œç‰ˆæœ¬ä¿¡æ¯æ˜ å°„
                        const plugins = (data.nodes || []).map(plugin => ({
                            name: plugin.name,
                            version: plugin.version || 'æœªçŸ¥',
                            date: plugin.git_date || plugin.date || 'N/A',
                            enabled: plugin.status === 'enabled',
                            url: plugin.repo_url || `https://github.com/search?q=${encodeURIComponent(plugin.name)}`,
                            hasUpdate: plugin.hasUpdate || false,
                            description: plugin.description || 'æ— æè¿°',
                            fileCount: plugin.fileCount || 0,
                            author: plugin.author || 'æœªçŸ¥',
                            status: plugin.status,
                            isLatestVersion: plugin.isLatestVersion !== false // é»˜è®¤è®¤ä¸ºæ˜¯æœ€æ–°ç‰ˆæœ¬
                        }));

                        // æ›´æ–°æ’ä»¶æ•°æ®
                        this.installedPlugins = plugins;

                        // åªæ›´æ–°æ’ä»¶åˆ—è¡¨éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ•´ä¸ªé¡µé¢
                        await this.updatePluginListOnly(plugins);

                        // æ»šåŠ¨åˆ°æŒ‡å®šæ’ä»¶
                        setTimeout(() => {
                            console.log('About to scroll to plugin:', pluginName);
                            this.scrollToPlugin(pluginName);
                        }, 300); // ç¨å¾®å»¶è¿Ÿä»¥ç¡®ä¿DOMæ›´æ–°å®Œæˆ

                        console.log('Plugin list refreshed and scrolled to plugin successfully');
                    } else {
                        console.error('Failed to refresh plugin list:', response.status);
                    }
                } catch (error) {
                    console.error('Error refreshing plugin list:', error);
                }
            }

            async updatePluginListOnly(plugins) {
                try {
                    // æŸ¥æ‰¾æ’ä»¶åˆ—è¡¨å®¹å™¨
                    const pluginListContainer = document.querySelector('#plugin-list-container');
                    if (!pluginListContainer) {
                        console.error('Plugin list container not found, falling back to full render');
                        this.renderInstalledPlugins(plugins);
                        return;
                    }

                    // ç”Ÿæˆæ’ä»¶åˆ—è¡¨HTMLï¼ˆä½¿ç”¨ç»Ÿä¸€æ¨¡æ¿ï¼‰
                    const pluginHTML = plugins.map(plugin => {
                        return this.renderPluginCard(plugin);
                    }).join('');

                    // åªæ›´æ–°æ’ä»¶åˆ—è¡¨éƒ¨åˆ†
                    pluginListContainer.innerHTML = pluginHTML;
                    console.log('Plugin list container updated without affecting scroll position');

                } catch (error) {
                    console.error('Error updating plugin list only:', error);
                    // å¦‚æœå‡ºé”™ï¼Œå›é€€åˆ°å®Œæ•´æ¸²æŸ“
                    this.renderInstalledPlugins(plugins);
                }
            }

            scrollToPlugin(pluginName) {
                try {
                    console.log('Scrolling to plugin:', pluginName);

                    // æŸ¥æ‰¾æ’ä»¶å…ƒç´ 
                    const mainContent = document.querySelector('.main-content');
                    if (!mainContent) {
                        console.error('Main content not found');
                        return;
                    }

                    // æŸ¥æ‰¾åŒ…å«æ’ä»¶åç§°çš„å…ƒç´  - ä½¿ç”¨æ›´å¹¿æ³›çš„æœç´¢
                    let targetElement = null;

                    // æ–¹æ³•1ï¼šé€šè¿‡æ’ä»¶åç§°æŸ¥æ‰¾
                    const allElements = mainContent.querySelectorAll('*');
                    for (const element of allElements) {
                        if (element.textContent && element.textContent.includes(pluginName)) {
                            // æ‰¾åˆ°åŒ…å«æ’ä»¶åç§°çš„å…ƒç´ ï¼Œå‘ä¸ŠæŸ¥æ‰¾æ’ä»¶å®¹å™¨
                            const container = element.closest('div[style*="background: rgba(255,255,255,0.05)"]') ||
                                            element.closest('div[style*="background:rgba(255,255,255,0.05)"]') ||
                                            element.closest('.plugin-item') ||
                                            element.closest('div[style*="border-left"]');
                            if (container) {
                                targetElement = container;
                                break;
                            }
                        }
                    }

                    // æ–¹æ³•2ï¼šå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°è¯•é€šè¿‡dataå±æ€§æŸ¥æ‰¾
                    if (!targetElement) {
                        targetElement = mainContent.querySelector(`[data-plugin-name="${pluginName}"]`);
                    }

                    if (targetElement) {
                        console.log('Found target element:', targetElement);

                        // è®¡ç®—æ»šåŠ¨ä½ç½®ï¼Œè®©æ’ä»¶æ˜¾ç¤ºåœ¨è§†çª—ä¸­å¤®
                        const containerRect = mainContent.getBoundingClientRect();
                        const elementRect = targetElement.getBoundingClientRect();
                        const scrollTop = mainContent.scrollTop + elementRect.top - containerRect.top - (containerRect.height / 2) + (elementRect.height / 2);

                        // å¹³æ»‘æ»šåŠ¨åˆ°ç›®æ ‡ä½ç½®
                        const targetScrollTop = Math.max(0, scrollTop);
                        console.log('Scrolling to position:', targetScrollTop);

                        mainContent.scrollTo({
                            top: targetScrollTop,
                            behavior: 'smooth'
                        });

                        // ç¡®ä¿æ»šåŠ¨å®Œæˆåå†åº”ç”¨é«˜äº®æ•ˆæœ
                        setTimeout(() => {
                            console.log('Current scroll position after scroll:', mainContent.scrollTop);
                        }, 800);

                        // æ·»åŠ é«˜äº®æ•ˆæœ
                        const originalStyle = {
                            transition: targetElement.style.transition || '',
                            boxShadow: targetElement.style.boxShadow || '',
                            border: targetElement.style.border || '',
                            backgroundColor: targetElement.style.backgroundColor || '',
                            transform: targetElement.style.transform || ''
                        };

                        // åº”ç”¨é«˜äº®æ•ˆæœ
                        targetElement.style.transition = 'all 0.5s ease';
                        targetElement.style.boxShadow = '0 0 30px rgba(0, 245, 255, 0.8), inset 0 0 20px rgba(0, 245, 255, 0.2)';
                        targetElement.style.border = '2px solid #00f5ff';
                        targetElement.style.backgroundColor = 'rgba(0, 245, 255, 0.15)';
                        targetElement.style.transform = 'scale(1.02)';

                        console.log('Applied highlight effect to plugin:', pluginName);

                        // 3ç§’åç§»é™¤é«˜äº®æ•ˆæœ
                        setTimeout(() => {
                            if (targetElement) {
                                targetElement.style.transition = originalStyle.transition;
                                targetElement.style.boxShadow = originalStyle.boxShadow;
                                targetElement.style.border = originalStyle.border;
                                targetElement.style.backgroundColor = originalStyle.backgroundColor;
                                targetElement.style.transform = originalStyle.transform;
                                console.log('Removed highlight effect from plugin:', pluginName);
                            }
                        }, 3000);

                        console.log('Scrolled to plugin successfully with highlight');
                    } else {
                        console.warn('Plugin element not found:', pluginName);
                        console.log('Available elements in main content:', mainContent.children.length);

                        // è°ƒè¯•ï¼šåˆ—å‡ºæ‰€æœ‰å¯èƒ½çš„æ’ä»¶å…ƒç´ 
                        const possibleElements = mainContent.querySelectorAll('div[style*="background"]');
                        console.log('Possible plugin elements:', possibleElements.length);
                        possibleElements.forEach((el, index) => {
                            console.log(`Element ${index}:`, el.textContent?.substring(0, 50));
                        });
                    }
                } catch (error) {
                    console.error('Error scrolling to plugin:', error);
                }
            }

            async checkComfyUIStatus() {
                try {
                    const response = await fetch(`${this.backendUrl}/comfyui/status`);
                    if (response.ok) {
                        const data = await response.json();
                        return data.status === 'running';
                    }
                } catch (error) {
                    console.error('Error checking ComfyUI status:', error);
                }
                return false;
            }

            // æµ‹è¯•å‡½æ•° - å¯ä»¥åœ¨æ§åˆ¶å°è°ƒç”¨
            testScrollToPlugin(pluginName) {
                console.log('Testing scroll to plugin:', pluginName);
                this.scrollToPlugin(pluginName);
            }

            async switchPluginVersion(version) {
                try {
                    console.log(`Switching plugin ${this.currentVersionSwitchPlugin} to version:`, version);

                    // è·å–å½“å‰ç‰ˆæœ¬
                    const currentVersion = this.getCurrentPluginVersion(this.currentVersionSwitchPlugin);

                    // å¦‚æœé€‰æ‹©çš„æ˜¯å½“å‰ç‰ˆæœ¬ï¼Œä¸éœ€è¦åˆ‡æ¢
                    if (version === currentVersion) {
                        alert(`${this.currentVersionSwitchPlugin} å·²ç»æ˜¯ç‰ˆæœ¬ ${version}ï¼Œæ— éœ€åˆ‡æ¢ã€‚`);
                        return;
                    }

                    // ç›´æ¥åˆ‡æ¢ï¼Œæ— éœ€ç¡®è®¤

                    // æ˜¾ç¤ºåˆ‡æ¢è¿›åº¦
                    const container = document.getElementById('version-switch-list');
                    if (container) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: #00f5ff;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                                <div>æ­£åœ¨åˆ‡æ¢ç‰ˆæœ¬...</div>
                                <div style="font-size: 12px; margin-top: 10px; color: #ccc;">
                                    ${this.currentVersionSwitchPlugin}: ${currentVersion} â†’ ${version}
                                </div>
                            </div>
                        `;
                    }

                    try {
                        // è°ƒç”¨çœŸå®çš„ç‰ˆæœ¬åˆ‡æ¢API
                        const response = await fetch(`${this.backendUrl}/plugins/${encodeURIComponent(this.currentVersionSwitchPlugin)}/switch-version`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ version: version })
                        });

                        if (response.ok) {
                            const result = await response.json();

                            if (result.status === 'success') {
                                // æ›´æ–°æ’ä»¶çš„å½“å‰ç‰ˆæœ¬çŠ¶æ€
                                if (!this.pluginVersionStates) {
                                    this.pluginVersionStates = {};
                                }
                                this.pluginVersionStates[this.currentVersionSwitchPlugin] = version;

                                // é‡æ–°ç”Ÿæˆç‰ˆæœ¬åˆ—è¡¨ä»¥åæ˜ æ–°çš„å½“å‰ç‰ˆæœ¬
                                const versions = await this.generatePluginVersions(this.currentVersionSwitchPlugin);

                                // é‡æ–°æ¸²æŸ“ç‰ˆæœ¬åˆ—è¡¨
                                this.renderPluginVersions(this.currentVersionSwitchPlugin, versions);

                                // å…³é—­ç‰ˆæœ¬åˆ‡æ¢å¼¹çª—
                                const modal = document.getElementById('version-switch-modal');
                                if (modal) {
                                    modal.classList.remove('show');
                                    modal.style.display = 'none';
                                }

                                // ç­‰å¾…ä¸€ä¸‹ç¡®ä¿åç«¯ç¼“å­˜å·²æ¸…é™¤
                                await new Promise(resolve => setTimeout(resolve, 800));

                                // å¼ºåˆ¶åˆ·æ–°æ’ä»¶åˆ—è¡¨ä»¥æ˜¾ç¤ºæœ€æ–°ç‰ˆæœ¬ä¿¡æ¯
                                await this.refreshPluginListAndScrollToPlugin(this.currentVersionSwitchPlugin);

                                // å»¶è¿Ÿæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼Œç¡®ä¿æ»šåŠ¨å’Œé«˜äº®æ•ˆæœå…ˆæ‰§è¡Œ
                                setTimeout(async () => {
                                    // æ£€æŸ¥ComfyUIè¿è¡ŒçŠ¶æ€å¹¶æ˜¾ç¤ºç®€åŒ–çš„æˆåŠŸæ¶ˆæ¯
                                    const comfyuiRunning = await this.checkComfyUIStatus();
                                    const restartMessage = comfyuiRunning ? ' è¯·é‡å¯ComfyUIä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚' : '';
                                    this.showNotification(`âœ… ç‰ˆæœ¬åˆ‡æ¢æˆåŠŸï¼${restartMessage}`, 'success', 'version');
                                }, 1000); // å»¶é•¿åˆ°1ç§’ï¼Œç¡®ä¿æ»šåŠ¨åŠ¨ç”»å®Œæˆ

                            } else if (result.status === 'warning') {
                                // å¤„ç†è­¦å‘Šï¼ˆå¦‚æœ‰æœªæäº¤çš„æ›´æ”¹ï¼‰- è‡ªåŠ¨å¼ºåˆ¶åˆ‡æ¢
                                {
                                    // ç”¨æˆ·ç¡®è®¤å¼ºåˆ¶åˆ‡æ¢ï¼Œé‡æ–°è°ƒç”¨APIå¹¶æ·»åŠ forceå‚æ•°
                                    const forceResponse = await fetch(`${this.backendUrl}/plugins/${encodeURIComponent(this.currentVersionSwitchPlugin)}/switch-version`, {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({ version: version, force: true })
                                    });

                                    if (forceResponse.ok) {
                                        const forceResult = await forceResponse.json();
                                        if (forceResult.status === 'success') {
                                            // æ›´æ–°çŠ¶æ€å¹¶é‡æ–°æ¸²æŸ“
                                            if (!this.pluginVersionStates) {
                                                this.pluginVersionStates = {};
                                            }
                                            this.pluginVersionStates[this.currentVersionSwitchPlugin] = version;
                                            const versions = await this.generatePluginVersions(this.currentVersionSwitchPlugin);
                                            this.renderPluginVersions(this.currentVersionSwitchPlugin, versions);

                                            // å…³é—­ç‰ˆæœ¬åˆ‡æ¢å¼¹çª—
                                            const modal = document.getElementById('version-switch-modal');
                                            if (modal) {
                                                modal.classList.remove('show');
                                                modal.style.display = 'none';
                                            }

                                            // ç­‰å¾…ä¸€ä¸‹ç¡®ä¿åç«¯ç¼“å­˜å·²æ¸…é™¤
                                            await new Promise(resolve => setTimeout(resolve, 800));

                                            // å¼ºåˆ¶åˆ·æ–°æ’ä»¶åˆ—è¡¨å¹¶ä¿æŒå½“å‰æ’ä»¶çš„å¯è§æ€§
                                            await this.refreshPluginListAndScrollToPlugin(this.currentVersionSwitchPlugin);

                                            // å»¶è¿Ÿæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼Œç¡®ä¿æ»šåŠ¨å’Œé«˜äº®æ•ˆæœå…ˆæ‰§è¡Œ
                                            setTimeout(async () => {
                                                // æ£€æŸ¥ComfyUIè¿è¡ŒçŠ¶æ€å¹¶æ˜¾ç¤ºç®€åŒ–çš„æˆåŠŸæ¶ˆæ¯
                                                const comfyuiRunning = await this.checkComfyUIStatus();
                                                const restartMessage = comfyuiRunning ? ' è¯·é‡å¯ComfyUIä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚' : '';
                                                this.showNotification(`âœ… ç‰ˆæœ¬åˆ‡æ¢æˆåŠŸï¼${restartMessage}`, 'success', 'version');
                                            }, 1000);
                                        } else {
                                            alert(`âŒ å¼ºåˆ¶åˆ‡æ¢å¤±è´¥ï¼š${forceResult.message}`);
                                        }
                                    }
                                }
                            } else {
                                // å¤„ç†é”™è¯¯
                                alert(`âŒ åˆ‡æ¢å¤±è´¥ï¼š${result.message}`);
                            }

                        } else {
                            throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                        }

                    } catch (apiError) {
                        console.error('API call failed:', apiError);
                        alert(`âŒ ç‰ˆæœ¬åˆ‡æ¢å¤±è´¥ï¼š${apiError.message}\n\nå¯èƒ½çš„åŸå› ï¼š\nâ€¢ ç½‘ç»œè¿æ¥é—®é¢˜\nâ€¢ åç«¯æœåŠ¡å¼‚å¸¸\nâ€¢ æ’ä»¶ä¸æ˜¯Gitä»“åº“\nâ€¢ Gitæ“ä½œæƒé™ä¸è¶³\n\nè¯·æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—è·å–è¯¦ç»†ä¿¡æ¯ã€‚`);
                    }

                } catch (error) {
                    console.error('Switch plugin version failed:', error);
                    alert(`ç‰ˆæœ¬åˆ‡æ¢å¤±è´¥: ${error.message}`);

                    // æ¢å¤ç‰ˆæœ¬åˆ—è¡¨æ˜¾ç¤º
                    try {
                        const versions = await this.generatePluginVersions(this.currentVersionSwitchPlugin);
                        this.renderPluginVersions(this.currentVersionSwitchPlugin, versions);
                    } catch (restoreError) {
                        console.error('Failed to restore version list:', restoreError);
                    }
                }
            }

            async uninstallPlugin(pluginName) {
                // è®¾ç½®å¸è½½æŒ‰é’®ä¸ºåŠ è½½çŠ¶æ€
                this.setPluginButtonLoading(pluginName, 'uninstallPlugin', true, {
                    loadingText: 'å¸è½½ä¸­'
                });

                try {
                    // æ˜¾ç¤ºè‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
                    const confirmed = await this.showCustomConfirm(
                    'ç¡®è®¤å¸è½½æ’ä»¶',
                    `ç¡®å®šè¦å¸è½½æ’ä»¶ "${pluginName}" å—ï¼Ÿ\n\nâš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤æ’ä»¶æ–‡ä»¶ï¼Œæ— æ³•æ’¤é”€ï¼\nå»ºè®®åœ¨å¸è½½å‰å¤‡ä»½é‡è¦æ•°æ®ã€‚`
                );

                    if (!confirmed) {
                        // å–æ¶ˆåŠ è½½çŠ¶æ€
                        this.setPluginButtonLoading(pluginName, 'uninstallPlugin', false);
                        return;
                    }
                        console.log('Uninstalling plugin:', pluginName);
                        this.showNotification(`æ­£åœ¨å¸è½½æ’ä»¶ ${pluginName}...`, 'info');

                        // è®¾ç½®è°ƒè¯•æ ‡è®°ï¼Œç”¨äºè¿½è¸ªå¸è½½çŠ¶æ€
                        window.lastUninstalledPlugin = pluginName;

                        // è°ƒç”¨çœŸå®çš„å¸è½½API
                        const response = await fetch(`${this.backendUrl}/nodes/uninstall`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                node_name: pluginName,
                                create_backup: true  // åˆ›å»ºå¤‡ä»½
                            })
                        });

                        const result = await response.json();

                        if (result.status === 'success') {
                            // ä»åˆ—è¡¨ä¸­ç§»é™¤æ’ä»¶
                            this.installedPlugins = this.installedPlugins.filter(p => p.name !== pluginName);
                            this.renderInstalledPlugins(this.installedPlugins);

                            // åŒæ­¥æ›´æ–°å¯ç”¨æ’ä»¶åˆ—è¡¨ä¸­çš„çŠ¶æ€
                            await this.syncUninstalledPluginStatus(pluginName);

                            this.showNotification(`æ’ä»¶ ${pluginName} å¸è½½æˆåŠŸ`, 'success', 'plugin');
                        } else {
                            throw new Error(result.message || 'å¸è½½å¤±è´¥');
                        }

                } catch (error) {
                    console.error('Uninstall plugin failed:', error);
                    this.showNotification(`æ’ä»¶å¸è½½å¤±è´¥: ${error.message}`, 'error');
                } finally {
                    // æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½è¦æ¸…é™¤åŠ è½½çŠ¶æ€
                    this.setPluginButtonLoading(pluginName, 'uninstallPlugin', false);
                }
            }

            async togglePlugin(pluginName, currentEnabled) {
                try {
                    console.log('Toggling plugin:', pluginName, 'current enabled:', currentEnabled);

                    const action = currentEnabled ? 'ç¦ç”¨' : 'å¯ç”¨';

                    // è®¾ç½®åˆ‡æ¢æŒ‰é’®ä¸ºåŠ è½½çŠ¶æ€
                    this.setPluginButtonLoading(pluginName, 'togglePlugin', true, {
                        loadingText: `${action}ä¸­`
                    });

                    // æ˜¾ç¤ºè‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
                    const confirmed = await this.showCustomConfirm(
                        `ç¡®è®¤${action}æ’ä»¶`,
                        `ç¡®å®šè¦${action}æ’ä»¶ "${pluginName}" å—ï¼Ÿ\n\n${action}åéœ€è¦é‡å¯ComfyUIæ‰èƒ½ç”Ÿæ•ˆã€‚`
                    );

                    if (!confirmed) {
                        // å–æ¶ˆåŠ è½½çŠ¶æ€
                        this.setPluginButtonLoading(pluginName, 'togglePlugin', false);
                        return;
                    }

                    this.showNotification(`æ­£åœ¨${action}æ’ä»¶ ${pluginName}...`, 'info');

                    // è°ƒç”¨çœŸå®çš„åˆ‡æ¢API
                    const response = await fetch(`${this.backendUrl}/nodes/toggle`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            node_name: pluginName,
                            enable: !currentEnabled  // åˆ‡æ¢çŠ¶æ€
                        })
                    });

                    const result = await response.json();

                    if (result.status === 'success') {
                        // æ›´æ–°æ’ä»¶çŠ¶æ€ï¼ˆåŒæ—¶æ›´æ–°enabledå’Œstatuså­—æ®µï¼‰
                        const plugin = this.installedPlugins.find(p => p.name === pluginName);
                        if (plugin) {
                            const newEnabledState = !currentEnabled;
                            plugin.enabled = newEnabledState;
                            plugin.status = newEnabledState ? 'enabled' : 'disabled';

                            console.log(`Plugin ${pluginName} state updated:`, {
                                enabled: plugin.enabled,
                                status: plugin.status
                            });
                        }

                        // æ¸…é™¤HTMLç¼“å­˜å¹¶é‡æ–°æ¸²æŸ“æ’ä»¶åˆ—è¡¨
                        this.cachedPluginHTML = null;
                        this.renderInstalledPlugins(this.installedPlugins);

                        this.showNotification(`æ’ä»¶ ${pluginName} ${action}æˆåŠŸ`, 'success', 'plugin');
                    } else {
                        throw new Error(result.message || `${action}å¤±è´¥`);
                    }

                } catch (error) {
                    console.error('Toggle plugin failed:', error);
                    this.showNotification(`æ’ä»¶çŠ¶æ€åˆ‡æ¢å¤±è´¥: ${error.message}`, 'error');
                } finally {
                    // æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½è¦æ¸…é™¤åŠ è½½çŠ¶æ€
                    this.setPluginButtonLoading(pluginName, 'togglePlugin', false);
                }
            }

            async installPlugin(pluginName, pluginUrl) {
                try {
                    console.log('Installing plugin:', pluginName, 'from:', pluginUrl);
                    this.showNotification(`æ­£åœ¨å®‰è£…æ’ä»¶ ${pluginName}...`, 'info');

                    // æ¨¡æ‹Ÿå®‰è£…è¿‡ç¨‹
                    await new Promise(resolve => setTimeout(resolve, 3000));

                    // æ·»åŠ åˆ°å·²å®‰è£…åˆ—è¡¨
                    const newPlugin = {
                        name: pluginName,
                        version: "1.0.0",
                        date: new Date().toISOString().split('T')[0],
                        enabled: true,
                        url: pluginUrl,
                        hasUpdate: false
                    };

                    this.installedPlugins.push(newPlugin);

                    // å¦‚æœå½“å‰åœ¨å·²å®‰è£…æ ‡ç­¾é¡µï¼Œåˆ·æ–°åˆ—è¡¨
                    if (this.currentPluginTab === 'installed') {
                        this.renderInstalledPlugins(this.installedPlugins);
                    }

                    this.showNotification(`æ’ä»¶ ${pluginName} å®‰è£…æˆåŠŸ`, 'success', 'plugin');

                } catch (error) {
                    console.error('Install plugin failed:', error);
                    this.showNotification(`æ’ä»¶å®‰è£…å¤±è´¥: ${error.message}`, 'error');
                }
            }



            filterPluginsByCategory(category) {
                if (!this.availablePlugins.length) return;

                const filtered = category ?
                    this.availablePlugins.filter(plugin => plugin.category === category) :
                    this.availablePlugins;

                this.renderAvailablePlugins(filtered);
            }

            // ç¯å¢ƒä¿¡æ¯æ£€æµ‹æ–¹æ³•
            async detectEnvironmentInfo() {
                try {
                    // æ£€æµ‹Pythonç¯å¢ƒ
                    await this.detectPythonInfo();
                    // æ£€æµ‹CUDAç¯å¢ƒ
                    await this.detectCudaInfo();
                    // æ£€æµ‹PyTorchç¯å¢ƒ
                    await this.detectPytorchInfo();
                    // æ£€æµ‹ä¾èµ–çŠ¶æ€
                    await this.detectDependencies();
                } catch (error) {
                    console.error('Environment detection failed:', error);
                }
            }

            async detectPythonInfo() {
                try {
                    const response = await fetch(`${this.backendUrl}/system/python-info`);
                    if (response.ok) {
                        const data = await response.json();
                        console.log('Python info received:', data);

                        // æ›´æ–°Pythonç‰ˆæœ¬
                        const versionElement = document.getElementById('python-version');
                        if (versionElement) {
                            versionElement.textContent = data.version || 'æœªæ£€æµ‹åˆ°';
                        }

                        // æ›´æ–°Pythonè·¯å¾„
                        const pathElement = document.getElementById('python-path');
                        if (pathElement) {
                            pathElement.textContent = data.path || 'æœªçŸ¥';
                        }

                        // æ›´æ–°è™šæ‹Ÿç¯å¢ƒçŠ¶æ€
                        const venvElement = document.getElementById('venv-status');
                        if (venvElement) {
                            const venvStatus = data.venv ? 'å·²æ¿€æ´»' : 'æœªæ¿€æ´»';
                            venvElement.textContent = venvStatus;
                            venvElement.style.color = data.venv ? '#00c864' : '#ff6b6b';
                        }
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    console.error('Failed to detect Python info:', error);
                    document.getElementById('python-version').textContent = 'æ£€æµ‹å¤±è´¥';
                    document.getElementById('python-path').textContent = 'æ£€æµ‹å¤±è´¥';
                    document.getElementById('venv-status').textContent = 'æ£€æµ‹å¤±è´¥';
                }
            }

            async detectCudaInfo() {
                try {
                    const response = await fetch(`${this.backendUrl}/system/cuda-info`);
                    if (response.ok) {
                        const data = await response.json();
                        console.log('CUDA info received:', data);

                        // æ›´æ–°CUDAç‰ˆæœ¬
                        const cudaElement = document.getElementById('cuda-version');
                        if (cudaElement) {
                            const cudaVersion = data.cuda_version || data.version || 'æœªå®‰è£…';
                            cudaElement.textContent = cudaVersion;
                            cudaElement.style.color = (cudaVersion !== 'æœªå®‰è£…' && cudaVersion !== 'æ£€æµ‹å¤±è´¥') ? '#00c864' : '#ff6b6b';
                        }

                        // æ›´æ–°GPUä¿¡æ¯
                        const gpuElement = document.getElementById('gpu-info');
                        if (gpuElement) {
                            const gpuInfo = data.gpu_name || data.name || 'æœªæ£€æµ‹åˆ°GPU';
                            gpuElement.textContent = gpuInfo;
                        }

                        // æ›´æ–°GPUå†…å­˜
                        const memoryElement = document.getElementById('gpu-memory');
                        if (memoryElement) {
                            let memoryInfo = 'æœªçŸ¥';
                            if (data.memory) {
                                if (typeof data.memory === 'string') {
                                    memoryInfo = data.memory;
                                } else {
                                    memoryInfo = `${Math.round(data.memory / 1024 / 1024)} MB`;
                                }
                            } else if (data.total_memory) {
                                memoryInfo = `${Math.round(data.total_memory / 1024 / 1024)} MB`;
                            }
                            memoryElement.textContent = memoryInfo;
                        }
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    console.error('Failed to detect CUDA info:', error);
                    document.getElementById('cuda-version').textContent = 'æ£€æµ‹å¤±è´¥';
                    document.getElementById('gpu-info').textContent = 'æ£€æµ‹å¤±è´¥';
                    document.getElementById('gpu-memory').textContent = 'æ£€æµ‹å¤±è´¥';
                }
            }

            async detectPytorchInfo() {
                try {
                    const response = await fetch(`${this.backendUrl}/system/pytorch-info`);
                    if (response.ok) {
                        const data = await response.json();
                        console.log('PyTorch info received:', data);

                        // æ›´æ–°PyTorchç‰ˆæœ¬
                        const versionElement = document.getElementById('pytorch-version');
                        if (versionElement) {
                            const version = data.version || 'æœªå®‰è£…';
                            versionElement.textContent = version;
                            versionElement.style.color = (version !== 'æœªå®‰è£…' && version !== 'æ£€æµ‹å¤±è´¥') ? '#00c864' : '#ff6b6b';
                        }

                        // æ›´æ–°CUDAæ”¯æŒçŠ¶æ€
                        const cudaSupportElement = document.getElementById('pytorch-cuda');
                        if (cudaSupportElement) {
                            const cudaAvailable = data.cuda_available || data.cuda_support;
                            const supportText = cudaAvailable ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ';
                            cudaSupportElement.textContent = supportText;
                            cudaSupportElement.style.color = cudaAvailable ? '#00c864' : '#ff6b6b';
                        }

                        // æ›´æ–°è®¾å¤‡ä¿¡æ¯
                        const deviceElement = document.getElementById('pytorch-device');
                        if (deviceElement) {
                            const device = data.device || 'æœªçŸ¥';
                            deviceElement.textContent = device;
                        }
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    console.error('Failed to detect PyTorch info:', error);
                    document.getElementById('pytorch-version').textContent = 'æ£€æµ‹å¤±è´¥';
                    document.getElementById('pytorch-cuda').textContent = 'æ£€æµ‹å¤±è´¥';
                    document.getElementById('pytorch-device').textContent = 'æ£€æµ‹å¤±è´¥';
                }
            }

            async detectDependencies() {
                try {
                    const response = await fetch(`${this.backendUrl}/system/dependencies`);
                    if (response.ok) {
                        const data = await response.json();
                        console.log('Dependencies info received:', data);

                        // æ›´æ–°æ ¸å¿ƒä¾èµ–çŠ¶æ€
                        const coreElement = document.getElementById('core-deps');
                        if (coreElement) {
                            const coreStatus = data.core_status || data.core || 'æ£€æµ‹å¤±è´¥';
                            coreElement.textContent = coreStatus;
                            coreElement.style.color = (coreStatus === 'å®Œæ•´' || coreStatus === 'ok') ? '#00c864' : '#ff6b6b';
                        }

                        // æ›´æ–°å¯é€‰ä¾èµ–çŠ¶æ€
                        const optionalElement = document.getElementById('optional-deps');
                        if (optionalElement) {
                            const optionalStatus = data.optional_status || data.optional || 'æ£€æµ‹å¤±è´¥';
                            optionalElement.textContent = optionalStatus;
                            optionalElement.style.color = (optionalStatus === 'å®Œæ•´' || optionalStatus === 'ok') ? '#00c864' : '#ff6b6b';
                        }

                        // æ›´æ–°æ•´ä½“ç¯å¢ƒçŠ¶æ€
                        const envElement = document.getElementById('env-status');
                        if (envElement) {
                            const envStatus = data.overall_status || data.status || 'æ£€æµ‹å¤±è´¥';
                            envElement.textContent = envStatus;
                            envElement.style.color = (envStatus === 'å®Œæ•´' || envStatus === 'ok') ? '#00c864' : '#ff6b6b';
                        }
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    console.error('Failed to detect dependencies:', error);
                    document.getElementById('core-deps').textContent = 'æ£€æµ‹å¤±è´¥';
                    document.getElementById('optional-deps').textContent = 'æ£€æµ‹å¤±è´¥';
                    document.getElementById('env-status').textContent = 'æ£€æµ‹å¤±è´¥';
                }
            }

            // æ£€æµ‹ç¯å¢ƒä¿¡æ¯
            async detectEnvironmentInfo() {
                console.log('Detecting environment information...');
                await this.refreshEnvironmentInfo();
            }

            // åˆ·æ–°ç¯å¢ƒä¿¡æ¯
            async refreshEnvironmentInfo() {
                console.log('Refreshing environment information...');

                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                const loadingElements = [
                    'python-version', 'python-path', 'venv-status',
                    'cuda-version', 'gpu-info', 'gpu-memory',
                    'pytorch-version', 'pytorch-cuda', 'pytorch-device',
                    'core-deps', 'optional-deps', 'env-status'
                ];

                loadingElements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = 'æ£€æµ‹ä¸­...';
                        element.style.color = '#888';
                    }
                });

                // å¹¶è¡Œæ£€æµ‹æ‰€æœ‰ç¯å¢ƒä¿¡æ¯
                try {
                    await Promise.all([
                        this.detectPythonInfo(),
                        this.detectCudaInfo(),
                        this.detectPytorchInfo(),
                        this.detectDependencies()
                    ]);
                    console.log('Environment information refreshed successfully');
                } catch (error) {
                    console.error('Failed to refresh environment information:', error);
                }
            }

            // æ‰‹åŠ¨å®‰è£…æ’ä»¶ç›¸å…³æ–¹æ³•
            initManualInstallPage() {
                console.log('Initializing manual install page');

                // åŠ è½½å®‰è£…å†å²
                this.loadInstallHistory();

                // ç»‘å®šè¡¨å•äº‹ä»¶
                this.bindManualInstallEvents();
            }

            bindManualInstallEvents() {
                // URLè¾“å…¥æ¡†å®æ—¶éªŒè¯
                const urlInput = document.getElementById('plugin-url');
                if (urlInput) {
                    urlInput.addEventListener('input', () => {
                        this.validateUrlInput();
                    });
                }


            }

            validateUrlInput() {
                const urlInput = document.getElementById('plugin-url');
                const hint = document.getElementById('url-hint');

                if (!urlInput || !hint) return;

                const url = urlInput.value.trim();
                if (!url) {
                    hint.innerHTML = '<i class="fas fa-lightbulb"></i><span>æ”¯æŒGitHubã€GitLabã€Giteeç­‰Gitä»“åº“åœ°å€</span>';
                    hint.style.color = 'var(--text-secondary)';
                    return;
                }

                if (this.isValidGitUrl(url)) {
                    hint.innerHTML = '<i class="fas fa-check-circle"></i><span>åœ°å€æ ¼å¼æ­£ç¡®</span>';
                    hint.style.color = '#28a745';
                } else {
                    hint.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>è¯·è¾“å…¥æœ‰æ•ˆçš„Gitä»“åº“åœ°å€</span>';
                    hint.style.color = '#dc3545';
                }
            }

            isValidGitUrl(url) {
                // æ”¯æŒçš„Gitä»“åº“åœ°å€æ ¼å¼
                const gitUrlPatterns = [
                    /^https:\/\/github\.com\/[\w\-\.]+\/[\w\-\.]+(?:\.git)?$/,
                    /^https:\/\/gitlab\.com\/[\w\-\.]+\/[\w\-\.]+(?:\.git)?$/,
                    /^https:\/\/gitee\.com\/[\w\-\.]+\/[\w\-\.]+(?:\.git)?$/,
                    /^https:\/\/[\w\-\.]+\/[\w\-\.]+\/[\w\-\.]+(?:\.git)?$/,
                    /^git@[\w\-\.]+:[\w\-\.]+\/[\w\-\.]+(?:\.git)?$/
                ];

                return gitUrlPatterns.some(pattern => pattern.test(url));
            }

            extractRepoName(url) {
                try {
                    // ä»URLä¸­æå–ä»“åº“åç§°
                    const match = url.match(/\/([^\/]+?)(?:\.git)?(?:\/)?$/);
                    return match ? match[1] : null;
                } catch (error) {
                    return null;
                }
            }

            async validatePluginUrl() {
                const urlInput = document.getElementById('plugin-url');
                const validateBtn = document.querySelector('.validate-btn');

                if (!urlInput || !validateBtn) return;

                const url = urlInput.value.trim();
                if (!url) {
                    this.showNotification('è¯·è¾“å…¥Gitä»“åº“åœ°å€', 'warning');
                    return;
                }

                // è®¾ç½®éªŒè¯ä¸­çŠ¶æ€
                const originalIcon = validateBtn.innerHTML;
                validateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                validateBtn.disabled = true;

                try {
                    // éªŒè¯URLå¯è®¿é—®æ€§
                    const response = await fetch(`${this.backendUrl}/plugins/validate-url`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ url })
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.showNotification('ä»“åº“åœ°å€éªŒè¯æˆåŠŸ', 'success');


                    } else {
                        this.showNotification(`éªŒè¯å¤±è´¥: ${result.message}`, 'error');
                    }
                } catch (error) {
                    console.error('URL validation failed:', error);
                    this.showNotification('éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                } finally {
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    validateBtn.innerHTML = originalIcon;
                    validateBtn.disabled = false;
                }
            }

            async installManualPlugin() {
                const urlInput = document.getElementById('plugin-url');
                const forceInstall = document.getElementById('force-install');
                const shallowClone = document.getElementById('shallow-clone');

                if (!urlInput) return;

                const url = urlInput.value.trim();
                if (!url) {
                    this.showNotification('è¯·è¾“å…¥Gitä»“åº“åœ°å€', 'warning');
                    return;
                }

                if (!this.isValidGitUrl(url)) {
                    this.showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„Gitä»“åº“åœ°å€', 'error');
                    return;
                }

                const pluginName = this.extractRepoName(url);
                if (!pluginName) {
                    this.showNotification('æ— æ³•ä»URLä¸­æå–æ’ä»¶åç§°', 'error');
                    return;
                }

                // æ˜¾ç¤ºå®‰è£…è¿›åº¦
                this.showInstallProgress();

                const installOptions = {
                    url: url,
                    name: pluginName,
                    force: forceInstall?.checked || false,
                    shallow: shallowClone?.checked || true
                };

                try {
                    await this.performManualInstall(installOptions);
                } catch (error) {
                    console.error('Manual install failed:', error);
                    this.hideInstallProgress();
                    this.showNotification(`å®‰è£…å¤±è´¥: ${error.message}`, 'error');
                }
            }

            showInstallProgress() {
                const progressContainer = document.getElementById('manual-install-progress');
                const formContainer = document.querySelector('.manual-install-form');

                if (progressContainer) {
                    progressContainer.style.display = 'block';
                }
                if (formContainer) {
                    formContainer.style.opacity = '0.5';
                    formContainer.style.pointerEvents = 'none';
                }

                // é‡ç½®è¿›åº¦
                this.updateInstallProgress(0, 'å‡†å¤‡å®‰è£…...', '');
            }

            hideInstallProgress() {
                const progressContainer = document.getElementById('manual-install-progress');
                const formContainer = document.querySelector('.manual-install-form');

                if (progressContainer) {
                    progressContainer.style.display = 'none';
                }
                if (formContainer) {
                    formContainer.style.opacity = '1';
                    formContainer.style.pointerEvents = 'auto';
                }
            }

            updateInstallProgress(percentage, text, details) {
                const progressFill = document.getElementById('manual-progress-fill');
                const progressText = document.getElementById('progress-text');
                const progressDetails = document.getElementById('progress-details');
                const progressPercentage = document.getElementById('progress-percentage');

                if (progressFill) {
                    progressFill.style.width = `${percentage}%`;
                }
                if (progressText) {
                    progressText.textContent = text;
                }
                if (progressDetails) {
                    progressDetails.textContent = details;
                }
                if (progressPercentage) {
                    progressPercentage.textContent = `${Math.round(percentage)}%`;
                }
            }

            async performManualInstall(options) {
                this.currentInstallProcess = {
                    cancelled: false,
                    options: options
                };

                try {
                    this.updateInstallProgress(10, 'æ­£åœ¨éªŒè¯ä»“åº“...', `æ£€æŸ¥ ${options.url}`);

                    // è°ƒç”¨åç«¯APIè¿›è¡Œå®‰è£…
                    const response = await fetch(`${this.backendUrl}/plugins/install-manual`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(options)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    // å¤„ç†æµå¼å“åº”
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();

                    while (true) {
                        if (this.currentInstallProcess?.cancelled) {
                            throw new Error('å®‰è£…å·²å–æ¶ˆ');
                        }

                        const { done, value } = await reader.read();
                        if (done) break;

                        const chunk = decoder.decode(value);
                        const lines = chunk.split('\n').filter(line => line.trim());

                        for (const line of lines) {
                            try {
                                const data = JSON.parse(line);
                                this.handleInstallProgress(data);
                            } catch (e) {
                                // å¿½ç•¥éJSONè¡Œ
                            }
                        }
                    }

                    // å®‰è£…å®Œæˆ
                    this.updateInstallProgress(100, 'å®‰è£…å®Œæˆ', 'æ’ä»¶å·²æˆåŠŸå®‰è£…');
                    this.showNotification(`æ’ä»¶ ${options.name} å®‰è£…æˆåŠŸ`, 'success', 'plugin');

                    // æ·»åŠ åˆ°å®‰è£…å†å²
                    this.addToInstallHistory({
                        name: options.name,
                        url: options.url,
                        status: 'success',
                        time: new Date().toLocaleString()
                    });

                    // æ¸…ç©ºè¡¨å•
                    setTimeout(() => {
                        this.clearManualInstallForm();
                        this.hideInstallProgress();

                        // å¦‚æœå½“å‰åœ¨å·²å®‰è£…æ ‡ç­¾é¡µï¼Œåˆ·æ–°åˆ—è¡¨
                        if (this.currentPluginTab === 'installed') {
                            this.needRefreshInstalledTab = true;
                        }
                    }, 2000);

                } catch (error) {
                    console.error('Manual install failed:', error);

                    // æ·»åŠ åˆ°å®‰è£…å†å²ï¼ˆå¤±è´¥è®°å½•ï¼‰
                    this.addToInstallHistory({
                        name: options.name,
                        url: options.url,
                        status: 'failed',
                        time: new Date().toLocaleString(),
                        error: error.message
                    });

                    throw error;
                } finally {
                    this.currentInstallProcess = null;
                }
            }

            handleInstallProgress(data) {
                if (data.progress !== undefined) {
                    this.updateInstallProgress(
                        data.progress,
                        data.message || 'æ­£åœ¨å®‰è£…...',
                        data.details || ''
                    );
                }

                if (data.error) {
                    throw new Error(data.error);
                }
            }

            cancelManualInstall() {
                if (this.currentInstallProcess) {
                    this.currentInstallProcess.cancelled = true;
                    this.showNotification('æ­£åœ¨å–æ¶ˆå®‰è£…...', 'info');

                    // æ·»åŠ å–æ¶ˆè®°å½•åˆ°å†å²
                    this.addToInstallHistory({
                        name: this.currentInstallProcess.options.name,
                        url: this.currentInstallProcess.options.url,
                        status: 'cancelled',
                        time: new Date().toLocaleString()
                    });

                    setTimeout(() => {
                        this.hideInstallProgress();
                        this.showNotification('å®‰è£…å·²å–æ¶ˆ', 'warning');
                    }, 1000);
                }
            }

            clearManualInstallForm() {
                const urlInput = document.getElementById('plugin-url');
                const forceInstall = document.getElementById('force-install');
                const shallowClone = document.getElementById('shallow-clone');
                const hint = document.getElementById('url-hint');

                if (urlInput) urlInput.value = '';
                if (forceInstall) forceInstall.checked = false;
                if (shallowClone) shallowClone.checked = true;

                if (hint) {
                    hint.innerHTML = '<i class="fas fa-lightbulb"></i><span>æ”¯æŒGitHubã€GitLabã€Giteeç­‰Gitä»“åº“åœ°å€</span>';
                    hint.style.color = 'var(--text-secondary)';
                }
            }

            loadInstallHistory() {
                try {
                    const history = JSON.parse(localStorage.getItem('manual-install-history') || '[]');
                    this.renderInstallHistory(history);
                } catch (error) {
                    console.error('Failed to load install history:', error);
                    this.renderInstallHistory([]);
                }
            }

            addToInstallHistory(record) {
                try {
                    const history = JSON.parse(localStorage.getItem('manual-install-history') || '[]');
                    history.unshift(record); // æ·»åŠ åˆ°å¼€å¤´

                    // é™åˆ¶å†å²è®°å½•æ•°é‡
                    if (history.length > 50) {
                        history.splice(50);
                    }

                    localStorage.setItem('manual-install-history', JSON.stringify(history));
                    this.renderInstallHistory(history);
                } catch (error) {
                    console.error('Failed to save install history:', error);
                }
            }

            renderInstallHistory(history) {
                const container = document.getElementById('install-history-list');
                if (!container) return;

                if (!history || history.length === 0) {
                    container.innerHTML = `
                        <div class="history-empty">
                            <i class="fas fa-clock"></i>
                            <span>æš‚æ— å®‰è£…å†å²</span>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = history.map(record => `
                    <div class="history-item">
                        <div class="history-header">
                            <div class="history-name">${this.escapeHtml(record.name)}</div>
                            <div class="history-status ${record.status}">${this.getStatusText(record.status)}</div>
                        </div>
                        <div class="history-details">
                            <div class="history-url" title="${this.escapeHtml(record.url)}">${this.escapeHtml(record.url)}</div>
                            <div class="history-time">${record.time}</div>
                        </div>
                        ${record.error ? `<div style="color: #dc3545; font-size: 11px; margin-top: 5px;">${this.escapeHtml(record.error)}</div>` : ''}
                    </div>
                `).join('');
            }

            getStatusText(status) {
                const statusMap = {
                    'success': 'æˆåŠŸ',
                    'failed': 'å¤±è´¥',
                    'cancelled': 'å·²å–æ¶ˆ',
                    'installing': 'å®‰è£…ä¸­'
                };
                return statusMap[status] || status;
            }
        }

        // åˆå§‹åŒ–å¯åŠ¨å™¨
        let launcherInstance;

        // å¯åŠ¨å™¨æ›´æ–°å‡½æ•°
        async function checkLauncherUpdate() {
            const btn = document.getElementById('check-launcher-update-btn');
            const originalText = btn.innerHTML;
            
            try {
                // æ˜¾ç¤ºæ£€æŸ¥ä¸­çŠ¶æ€
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ£€æŸ¥ä¸­...';
                btn.disabled = true;
                
                // è·å–åç«¯URL
                const backendUrl = await window.electronAPI.getBackendUrl();
                const response = await fetch(`${backendUrl}/launcher/version-info`);
                const versionInfo = await response.json();
                
                if (versionInfo.error) {
                    throw new Error(versionInfo.error);
                }
                
                // æ›´æ–°é¡µé¢ä¸­çš„ç‰ˆæœ¬ä¿¡æ¯
                updateVersionDisplay(versionInfo);
                
                if (versionInfo.has_update) {
                    showUpdateNotification(versionInfo);
                } else if (versionInfo.manual_update) {
                    // æ˜¾ç¤ºæ‰‹åŠ¨æ›´æ–°æŒ‡å¼•
                    showManualUpdateDialog(versionInfo);
                } else {
                    showMessage('å¯åŠ¨å™¨å·²æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼', 'success');
                }
                
            } catch (error) {
                console.error('æ£€æŸ¥æ›´æ–°å¤±è´¥:', error);
                showMessage('æ£€æŸ¥æ›´æ–°å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function showManualUpdateDialog(versionInfo) {
            const modal = document.createElement('div');
            modal.className = 'custom-confirm-modal';
            modal.innerHTML = `
                <div class="custom-confirm-content">
                    <div class="custom-confirm-header">
                        <h3>ğŸš€ å¯åŠ¨å™¨æ›´æ–°</h3>
                    </div>
                    <div class="custom-confirm-body">
                        <p><strong>å½“å‰ç‰ˆæœ¬:</strong> v${versionInfo.current_version}</p>
                        <div style="margin: 15px 0; padding: 15px; background: rgba(0, 245, 255, 0.1); border-radius: 8px; border-left: 3px solid var(--neon-glow);">
                            <p style="margin: 0; color: var(--neon-glow);"><strong>â„¹ï¸ æ›´æ–°è¯´æ˜</strong></p>
                            <p style="margin: 5px 0 0 0;">${versionInfo.message}</p>
                        </div>
                        <p><strong>å¦‚éœ€è·å–æœ€æ–°ç‰ˆæœ¬ï¼Œè¯·ï¼š</strong></p>
                        <ul style="text-align: left; margin: 10px 0; color: var(--text-secondary);">
                            <li>è®¿é—®é¡¹ç›®GitHubé¡µé¢æŸ¥çœ‹æœ€æ–°Release</li>
                            <li>ä¸‹è½½launcheræ›´æ–°åŒ…</li>
                            <li>æ›¿æ¢å½“å‰launcherç›®å½•</li>
                            <li>é‡å¯å¯åŠ¨å™¨åº”ç”¨</li>
                        </ul>
                    </div>
                    <div class="custom-confirm-actions">
                        <button class="custom-confirm-btn confirm" onclick="openGitHubPage('${versionInfo.github_url}')">
                            <i class="fas fa-external-link-alt"></i> è®¿é—®GitHub
                        </button>
                        <button class="custom-confirm-btn cancel" onclick="document.body.removeChild(this.closest('.custom-confirm-modal'))">
                            çŸ¥é“äº†
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function openGitHubPage(url) {
            // ä½¿ç”¨Electron APIæ‰“å¼€å¤–éƒ¨é“¾æ¥
            if (window.electronAPI && window.electronAPI.openExternal) {
                window.electronAPI.openExternal(url);
            } else {
                // å¤‡ç”¨æ–¹æ¡ˆ
                window.open(url, '_blank');
            }
            
            // å…³é—­å¼¹çª—
            const modal = document.querySelector('.custom-confirm-modal');
            if (modal) document.body.removeChild(modal);
        }

        function updateVersionDisplay(versionInfo) {
            // æ›´æ–°å½“å‰ç‰ˆæœ¬æ˜¾ç¤º
            const versionElements = document.querySelectorAll('.info-value');
            if (versionElements.length >= 2) {
                versionElements[0].textContent = `v${versionInfo.current_version}`;
                
                // ä¼˜å…ˆæ˜¾ç¤ºGitHub Releaseå‘å¸ƒæ—¶é—´ï¼Œå¦åˆ™æ˜¾ç¤ºæœ¬åœ°æ—¶é—´
                if (versionInfo.published_at) {
                    const date = new Date(versionInfo.published_at);
                    const formattedDate = date.toLocaleDateString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit', 
                        day: '2-digit'
                    });
                    versionElements[1].textContent = formattedDate;
                } else if (versionInfo.lastModified) {
                    versionElements[1].textContent = versionInfo.lastModified;
                }
            }
        }

        function showUpdateNotification(versionInfo) {
            const modal = document.createElement('div');
            modal.className = 'custom-confirm-modal';
            modal.innerHTML = `
                <div class="custom-confirm-content">
                    <div class="custom-confirm-header">
                        <h3>ğŸš€ å‘ç°å¯åŠ¨å™¨æ–°ç‰ˆæœ¬</h3>
                    </div>
                    <div class="custom-confirm-body">
                        <p><strong>å½“å‰ç‰ˆæœ¬:</strong> v${versionInfo.current_version}</p>
                        <p><strong>æœ€æ–°ç‰ˆæœ¬:</strong> v${versionInfo.latest_version}</p>
                        <p><strong>æ›´æ–°å¤§å°:</strong> ${formatFileSize(versionInfo.size)}</p>
                        <div style="margin-top: 15px;">
                            <strong>æ›´æ–°å†…å®¹:</strong>
                            <div style="max-height: 200px; overflow-y: auto; margin-top: 5px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 5px;">
                                ${formatChangelog(versionInfo.changelog)}
                            </div>
                        </div>
                    </div>
                    <div class="custom-confirm-actions">
                        <button class="custom-confirm-btn confirm" onclick="startLauncherUpdate('${versionInfo.download_url}', this.closest('.custom-confirm-modal'))">
                            <i class="fas fa-download"></i> ç«‹å³æ›´æ–°
                        </button>
                        <button class="custom-confirm-btn cancel" onclick="document.body.removeChild(this.closest('.custom-confirm-modal'))">
                            ç¨åæé†’
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function startLauncherUpdate(downloadUrl, modal) {
            try {
                // å…³é—­æ›´æ–°é€šçŸ¥å¼¹çª—
                document.body.removeChild(modal);
                
                // æ˜¾ç¤ºä¸‹è½½è¿›åº¦
                showUpdateProgress();
                
                const response = await fetch('/launcher/download-update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ download_url: downloadUrl })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    updateProgressText('ä¸‹è½½å®Œæˆï¼Œæ­£åœ¨å®‰è£…...');
                    
                    // ä½¿ç”¨Electron APIå®‰è£…æ›´æ–°
                    if (window.electronAPI && window.electronAPI.installLauncherUpdate) {
                        const installResult = await window.electronAPI.installLauncherUpdate(result.file_path);
                        
                        if (installResult.success) {
                            updateProgressText('å®‰è£…æˆåŠŸï¼Œ3ç§’åé‡å¯...');
                            setTimeout(() => {
                                window.electronAPI.restartLauncher();
                            }, 3000);
                        } else {
                            throw new Error(installResult.error);
                        }
                    } else {
                        throw new Error('Electron APIä¸å¯ç”¨ï¼Œè¯·æ‰‹åŠ¨é‡å¯å¯åŠ¨å™¨');
                    }
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                console.error('æ›´æ–°å¤±è´¥:', error);
                hideUpdateProgress();
                showMessage(`æ›´æ–°å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function showUpdateProgress() {
            const progress = document.createElement('div');
            progress.id = 'launcher-update-progress';
            progress.className = 'custom-confirm-modal';
            progress.innerHTML = `
                <div class="custom-confirm-content">
                    <div class="custom-confirm-header">
                        <h3>æ­£åœ¨æ›´æ–°å¯åŠ¨å™¨</h3>
                    </div>
                    <div class="custom-confirm-body">
                        <div style="text-align: center; padding: 20px;">
                            <div class="loading-spinner" style="margin: 0 auto 20px;"></div>
                            <p id="update-progress-text">æ­£åœ¨ä¸‹è½½æ›´æ–°åŒ…...</p>
                            <p style="color: #666; font-size: 0.9rem;">è¯·å‹¿å…³é—­å¯åŠ¨å™¨</p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(progress);
        }

        function updateProgressText(text) {
            const textEl = document.getElementById('update-progress-text');
            if (textEl) textEl.textContent = text;
        }

        function hideUpdateProgress() {
            const progress = document.getElementById('launcher-update-progress');
            if (progress) document.body.removeChild(progress);
        }

        function formatFileSize(bytes) {
            if (!bytes) return 'æœªçŸ¥';
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function formatChangelog(changelog) {
            if (!changelog) return 'æš‚æ— æ›´æ–°è¯´æ˜';
            
            // ç®€å•å¤„ç†markdownæ ¼å¼
            return changelog
                .replace(/^### /gm, '<strong>')
                .replace(/^## /gm, '<strong>')
                .replace(/^# /gm, '<strong>')
                .replace(/\n- /g, '<br>â€¢ ')
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        }

        function showMessage(message, type = 'info') {
            // ç®€å•çš„æ¶ˆæ¯æç¤º
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                color: white;
                border-radius: 5px;
                z-index: 10000;
                font-size: 14px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }

        // éŸ³æ•ˆç®¡ç†å™¨åˆå§‹åŒ–
        let audioManager;

        // éŸ³æ•ˆç»‘å®šå‡½æ•°
        function bindAudioToButtons() {
            if (!audioManager) return;

            // ä¸ºæ‰€æœ‰æŒ‰é’®ç»‘å®šç‚¹å‡»éŸ³æ•ˆ
            document.querySelectorAll('button').forEach(button => {
                if (!button.hasAttribute('data-audio-bound')) {
                    button.addEventListener('click', (e) => {
                        const buttonType = getButtonType(button);
                        audioManager.play(buttonType);
                    });

                    // æ‚¬åœéŸ³æ•ˆï¼ˆå¦‚æœå¯ç”¨ï¼‰
                    button.addEventListener('mouseenter', () => {
                        if (audioManager.settings.hoverSounds) {
                            audioManager.play('hover');
                        }
                    });

                    button.setAttribute('data-audio-bound', 'true');
                }
            });

            // ä½¿ç”¨äº‹ä»¶å§”æ‰˜ä¸ºåŠ¨æ€æ·»åŠ çš„æŒ‰é’®ç»‘å®šéŸ³æ•ˆ
            document.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' && !e.target.hasAttribute('data-audio-bound')) {
                    const buttonType = getButtonType(e.target);
                    audioManager.play(buttonType);
                }
            });

            // æ ‡ç­¾é¡µéŸ³æ•ˆç°åœ¨é€šè¿‡ getButtonType() å‡½æ•°å’Œé€šç”¨æŒ‰é’®ç»‘å®šå¤„ç†
            // ä¸éœ€è¦å•ç‹¬çš„æ ‡ç­¾é¡µéŸ³æ•ˆç»‘å®šé€»è¾‘

            // ä¸ºè¾“å…¥æ¡†ç»‘å®šè¾“å…¥éŸ³æ•ˆ
            document.querySelectorAll('input[type="text"], input[type="search"], textarea').forEach(input => {
                if (!input.hasAttribute('data-audio-bound')) {
                    input.addEventListener('focus', () => {
                        audioManager.play('input');
                    });
                    input.setAttribute('data-audio-bound', 'true');
                }
            });
        }

        // ä¼˜åŒ–çš„æŒ‰é’®éŸ³æ•ˆè¯†åˆ« - åŸºäºéŸ³æ•ˆæ–¹æ¡ˆè§„åˆ’
        function getButtonType(button) {
            const classList = button.classList;
            const id = button.id;
            const text = button.textContent.toLowerCase();

            // æ ‡ç­¾é¡µæŒ‰é’® - ä½¿ç”¨æ ‡ç­¾é¡µåˆ‡æ¢éŸ³æ•ˆï¼ˆå¯¼èˆªæ ‡ç­¾éŸ³æ•ˆï¼‰
            if (classList.contains('tab-btn') || classList.contains('plugin-tab-btn') ||
                classList.contains('version-tab-btn') || classList.contains('environment-tab-btn') ||
                button.hasAttribute('data-tab') || button.hasAttribute('data-type')) {
                return 'tab-switch';
            }

            // ComfyUIç³»ç»Ÿçº§æ“ä½œ - ä½¿ç”¨ä¸“ç”¨ç³»ç»ŸéŸ³æ•ˆ
            if (id === 'start-comfyui-btn' || (text.includes('å¯åŠ¨') && text.includes('comfyui'))) {
                return 'startup';
            }
            if (id === 'stop-comfyui-btn' || (text.includes('åœæ­¢') && text.includes('comfyui')) ||
                (text.includes('å…³é—­') && text.includes('comfyui'))) {
                return 'shutdown';
            }

            // è­¦å‘Šç±»æŒ‰é’® - ä½¿ç”¨è­¦å‘ŠéŸ³æ•ˆ
            if (classList.contains('danger') || classList.contains('warning') || classList.contains('uninstall') ||
                text.includes('åˆ é™¤') || text.includes('å¸è½½') || text.includes('æ¸…ç©º') ||
                text.includes('é‡ç½®') || text.includes('å–æ¶ˆ') || text.includes('ç§»é™¤')) {
                return 'warning';
            }

            // ä¸»è¦æ“ä½œæŒ‰é’® - ä½¿ç”¨ä¸»è¦æŒ‰é’®éŸ³æ•ˆï¼ˆæŒ‰é’®ç§‘æŠ€éŸ³æ•ˆï¼‰
            if (classList.contains('primary') || classList.contains('btn-primary') ||
                classList.contains('main-btn') || classList.contains('important') ||
                classList.contains('install') || classList.contains('update') ||
                text.includes('ä¿å­˜') || text.includes('ç¡®è®¤') || text.includes('å®‰è£…') ||
                text.includes('æ›´æ–°') || text.includes('ä¸‹è½½') || text.includes('åº”ç”¨') ||
                text.includes('åˆ‡æ¢ç‰ˆæœ¬') || text.includes('åˆ‡æ¢åˆ°')) {
                return 'click-primary';
            }

            // å¼€å…³åˆ‡æ¢æŒ‰é’® - ä½¿ç”¨åˆ‡æ¢éŸ³æ•ˆï¼ˆå¯¼èˆªæ ‡ç­¾éŸ³æ•ˆï¼‰
            if (classList.contains('toggle') || classList.contains('switch') ||
                text.includes('å¯ç”¨') || text.includes('ç¦ç”¨') || text.includes('å¼€å¯') || text.includes('å…³é—­')) {
                return 'switch';
            }

            // ç¡®è®¤å¯¹è¯æ¡†æŒ‰é’® - ä½¿ç”¨ç¡®è®¤éŸ³æ•ˆï¼ˆå¯¼èˆªæ ‡ç­¾éŸ³æ•ˆï¼‰
            if (classList.contains('confirm') || text.includes('ç¡®å®š') || text.includes('å¥½çš„')) {
                return 'confirm';
            }

            // é»˜è®¤ä½¿ç”¨æ™®é€šç‚¹å‡»éŸ³æ•ˆï¼ˆæŒ‰é’®ç§‘æŠ€éŸ³æ•ˆï¼‰
            return 'click';
        }

        // åˆå§‹åŒ–å£°éŸ³è®¾ç½®
        function initAudioSettings() {
            // åˆå§‹åŒ–èƒŒæ™¯è§†é¢‘å£°éŸ³è®¾ç½®
            initVideoAudioSettings();

            if (!audioManager) return;

            // åŠ è½½ä¿å­˜çš„è®¾ç½®
            const settings = audioManager.getSettings();

            // è®¾ç½®UIæ§ä»¶çš„å€¼
            const audioEnabled = document.getElementById('audio-enabled');
            const audioVolume = document.getElementById('audio-volume');
            const volumeDisplay = document.getElementById('volume-display');

            if (audioEnabled) {
                audioEnabled.checked = settings.enabled;
                audioEnabled.addEventListener('change', (e) => {
                    audioManager.setEnabled(e.target.checked);
                    if (e.target.checked) {
                        audioManager.play('click');
                    }
                });
            }

            if (audioVolume && volumeDisplay) {
                audioVolume.value = settings.volume * 100;
                volumeDisplay.textContent = Math.round(settings.volume * 100) + '%';
                audioVolume.addEventListener('input', (e) => {
                    const volume = e.target.value / 100;
                    audioManager.setVolume(volume);
                    volumeDisplay.textContent = e.target.value + '%';
                    // æ’­æ”¾é¢„è§ˆéŸ³æ•ˆ
                    audioManager.play('click', volume);
                });
            }

        }

        // åˆå§‹åŒ–èƒŒæ™¯è§†é¢‘å£°éŸ³è®¾ç½®
        function initVideoAudioSettings() {
            const videoAudioEnabled = document.getElementById('video-audio-enabled');
            const videoVolume = document.getElementById('video-volume');
            const videoVolumeDisplay = document.getElementById('video-volume-display');
            const backgroundVideo = document.getElementById('backgroundVideo');

            // ä»localStorageåŠ è½½è®¾ç½®
            const savedVideoAudioEnabled = localStorage.getItem('video-audio-enabled') === 'true';
            const savedVideoVolume = parseFloat(localStorage.getItem('video-volume')) || 0.3;

            // è®¾ç½®åˆå§‹å€¼
            if (videoAudioEnabled) {
                videoAudioEnabled.checked = savedVideoAudioEnabled;
                videoAudioEnabled.addEventListener('change', (e) => {
                    const enabled = e.target.checked;
                    localStorage.setItem('video-audio-enabled', enabled);
                    if (backgroundVideo) {
                        backgroundVideo.muted = !enabled;
                        if (enabled) {
                            backgroundVideo.volume = savedVideoVolume;
                        }
                    }
                    // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
                    if (window.audioManager) {
                        audioManager.play('click');
                    }
                });
            }

            if (videoVolume && videoVolumeDisplay) {
                videoVolume.value = savedVideoVolume * 100;
                videoVolumeDisplay.textContent = Math.round(savedVideoVolume * 100) + '%';
                videoVolume.addEventListener('input', (e) => {
                    const volume = e.target.value / 100;
                    localStorage.setItem('video-volume', volume);
                    videoVolumeDisplay.textContent = e.target.value + '%';
                    if (backgroundVideo && !backgroundVideo.muted) {
                        backgroundVideo.volume = volume;
                    }
                });
            }

            // åº”ç”¨åˆå§‹è®¾ç½®åˆ°è§†é¢‘å…ƒç´ 
            if (backgroundVideo) {
                backgroundVideo.muted = !savedVideoAudioEnabled;
                if (savedVideoAudioEnabled) {
                    backgroundVideo.volume = savedVideoVolume;
                }
            }
        }

        // éŸ³æ•ˆé¢„è§ˆå‡½æ•°
        function previewSound(soundName) {
            if (audioManager) {
                audioManager.preview(soundName);
            }
        }

        // è‡ªåŠ¨æ›´æ–°å¯åŠ¨å™¨ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤º
        async function updateLauncherVersionInfo() {
            try {
                // è·å–åç«¯URL
                const backendUrl = await window.electronAPI.getBackendUrl();
                const response = await fetch(`${backendUrl}/launcher/get-version`);
                const versionData = await response.json();
                
                if (versionData.status === 'success') {
                    // æ›´æ–°è®¾ç½®é¡µé¢ä¸­çš„ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤º
                    const versionElements = document.querySelectorAll('.info-value');
                    if (versionElements.length >= 2) {
                        versionElements[0].textContent = `v${versionData.version}`;
                        versionElements[1].textContent = versionData.lastModified;
                    }
                    
                    console.log('å¯åŠ¨å™¨ç‰ˆæœ¬ä¿¡æ¯å·²æ›´æ–°:', versionData);
                }
            } catch (error) {
                console.warn('è·å–å¯åŠ¨å™¨ç‰ˆæœ¬ä¿¡æ¯å¤±è´¥:', error);
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMContentLoaded - initializing launcher...');

            // åˆå§‹åŒ–éŸ³æ•ˆç®¡ç†å™¨
            if (window.audioManager) {
                audioManager = window.audioManager;
                console.log('Audio manager initialized');

                // ç»‘å®šæŒ‰é’®éŸ³æ•ˆ
                setTimeout(() => {
                    bindAudioToButtons();
                    initAudioSettings();
                    console.log('Audio effects bound to buttons');
                }, 100);

                // æ’­æ”¾å¯åŠ¨éŸ³æ•ˆ
                setTimeout(() => audioManager.play('startup'), 500);
            }

            launcherInstance = new AIVisionLauncher();
            console.log('launcherInstance created:', !!launcherInstance);
            console.log('showPluginVersions method exists:', !!(launcherInstance && launcherInstance.showPluginVersions));

            // åˆå§‹åŒ–å¯åŠ¨å™¨ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤º
            setTimeout(async () => {
                await updateLauncherVersionInfo();
                // åŒæ—¶è·å–GitHub Releaseä¿¡æ¯æ¥æ›´æ–°æ˜¾ç¤º
                try {
                    const backendUrl = await window.electronAPI.getBackendUrl();
                    const response = await fetch(`${backendUrl}/launcher/version-info`);
                    const versionInfo = await response.json();
                    if (versionInfo.published_at) {
                        updateVersionDisplay(versionInfo);
                    }
                } catch (error) {
                    console.warn('è·å–GitHubç‰ˆæœ¬ä¿¡æ¯å¤±è´¥:', error);
                }
            }, 1000);

            // æ·»åŠ çª—å£å…³é—­éŸ³æ•ˆ
            window.addEventListener('beforeunload', () => {
                if (window.audioManager) {
                    audioManager.play('app-close');
                }
            });

            // åˆå§‹åŒ–æ—¶ç«‹å³åŠ è½½GPUä¿¡æ¯
            if (launcherInstance && launcherInstance.loadRealGPUInfo) {
                setTimeout(() => {
                    launcherInstance.loadRealGPUInfo();
                }, 1000); // å»¶è¿Ÿ1ç§’ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨
            }



            // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
            loadSavedTheme();

            // åˆå§‹åŒ–å¼€æœºè‡ªå¯åŠ¨è®¾ç½®
            initAutoStartSetting();

            // ä¸ºå¼€æœºè‡ªå¯åŠ¨å¤é€‰æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            const autoStartCheckbox = document.getElementById('autoStart');
            if (autoStartCheckbox) {
                autoStartCheckbox.addEventListener('change', toggleAutoStart);
            }

            // åˆå§‹åŒ–å‘½ä»¤é¢„è§ˆï¼ˆä»…åœ¨å¯åŠ¨è®¾ç½®å…ƒç´ å­˜åœ¨æ—¶ï¼‰
            if (document.getElementById('listen-ip')) {
                launcherInstance.updateCommandPreview();
            }
            console.log('Launcher initialization complete');
        });

        // å…¨å±€å‡½æ•°ï¼Œä¾›HTMLæŒ‰é’®è°ƒç”¨
        function saveSettings() {
            if (launcherInstance) {
                launcherInstance.saveSettings();
            }
        }

        function applyAndLaunch() {
            if (launcherInstance) {
                launcherInstance.applyAndLaunch();
            }
        }

        // ç‰ˆæœ¬åˆ‡æ¢å…¨å±€å‡½æ•°
        function switchToVersion(commit, versionHash) {
            console.log('Global switchToVersion called:', commit, versionHash);
            if (launcherInstance && launcherInstance.switchToVersion) {
                launcherInstance.switchToVersion(commit, versionHash);
            } else {
                console.error('launcherInstance or switchToVersion method not available');
            }
        }

        // ç¯å¢ƒé…ç½®é¡µé¢ç›¸å…³å‡½æ•°
        function switchEnvironmentTab(tabId) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            const allTabs = document.querySelectorAll('.environment-tab-content');
            allTabs.forEach(tab => tab.classList.remove('active'));

            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾æŒ‰é’®çš„activeç±»
            const allButtons = document.querySelectorAll('.environment-tab-btn');
            allButtons.forEach(btn => btn.classList.remove('active'));

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // æ¿€æ´»å¯¹åº”çš„æ ‡ç­¾æŒ‰é’®
            const selectedButton = document.querySelector(`[onclick="switchEnvironmentTab('${tabId}')"]`);
            if (selectedButton) {
                selectedButton.classList.add('active');
            }

            // æ ¹æ®æ ‡ç­¾é¡µç±»å‹æ‰§è¡Œç›¸åº”çš„åˆå§‹åŒ–
            if (tabId === 'env-info' && launcherInstance) {
                // å¦‚æœåˆ‡æ¢åˆ°ç¯å¢ƒä¿¡æ¯æ ‡ç­¾é¡µï¼Œè‡ªåŠ¨æ£€æµ‹ç¯å¢ƒä¿¡æ¯
                launcherInstance.detectEnvironmentInfo();
            } else if (tabId === 'env-terminal') {
                // å¦‚æœåˆ‡æ¢åˆ°ç»ˆç«¯æ ‡ç­¾é¡µï¼ŒåŠ è½½ç»ˆç«¯ä¿¡æ¯
                loadTerminalInfo();
            }
        }



        function returnToMainPage() {
            // åˆ‡æ¢åˆ°ä¸»é¡µæ ‡ç­¾
            if (launcherInstance && launcherInstance.switchTab) {
                launcherInstance.switchTab('home');
            } else {
                console.error('launcherInstance or switchTab method not available');
            }
        }

        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        function switchTheme(theme) {
            // æ›´æ–°ä¸»é¢˜æŒ‰é’®çŠ¶æ€
            const themeBtns = document.querySelectorAll('.theme-btn');
            themeBtns.forEach(btn => btn.classList.remove('active'));

            const activeBtn = document.querySelector(`[data-theme="${theme}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }

            // åº”ç”¨ä¸»é¢˜é¢œè‰²
            const root = document.documentElement;
            switch(theme) {
                case 'blue':
                    root.style.setProperty('--neon-glow', '#00f5ff');
                    root.style.setProperty('--accent-cyan', '#00f5ff');
                    break;
                case 'green':
                    root.style.setProperty('--neon-glow', '#00ff88');
                    root.style.setProperty('--accent-cyan', '#00ff88');
                    break;
                case 'purple':
                    root.style.setProperty('--neon-glow', '#8a2be2');
                    root.style.setProperty('--accent-cyan', '#8a2be2');
                    break;
                case 'red':
                    root.style.setProperty('--neon-glow', '#ff4757');
                    root.style.setProperty('--accent-cyan', '#ff4757');
                    break;
            }

            // ä¿å­˜ä¸»é¢˜è®¾ç½®åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('selectedTheme', theme);

            console.log(`Theme switched to: ${theme}`);
        }

        // é¡µé¢åŠ è½½æ—¶æ¢å¤ä¿å­˜çš„ä¸»é¢˜
        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('selectedTheme') || 'blue';
            switchTheme(savedTheme);
        }

        // å¼€æœºè‡ªå¯åŠ¨åŠŸèƒ½
        async function initAutoStartSetting() {
            try {
                const result = await window.electronAPI.getAutoStart();
                if (result.success) {
                    const autoStartCheckbox = document.getElementById('autoStart');
                    if (autoStartCheckbox) {
                        autoStartCheckbox.checked = result.enabled;
                        console.log('å¼€æœºè‡ªå¯åŠ¨çŠ¶æ€:', result.enabled);
                    }
                }
            } catch (error) {
                console.error('è·å–å¼€æœºè‡ªå¯åŠ¨çŠ¶æ€å¤±è´¥:', error);
            }
        }

        async function toggleAutoStart(event) {
            try {
                const enabled = event.target.checked;
                console.log('è®¾ç½®å¼€æœºè‡ªå¯åŠ¨:', enabled);

                const result = await window.electronAPI.setAutoStart(enabled);

                if (result.success) {
                    console.log('å¼€æœºè‡ªå¯åŠ¨è®¾ç½®æˆåŠŸ:', enabled);

                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    await window.electronAPI.showMessageBox({
                        type: 'info',
                        title: 'è®¾ç½®æˆåŠŸ',
                        message: enabled ? 'å·²å¯ç”¨å¼€æœºè‡ªå¯åŠ¨' : 'å·²ç¦ç”¨å¼€æœºè‡ªå¯åŠ¨',
                        buttons: ['ç¡®å®š']
                    });
                } else {
                    throw new Error(result.error || 'è®¾ç½®å¼€æœºè‡ªå¯åŠ¨å¤±è´¥');
                }
            } catch (error) {
                console.error('è®¾ç½®å¼€æœºè‡ªå¯åŠ¨å¤±è´¥:', error);

                // æ¢å¤å¤é€‰æ¡†çŠ¶æ€
                event.target.checked = !event.target.checked;

                // æ˜¾ç¤ºé”™è¯¯æç¤º
                await window.electronAPI.showMessageBox({
                    type: 'error',
                    title: 'è®¾ç½®å¤±è´¥',
                    message: 'è®¾ç½®å¼€æœºè‡ªå¯åŠ¨å¤±è´¥',
                    detail: error.message,
                    buttons: ['ç¡®å®š']
                });
            }
        }

        // åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼
        async function createDesktopShortcut(event) {
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                const button = event ? event.target.closest('.action-btn') : document.querySelector('.action-btn[onclick*="createDesktopShortcut"]');
                if (!button) {
                    throw new Error('æ— æ³•æ‰¾åˆ°æŒ‰é’®å…ƒç´ ');
                }
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> åˆ›å»ºä¸­...';
                button.disabled = true;

                // è°ƒç”¨Electron APIåˆ›å»ºå¿«æ·æ–¹å¼
                const result = await window.electronAPI.createDesktopShortcut();

                if (result.success) {
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    await window.electronAPI.showMessageBox({
                        type: 'info',
                        title: 'æˆåŠŸ',
                        message: result.message,
                        detail: `å¿«æ·æ–¹å¼å·²åˆ›å»ºåˆ°æ¡Œé¢ï¼š\n${result.path || ''}`,
                        buttons: ['ç¡®å®š']
                    });

                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    button.innerHTML = '<i class="fas fa-check"></i> åˆ›å»ºæˆåŠŸ';
                    button.style.background = 'linear-gradient(45deg, #00ff88, #00cc6a)';

                    // 3ç§’åæ¢å¤åŸçŠ¶
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.disabled = false;
                        button.style.background = '';
                    }, 3000);

                } else {
                    throw new Error(result.error || 'åˆ›å»ºå¿«æ·æ–¹å¼å¤±è´¥');
                }

            } catch (error) {
                console.error('åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼å¤±è´¥:', error);

                // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                await window.electronAPI.showMessageBox({
                    type: 'error',
                    title: 'é”™è¯¯',
                    message: 'åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼å¤±è´¥',
                    detail: error.message,
                    buttons: ['ç¡®å®š']
                });

                // æ¢å¤æŒ‰é’®çŠ¶æ€
                const button = event ? event.target.closest('.action-btn') : document.querySelector('.action-btn[onclick*="createDesktopShortcut"]');
                if (button) {
                    button.innerHTML = '<i class="fas fa-plus"></i> åˆ›å»ºå¿«æ·æ–¹å¼';
                    button.disabled = false;
                }
            }
        }



        // è·å–ç»ˆç«¯ç¯å¢ƒä¿¡æ¯
        async function loadTerminalInfo() {
            try {
                const response = await fetch('http://127.0.0.1:8404/terminal/info');
                if (response.ok) {
                    const data = await response.json();
                    console.log('Terminal info received:', data);

                    // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
                    if (data.error) {
                        throw new Error(data.error);
                    }

                    // æ›´æ–°å·¥ä½œç›®å½•
                    const cwdElement = document.getElementById('terminal-cwd');
                    if (cwdElement) {
                        cwdElement.textContent = data.work_dir || 'æœªçŸ¥';
                    }

                    // æ›´æ–°è™šæ‹Ÿç¯å¢ƒä¿¡æ¯
                    const venvElement = document.getElementById('terminal-venv');
                    if (venvElement) {
                        const venvInfo = data.venv_exists ?
                            `${data.env_type} (${data.venv_path})` :
                            'æœªæ£€æµ‹åˆ°è™šæ‹Ÿç¯å¢ƒ';
                        venvElement.textContent = venvInfo;
                        venvElement.style.color = data.venv_exists ? '#00ff88' : '#ff6b6b';
                    }

                    // æ›´æ–°Pythonç‰ˆæœ¬
                    const pythonElement = document.getElementById('terminal-python');
                    if (pythonElement) {
                        pythonElement.textContent = data.python_version || 'æœªçŸ¥';
                    }

                    // æ›´æ–°ç¯å¢ƒçŠ¶æ€
                    const statusElement = document.getElementById('terminal-status');
                    if (statusElement) {
                        statusElement.textContent = data.env_status || 'æœªçŸ¥';
                        statusElement.style.color = data.env_status === 'å·²æ¿€æ´»' ? '#00ff88' : '#ff6b6b';
                    }

                    // æ›´æ–°ç»ˆç«¯æç¤ºç¬¦
                    const promptElement = document.getElementById('terminal-prompt');
                    if (promptElement) {
                        promptElement.textContent = data.prompt || 'cmd> ';
                    }

                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('Failed to load terminal info:', error);
                // ä½¿ç”¨ä¾¿æºåŒ…çš„å®é™…ç¯å¢ƒä¿¡æ¯ä½œä¸ºå¤‡ç”¨
                loadTerminalInfoFallback();
            }
        }

        // å¤‡ç”¨çš„ç»ˆç«¯ä¿¡æ¯åŠ è½½ï¼ˆä½¿ç”¨ä¾¿æºåŒ…çš„å®é™…è·¯å¾„ï¼‰
        function loadTerminalInfoFallback() {
            console.log('Using fallback terminal info...');

            // åŸºäºä¾¿æºåŒ…çš„å®é™…è·¯å¾„è®¾ç½®ç¯å¢ƒä¿¡æ¯
            const portableRoot = 'D:\\AI\\ComfyUI-AI-Vision\\Portable\\ComfyUI-AI-Vision-Portable';
            const venvPath = portableRoot + '\\venv';

            // æ›´æ–°å·¥ä½œç›®å½•
            const cwdElement = document.getElementById('terminal-cwd');
            if (cwdElement) {
                cwdElement.textContent = portableRoot;
            }

            // æ›´æ–°è™šæ‹Ÿç¯å¢ƒä¿¡æ¯
            const venvElement = document.getElementById('terminal-venv');
            if (venvElement) {
                venvElement.textContent = `venv (${venvPath})`;
                venvElement.style.color = '#00ff88';
            }

            // æ›´æ–°Pythonç‰ˆæœ¬
            const pythonElement = document.getElementById('terminal-python');
            if (pythonElement) {
                pythonElement.textContent = 'Python 3.12.9';
            }

            // æ›´æ–°ç¯å¢ƒçŠ¶æ€
            const statusElement = document.getElementById('terminal-status');
            if (statusElement) {
                statusElement.textContent = 'å·²æ¿€æ´»';
                statusElement.style.color = '#00ff88';
            }

            // æ›´æ–°ç»ˆç«¯æç¤ºç¬¦
            const promptElement = document.getElementById('terminal-prompt');
            if (promptElement) {
                promptElement.textContent = 'venv> ';
            }
        }

        function clearTerminal() {
            const terminalOutput = document.getElementById('terminal-output');
            if (terminalOutput) {
                terminalOutput.innerHTML = '';
            }
        }


        function handleTerminalInput(event) {
            if (event.key === 'Enter') {
                const input = event.target;
                const command = input.value.trim();

                if (command) {
                    // æ·»åŠ å‘½ä»¤åˆ°è¾“å‡º
                    const terminalOutput = document.getElementById('terminal-output');
                    if (terminalOutput) {
                        // è·å–å½“å‰æç¤ºç¬¦
                        const promptElement = document.getElementById('terminal-prompt');
                        const currentPrompt = promptElement ? promptElement.textContent : 'cmd> ';

                        const commandLine = document.createElement('div');
                        commandLine.innerHTML = `<span style="color: #00ff88;">${currentPrompt}</span><span style="color: #00ff00;">${command}</span>`;
                        commandLine.style.marginBottom = '8px';
                        terminalOutput.appendChild(commandLine);

                        // æ‰§è¡Œå‘½ä»¤
                        executeTerminalCommand(command, terminalOutput);

                        // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
                        scrollTerminalToBottom(terminalOutput);
                    }

                    // æ¸…ç©ºè¾“å…¥
                    input.value = '';
                }
            }
        }

        function scrollTerminalToBottom(terminalOutput) {
            // å¹³æ»‘æ»šåŠ¨åˆ°åº•éƒ¨
            setTimeout(() => {
                terminalOutput.scrollTop = terminalOutput.scrollHeight;
            }, 100);
        }

        async function executeTerminalCommand(command, outputElement) {
            // æ˜¾ç¤ºæ‰§è¡Œä¸­çŠ¶æ€
            const executingDiv = document.createElement('div');
            executingDiv.style.color = '#888';
            executingDiv.innerHTML = `<i class="fas fa-spinner fa-spin"></i> æ‰§è¡Œä¸­...`;
            outputElement.appendChild(executingDiv);

            try {
                // è°ƒç”¨åç«¯APIæ‰§è¡Œå‘½ä»¤
                const response = await fetch('http://127.0.0.1:8404/terminal/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ command: command })
                });

                // ç§»é™¤æ‰§è¡Œä¸­çŠ¶æ€
                outputElement.removeChild(executingDiv);

                if (response.ok) {
                    const data = await response.json();

                    // å¤„ç†æ¸…ç©ºå‘½ä»¤
                    if (data.clear) {
                        outputElement.innerHTML = '';
                        return;
                    }

                    // æ˜¾ç¤ºå‘½ä»¤è¾“å‡º
                    const result = document.createElement('div');
                    result.style.marginBottom = '12px';
                    result.style.lineHeight = '1.4';

                    if (data.error) {
                        result.style.color = '#ff6b6b';
                        result.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${data.error}`;
                    } else if (data.output) {
                        result.style.color = '#cccccc';
                        result.style.whiteSpace = 'pre-wrap';
                        result.textContent = data.output;
                    }

                    outputElement.appendChild(result);

                    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
                    scrollTerminalToBottom(outputElement);
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

            } catch (error) {
                // ç§»é™¤æ‰§è¡Œä¸­çŠ¶æ€
                if (executingDiv.parentNode) {
                    outputElement.removeChild(executingDiv);
                }

                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                const errorDiv = document.createElement('div');
                errorDiv.style.color = '#ff6b6b';
                errorDiv.style.marginBottom = '12px';
                errorDiv.style.lineHeight = '1.4';
                errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> å‘½ä»¤æ‰§è¡Œå¤±è´¥: ${error.message}`;
                outputElement.appendChild(errorDiv);

                // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
                scrollTerminalToBottom(outputElement);
            }
        }

        function resetToDefault() {
            if (launcherInstance) {
                launcherInstance.resetToDefault();
            }
        }

        // æ’ä»¶ç®¡ç†å…¨å±€å‡½æ•°
        function updatePlugin(pluginName) {
            console.log('updatePlugin called for:', pluginName);
            if (launcherInstance && launcherInstance.updatePlugin) {
                launcherInstance.updatePlugin(pluginName);
            } else {
                setTimeout(() => {
                    if (launcherInstance && launcherInstance.updatePlugin) {
                        launcherInstance.updatePlugin(pluginName);
                    }
                }, 100);
            }
        }

        function showPluginVersions(pluginName) {
            console.log('Global showPluginVersions called for:', pluginName);
            console.log('launcherInstance available:', !!launcherInstance);

            if (launcherInstance && launcherInstance.showPluginVersions) {
                launcherInstance.showPluginVersions(pluginName);
            } else {
                console.warn('launcherInstance not ready, retrying in 100ms...');
                setTimeout(() => {
                    if (launcherInstance && launcherInstance.showPluginVersions) {
                        launcherInstance.showPluginVersions(pluginName);
                    } else {
                        console.error('launcherInstance still not available after retry');
                        alert('å¯åŠ¨å™¨å°šæœªå®Œå…¨åŠ è½½ï¼Œè¯·ç¨åå†è¯•');
                    }
                }, 100);
            }
        }





        function installPlugin(pluginName, pluginUrl) {
            if (launcherInstance) {
                launcherInstance.installPlugin(pluginName, pluginUrl);
            }
        }

        function switchPluginVersion(version) {
            if (launcherInstance) {
                launcherInstance.switchPluginVersion(version);
            }
        }

        function closeVersionSwitchModal() {
            logger.debug('closeVersionSwitchModal called');
            const modal = document.getElementById('version-switch-modal');
            if (modal) {
                modal.classList.remove('show');
                // æ·»åŠ æ·¡å‡ºåŠ¨ç”»
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
                logger.debug('Modal closed successfully');
            } else {
                logger.error('Modal not found');
            }
            if (launcherInstance) {
                // æ¢å¤åˆ‡æ¢æŒ‰é’®çŠ¶æ€
                if (launcherInstance.currentVersionSwitchPlugin) {
                    launcherInstance.setPluginButtonLoading(
                        launcherInstance.currentVersionSwitchPlugin,
                        'showPluginVersions',
                        false
                    );
                }
                launcherInstance.currentVersionSwitchPlugin = null;
            }
        }

        // æ·»åŠ é”®ç›˜æ”¯æŒ
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('version-switch-modal');
                if (modal && modal.classList.contains('show')) {
                    closeVersionSwitchModal();
                }
            }
        });

        // ç‰ˆæœ¬ç®¡ç†å…¨å±€å‡½æ•°


        function cancelVersionSwitch() {
            document.getElementById('version-confirm-modal').classList.remove('show');
            if (launcherInstance) {
                launcherInstance.pendingVersionSwitch = null;
            }
        }

        function confirmVersionSwitch() {
            document.getElementById('version-confirm-modal').classList.remove('show');
            if (launcherInstance && launcherInstance.pendingVersionSwitch) {
                launcherInstance.performVersionSwitch(launcherInstance.pendingVersionSwitch);
            }
        }



        function switchPluginVersion(version) {
            if (launcherInstance && launcherInstance.switchPluginVersion) {
                launcherInstance.switchPluginVersion(version);
            } else {
                setTimeout(() => {
                    if (launcherInstance && launcherInstance.switchPluginVersion) {
                        launcherInstance.switchPluginVersion(version);
                    }
                }, 100);
            }
        }



        function togglePlugin(pluginName, currentEnabled) {
            // å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¸ƒå°”å€¼
            const isEnabled = currentEnabled === 'true' || currentEnabled === true;

            if (launcherInstance && launcherInstance.togglePlugin) {
                launcherInstance.togglePlugin(pluginName, isEnabled);
            } else {
                setTimeout(() => {
                    if (launcherInstance && launcherInstance.togglePlugin) {
                        launcherInstance.togglePlugin(pluginName, isEnabled);
                    }
                }, 100);
            }
        }

        function uninstallPlugin(pluginName) {
            if (launcherInstance && launcherInstance.uninstallPlugin) {
                launcherInstance.uninstallPlugin(pluginName);
            } else {
                setTimeout(() => {
                    if (launcherInstance && launcherInstance.uninstallPlugin) {
                        launcherInstance.uninstallPlugin(pluginName);
                    }
                }, 100);
            }
        }



        function installPlugin(pluginName, pluginUrl) {
            if (launcherInstance && launcherInstance.installPlugin) {
                launcherInstance.installPlugin(pluginName, pluginUrl);
            } else {
                setTimeout(() => {
                    if (launcherInstance && launcherInstance.installPlugin) {
                        launcherInstance.installPlugin(pluginName, pluginUrl);
                    }
                }, 100);
            }
        }

        // æ‰‹åŠ¨å®‰è£…æ’ä»¶å…¨å±€å‡½æ•°
        function validatePluginUrl() {
            if (launcherInstance && launcherInstance.validatePluginUrl) {
                launcherInstance.validatePluginUrl();
            }
        }

        function installManualPlugin() {
            if (launcherInstance && launcherInstance.installManualPlugin) {
                launcherInstance.installManualPlugin();
            }
        }

        function cancelManualInstall() {
            if (launcherInstance && launcherInstance.cancelManualInstall) {
                launcherInstance.cancelManualInstall();
            }
        }

        function clearManualInstallForm() {
            if (launcherInstance && launcherInstance.clearManualInstallForm) {
                launcherInstance.clearManualInstallForm();
            }
        }

        function refreshEnvironmentInfo() {
            if (launcherInstance && launcherInstance.refreshEnvironmentInfo) {
                launcherInstance.refreshEnvironmentInfo();
            }
        }


    </script>

    <!-- ç‰ˆæœ¬ç®¡ç†ä¼˜åŒ–è„šæœ¬ -->
    <script src="version-management-optimized.js"></script>
    <script src="version-management-integration.js"></script>
</body>
</html>